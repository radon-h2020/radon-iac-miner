[{"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjI1OTM5Njk2", "author_name": "Ben Kincaid", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "fixed minor indentation issue on playbooks/manage-users/manage-atlassian-users.yml (#301)", "sha": "3fa317760961ec34ee01a42198aba3124880b44d", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/3fa317760961ec34ee01a42198aba3124880b44d", "parents": ["abc45ed164c9b2ac57eea0edda8515673a9942ea"], "files": [{"sha": "f13e7a1e8ea7e5539cdf194ceb02cc01c3792acc", "filename": "playbooks/manage-users/manage-atlassian-users.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/3fa317760961ec34ee01a42198aba3124880b44d/playbooks/manage-users/manage-atlassian-users.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/3fa317760961ec34ee01a42198aba3124880b44d/playbooks/manage-users/manage-atlassian-users.yml", "status": "modified", "patch": "@@ -4,7 +4,7 @@\n   tasks:    \n     - import_role:\n         name: user-management/manage-atlassian-users\n-    when:\n-     - atlassian is defined\n-     - atlassian.user is defined\n+      when:\n+       - atlassian is defined\n+       - atlassian.user is defined\n   no_log: true"}]}, {"repo": "oVirt/ovirt-ansible-hosted-engine-setup", "author_id": "MDQ6VXNlcjkzNzg2MA==", "author_name": "Sandro Bonazzola", "committer_id": "MDQ6VXNlcjgxNTYwNTQ=", "committer_name": "Simone Tiraboschi", "committer_email": "stirabos@redhat.com", "message": "Fix rhbz1654697 (#108)\n\n* Fix rhbz1654697\r\n\r\nFix rhbz1654697 by not using dmidecode on ppc64le where /proc/device-tree/system-id provides the UUID.\r\nFor reference: https://github.com/oVirt/vdsm/blob/master/lib/vdsm/ppc64HardwareInfo.py\r\n\r\nBug-Url: https://bugzilla.redhat.com/show_bug.cgi?id=1654697\r\nSigned-off-by: Sandro Bonazzola <sbonazzo@redhat.com>", "sha": "9267118f456de46b9059e76b63bc85c18fcab5dd", "url": "https://api.github.com/repos/oVirt/ovirt-ansible-hosted-engine-setup/commits/9267118f456de46b9059e76b63bc85c18fcab5dd", "parents": ["5e928a1d9fef3c90a45df7c55ed5f0e7207218f3"], "files": [{"sha": "d9ce212b5700f5a8e9542da0c15b33d317d8c700", "filename": "tasks/bootstrap_local_vm/02_create_local_vm.yml", "previous_filename": null, "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/oVirt/ovirt-ansible-hosted-engine-setup/blob/9267118f456de46b9059e76b63bc85c18fcab5dd/tasks/bootstrap_local_vm/02_create_local_vm.yml", "raw_url": "https://github.com/oVirt/ovirt-ansible-hosted-engine-setup/raw/9267118f456de46b9059e76b63bc85c18fcab5dd/tasks/bootstrap_local_vm/02_create_local_vm.yml", "status": "modified", "patch": "@@ -15,7 +15,13 @@\n   - name: Initial tasks\n     block:\n       - name: Get host unique id\n-        shell: if [ -e /etc/vdsm/vdsm.id ]; then cat /etc/vdsm/vdsm.id; else dmidecode -s system-uuid; fi;\n+        shell: |\n+          if [ -e /etc/vdsm/vdsm.id ];\n+          then cat /etc/vdsm/vdsm.id;\n+          elif [ -e /proc/device-tree/system-id ];\n+          then cat /proc/device-tree/system-id; #ppc64le\n+          else dmidecode -s system-uuid;\n+          fi;\n         environment: \"{{ he_cmd_lang }}\"\n         changed_when: true\n         register: unique_id_out"}]}, {"repo": "zzet/ansible-rbenv-role", "author_id": "MDQ6VXNlcjE5NDI2NTky", "author_name": "Olivier Locard", "committer_id": "MDQ6VXNlcjE5NDI2NTky", "committer_name": "Olivier Locard", "committer_email": "olivier.locard@deveryware.com", "message": "Fixes #102: conditional arg item[0] turn into item.", "sha": "aeacfa6fc88d74e57f7d146faba150d4cbd72a74", "url": "https://api.github.com/repos/zzet/ansible-rbenv-role/commits/aeacfa6fc88d74e57f7d146faba150d4cbd72a74", "parents": ["14f8179b0a17de7b657ea7520bc0d50ea528c0e5"], "files": [{"sha": "6e211093df033eefa2ee90f90840eb2f67b2912f", "filename": "tasks/user_install.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/zzet/ansible-rbenv-role/blob/aeacfa6fc88d74e57f7d146faba150d4cbd72a74/tasks/user_install.yml", "raw_url": "https://github.com/zzet/ansible-rbenv-role/raw/aeacfa6fc88d74e57f7d146faba150d4cbd72a74/tasks/user_install.yml", "status": "modified", "patch": "@@ -97,7 +97,7 @@\n     - \"{{ rbenv.rubies }}\"\n   when:\n     - item[0].rc == 0\n-    - item[0].item[0] == item[1]\n+    - item[0].item == item[1]\n     - item[2].version not in item[0].stdout_lines\n   ignore_errors: yes\n   environment: \"{{ item[2].env | default({}) | combine({ 'TMPDIR': rbenv_tmpdir }) }}\""}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #104", "sha": "8d4956fcd97d78caa57ee3e5a36e9c44a23ab2a6", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/8d4956fcd97d78caa57ee3e5a36e9c44a23ab2a6", "parents": ["f0a45b0db41256bef05f1487a7b5a2a37d6afe65"], "files": [{"sha": "29acfcd4e933ef9cf1f6be2f1a72eab211bde693", "filename": "tasks/install-docker.yml", "previous_filename": null, "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8d4956fcd97d78caa57ee3e5a36e9c44a23ab2a6/tasks/install-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8d4956fcd97d78caa57ee3e5a36e9c44a23ab2a6/tasks/install-docker.yml", "status": "modified", "patch": "@@ -25,7 +25,8 @@\n     - _docker_packages is not defined\n     - (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version | int < 9) or\n       (_docker_os_dist == \"Fedora\" and _docker_os_dist_major_version | int < 27) or\n-      (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version | int < 16)\n+      (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version | int < 16) or\n+      (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version | int == 17) \n \n - name: Ensure Docker CE is installed\n   become: true"}]}, {"repo": "nginxinc/ansible-role-nginx", "author_id": "MDQ6VXNlcjE0OTQ2NjM=", "author_name": "Thomas Boros", "committer_id": "MDQ6VXNlcjE1NjU0NTI1", "committer_name": "Alessandro Fael Garcia", "committer_email": "alessfg@hotmail.com", "message": "Fix module installation when with plus (#162)\n\n* Fixes module installation when nginx_delete_license is set to true with plus license", "sha": "af54ab1401717161aa37783bf2ed71f0d28d714d", "url": "https://api.github.com/repos/nginxinc/ansible-role-nginx/commits/af54ab1401717161aa37783bf2ed71f0d28d714d", "parents": ["c6c133674e6249e75f9a3b8026e5850b3625a0cd"], "files": [{"sha": "c091124ca8862b9b641f15a95217f74c8df82158", "filename": "tasks/plus/install-plus.yml", "previous_filename": null, "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/af54ab1401717161aa37783bf2ed71f0d28d714d/tasks/plus/install-plus.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/af54ab1401717161aa37783bf2ed71f0d28d714d/tasks/plus/install-plus.yml", "status": "modified", "patch": "@@ -21,6 +21,3 @@\n     name: nginx-plus\n     state: present\n   notify: \"(Handler: All OSs) Start NGINX\"\n-\n-- import_tasks: delete-license.yml\n-  when: nginx_delete_license | bool"}, {"sha": "8d893f8fb22d99897c0c39927f45e45eccd29ae7", "filename": "tasks/main.yml", "previous_filename": null, "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/af54ab1401717161aa37783bf2ed71f0d28d714d/tasks/main.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/af54ab1401717161aa37783bf2ed71f0d28d714d/tasks/main.yml", "status": "modified", "patch": "@@ -55,6 +55,9 @@\n     - import_tasks: conf/debug-output.yml\n       when: nginx_debug_output | bool\n \n+    - import_tasks: plus/delete-license.yml\n+      when: nginx_type == \"plus\" and nginx_delete_license\n+\n   when: nginx_enable | bool\n \n - import_tasks: amplify/install-amplify.yml"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #98", "sha": "2568137b9931352a3e3857a26c3abe8bd1911377", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/2568137b9931352a3e3857a26c3abe8bd1911377", "parents": ["9b692f6b104a6e4a7d1a8fd5985b2aa6610d94e7"], "files": [{"sha": "26130481db38163f4ed7b45509fc386d0bd3a421", "filename": "tasks/setup-repository-RedHat.yml", "previous_filename": null, "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2568137b9931352a3e3857a26c3abe8bd1911377/tasks/setup-repository-RedHat.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2568137b9931352a3e3857a26c3abe8bd1911377/tasks/setup-repository-RedHat.yml", "status": "modified", "patch": "@@ -35,4 +35,6 @@\n       tags:\n         - skip_ansible_lint\n \n-  when: _docker_os_dist_major_version == '7'\n\\ No newline at end of file\n+  when: \n+    - docker_network_access | bool\n+    - _docker_os_dist_major_version == '7'\n\\ No newline at end of file"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #23: Idempotence for Solr 5/6 installation.", "sha": "4eeee9eb934aff6fd8af0b32e75128c884379f1d", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/4eeee9eb934aff6fd8af0b32e75128c884379f1d", "parents": ["691072e55614ca50cb35b7bd0a2772dddea7fc24"], "files": [{"sha": "a042017296dec7408a87eea601b185e985557656", "filename": "tasks/install.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/4eeee9eb934aff6fd8af0b32e75128c884379f1d/tasks/install.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/4eeee9eb934aff6fd8af0b32e75128c884379f1d/tasks/install.yml", "status": "modified", "patch": "@@ -12,3 +12,4 @@\n     -u {{ solr_user }}\n     -s {{ solr_service_name }}\n     -p {{ solr_port }}\n+    creates={{ solr_install_dir }}/solr/bin/solr"}]}, {"repo": "iiab/iiab", "author_id": "MDQ6VXNlcjI0NTg5MDc=", "author_name": "A Holt", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #584 from jvonau/upgrades\n\nguard against losing dns lookups when the machine has alreay been con\u2026\r\n\r\ncloses #581", "sha": "0b3a5eab5db4b7b99845b9847ee5ac211ca9c693", "url": "https://api.github.com/repos/iiab/iiab/commits/0b3a5eab5db4b7b99845b9847ee5ac211ca9c693", "parents": ["2c33b757a1a020b84413ae1f7935f9e272f21964", "4c18f746dca7c7eeb3eaeee40c7a8088814be2d6"], "files": [{"sha": "bfeaa7c1675a3f45de5133f2de8e8af9fa697aa7", "filename": "roles/network/tasks/named.yml", "previous_filename": null, "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/iiab/iiab/blob/0b3a5eab5db4b7b99845b9847ee5ac211ca9c693/roles/network/tasks/named.yml", "raw_url": "https://github.com/iiab/iiab/raw/0b3a5eab5db4b7b99845b9847ee5ac211ca9c693/roles/network/tasks/named.yml", "status": "modified", "patch": "@@ -90,3 +90,6 @@\n   file: path=/etc/{{ apache_config_dir }}/dns-jail.conf\n         state=absent\n   when: not is_debuntu and not dns_jail_enabled\n+\n+- name: Start named after copying files\n+  service: name={{ dns_service }} state=started"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #33: Workaround Solr init script breaking systemd-based service usage.", "sha": "71d5d56d024765b5d7f83c76fe2c54978a446674", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/71d5d56d024765b5d7f83c76fe2c54978a446674", "parents": ["c06d9b4285042fe4fd36c653b6f9236b83dccc43"], "files": [{"sha": "c75f0e59c3dc56a281b1257cb644ff6d7a233b21", "filename": "tasks/install.yml", "previous_filename": null, "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/71d5d56d024765b5d7f83c76fe2c54978a446674/tasks/install.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/71d5d56d024765b5d7f83c76fe2c54978a446674/tasks/install.yml", "status": "modified", "patch": "@@ -13,3 +13,9 @@\n     -s {{ solr_service_name }}\n     -p {{ solr_port }}\n     creates={{ solr_install_dir }}/solr/bin/solr\n+  register: solr_install_script_result\n+\n+# Workaround for bug https://github.com/ansible/ansible-modules-core/issues/915.\n+- name: Ensure solr is stopped (RHEL 7 workaround).\n+  command: service {{ solr_service_name }} stop\n+  when: (ansible_os_family == 'RedHat') and (ansible_distribution_version.split(\".\")[0] == '7') and (solr_install_script_result.changed)"}]}, {"repo": "m4rcu5nl/ansible-role-zerotier", "author_id": "MDQ6VXNlcjEzMDgxNjYz", "author_name": "Marcus Meurs", "committer_id": "MDQ6VXNlcjEzMDgxNjYz", "committer_name": "Marcus Meurs", "committer_email": "marcusmeurs@gmail.com", "message": "Resolved errors in check-mode\n\nFixes #3", "sha": "c90f7556c2d394de74a744df7eea1c19fa69a8f0", "url": "https://api.github.com/repos/m4rcu5nl/ansible-role-zerotier/commits/c90f7556c2d394de74a744df7eea1c19fa69a8f0", "parents": ["9b6296e678f5f1354c787e545439a9ad8ea284a3"], "files": [{"sha": "3249a31021736b628216b1a276ad3042fffbf3bd", "filename": "tasks/install.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/m4rcu5nl/ansible-role-zerotier/blob/c90f7556c2d394de74a744df7eea1c19fa69a8f0/tasks/install.yml", "raw_url": "https://github.com/m4rcu5nl/ansible-role-zerotier/raw/c90f7556c2d394de74a744df7eea1c19fa69a8f0/tasks/install.yml", "status": "modified", "patch": "@@ -36,6 +36,7 @@\n \n   when:\n   - zerotier_repo|succeeded\n+  - not ansible_check_mode\n   tags:\n   - installation\n   - packages"}, {"sha": "26e0213eaa048913e249fb609345b80ee6bb5bdf", "filename": "tasks/join_network.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/m4rcu5nl/ansible-role-zerotier/blob/c90f7556c2d394de74a744df7eea1c19fa69a8f0/tasks/join_network.yml", "raw_url": "https://github.com/m4rcu5nl/ansible-role-zerotier/raw/c90f7556c2d394de74a744df7eea1c19fa69a8f0/tasks/join_network.yml", "status": "modified", "patch": "@@ -29,5 +29,6 @@\n \n   when:\n   - zerotier_accesstoken is defined\n+  - not ansible_check_mode\n   tags:\n   - configuration"}, {"sha": "fc3a08f452c5a078c04f9e467b938fa22d265fde", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/m4rcu5nl/ansible-role-zerotier/blob/c90f7556c2d394de74a744df7eea1c19fa69a8f0/tasks/main.yml", "raw_url": "https://github.com/m4rcu5nl/ansible-role-zerotier/raw/c90f7556c2d394de74a744df7eea1c19fa69a8f0/tasks/main.yml", "status": "modified", "patch": "@@ -5,6 +5,7 @@\n - name: Check for successfully joined networks\n   shell: zerotier-cli listnetworks | grep 'OK'| awk '{print $3}'\n   register: joinednetworks\n+  check_mode: yes\n \n - include_tasks: join_network.yml\n   when:"}]}, {"repo": "geerlingguy/ansible-role-security", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #10: CentOS 7 autoupdate doesn't install updates.", "sha": "96ff62a5bfa4e74c1ffb1566d2a1070f5e292a15", "url": "https://api.github.com/repos/geerlingguy/ansible-role-security/commits/96ff62a5bfa4e74c1ffb1566d2a1070f5e292a15", "parents": ["01c4359d8ad17ba10149ac898663e598069b9055"], "files": [{"sha": "3e7a0a2dec910933b68b9619f49ecab64c88dade", "filename": "tasks/autoupdate-RedHat.yml", "previous_filename": null, "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/geerlingguy/ansible-role-security/blob/96ff62a5bfa4e74c1ffb1566d2a1070f5e292a15/tasks/autoupdate-RedHat.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-security/raw/96ff62a5bfa4e74c1ffb1566d2a1070f5e292a15/tasks/autoupdate-RedHat.yml", "status": "modified", "patch": "@@ -4,3 +4,10 @@\n \n - name: Ensure yum-cron is running and enabled on boot.\n   service: name=yum-cron state=started enabled=yes\n+\n+- name: Configure autoupdates (RHEL 7).\n+  lineinfile:\n+    dest: \"/etc/yum/yum-cron.conf\"\n+    regexp: '^apply_updates = .+'\n+    line: 'apply_updates = yes'\n+  when: security_autoupdate_enabled and ansible_distribution_major_version | int == 7"}]}, {"repo": "NVIDIA/deepops", "author_id": "MDQ6VXNlcjY4NzI2OQ==", "author_name": "Luke Yeager", "committer_id": "MDQ6VXNlcjEwMzQzMA==", "committer_name": "Doug Holt", "committer_email": "doug.holt@gmail.com", "message": "Fix driver package name (#75)\n\nThe PPA package names are \"nvidia-XXX\".\r\nhttps://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa", "sha": "7ef791f4cb0fe65aad3a058ee28fd31a43cd1e96", "url": "https://api.github.com/repos/NVIDIA/deepops/commits/7ef791f4cb0fe65aad3a058ee28fd31a43cd1e96", "parents": ["a88b40fbf6c5fd5af2b284d8385081067e618066"], "files": [{"sha": "faaf33cf8c0142831b2ed0c8daac91387db1866b", "filename": "playbooks/nvidia-gpu-driver.yml", "previous_filename": null, "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/NVIDIA/deepops/blob/7ef791f4cb0fe65aad3a058ee28fd31a43cd1e96/playbooks/nvidia-gpu-driver.yml", "raw_url": "https://github.com/NVIDIA/deepops/raw/7ef791f4cb0fe65aad3a058ee28fd31a43cd1e96/playbooks/nvidia-gpu-driver.yml", "status": "modified", "patch": "@@ -21,8 +21,7 @@\n         cache_valid_time: 3600\n         state: latest\n       with_items:\n-        - nvidia-driver-410\n-        - nvidia-utils-410\n+        - nvidia-410\n     - name: load nvidia driver\n       modprobe:\n         name: nvidia"}]}, {"repo": "lean-delivery/ansible-role-java", "author_id": "MDQ6VXNlcjkzOTIwMzM=", "author_name": "Pavel Pikta", "committer_id": "MDQ6VXNlcjQwMzAwNjQy", "committer_name": "Timur Gadiev", "committer_email": "Timur_Gadiev@epam.com", "message": "fix security policy installation for oracle jre (#106)", "sha": "8b0d4eaa526ee1231a5095a821690258693a628b", "url": "https://api.github.com/repos/lean-delivery/ansible-role-java/commits/8b0d4eaa526ee1231a5095a821690258693a628b", "parents": ["fbecfb07716ea9536ad2b97bf0363ba0007415e1"], "files": [{"sha": "6e9e23b8c46ddccafe24dac6b09e2b6c536de6fa", "filename": "tasks/Linux/security_policy.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/8b0d4eaa526ee1231a5095a821690258693a628b/tasks/Linux/security_policy.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/8b0d4eaa526ee1231a5095a821690258693a628b/tasks/Linux/security_policy.yml", "status": "modified", "patch": "@@ -16,7 +16,7 @@\n     - name: Unzip patch file\n       unarchive:\n         src: '{{ security_policy_java_artifact }}'\n-        dest: '{{ java_path }}/{{ java_folder }}/jre/lib/security'\n+        dest: '{{ security_patch_path }}'\n         remote_src: true\n         owner: root\n         group: root\n@@ -26,7 +26,7 @@\n       copy:\n         src: \"{{ java_path }}/{{ java_folder }}/jre/lib/security/\\\n           {{ security_patch_folders[java_major_version|int] }}/{{ policy_item }}\"\n-        dest: '{{ java_path }}/{{ java_folder }}/jre/lib/security/'\n+        dest: '{{ security_patch_path }}/'\n         remote_src: true\n         directory_mode: true\n         owner: root\n@@ -43,7 +43,7 @@\n \n - name: Apply setting\n   replace:\n-    path: '{{ java_path }}/{{ java_folder }}/jre/lib/security/java.security'\n+    path: '{{ security_patch_path }}/java.security'\n     regexp: '#crypto.policy=unlimited'\n     replace: 'crypto.policy=unlimited'\n   when: java_major_version | int < 9"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjEwOTY1OTk3", "author_name": "Jim Rigsbee", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "Fix IdM Groups not being added bug (#334)\n\n* added AWS provisioning to IdM config\r\n\r\n* Added ability to provision IdentityManager on AWS\r\n\r\n* Corrected variable name for groups in identities.groups so that downstream group creation conditional is satisfied and groups added. This resolves issue #333", "sha": "96f860c1328efe86c4b70eae50754c68ddf0df75", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/96f860c1328efe86c4b70eae50754c68ddf0df75", "parents": ["884e3e63ed95434612f31eef55d94e5f7830ce5b"], "files": [{"sha": "534e250f890ab8b662b1e96d2fcaf19e43f29bcc", "filename": "roles/identity-management/populate-users/tasks/main.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/96f860c1328efe86c4b70eae50754c68ddf0df75/roles/identity-management/populate-users/tasks/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/96f860c1328efe86c4b70eae50754c68ddf0df75/roles/identity-management/populate-users/tasks/main.yml", "status": "modified", "patch": "@@ -4,14 +4,14 @@\n   set_fact:\n     identities:\n       users: \"{{ lookup('csvtojson', 'file=' + csv_doc_file_name + ' var=users') }}\"\n-      user_groups: \"{{ lookup('csvtojson', 'file=' + csv_doc_file_name + ' var=user_groups') }}\"\n+      groups: \"{{ lookup('csvtojson', 'file=' + csv_doc_file_name + ' var=user_groups') }}\"\n \n - name: \"Display imported users values\"\n   debug:\n     var: identities.users\n     verbosity: 2\n \n-- name: \"Display imported user_groups values\"\n+- name: \"Display imported groups values\"\n   debug:\n-    var: identities.user_groups\n+    var: identities.groups\n     verbosity: 2"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjUyNTM2NzE=", "author_name": "Phil Huang", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "Fixed NVD switched to HTTPS issue (#368)\n\nNVD stopped provide HTTPS traffic and switched to HTTPS\r\n\r\nclair-jwt v2.0.7+ can resolve the issue\r\n\r\nSigned-off-by: Phil Huang <phil.huang@redhat.com>", "sha": "d34de7b476a164b23bda483f9bf6853264ca89ec", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/d34de7b476a164b23bda483f9bf6853264ca89ec", "parents": ["a050f0c00e18bfe3e91ea67ee6fc4461ed6e904f"], "files": [{"sha": "afa50280eb84f03e3a519f2b574e35f2a8f97bc1", "filename": "roles/config-clair/defaults/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/d34de7b476a164b23bda483f9bf6853264ca89ec/roles/config-clair/defaults/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/d34de7b476a164b23bda483f9bf6853264ca89ec/roles/config-clair/defaults/main.yml", "status": "modified", "patch": "@@ -10,7 +10,7 @@ systemd_service_dir: /usr/lib/systemd/system\n systemd_environmentfile_dir: /etc/sysconfig\n \n # Clair\n-clair_image: quay.io/coreos/clair-jwt:v2.0.4\n+clair_image: quay.io/coreos/clair-jwt:v2.0.8\n clair_config_dir: /var/lib/clair/config\n clair_container_config_dir: /config\n clair_ssl_trust_configure: False\n@@ -46,4 +46,4 @@ clair_container_api_port: 6061\n #clair_ssl_generate_country: US\n #clair_ssl_generate_organization: Red Hat\n #clair_ssl_generate_organizational_unit: CoP\n-#clair_ssl_generate_days_validity: 365\n\\ No newline at end of file\n+#clair_ssl_generate_days_validity: 365"}]}, {"repo": "geerlingguy/ansible-role-php-xdebug", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #9: A few php .ini files are in the wrong place on Ubuntu.", "sha": "54430da1067241aa5fcd13a3e02c676a762a7db3", "url": "https://api.github.com/repos/geerlingguy/ansible-role-php-xdebug/commits/54430da1067241aa5fcd13a3e02c676a762a7db3", "parents": ["25a54626dd06a22faa2c622732ab84db89736f78"], "files": [{"sha": "e9d725848624557bc9921c5b1d62a737d6bb742c", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 20, "changes": 21, "blob_url": "https://github.com/geerlingguy/ansible-role-php-xdebug/blob/54430da1067241aa5fcd13a3e02c676a762a7db3/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-php-xdebug/raw/54430da1067241aa5fcd13a3e02c676a762a7db3/tasks/main.yml", "status": "modified", "patch": "@@ -37,23 +37,4 @@\n     creates={{ php_xdebug_module_path }}/xdebug.so\n   notify: restart webserver\n \n-- name: Copy xdebug INI into php.d folder.\n-  template:\n-    src: xdebug.ini.j2\n-    dest: \"{{ php_extension_conf_path }}/xdebug.ini\"\n-    owner: root\n-    group: root\n-    mode: 0644\n-  notify: restart webserver\n-\n-- name: Check for separate cli php conf.d directory.\n-  stat: path=/etc/php5/cli/conf.d\n-  register: php_cli_path\n-  when: php_xdebug_cli_enable\n-\n-- name: Symlink xdebug.ini into separate cli directory if it exists.\n-  file:\n-    src: \"{{ php_extension_conf_path }}/xdebug.ini\"\n-    dest: /etc/php5/cli/conf.d/xdebug.ini\n-    state: link\n-  when: php_xdebug_cli_enable and php_cli_path.stat.isdir is defined and php_cli_path.stat.isdir\n+- include: configure.yml"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #19", "sha": "8e163ea5311fe60375fd7dc20c9ca22ca926bce4", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/8e163ea5311fe60375fd7dc20c9ca22ca926bce4", "parents": ["35c4af9fd84d7a7e6bc093adc944b352e68d6ff1"], "files": [{"sha": "61bdf5f0c33bf820ae8d2dba8751088befe0855f", "filename": "tasks/setup-repository.yml", "previous_filename": "tasks/main-Fedora.yml", "additions": 22, "deletions": 16, "changes": 38, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8e163ea5311fe60375fd7dc20c9ca22ca926bce4/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8e163ea5311fe60375fd7dc20c9ca22ca926bce4/tasks/setup-repository.yml", "status": "renamed", "patch": "@@ -1,18 +1,29 @@\n ---\n-# tasks file for ansible-role-docker-ce\n+- name: Ensure python and deps for Ansible modules\n+  raw: dnf install -y python2 python2-dnf libselinux-python\n+  become: true\n+  changed_when: false\n+  when: ansible_distribution == \"Fedora\"\n+\n+- name: Ensure yum-utils is installed\n+  package:\n+    name: yum-utils\n+    state: present\n+  become: true\n+  when: ansible_distribution == \"CentOS\"\n \n - name: Add Docker CE repository\n   get_url:\n-    url: https://download.docker.com/linux/fedora/docker-ce.repo\n+    url: \"{{ docker_repository_url[ansible_distribution] }}\"\n     dest: /etc/yum.repos.d/docker-ce.repo\n     mode: 0644\n   become: true\n-  register: dnf_repo\n+  register: docker_repo\n \n - name: Determine Docker CE Edge repo status\n-  shell: dnf config-manager --dump docker-ce-edge | grep enabled\n+  shell: \"{{ docker_cmd_check_edge_repo_status[ansible_distribution] }}\"\n   args:\n-    warn: false\n+    warn: false  \n   ignore_errors: yes\n   changed_when: false\n   register: cmd_docker_ce_edge_enabled\n@@ -22,18 +33,13 @@\n     fact_docker_ce_edge_enabled: \"{{ cmd_docker_ce_edge_enabled.stdout == 'enabled = True' }}\"\n \n - name: Enable/Disable Docker CE Edge Repository\n-  shell: dnf config-manager --set-{{ (docker_enable_ce_edge == true) | ternary('enabled','disabled') }} docker-ce-edge\n+  shell: \"{{ docker_cmd_enable_disable_edge_repo[ansible_distribution] }}\"\n   become: true\n   when: fact_docker_ce_edge_enabled != docker_enable_ce_edge\n \n-- name: Update dnf cache\n-  shell: dnf makecache fast\n-  become: true\n-  when: dnf_repo.changed\n-\n-- name: Install python and deps for ansible modules\n-  raw: dnf install -y python2 python2-dnf libselinux-python\n+- name: Update repository cache\n+  shell: \"{{ docker_cmd_update_repo_cache[ansible_distribution] }}\"\n+  args:\n+    warn: false  \n   become: true\n-  changed_when: false\n-\n-- include: main-Generic.yml\n\\ No newline at end of file\n+  when: docker_repo.changed\n\\ No newline at end of file"}, {"sha": "d3718deb61f0fb2119e465c8c39e4da97b32c3d2", "filename": "handlers/main.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8e163ea5311fe60375fd7dc20c9ca22ca926bce4/handlers/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8e163ea5311fe60375fd7dc20c9ca22ca926bce4/handlers/main.yml", "status": "modified", "patch": "@@ -5,11 +5,11 @@\n   service:\n     name: docker\n     state: restarted\n-  become: true\n+  become: yes\n \n # Workaround because systemd cannot be used: https://github.com/ansible/ansible/issues/22171\n - name: restart auditd\n   shell: service auditd restart\n   args:\n-    warn: false\n-  become: true\n+    warn: no\n+  become: yes"}, {"sha": "8fba9cdd3f1f391ce513a708adbfc6d50e205ad6", "filename": "tasks/main.yml", "previous_filename": null, "additions": 26, "deletions": 5, "changes": 31, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8e163ea5311fe60375fd7dc20c9ca22ca926bce4/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8e163ea5311fe60375fd7dc20c9ca22ca926bce4/tasks/main.yml", "status": "modified", "patch": "@@ -1,8 +1,29 @@\n ---\n-# tasks file for ansible-role-docker-ce\n+- name: Fail if unsupported CentOS version\n+  fail:\n+    msg: \"CentOS 7 or later is required!\"\n+  when: ansible_distribution == \"CentOS\" and ansible_distribution_major_version < '7'\n \n-- include: main-CentOS.yml\n-  when: ansible_distribution == \"CentOS\" and ansible_distribution_major_version > '6'\n+- name: Fail if unsupported Fedora version\n+  fail:\n+    msg: \"Fedora 24 or later is required!\"\n+  when: ansible_distribution == \"Fedora\" and ansible_distribution_major_version < '24'\n \n-- include: main-Fedora.yml\n-  when: ansible_distribution == \"Fedora\" and ansible_distribution_major_version > '23'\n+- name: Fail if this roles does not support the distribution\n+  fail:\n+    msg: \"Distribution you are running is not supported by this role!\"\n+  when: ansible_distribution != \"Fedora\" and ansible_distribution != \"CentOS\"\n+\n+- include: setup-repository.yml\n+\n+- include: kernel-3-mount-fixes.yml\n+  when: ansible_kernel | version_compare('4', '<')\n+\n+- include: setup-audit.yml\n+\n+- include: remove-pre-docker-ce.yml\n+  when: docker_remove_pre_ce | bool\n+\n+- include: install-docker.yml\n+\n+- include: configure-docker.yml"}]}, {"repo": "lean-delivery/ansible-role-sonarqube", "author_id": "MDQ6VXNlcjE5NzA0Nzgy", "author_name": "Dzmitry Rudnouski", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix for ansible 2.6.*, plugins update, ability to override optional and excluded plugins (#11) (#12)", "sha": "0319d599ae1812d73a639756708a829b66ba5a6c", "url": "https://api.github.com/repos/lean-delivery/ansible-role-sonarqube/commits/0319d599ae1812d73a639756708a829b66ba5a6c", "parents": ["418258bbe2faefc49ea8da7dc9d60ad5d339da42"], "files": [{"sha": "5c090c30e5823e16f0210f08c60704ffc8e9565c", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-sonarqube/blob/0319d599ae1812d73a639756708a829b66ba5a6c/tasks/main.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-sonarqube/raw/0319d599ae1812d73a639756708a829b66ba5a6c/tasks/main.yml", "status": "modified", "patch": "@@ -21,5 +21,5 @@\n   delay: 5\n   register: sonar_plugin\n   with_items:\n-    - \"{{ sonar_plugins }}\"\n+    - \"{{ sonar_plugins }} + {{ sonar_optional_plugins }}\"\n   become: True"}, {"sha": "5c03b3552cc95f6f58bb9d4ef430155f268cf34c", "filename": "tasks/system/Linux.yml", "previous_filename": null, "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/lean-delivery/ansible-role-sonarqube/blob/0319d599ae1812d73a639756708a829b66ba5a6c/tasks/system/Linux.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-sonarqube/raw/0319d599ae1812d73a639756708a829b66ba5a6c/tasks/system/Linux.yml", "status": "modified", "patch": "@@ -58,12 +58,24 @@\n       list_files: True\n     become_user: \"{{ sonar_user }}\"\n     register: sonar_installation_result\n+    # workaround for ansible 2.6.*, see https://github.com/ansible/ansible/issues/45124\n+    ignore_errors: True\n \n   - name: \"SonarQube installation facts\"\n     set_fact:\n       sonar_installation: \"{{ sonar_path }}/{{ sonar_installation_result.files.0 }}\"\n       distro: \"{{ ansible_facts.system | lower }}\"\n       arch: \"{{ 'x86-32' if ansible_architecture == 'i386' else 'x86-64' }}\"\n+    when: sonar_installation_result.files is defined\n+\n+    # continuation of ansible 2.6.* workaround\n+  - name: \"SonarQube installation facts\"\n+    set_fact:\n+      sonar_installation: \"{{ sonar_path }}/\\\n+      sonarqube-{{ sonar_major_version }}.{{ sonar_minor_version }}/\"\n+      distro: \"{{ ansible_facts.system | lower }}\"\n+      arch: \"{{ 'x86-32' if ansible_architecture == 'i386' else 'x86-64' }}\"\n+    when: sonar_installation_result.files is not defined\n \n   - name: \"Render sonar.properties\"\n     template:"}]}, {"repo": "florianutz/Ubuntu1604-CIS", "author_id": null, "author_name": "Florian Utz", "committer_id": null, "committer_name": "Florian Utz", "committer_email": "florian.utz@github.com", "message": "fixed duplicate task 4.1.13  #2", "sha": "86655eaf1b83c1c0bc5b859e33db155fb3f5230d", "url": "https://api.github.com/repos/florianutz/Ubuntu1604-CIS/commits/86655eaf1b83c1c0bc5b859e33db155fb3f5230d", "parents": ["c6daa6018a218b51f60873f452dcbae6e67f75cc"], "files": [{"sha": "b75d3e8254ad2f4529868c0e9e04c20dcc78187b", "filename": "tasks/section4.yml", "previous_filename": null, "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/86655eaf1b83c1c0bc5b859e33db155fb3f5230d/tasks/section4.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/86655eaf1b83c1c0bc5b859e33db155fb3f5230d/tasks/section4.yml", "status": "modified", "patch": "@@ -150,17 +150,6 @@\n       - rule_4.1.12\n       - notimplemented\n \n-- name: \"SCORED | 4.1.13 | PATCH | Ensure successful file system mounts are collected\"\n-  lineinfile:\n-      dest: /etc/audit/rules.d/audit.rules\n-      line: \"-a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=4294967295 -k mounts\"\n-      state: present\n-  tags:\n-      - level2\n-      - auditd\n-      - patch\n-      - rule_4.1.13\n-\n - name: \"SCORED | 4.1.13 | PATCH | Ensure successful file system mounts are collected\"\n   lineinfile:\n       dest: /etc/audit/audit.rules"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjczMzg1MTM=", "author_name": "Phil Nelson", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix failed_when in template_root check with wp-cli 1.5.0 (#948)\n\nPrevious wp-cli versions returned rc=1 and stderr='' for\r\n`wp option get template_root` when the option didn't exist.\r\nVersion 1.5.0 uses a new stderr message.", "sha": "658c9ee2f74b71ae40b048afd9ba25be748b7ec7", "url": "https://api.github.com/repos/roots/trellis/commits/658c9ee2f74b71ae40b048afd9ba25be748b7ec7", "parents": ["c8515b3586bbe8ce81bbf3911d54aa0d5d845d0e"], "files": [{"sha": "dd23480bb1e2eaa49c166f4d7aa9bba4ebe8c594", "filename": "roles/deploy/hooks/finalize-before.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/658c9ee2f74b71ae40b048afd9ba25be748b7ec7/roles/deploy/hooks/finalize-before.yml", "raw_url": "https://github.com/roots/trellis/raw/658c9ee2f74b71ae40b048afd9ba25be748b7ec7/roles/deploy/hooks/finalize-before.yml", "status": "modified", "patch": "@@ -23,7 +23,7 @@\n     chdir: \"{{ deploy_helper.current_path }}\"\n   register: wp_template_root\n   changed_when: false\n-  failed_when: wp_template_root.stderr  | default('') != ''\n+  failed_when: not wp_template_root.stderr | default('') | match(\"(|.*Could not get '\" + item + \"' option\\. Does it exist\\?)\")\n   when:\n     - wp_installed.rc == 0\n     - project.update_wp_theme_paths | default(update_wp_theme_paths | default(true)) | bool"}]}, {"repo": "florianutz/Ubuntu1604-CIS", "author_id": "MDQ6VXNlcjM1ODc5MTM=", "author_name": "Scott Miller", "committer_id": "MDQ6VXNlcjEzNjgzNzQz", "committer_name": "Florian Utz", "committer_email": "florianutz@users.noreply.github.com", "message": "Fix ansible-lint errors (#36)\n\n* fix handler conditionals\r\n\r\n* fix section1 linter errors\r\n\r\n* fix section2 linter errors\r\n\r\n* fix section3 linter errors\r\n\r\n* fix section4 linter errors\r\n\r\n* fix section5 linter errors\r\n\r\n* fix section6 linter errors\r\n\r\n* fix linter errors\r\n\r\n* fix sed linter errors\r\n\r\n* fix pipefail\r\n\r\n* use literal `+` in lineinfile regex\r\n\r\n* use `not` rather than `!`", "sha": "96cda04d603c48eb1b631bde06f2bd0b59d9e746", "url": "https://api.github.com/repos/florianutz/Ubuntu1604-CIS/commits/96cda04d603c48eb1b631bde06f2bd0b59d9e746", "parents": ["8b12f248491aabc60c6c69ddedbfcfa6a7ae6edf"], "files": [{"sha": "9a65fcb620dda85da0a675ce199480146c041c0e", "filename": "tasks/prelim.yml", "previous_filename": null, "additions": 112, "deletions": 28, "changes": 140, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/prelim.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/prelim.yml", "status": "modified", "patch": "@@ -8,13 +8,19 @@\n   check_mode: false\n \n - name: \"PRELIM | Gather accounts with empty password fields\"\n-  shell: \"cat /etc/shadow | awk -F: '($2 == \\\"\\\" ) {j++;print $1; } END {exit j}'\"\n+  shell: \"set -o pipefail\n+      cat /etc/shadow | awk -F: '($2 == \\\"\\\" ) {j++;print $1; } END {exit j}'\"\n+  args:\n+      executable: /bin/bash\n   register: empty_password_accounts\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Gather UID 0 accounts other than root\"\n-  shell: \"cat /etc/passwd | awk -F: '($3 == 0 && $1 != \\\"root\\\") {i++;print $1 } END {exit i}'\"\n+  shell: \"set -o pipefail\n+      cat /etc/passwd | awk -F: '($3 == 0 && $1 != \\\"root\\\") {i++;print $1 } END {exit i}'\"\n+  args:\n+      executable: /bin/bash\n   register: uid_zero_accounts_except_root\n   changed_when: false\n   check_mode: false\n@@ -56,157 +62,235 @@\n \n # Individual service checks\n - name: \"PRELIM | Check for xinetd service\"\n-  shell: \"systemctl show xinetd | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show xinetd | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: xinetd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for ntpd service\"\n-  shell: \"systemctl show {{ ntp_service[ansible_os_family] }} | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show {{ ntp_service[ansible_os_family] }} | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: ntpd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for chronyd service\"\n-  shell: \"systemctl show {{ chrony_service[ansible_os_family] }} | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show {{ chrony_service[ansible_os_family] }} | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: chronyd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for avahi-daemon service\"\n-  shell: \"systemctl show avahi-daemon | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show avahi-daemon | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: avahi_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for cups service\"\n-  shell: \"systemctl show cups | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show cups | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: cups_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for dhcpd service\"\n-  shell: \"systemctl show dhcpd | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show dhcpd | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: dhcpd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for slapd service\"\n-  shell: \"systemctl show slapd | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show slapd | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: slapd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for nfs service\"\n-  shell: \"systemctl show nfs | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show nfs | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: nfs_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for rpcbind service\"\n-  shell: \"systemctl show rpcbind | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show rpcbind | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: rpcbind_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for named service\"\n-  shell: \"systemctl show named | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show named | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: named_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for vsftpd service\"\n-  shell: \"systemctl show vsftpd | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show vsftpd | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: vsftpd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for httpd service\"\n-  shell: \"systemctl show httpd | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show httpd | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: httpd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for dovecot service\"\n-  shell: \"systemctl show dovecot | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show dovecot | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: dovecot_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for smb service\"\n-  shell: \"systemctl show smb | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show smb | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: smb_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for squid service\"\n-  shell: \"systemctl show squid | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show squid | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: squid_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for snmpd service\"\n-  shell: \"systemctl show snmpd | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show snmpd | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: snmpd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for ypserv service\"\n-  shell: \"systemctl show ypserv | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show ypserv | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: ypserv_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for rsh.socket service\"\n-  shell: \"systemctl show rsh.socket | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show rsh.socket | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: rsh_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for rlogin.socket service\"\n-  shell: \"systemctl show rlogin.socket | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show rlogin.socket | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: rlogin_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for rexec.socket service\"\n-  shell: \"systemctl show rexec.socket | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show rexec.socket | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: rexec_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for telnet service\"\n-  shell: \"systemctl show telnet | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show telnet | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: telnet_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for tftp service\"\n-  shell: \"systemctl show tftp | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show tftp | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: tftp_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for rsyncd service\"\n-  shell: \"systemctl show rsyncd | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show rsyncd | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: rsyncd_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for ntalk service\"\n-  shell: \"systemctl show ntalk | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show ntalk | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: ntalk_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for autofs service\"\n-  shell: \"systemctl show autofs | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show autofs | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: autofs_service_status\n   changed_when: false\n   check_mode: false\n \n - name: \"PRELIM | Check for rhnsd service\"\n-  shell: \"systemctl show rhnsd | grep LoadState | cut -d = -f 2\"\n+  shell: \"set -o pipefail\n+      systemctl show rhnsd | grep LoadState | cut -d = -f 2\"\n+  args:\n+      executable: /bin/bash\n   register: rhnsd_service_status\n   changed_when: false\n   check_mode: false"}, {"sha": "48b2e97f977afbecfb4014c489318a7de9cfe4bf", "filename": "tasks/section3.yml", "previous_filename": null, "additions": 38, "deletions": 16, "changes": 54, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section3.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section3.yml", "status": "modified", "patch": "@@ -6,7 +6,7 @@\n       state: present\n       reload: true\n       ignoreerrors: true\n-  when: ubuntu1604cis_is_router == false\n+  when: not ubuntu1604cis_is_router\n   notify:\n       - sysctl flush ipv4 route table\n   tags:\n@@ -27,7 +27,7 @@\n   with_items:\n       - { name: net.ipv4.conf.all.send_redirects, value: 0 }\n       - { name: net.ipv4.conf.default.send_redirects, value: 0 }\n-  when: ubuntu1604cis_is_router == false\n+  when: not ubuntu1604cis_is_router\n   notify:\n       - sysctl flush ipv4 route table\n   tags:\n@@ -196,7 +196,7 @@\n   with_items:\n       - { name: net.ipv6.conf.all.accept_ra, value: 0 }\n       - { name: net.ipv6.conf.default.accept_ra, value: 0 }\n-  when: ubuntu1604cis_ipv6_required == true\n+  when: ubuntu1604cis_ipv6_required\n   notify:\n       - sysctl flush ipv6 route table\n   tags:\n@@ -217,7 +217,7 @@\n   with_items:\n       - { name: net.ipv6.conf.all.accept_redirects, value: 0 }\n       - { name: net.ipv6.conf.default.accept_redirects, value: 0 }\n-  when: ubuntu1604cis_ipv6_required == true\n+  when: ubuntu1604cis_ipv6_required\n   notify:\n       - sysctl flush ipv6 route table\n   tags:\n@@ -233,7 +233,7 @@\n       regexp: \"^(#)?options ipv6 disable=\"\n       line: \"options ipv6 disable=1\"\n       create: true\n-  when: ubuntu1604cis_ipv6_required == false\n+  when: not ubuntu1604cis_ipv6_required\n   tags:\n       - level1\n       - notscored\n@@ -352,7 +352,9 @@\n       name: firewalld\n       state: present\n       install_recommends: false\n-  when: ubuntu1604cis_firewall == \"firewalld\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"firewalld\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored\n@@ -364,7 +366,9 @@\n       name: firewalld\n       state: started\n       enabled: true\n-  when: ubuntu1604cis_firewall == \"firewalld\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"firewalld\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored\n@@ -376,7 +380,9 @@\n       name: iptables\n       state: present\n       install_recommends: false\n-  when: ubuntu1604cis_firewall == \"iptables\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"iptables\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored\n@@ -388,7 +394,9 @@\n       name: iptables\n       state: started\n       enabled: true\n-  when: ubuntu1604cis_firewall == \"iptables\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"iptables\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored\n@@ -400,7 +408,9 @@\n       dest: /etc/firewalld/firewalld.conf\n       regexp: \"^DefaultZone\"\n       line: \"DefaultZone=drop\"\n-  when: ubuntu1604cis_firewall == \"firewalld\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"firewalld\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored\n@@ -412,7 +422,9 @@\n       state: enabled\n       zone: drop\n       permanent: true\n-  when: ubuntu1604cis_firewall == \"firewalld\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"firewalld\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored\n@@ -422,7 +434,9 @@\n - name: \"SCORED | 3.6.2 | PATCH | Ensure default deny firewall policy\"\n   command: /bin/true\n   changed_when: false\n-  when: ubuntu1604cis_firewall == \"iptables\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"iptables\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored\n@@ -433,7 +447,9 @@\n - name: \"SCORED | 3.6.3 | PATCH | Ensure loopback traffic is configured\"\n   command: /bin/true\n   changed_when: false\n-  when: ubuntu1604cis_firewall == \"iptables\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"iptables\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored\n@@ -444,7 +460,9 @@\n - name: \"NOTSCORED | 3.6.4 | PATCH | Ensure outbound and established connections are configured\"\n   command: /bin/true\n   changed_when: false\n-  when: ubuntu1604cis_firewall == \"iptables\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"iptables\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - notscored\n@@ -459,7 +477,9 @@\n       zone: drop\n       permanent: true\n       immediate: true\n-  when: ubuntu1604cis_firewall == \"firewalld\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"firewalld\"\n+      - ubuntu1604cis_setup_firewall\n   notify: restart firewalld\n   with_items: \"{{ ubuntu1604cis_firewall_services }}\"\n   tags:\n@@ -471,7 +491,9 @@\n - name: \"SCORED | 3.6.5 | PATCH | Ensure firewall rules exist for all open ports\"\n   command: /bin/true\n   changed_when: false\n-  when: ubuntu1604cis_firewall == \"iptables\" and ubuntu1604cis_setup_firewall\n+  when:\n+      - ubuntu1604cis_firewall == \"iptables\"\n+      - ubuntu1604cis_setup_firewall\n   tags:\n       - level1\n       - scored"}, {"sha": "7c5d9eb5926e81c1472419312aead5bc3b54a91e", "filename": "handlers/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/handlers/main.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/handlers/main.yml", "status": "modified", "patch": "@@ -68,14 +68,14 @@\n       name: auditd\n       state: restarted\n   when:\n-      - ubuntu1604cis_skip_for_travis == false\n+      - not ubuntu1604cis_skip_for_travis\n   tags:\n       - skip_ansible_lint\n \n - name: load audit rules\n   become: true\n   command: /sbin/augenrules --load\n   when:\n-      - ubuntu1604cis_skip_for_travis == false\n+      - not ubuntu1604cis_skip_for_travis\n   tags:\n       - skip_ansible_lint"}, {"sha": "942bb4ecee90e9e547cded846bb8b7341d65ef71", "filename": "tasks/section1.yml", "previous_filename": null, "additions": 40, "deletions": 11, "changes": 51, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section1.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section1.yml", "status": "modified", "patch": "@@ -263,7 +263,7 @@\n       - systemd restart tmp.mount\n   when:\n       - ubuntu1604cis_rule_1_1_2\n-      - ubuntu1604cis_skip_for_travis == false\n+      - not ubuntu1604cis_skip_for_travis\n   tags:\n       - level2\n       - scored\n@@ -279,7 +279,7 @@\n       state: started\n   when:\n       - ubuntu1604cis_rule_1_1_2\n-      - ubuntu1604cis_skip_for_travis == false\n+      - not ubuntu1604cis_skip_for_travis\n   tags:\n       - level2\n       - scored\n@@ -311,7 +311,11 @@\n       - rule_1.1.4\n \n - name: \"SCORED | 1.1.5 | PATCH | Ensure separate partition exists for /var\"\n-  shell: mount | grep \"on /var \"\n+  shell: |\n+      set -o pipefail\n+      mount | grep \"on /var \"\n+  args:\n+      executable: /bin/bash\n   register: var_mounted\n   changed_when: false\n   failed_when: false\n@@ -325,7 +329,11 @@\n       - skip_ansible_lint\n \n - name: \"SCORED | 1.1.6 | PATCH | Ensure separate partition exists for /var/tmp\"\n-  shell: mount | grep \"on /var/tmp \"\n+  shell: |\n+      set -o pipefail\n+      mount | grep \"on /var/tmp \"\n+  args:\n+      executable: /bin/bash\n   register: var_tmp_mounted\n   changed_when: false\n   failed_when: false\n@@ -361,7 +369,11 @@\n       - rule_1.1.9\n \n - name: \"SCORED | 1.1.10 | PATCH | Ensure separate partition exists for /var/log\"\n-  shell: mount | grep \"on /var/log \"\n+  shell: |\n+      set -o pipefail\n+      mount | grep \"on /var/log \"\n+  args:\n+      executable: /bin/bash\n   register: var_log_mounted\n   changed_when: false\n   failed_when: false\n@@ -375,7 +387,11 @@\n       - skip_ansible_lint\n \n - name: \"SCORED | 1.1.11 | PATCH | Ensure separate partition exists for /var/log/audit\"\n-  shell: mount | grep \"on /var/log/audit \"\n+  shell: |\n+      set -o pipefail\n+      mount | grep \"on /var/log/audit \"\n+  args:\n+      executable: /bin/bash\n   register: var_log_audit_mounted\n   changed_when: false\n   failed_when: false\n@@ -389,7 +405,11 @@\n       - skip_ansible_lint\n \n - name: \"SCORED | 1.1.12 | PATCH | Ensure separate partition exists for /home\"\n-  shell: mount | grep \"on /home \"\n+  shell: |\n+      set -o pipefail\n+      mount | grep \"on /home \"\n+  args:\n+      executable: /bin/bash\n   register: home_mounted\n   changed_when: false\n   failed_when: false\n@@ -478,7 +498,11 @@\n       - notimplemented\n \n - name: \"SCORED | 1.1.20 | PATCH | Ensure sticky bit is set on all world-writable directories\"\n-  shell: df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type d -perm -0002 2>/dev/null | xargs chmod a+t\n+  shell: |\n+      set -o pipefail\n+      df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type d -perm -0002 2>/dev/null | xargs chmod a+t\n+  args:\n+      executable: /bin/bash\n   changed_when: false\n   failed_when: false\n   when:\n@@ -495,7 +519,8 @@\n       name: autofs\n       enabled: false\n   when:\n-      - ubuntu1604cis_allow_autofs == false and autofs_service_status.stdout == \"loaded\"\n+      - not ubuntu1604cis_allow_autofs\n+      - autofs_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_1_1_21\n   tags:\n       - level1\n@@ -586,7 +611,7 @@\n       owner: root\n       group: root\n       mode: 0600\n-  when: \n+  when:\n       - ansible_os_family == \"Debian\"\n       - ubuntu1604cis_rule_1_4_1\n   tags:\n@@ -657,7 +682,11 @@\n       - rule_1.5.1\n \n - name: \"NOTSCORED | 1.5.2 | PATCH | Ensure XD/NX support is enabled\"\n-  shell: dmesg | grep -E \"NX|XD\" | grep \" active\"\n+  shell: |\n+      set -o pipefail\n+      dmesg | grep -E \"NX|XD\" | grep \" active\"\n+  args:\n+      executable: /bin/bash\n   changed_when: false\n   when:\n       - ubuntu1604cis_rule_1_5_2"}, {"sha": "c7893d89ac78336888116f223b45c20367497b9d", "filename": "tasks/section4.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section4.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section4.yml", "status": "modified", "patch": "@@ -73,7 +73,7 @@\n       state: started\n       enabled: true\n   when:\n-      - ubuntu1604cis_skip_for_travis == false\n+      - not ubuntu1604cis_skip_for_travis\n       - ubuntu1604cis_rule_4_1_2\n   tags:\n       - level2"}, {"sha": "2bd4f3a072aeee3a057e5774cf05c28458f93708", "filename": "tasks/section6.yml", "previous_filename": null, "additions": 14, "deletions": 10, "changes": 24, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section6.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section6.yml", "status": "modified", "patch": "@@ -198,9 +198,10 @@\n       - rule_6.2.1\n \n - name: \"SCORED | 6.2.2 | PATCH | Ensure no legacy '+' entries exist in /etc/passwd\"\n-  command: sed -i '/^+/ d' /etc/passwd\n-  changed_when: false\n-  failed_when: false\n+  lineinfile:\n+      regexp: '^\\+'\n+      state: absent\n+      path: /etc/passwd\n   when:\n       - ubuntu1604cis_rule_6_2_2\n   tags:\n@@ -210,9 +211,10 @@\n       - rule_6.2.2\n \n - name: \"SCORED | 6.2.3 | PATCH | Ensure no legacy '+' entries exist in /etc/shadow\"\n-  command: sed -i '/^+/ d' /etc/shadow\n-  changed_when: false\n-  failed_when: false\n+  lineinfile:\n+      regexp: '^\\+'\n+      state: absent\n+      path: /etc/shadow\n   when:\n       - ubuntu1604cis_rule_6_2_3\n   tags:\n@@ -222,9 +224,10 @@\n       - rule_6.2.3\n \n - name: \"SCORED | 6.2.4 | PATCH | Ensure no legacy '+' entries exist in /etc/group\"\n-  command: sed -i '/^+/ d' /etc/group\n-  changed_when: false\n-  failed_when: false\n+  lineinfile:\n+      regexp: '^\\+'\n+      state: absent\n+      path: /etc/group\n   when:\n       - ubuntu1604cis_rule_6_2_4\n   tags:\n@@ -261,6 +264,7 @@\n \n - name: \"SCORED | 6.2.6 | PATCH | Ensure root PATH Integrity\"\n   shell: |\n+    set -o pipefail\n     sudopath=($(grep secure_path /etc/sudoers | cut -f2 -d= |cut -f2 -d\\\"))\n     IFS=:\n     for i in ${sudopath[*]}\n@@ -290,7 +294,7 @@\n       line: '\\1\"{{ fixsudo.stdout_lines[0] }}\"'\n       backrefs: true\n   when:\n-      - fixsudo.stdout_lines[0] != \"\"\n+      - fixsudo.stdout_lines[0]\n   tags:\n       - level1\n       - scored"}, {"sha": "dcac71744276c5002a8e861651429eef0456cd8c", "filename": "meta/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/meta/main.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/meta/main.yml", "status": "modified", "patch": "@@ -1,6 +1,6 @@\n ---\n galaxy_info:\n-  author: \"\"\n+  author: \"Florian Utz\"\n   description: \"Ansible role to apply Ubuntu 16.04 CIS Baseline\"\n   company:\n   license: MIT"}, {"sha": "ccf5e2699c2588a29f482c60f6c3e1113a4df5a9", "filename": "tasks/post.yml", "previous_filename": null, "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/post.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/post.yml", "status": "modified", "patch": "@@ -2,7 +2,11 @@\n # Post tasks\n \n - name: \"POST | Find removed but configured apt packages\"\n-  shell: \"dpkg --list | grep ^rc | tr -s ' ' | cut -d ' ' -f 2\"\n+  shell: |\n+      set -o pipefail\n+      dpkg --list | grep ^rc | tr -s ' ' | cut -d ' ' -f 2\n+  args:\n+      executable: /bin/bash\n   register: apt_rc_packages\n   changed_when: false\n "}, {"sha": "c393dfc5fdbcaaf138ea7bd8597a11646d28d2c7", "filename": "tasks/section2.yml", "previous_filename": null, "additions": 69, "deletions": 41, "changes": 110, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section2.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section2.yml", "status": "modified", "patch": "@@ -7,7 +7,9 @@\n         register: chargen_dgram_service\n \n       - name: \"SCORED | 2.1.1 | PATCH | Ensure chargen services are not enabled | chargen-dgram\"\n-        command: chkconfig chargen-dgram off\n+        service:\n+            name: chargen-dgram\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - chargen_dgram_service.stat.exists\n@@ -18,7 +20,9 @@\n         register: chargen_stream_service\n \n       - name: \"SCORED | 2.1.1 | PATCH | Ensure chargen services are not enabled | chargen-stream\"\n-        command: chkconfig chargen-stream off\n+        service:\n+            name: chargen-stream\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - chargen_stream_service.stat.exists\n@@ -40,7 +44,9 @@\n         register: daytime_dgram_service\n \n       - name: \"SCORED | 2.1.2 | PATCH | Ensure daytime services are not enabled | daytime-dgram\"\n-        command: chkconfig daytime-dgram off\n+        service:\n+            name: daytime-dgram\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - daytime_dgram_service.stat.exists\n@@ -51,7 +57,9 @@\n         register: daytime_stream_service\n \n       - name: \"SCORED | 2.1.2 | PATCH | Ensure daytime services are not enabled | daytime-stream\"\n-        command: chkconfig daytime-stream off\n+        service:\n+            name: daytime-stream\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - daytime_stream_service.stat.exists\n@@ -72,7 +80,9 @@\n         register: discard_dgram_service\n \n       - name: \"SCORED | 2.1.3 | PATCH | Ensure discard services are not enabled | discard-dgram\"\n-        command: chkconfig discard-dgram off\n+        service:\n+            name: discard-dgram\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - discard_dgram_service.stat.exists\n@@ -83,7 +93,9 @@\n         register: discard_stream_service\n \n       - name: \"SCORED | 2.1.3 | PATCH | Ensure discard services are not enabled | discard-stream\"\n-        command: chkconfig discard-stream off\n+        service:\n+            name: discard-stream\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - discard_stream_service.stat.exists\n@@ -104,7 +116,9 @@\n         register: echo_dgram_service\n \n       - name: \"SCORED | 2.1.4 | PATCH | Ensure echo services are not enabled | echo-dgram\"\n-        command: chkconfig echo-dgram off\n+        service:\n+            name: echo-dgram\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - echo_dgram_service.stat.exists\n@@ -115,7 +129,9 @@\n         register: echo_stream_service\n \n       - name: \"SCORED | 2.1.4 | PATCH | Ensure echo services are not enabled | echo-stream\"\n-        command: chkconfig echo-stream off\n+        service:\n+            name: echo-stream\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - echo_stream_service.stat.exists\n@@ -136,7 +152,9 @@\n         register: time_dgram_service\n \n       - name: \"SCORED | 2.1.5 | PATCH | Ensure time services are not enabled | time-dgram\"\n-        command: chkconfig time-dgram off\n+        service:\n+            name: time-dgram\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - time_dgram_service.stat.exists\n@@ -147,7 +165,9 @@\n         register: time_stream_service\n \n       - name: \"SCORED | 2.1.5 | PATCH | Ensure time services are not enabled | time-stream\"\n-        command: chkconfig time-stream off\n+        service:\n+            name: time-stream\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - time_stream_service.stat.exists\n@@ -168,11 +188,13 @@\n         register: tftp_service\n \n       - name: \"SCORED | 2.1.6 | PATCH | Ensure tftp server is not enabled\"\n-        command: chkconfig tftp off\n+        service:\n+            name: tftp\n+            enabled: no\n         notify: restart xinetd\n         when:\n             - tftp_service.stat.exists\n-            - ubuntu1604cis_tftp_server == false\n+            - not ubuntu1604cis_tftp_server\n         tags:\n             - skip_ansible_lint\n   when:\n@@ -303,13 +325,13 @@\n \n - name: \"SCORED | 2.2.2 | PATCH | Ensure X Window System is not installed\"\n   apt:\n-      name: \"{{item}}\"\n+      name: \"{{ item }}\"\n       state: absent\n   with_items:\n       - \"@X Window System\"\n       - \"x11*\"\n   when:\n-      - ubuntu1604cis_xwindows_required == false\n+      - not ubuntu1604cis_xwindows_required\n       - ubuntu1604cis_rule_2_2_2\n   tags:\n       - level1\n@@ -324,7 +346,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_avahi_server == false\n+      - not ubuntu1604cis_avahi_server\n       - avahi_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_3\n   tags:\n@@ -341,7 +363,8 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_cups_server == false and cups_service_status.stdout == \"loaded\"\n+      - not ubuntu1604cis_cups_server\n+      - cups_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_4\n   tags:\n       - level1\n@@ -357,7 +380,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_dhcp_server == false\n+      - not ubuntu1604cis_dhcp_server\n       - dhcpd_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_5\n   tags:\n@@ -374,7 +397,8 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_ldap_server == false and slapd_service_status.stdout == \"loaded\"\n+      - not ubuntu1604cis_ldap_server\n+      - slapd_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_6\n   tags:\n       - level1\n@@ -390,7 +414,8 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_nfs_rpc_server == false and nfs_service_status.stdout == \"loaded\"\n+      - not ubuntu1604cis_nfs_rpc_server\n+      - nfs_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_7\n   tags:\n       - level1\n@@ -407,7 +432,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_nfs_rpc_server == false\n+      - not ubuntu1604cis_nfs_rpc_server\n       - rpcbind_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_7\n   tags:\n@@ -425,7 +450,8 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_named_server == false and named_service_status.stdout == \"loaded\"\n+      - not ubuntu1604cis_named_server\n+      - named_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_8\n   tags:\n       - level1\n@@ -439,7 +465,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_vsftpd_server == false\n+      - not ubuntu1604cis_vsftpd_server\n       - vsftpd_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_9\n   tags:\n@@ -454,7 +480,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_httpd_server == false\n+      - not ubuntu1604cis_httpd_server\n       - httpd_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_10\n   tags:\n@@ -469,7 +495,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_dovecot_server == false\n+      - not ubuntu1604cis_dovecot_server\n       - dovecot_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_11\n   tags:\n@@ -484,7 +510,8 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_smb_server == false and smb_service_status.stdout == \"loaded\"\n+      - not ubuntu1604cis_smb_server\n+      - smb_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_12\n   tags:\n       - level1\n@@ -498,7 +525,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_squid_server == false\n+      - not ubuntu1604cis_squid_server\n       - squid_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_13\n   tags:\n@@ -513,7 +540,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_snmp_server == false\n+      - not ubuntu1604cis_snmp_server\n       - snmpd_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_14\n   tags:\n@@ -528,7 +555,7 @@\n       regexp: \"^(#)?inet_interfaces\"\n       line: \"inet_interfaces = localhost\"\n   when:\n-      - ubuntu1604cis_is_mail_server == false\n+      - not ubuntu1604cis_is_mail_server\n       - postfix_installed.rc == 0\n       - ubuntu1604cis_rule_2_2_15\n   tags:\n@@ -543,7 +570,8 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_nis_server == false and ypserv_service_status.stdout == \"loaded\"\n+      - not ubuntu1604cis_nis_server\n+      - ypserv_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_16\n   tags:\n       - level1\n@@ -557,7 +585,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_rsh_server == false\n+      - not ubuntu1604cis_rsh_server\n       - rsh_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_17\n   tags:\n@@ -572,7 +600,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_rsh_server == false\n+      - not ubuntu1604cis_rsh_server\n       - rlogin_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_17\n   tags:\n@@ -587,7 +615,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_rsh_server == false\n+      - not ubuntu1604cis_rsh_server\n       - rexec_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_17\n   tags:\n@@ -602,7 +630,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_telnet_server == false\n+      - not ubuntu1604cis_telnet_server\n       - telnet_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_18\n   tags:\n@@ -617,7 +645,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_tftp_server == false\n+      - not ubuntu1604cis_tftp_server\n       - tftp_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_19\n   tags:\n@@ -635,7 +663,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_rsyncd_server == false\n+      - not ubuntu1604cis_rsyncd_server\n       - rsyncd_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_20\n   tags:\n@@ -650,7 +678,7 @@\n       state: stopped\n       enabled: false\n   when:\n-      - ubuntu1604cis_ntalk_server == false\n+      - not ubuntu1604cis_ntalk_server\n       - ntalk_service_status.stdout == \"loaded\"\n       - ubuntu1604cis_rule_2_2_21\n   tags:\n@@ -664,7 +692,7 @@\n       name: ypbind\n       state: absent\n   when:\n-      - ubuntu1604cis_ypbind_required == false\n+      - not ubuntu1604cis_ypbind_required\n       - ubuntu1604cis_rule_2_3_1\n   tags:\n       - level1\n@@ -677,7 +705,7 @@\n       name: rsh\n       state: absent\n   when:\n-      - ubuntu1604cis_rsh_required == false\n+      - not ubuntu1604cis_rsh_required\n       - ubuntu1604cis_rule_2_3_2\n   tags:\n       - level1\n@@ -690,7 +718,7 @@\n       name: talk\n       state: absent\n   when:\n-      - ubuntu1604cis_talk_required == false\n+      - not ubuntu1604cis_talk_required\n       - ubuntu1604cis_rule_2_3_3\n   tags:\n       - level1\n@@ -703,7 +731,7 @@\n       name: telnet\n       state: absent\n   when:\n-      - ubuntu1604cis_telnet_required == false\n+      - not ubuntu1604cis_telnet_required\n       - ubuntu1604cis_rule_2_3_4\n   tags:\n       - level1\n@@ -716,7 +744,7 @@\n       name: openldap-clients\n       state: absent\n   when:\n-      - ubuntu1604cis_openldap_clients_required == false\n+      - not ubuntu1604cis_openldap_clients_required\n       - ubuntu1604cis_rule_2_3_5\n   tags:\n       - level1"}, {"sha": "c20a3f8795e85542472995fea4a69021b3e13e33", "filename": "tasks/section5.yml", "previous_filename": null, "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section5.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/96cda04d603c48eb1b631bde06f2bd0b59d9e746/tasks/section5.yml", "status": "modified", "patch": "@@ -122,7 +122,7 @@\n       - name: \"SCORED | 5.1.8 | PATCH | Ensure at/cron is restricted to authorized users\"\n         file:\n             dest: /etc/at.allow\n-            state: '{{ \"file\" if  at_allow.stat.exists else \"touch\"}}'\n+            state: '{{ \"file\" if  at_allow.stat.exists else \"touch\" }}'\n             owner: root\n             group: root\n             mode: 0600\n@@ -140,7 +140,7 @@\n       - name: \"SCORED | 5.1.8 | PATCH | Ensure at/cron is restricted to authorized users\"\n         file:\n             dest: /etc/cron.allow\n-            state: '{{ \"file\" if  cron_allow.stat.exists else \"touch\"}}'\n+            state: '{{ \"file\" if  cron_allow.stat.exists else \"touch\" }}'\n             owner: root\n             group: root\n             mode: 0600\n@@ -369,7 +369,7 @@\n         notify:\n             - restart sshd\n         when:\n-            - \"ubuntu1604cis_sshd['allowusers']|default('') != ''\"\n+            - \"ubuntu1604cis_sshd['allowusers']|default('')\"\n \n       - name: \"SCORED | 5.2.14 | PATCH | Ensure SSH access is limited - allowgroups\"\n         lineinfile:\n@@ -380,7 +380,7 @@\n         notify:\n             - restart sshd\n         when:\n-            - \"ubuntu1604cis_sshd['allowgroups']|default('') != ''\"\n+            - \"ubuntu1604cis_sshd['allowgroups']|default('')\"\n \n       - name: \"SCORED | 5.2.14 | PATCH | Ensure SSH access is limited - denyusers\"\n         lineinfile:\n@@ -391,7 +391,7 @@\n         notify:\n             - restart sshd\n         when:\n-            - \"ubuntu1604cis_sshd['denyusers']|default('') != ''\"\n+            - \"ubuntu1604cis_sshd['denyusers']|default('')\"\n \n       - name: \"SCORED | 5.2.14 | PATCH | Ensure SSH access is limited - denygroups\"\n         lineinfile:\n@@ -402,7 +402,7 @@\n         notify:\n             - restart sshd\n         when:\n-            - \"ubuntu1604cis_sshd['denygroups']|default('') != ''\"\n+            - \"ubuntu1604cis_sshd['denygroups']|default('')\"\n   when:\n       - ubuntu1604cis_rule_5_2_14\n   tags:"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fixes #144 - HHVM mysql fix\n\nHHVM 3.6.0 has a bug to do with the MySQL socket path. Right now the\nonly solution for WordPress (since it uses PDO) is to symlink the\nsocket.\n\nSee https://github.com/facebook/hhvm/issues/4987", "sha": "2220523b5369cb96f1f6fe2d18242090d01e1307", "url": "https://api.github.com/repos/roots/trellis/commits/2220523b5369cb96f1f6fe2d18242090d01e1307", "parents": ["96af131e1644281d00ac519c31cfb866809d2098"], "files": [{"sha": "7e8337a67bf380028ed49935618530b0fd154564", "filename": "roles/hhvm/tasks/main.yml", "previous_filename": null, "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/roots/trellis/blob/2220523b5369cb96f1f6fe2d18242090d01e1307/roles/hhvm/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/2220523b5369cb96f1f6fe2d18242090d01e1307/roles/hhvm/tasks/main.yml", "status": "modified", "patch": "@@ -20,6 +20,12 @@\n - name: HHVM server.ini\n   template: src=server.ini.j2 dest=/etc/hhvm/server.ini\n \n+- name: HHVM php.ini\n+  template: src=php.ini.j2 dest=/etc/hhvm/php.ini\n+\n+- name: Symlink mysql.sock for HHVM\n+  file: src=/var/run/mysqld/mysqld.sock dest=/tmp/mysql.sock owner=mysql group=mysql state=link force=yes\n+\n - name: Start HHVM service\n   service: name=hhvm state=started enabled=true\n "}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #76", "sha": "fa9e89f81fa0afc0c182af06aca1e3ce16f28e23", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23", "parents": ["71dae01c79c1ff089e7279a54b4642fef92db820"], "files": [{"sha": "2e28616f7378bdc60055d77883dea5513e2dfaf6", "filename": "tasks/checks/distribution-checks.yml", "previous_filename": "tasks/distribution-checks.yml", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/checks/distribution-checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/checks/distribution-checks.yml", "status": "renamed", "patch": null}, {"sha": "daab84b3ab7dbe12286bde92db2fb0ff7ba1c24c", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -1,4 +1,25 @@\n ---\n+# https://wiki.ubuntu.com/SystemdForUpstartUsers\n+# Important! systemd is only fully supported in Ubuntu 15.04 and later releases\n+- name: Determine usage of systemd\n+  become: true\n+  shell: \"ps -p1 | grep systemd 1>/dev/null && echo systemd || echo upstart\"\n+  changed_when: no\n+  check_mode: no\n+  register: _determine_systemd_usage\n+\n+- name: Set fact to indicate systemd is used or not\n+  set_fact:\n+    _docker_systemd_used: \"{{ _determine_systemd_usage is defined and _determine_systemd_usage.stdout == 'systemd' }}\"\n+\n+- name: Configure systemd service\n+  include_tasks: configure-docker/configure-systemd.yml\n+  when: _docker_systemd_used | bool\n+\n+- name: Configure non-systemd service\n+  include_tasks: configure-docker/configure-non-systemd.yml\n+  when: not _docker_systemd_used | bool\n+\n - name: Ensure /etc/docker directory exists\n   become: true\n   file:"}, {"sha": "288ca2e6d5e5e91b05c6642fc580d3933b8a09e7", "filename": "tasks/checks.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/checks.yml", "status": "modified", "patch": "@@ -1,6 +1,6 @@\n ---\n-- include_tasks: distribution-checks.yml\n+- include_tasks: checks/distribution-checks.yml\n   when:\n     _docker_os_dist_check | bool\n \n-- include_tasks: compatibility-checks.yml\n+- include_tasks: checks/compatibility-checks.yml"}, {"sha": "c2d8c7433623060ed107702d6f41acd8286ad892", "filename": "tasks/configure-docker/configure-systemd.yml", "previous_filename": "tasks/configure-systemd.yml", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/configure-docker/configure-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/configure-docker/configure-systemd.yml", "status": "renamed", "patch": null}, {"sha": "6a2e411f2b901ee4195c98dbc0be9e9b865311cd", "filename": "tasks/main.yml", "previous_filename": null, "additions": 0, "deletions": 23, "changes": 23, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/main.yml", "status": "modified", "patch": "@@ -22,19 +22,6 @@\n     docker_systemd_service_config_tweaks: []\n     docker_service_envs: {}\n \n-# https://wiki.ubuntu.com/SystemdForUpstartUsers\n-# Important! systemd is only fully supported in Ubuntu 15.04 and later releases\n-- name: Determine usage of systemd\n-  become: true\n-  shell: \"ps -p1 | grep systemd 1>/dev/null && echo systemd || echo upstart\"\n-  changed_when: no\n-  check_mode: no\n-  register: _determine_systemd_usage\n-\n-- name: Set fact to indicate systemd is used or not\n-  set_fact:\n-    _docker_systemd_used: \"{{ _determine_systemd_usage is defined and _determine_systemd_usage.stdout == 'systemd' }}\"\n-\n - name: Temporary handling of deprecated variable docker_enable_ce_edge (#54)\n   set_fact:\n     docker_channel: edge\n@@ -67,16 +54,6 @@\n   include_tasks: bug-tweaks.yml\n   tags: [\"configure\"]\n \n-- name: Configure systemd service\n-  include_tasks: configure-systemd.yml\n-  when: _docker_systemd_used | bool\n-  tags: [\"configure\"]\n-\n-- name: Configure non-systemd service\n-  include_tasks: configure-non-systemd.yml\n-  when: not _docker_systemd_used | bool\n-  tags: [\"configure\"]\n-\n - name: Configure Docker\n   include_tasks: configure-docker.yml\n   tags: [\"configure\"]"}, {"sha": "32e7ca262c90a7c700f6d81bad1456756d151a76", "filename": "tasks/bug-tweaks.yml", "previous_filename": null, "additions": 3, "deletions": 61, "changes": 64, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/bug-tweaks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/bug-tweaks.yml", "status": "modified", "patch": "@@ -1,69 +1,11 @@\n-- name: Configuration to avoid 'Device or resource busy'\n-  block:\n-  - name: Stat /proc/sys/fs/may_detach_mounts (CentOS/RedHat)\n-    stat:\n-      path: /proc/sys/fs/may_detach_mounts\n-    register: may_detach_mounts\n-    check_mode: no\n-\n-  - name: Ensure fs.may_detach_mounts is set to avoid 'Device or resource busy' (CentOS/RedHat)\n-    become: true\n-    sysctl:\n-      name: fs.may_detach_mounts\n-      value: 1\n-      sysctl_file: /etc/sysctl.d/99-docker.conf\n-      reload: yes\n-    when: may_detach_mounts.stat.exists\n-\n-  # Keep for compatibility reasons of this role. Now everything is in the same file.\n-  - name: Remove systemd drop-in for Docker Mount Flags slave configuration (CentOS/RedHat)\n-    become: true\n-    file:\n-      path: /etc/systemd/system/docker.service.d/mountflags-slave.conf\n-      state: absent\n-    notify: restart docker\n-\n-  - name: Set MountFlags option to \"slave\" to prevent \"device busy\" errors on CentOS/RedHat 7.3 kernels (CentOS/RedHat)\n-    set_fact:\n-      docker_systemd_service_config_tweaks: \"{{ docker_systemd_service_config_tweaks + \\\n-        _systemd_service_config_tweaks }}\"\n-    vars:\n-      _systemd_service_config_tweaks:\n-        - 'MountFlags=slave'\n+- name: Configuration to avoid 'Device or resource busy' (CentOS/RedHat)\n+  include_tasks: bug-tweaks/bug-centos7-resource-busy.yml\n   when:\n     - _docker_os_dist == \"CentOS\" or _docker_os_dist == \"RedHat\"\n-    - docker_enable_mount_flag_fix | bool\n     - ansible_kernel | version_compare('4', '<')\n \n - name: Best effort handling to directlvm for Debian 8 to get uniform behavior across distributions\n-  block:\n-  - name: Create LVM thinpool for Docker according to Docker documentation\n-    include_tasks: lvm-thinpool.yml\n-    vars:\n-      pool:\n-        name: thinpool\n-        volume_group: docker\n-        physical_volumes: \"{{ docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+') \\\n-          | list | regex_replace('dm.directlvm_device=\\\\s*(.+)', '\\\\1') }}\"\n-        metadata_size: \"1%VG\"\n-        data_size: \"95%VG\"\n-\n-  - name: Modify storage-opts to handle problems with thinpool on Debian 8\n-    set_fact:\n-      _modified_storage_config: \"{{ (docker_daemon_config['storage-opts'] | difference(_exclusions)) + \\\n-        ['dm.thinpooldev=/dev/mapper/docker-thinpool-tpool'] }}\"\n-    vars:\n-      _exclusions: \"{{ docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+') | list }}\"\n-\n-  - name: Update Docker daemon configuration to handle consistency between distributions\n-    set_fact:\n-      docker_daemon_config: \"{{ docker_daemon_config | combine(_updated_item, recursive=true) }}\"\n-    vars:\n-      _updated_item: \"{ 'storage-opts': {{ _modified_storage_config }} }\"\n-\n-  - name: Updated Docker daemon configuration\n-    debug:\n-      var: docker_daemon_config\n+  include_tasks: bug-tweaks/tweak-debian8-directlvm.yml\n   when:\n     - _docker_os_dist == \"Debian\"\n     - _docker_os_dist_major_version == '8'"}, {"sha": "5f0fe561dbd24edd1600aab9c8420742a6dad9e9", "filename": "tasks/checks/compatibility-checks.yml", "previous_filename": "tasks/compatibility-checks.yml", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/checks/compatibility-checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/checks/compatibility-checks.yml", "status": "renamed", "patch": null}, {"sha": "ea43181c3cbef322147ad703a1389d78fa6f2b48", "filename": "tasks/configure-docker/configure-non-systemd.yml", "previous_filename": "tasks/configure-non-systemd.yml", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/configure-docker/configure-non-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/fa9e89f81fa0afc0c182af06aca1e3ce16f28e23/tasks/configure-docker/configure-non-systemd.yml", "status": "renamed", "patch": null}]}, {"repo": "robertdebock/ansible-role-tomcat", "author_id": "MDQ6VXNlcjU1NDIzMDc=", "author_name": "bdelemotte", "committer_id": "MDQ6VXNlcjU1NDIzMDc=", "committer_name": "bdelemotte", "committer_email": "barthelemy.delemotte@polyconseil.fr", "message": "fix #17", "sha": "6c40639685db155122fcd88cb56fcd1be3d95867", "url": "https://api.github.com/repos/robertdebock/ansible-role-tomcat/commits/6c40639685db155122fcd88cb56fcd1be3d95867", "parents": ["12c9f0e6332ae3069fb14e973ce404e1f03b3e8e"], "files": [{"sha": "c50347a37a40ee8fd8a76fdd94510030c15bd9b6", "filename": "tasks/instance.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/robertdebock/ansible-role-tomcat/blob/6c40639685db155122fcd88cb56fcd1be3d95867/tasks/instance.yml", "raw_url": "https://github.com/robertdebock/ansible-role-tomcat/raw/6c40639685db155122fcd88cb56fcd1be3d95867/tasks/instance.yml", "status": "modified", "patch": "@@ -54,7 +54,7 @@\n     src: setenv.sh.j2\n     dest: \"{{ tomcat_directory }}/{{ instance.name }}/bin/setenv.sh\"\n   when:\n-    - instance.java_opts is defined\n+    - (instance.java_opts is defined) or (instance.xms is defined) or (instance.xmx is defined)\n   notify:\n     - restart tomcat instance\n "}]}, {"repo": "Oefenweb/ansible-postfix", "author_id": "MDQ6VXNlcjc4NjA3", "author_name": "Andrew Grigorev", "committer_id": "MDQ6VXNlcjc4NjA3", "committer_name": "Andrew Grigorev", "committer_email": "andrew@ei-grad.ru", "message": "Fix duplicate aliases, closes #26", "sha": "171ee647fe6d63459a5b35ac6e67e0ff1795b94e", "url": "https://api.github.com/repos/Oefenweb/ansible-postfix/commits/171ee647fe6d63459a5b35ac6e67e0ff1795b94e", "parents": ["9365490687096b0f8ae4a57599e22f8b096b628a"], "files": [{"sha": "2d7882f730bb617e907be06b91ffc570e0b4223b", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Oefenweb/ansible-postfix/blob/171ee647fe6d63459a5b35ac6e67e0ff1795b94e/tasks/main.yml", "raw_url": "https://github.com/Oefenweb/ansible-postfix/raw/171ee647fe6d63459a5b35ac6e67e0ff1795b94e/tasks/main.yml", "status": "modified", "patch": "@@ -54,7 +54,7 @@\n - name: configure aliases\n   lineinfile:\n     dest: /etc/aliases\n-    regexp: '^{{ item.user }}:\\s+{{ item.alias }}'\n+    regexp: '^{{ item.user }}:.*'\n     line: '{{ item.user }}: {{ item.alias }}'\n     owner: root\n     group: root"}]}, {"repo": "ansible-ThoTeam/nexus3-oss", "author_id": "MDQ6VXNlcjE3Njc3Ng==", "author_name": "Olivier Clavel", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #65 from Brialius/Fix-version-comparison\n\nFix version comparison\r\n\r\nFixes #64", "sha": "86724cf84fd0fc05d82f8d3dd677b4674cba1338", "url": "https://api.github.com/repos/ansible-ThoTeam/nexus3-oss/commits/86724cf84fd0fc05d82f8d3dd677b4674cba1338", "parents": ["da19a34b6fe5f0aa93dd4a66c624695ccd323ca8", "975ad11730eb7c738633761c8ed62db78d72b513"], "files": [{"sha": "3f4508fee4d2e371978fda5f6a356ee87467deee", "filename": "tasks/nexus_install.yml", "previous_filename": null, "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ansible-ThoTeam/nexus3-oss/blob/86724cf84fd0fc05d82f8d3dd677b4674cba1338/tasks/nexus_install.yml", "raw_url": "https://github.com/ansible-ThoTeam/nexus3-oss/raw/86724cf84fd0fc05d82f8d3dd677b4674cba1338/tasks/nexus_install.yml", "status": "modified", "patch": "@@ -53,18 +53,18 @@\n - name: Get path to default settings\n   set_fact:\n     nexus_default_settings_file: \"{{ nexus_installation_dir }}/nexus-latest/etc/org.sonatype.nexus.cfg\"\n-  when: nexus_version < '3.1.0'\n+  when: nexus_version is version_compare('3.1.0', '<')\n \n - name: Get path to default settings\n   set_fact:\n     nexus_default_settings_file: \"{{ nexus_installation_dir }}/nexus-latest/etc/nexus-default.properties\"\n-  when: nexus_version >= '3.1.0'\n+  when: nexus_version is version_compare('3.1.0', '>=')\n \n - name: Get application settings directories\n   set_fact:\n     nexus_app_dir_settings_dirs:\n       - \"{{ nexus_installation_dir }}/nexus-latest/etc\"\n-  when: nexus_version < '3.1.0'\n+  when: nexus_version is version_compare('3.1.0', '<')\n \n - name: Get application settings directories\n   set_fact:\n@@ -75,17 +75,17 @@\n       - \"{{ nexus_installation_dir }}/nexus-latest/etc/fabric\"\n       - \"{{ nexus_installation_dir }}/nexus-latest/etc/logback\"\n       - \"{{ nexus_installation_dir }}/nexus-latest/etc/scripts\"\n-  when: nexus_version >= '3.1.0'\n+  when: nexus_version is version_compare('3.1.0', '>=')\n \n - name: Get rest API endpoint (v < 3.8.0)\n   set_fact:\n     nexus_rest_api_endpoint: \"service/siesta/rest/v1/script\"\n-  when: nexus_version < '3.8.0'\n+  when: nexus_version is version_compare('3.8.0', '<')\n \n - name: Get rest API endpoint (v >= 3.8.0)\n   set_fact:\n     nexus_rest_api_endpoint: \"service/rest/v1/script\"\n-  when: nexus_version >='3.8.0'\n+  when: nexus_version is version_compare('3.8.0', '>=')\n \n - name: Allow nexus to create first-time install configuration files in  {{ nexus_installation_dir }}/nexus-latest/etc\n   file:"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #20", "sha": "b0e86eb9314db3419c3ff30ef230518bad3fbae5", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/b0e86eb9314db3419c3ff30ef230518bad3fbae5", "parents": ["8e163ea5311fe60375fd7dc20c9ca22ca926bce4"], "files": [{"sha": "3b95f900b59348b8aaa0c53c13a82e1300713b93", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 14, "changes": 15, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/main.yml", "status": "modified", "patch": "@@ -1,18 +1,5 @@\n ---\n-- name: Fail if unsupported CentOS version\n-  fail:\n-    msg: \"CentOS 7 or later is required!\"\n-  when: ansible_distribution == \"CentOS\" and ansible_distribution_major_version < '7'\n-\n-- name: Fail if unsupported Fedora version\n-  fail:\n-    msg: \"Fedora 24 or later is required!\"\n-  when: ansible_distribution == \"Fedora\" and ansible_distribution_major_version < '24'\n-\n-- name: Fail if this roles does not support the distribution\n-  fail:\n-    msg: \"Distribution you are running is not supported by this role!\"\n-  when: ansible_distribution != \"Fedora\" and ansible_distribution != \"CentOS\"\n+- include: distribution-check.yml\n \n - include: setup-repository.yml\n "}, {"sha": "8b22eb105dbedc16fd7c46d5ddffe435b461a60b", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 53, "deletions": 10, "changes": 63, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -5,41 +5,84 @@\n   changed_when: false\n   when: ansible_distribution == \"Fedora\"\n \n-- name: Ensure yum-utils is installed\n+- name: Update APT cache\n+  apt:\n+    update_cache: yes\n+  become: true\n+  when: ansible_distribution == \"Ubuntu\" or\n+        ansible_distribution == \"Debian\"\n+\n+- name: Ensure packages are installed for repository setup\n   package:\n-    name: yum-utils\n+    name: \"{{ item }}\"\n+    state: present\n+  with_items: \n+    - \"{{ docker_repository_related_packages[ansible_distribution] }}\"\n+  become: true\n+  when: ansible_distribution == \"Ubuntu\" or\n+        ansible_distribution == \"Debian\" or\n+        ansible_distribution == \"CentOS\"\n+\n+- name: Add Docker\u2019s official GPG key\n+  apt_key:\n+    url: https://download.docker.com/linux/{{ ansible_distribution|lower }}/gpg\n+    state: present\n+  become: true\n+  when: (ansible_distribution == \"Ubuntu\" and ansible_distribution_major_version > '14')\n+        or ansible_distribution == \"Debian\"\n+\n+- name: Add Docker APT key (alternative for older Ubuntu systems without SNI).\n+  shell: \"curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\"\n+  args:\n+    warn: false\n+  become: true\n+  when: ansible_distribution == \"Ubuntu\" and\n+        ansible_distribution_major_version == '14'\n+\n+- name: Add Docker CE repository (Ubuntu/Debian)\n+  apt_repository:\n+    repo: deb [arch=amd64] https://download.docker.com/linux/{{ ansible_distribution|lower }} {{ ansible_distribution_release }} stable {{ (docker_enable_ce_edge == true) | ternary('edge','') }}\n     state: present\n+    filename: 'docker-ce'\n   become: true\n-  when: ansible_distribution == \"CentOS\"\n+  when: ansible_distribution == \"Ubuntu\" or\n+        ansible_distribution == \"Debian\"\n \n-- name: Add Docker CE repository\n+- name: Add Docker CE repository (Fedora/CentOS)\n   get_url:\n     url: \"{{ docker_repository_url[ansible_distribution] }}\"\n     dest: /etc/yum.repos.d/docker-ce.repo\n     mode: 0644\n   become: true\n   register: docker_repo\n+  when: ansible_distribution == \"CentOS\" or\n+        ansible_distribution == \"Fedora\"\n \n-- name: Determine Docker CE Edge repo status\n+- name: Determine Docker CE Edge repo status (Fedora/CentOS)\n   shell: \"{{ docker_cmd_check_edge_repo_status[ansible_distribution] }}\"\n   args:\n-    warn: false  \n+    warn: false\n   ignore_errors: yes\n   changed_when: false\n   register: cmd_docker_ce_edge_enabled\n+  when: ansible_distribution == \"CentOS\" or\n+        ansible_distribution == \"Fedora\"\n \n-- name: Set current Docker CE Edge repo status fact\n+- name: Set current Docker CE Edge repo status fact (Fedora/CentOS)\n   set_fact:\n     fact_docker_ce_edge_enabled: \"{{ cmd_docker_ce_edge_enabled.stdout == 'enabled = True' }}\"\n+  when: ansible_distribution == \"CentOS\" or\n+        ansible_distribution == \"Fedora\"\n \n-- name: Enable/Disable Docker CE Edge Repository\n+- name: Enable/Disable Docker CE Edge Repository (Fedora/CentOS)\n   shell: \"{{ docker_cmd_enable_disable_edge_repo[ansible_distribution] }}\"\n   become: true\n-  when: fact_docker_ce_edge_enabled != docker_enable_ce_edge\n+  when: (ansible_distribution == \"CentOS\" or ansible_distribution == \"Fedora\") and\n+        fact_docker_ce_edge_enabled != docker_enable_ce_edge\n \n - name: Update repository cache\n   shell: \"{{ docker_cmd_update_repo_cache[ansible_distribution] }}\"\n   args:\n-    warn: false  \n+    warn: false\n   become: true\n   when: docker_repo.changed\n\\ No newline at end of file"}, {"sha": "3ba6da956319ac47a0b432ae70f8d86ed9a4869a", "filename": "tasks/kernel-3-mount-fixes.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/kernel-3-mount-fixes.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/kernel-3-mount-fixes.yml", "status": "modified", "patch": "@@ -13,7 +13,7 @@\n   when: may_detach_mounts.stat.exists\n \n - name: Ensure /etc/systemd/system/docker.service.d directory exists\n-  file: \n+  file:\n     path: /etc/systemd/system/docker.service.d\n     state: directory\n     mode: 0755"}, {"sha": "16ffa8babde5e1d1d1dafdc9802515e25aca16bd", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -20,7 +20,7 @@\n     dest: /etc/docker/daemon.json\n   become: true\n   notify: restart docker\n-  when: docker_daemon_config_file is not defined and \n+  when: docker_daemon_config_file is not defined and\n         docker_daemon_config is defined\n \n - name: Ensure Docker default user namespace is defined in subuid and subgid\n@@ -37,6 +37,16 @@\n         docker_daemon_config['userns-remap'] == 'default') or\n         docker_bug_usermod|bool == true\n \n+\n+- name: Ensure thin-provisioning-tools is installed when devicemapper is used (Ubuntu)\n+  package:\n+    name: thin-provisioning-tools\n+    state: present\n+  become: yes\n+  when: (ansible_distribution == \"Ubuntu\" or ansible_distribution == \"Debian\") and \n+        docker_daemon_config['storage-driver'] is defined and \n+        docker_daemon_config['storage-driver'] == 'devicemapper'\n+\n - name: Enable Docker service\n   service:\n     name: docker\n@@ -50,4 +60,5 @@\n     name: docker\n   notify: restart docker\n   changed_when: docker_service.status.SubState != \"running\"\n-  \n\\ No newline at end of file\n+  when: docker_service.status is defined\n+"}, {"sha": "da48e816cf3e8fabfc11496bc2d738189272f530", "filename": "tasks/setup-audit.yml", "previous_filename": null, "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/setup-audit.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/setup-audit.yml", "status": "modified", "patch": "@@ -1,4 +1,12 @@\n ---\n+- name: Ensure auditd is installed\n+  package:\n+    name: auditd\n+    state: present\n+  become: true\n+  when: ansible_distribution == \"Ubuntu\" or \n+        ansible_distribution == \"Debian\"\n+\n - name: Copy Docker audit rules\n   copy:\n     src: files/etc/audit/rules.d/docker.rules"}, {"sha": "90f220163d70cad468f63d007a94995d7a551267", "filename": "tasks/remove-pre-docker-ce.yml", "previous_filename": null, "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/remove-pre-docker-ce.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b0e86eb9314db3419c3ff30ef230518bad3fbae5/tasks/remove-pre-docker-ce.yml", "status": "modified", "patch": "@@ -30,9 +30,5 @@\n     state: absent\n   become: true\n   when: remove_old_docker|default(false) | bool == true\n-  with_items:\n-    - docker\n-    - docker-common\n-    - container-selinux\n-    - docker-selinux\n-    - docker-engine\n+  with_items: \n+    - \"{{ docker_old_packages[ansible_distribution] }}\""}, {"sha": "05088b314e2700277d56bba6d4899332309122f2", "filename": "meta/main.yml", "previous_filename": null, "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b0e86eb9314db3419c3ff30ef230518bad3fbae5/meta/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b0e86eb9314db3419c3ff30ef230518bad3fbae5/meta/main.yml", "status": "modified", "patch": "@@ -8,10 +8,22 @@ galaxy_info:\n     versions:\n       - 24\n       - 25\n+      - 26\n+\n   - name: EL\n     versions:\n       - 7\n \n+  - name: Debian\n+    versions:\n+      - jessie\n+      - stretch\n+\n+  - name: Ubuntu\n+    versions:\n+      - trusty\n+      - xenial\n+\n   galaxy_tags:\n     - docker\n     - docker-ce"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #639 - WP 4.6 compat: update WP-CLI to 0.24.1", "sha": "84c184cb2178f1787292912c7b402ee9cff8e5b4", "url": "https://api.github.com/repos/roots/trellis/commits/84c184cb2178f1787292912c7b402ee9cff8e5b4", "parents": ["7736334bb143cf6ee56adc9db597785c09acf67d"], "files": [{"sha": "71a1e5ee02744c68e8e94eb54482a4f7065ebe1d", "filename": "roles/wp-cli/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/84c184cb2178f1787292912c7b402ee9cff8e5b4/roles/wp-cli/defaults/main.yml", "raw_url": "https://github.com/roots/trellis/raw/84c184cb2178f1787292912c7b402ee9cff8e5b4/roles/wp-cli/defaults/main.yml", "status": "modified", "patch": "@@ -1,4 +1,4 @@\n-wp_cli_version: 0.24.0\n+wp_cli_version: 0.24.1\n wp_cli_bin_path: /usr/bin/wp\n wp_cli_phar_url: \"https://github.com/wp-cli/wp-cli/releases/download/v{{ wp_cli_version }}/wp-cli-{{ wp_cli_version }}.phar\"\n wp_cli_completion_url: \"https://raw.githubusercontent.com/wp-cli/wp-cli/v{{ wp_cli_version }}/utils/wp-completion.bash\""}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #97", "sha": "f3c81d09c0c321256db259c574f7bfcd33681c9e", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/f3c81d09c0c321256db259c574f7bfcd33681c9e", "parents": ["780b1754c3ac0406b0f3768fe2cfe3e89530913f"], "files": [{"sha": "f3c95a2bc8422497879989ca795fd6b97873f488", "filename": "tasks/checks/distribution-checks-RedHat.yml", "previous_filename": null, "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f3c81d09c0c321256db259c574f7bfcd33681c9e/tasks/checks/distribution-checks-RedHat.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f3c81d09c0c321256db259c574f7bfcd33681c9e/tasks/checks/distribution-checks-RedHat.yml", "status": "modified", "patch": "@@ -3,3 +3,10 @@\n   fail:\n     msg: \"RedHat 7 or later is required!\"\n   when: _docker_os_dist_major_version < '7'\n+\n+# https://github.com/haxorof/ansible-role-docker-ce/issues/97\n+- name: Fail if Docker SDK/Stack/Compose shall be installed using PiP on RedHat\n+  fail:\n+    msg: \"This role does not handle packages coming from PiP!\"\n+  when: (docker_sdk | bool) or (docker_stack | bool)\n+    or (docker_compose | bool and not docker_compose_no_pip | bool)"}]}, {"repo": "florianutz/Ubuntu1604-CIS", "author_id": "MDQ6VXNlcjEzNjMyNDU0", "author_name": "Isaac Bentley", "committer_id": "MDQ6VXNlcjEzNjgzNzQz", "committer_name": "Florian Utz", "committer_email": "florianutz@users.noreply.github.com", "message": "fixed 1.4.1 missing condition to skip (#24)", "sha": "836dc4dd0dacc490044a14c0e39469d162b9449b", "url": "https://api.github.com/repos/florianutz/Ubuntu1604-CIS/commits/836dc4dd0dacc490044a14c0e39469d162b9449b", "parents": ["b4e1f0b868b5b344029a2a379812bd7112534a26"], "files": [{"sha": "377da8f4a0e8a1455ff9eb42ced862040df4b618", "filename": "tasks/section1.yml", "previous_filename": null, "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/836dc4dd0dacc490044a14c0e39469d162b9449b/tasks/section1.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/836dc4dd0dacc490044a14c0e39469d162b9449b/tasks/section1.yml", "status": "modified", "patch": "@@ -586,7 +586,9 @@\n       owner: root\n       group: root\n       mode: 0600\n-  when: ansible_os_family == \"Debian\"\n+  when: \n+      - ansible_os_family == \"Debian\"\n+      - ubuntu1604cis_rule_1_4_1\n   tags:\n       - level1\n       - scored"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "haxorof", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "haxorof", "committer_email": "bjorn.oscarsson@gmail.com", "message": "Fixes #1", "sha": "b11c4477d973b0cc87a296f6b028eaf9abab4686", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/b11c4477d973b0cc87a296f6b028eaf9abab4686", "parents": ["23d89498e8b43ab624b6e832c34b722ae49f106d"], "files": [{"sha": "2c307c60a332af536d304b4059175c10570610dc", "filename": "tasks/main-Generic.yml", "previous_filename": null, "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b11c4477d973b0cc87a296f6b028eaf9abab4686/tasks/main-Generic.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b11c4477d973b0cc87a296f6b028eaf9abab4686/tasks/main-Generic.yml", "status": "modified", "patch": "@@ -10,7 +10,7 @@\n - name: Set fact if old Docker installation shall be removed\n   set_fact:\n     remove_old_docker: \"{{docker_remove_pre_ce | bool }} == true and {{ cmd_docker_version.stdout_lines[0] | search('-ce') }} == false\"\n-  when: cmd_docker_version.stdout_lines[0] is defined\n+  when: cmd_docker_version.stdout_lines is defined and cmd_docker_version.stdout_lines[0] is defined\n \n - name: Check if Docker is running\n   command: systemctl status docker\n@@ -53,13 +53,22 @@\n     mode: 0755\n   become: true\n \n-- name: Configure Docker daemon\n+- name: Configure Docker daemon (file)\n   copy:\n-    content: \"{{docker_daemon_config | to_nice_json}}\"\n+    src: \"{{ docker_daemon_config_file }}\"\n     dest: /etc/docker/daemon.json\n   become: true\n   notify: restart docker\n-  when: docker_daemon_config is defined\n+  when: docker_daemon_config_file is defined\n+\n+- name: Configure Docker daemon (variables)\n+  copy:\n+    content: \"{{ docker_daemon_config | to_nice_json }}\"\n+    dest: /etc/docker/daemon.json\n+  become: true\n+  notify: restart docker\n+  when: docker_daemon_config_file is not defined and \n+        docker_daemon_config is defined\n \n - name: Enable and start Docker service\n   service:"}]}, {"repo": "dev-sec/ansible-os-hardening", "author_id": null, "author_name": "Sebastian Gumprich", "committer_id": null, "committer_name": "Sebastian Gumprich", "committer_email": "sebastian.gumprich@38.de", "message": "add rhel7 pam_pwquality. fix #73", "sha": "723205f8f257f89edf6d665ac8b5a8eaa9964f70", "url": "https://api.github.com/repos/dev-sec/ansible-os-hardening/commits/723205f8f257f89edf6d665ac8b5a8eaa9964f70", "parents": ["f7774d150341f16d9a334acd302ca9c2a56c4db1"], "files": [{"sha": "b2774456b37cba6dabe6e6bffe7011b34b942d91", "filename": "tasks/pam.yml", "previous_filename": null, "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/dev-sec/ansible-os-hardening/blob/723205f8f257f89edf6d665ac8b5a8eaa9964f70/tasks/pam.yml", "raw_url": "https://github.com/dev-sec/ansible-os-hardening/raw/723205f8f257f89edf6d665ac8b5a8eaa9964f70/tasks/pam.yml", "status": "modified", "patch": "@@ -31,7 +31,7 @@\n   when: (ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu') and not os_auth_pam_passwdqc_enable\n \n - name: install tally2\n-  apt: name='libpam-modules' state=installed\n+  apt: name='libpam-modules' state='installed'\n   when: (ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu') and not os_auth_pam_passwdqc_enable and os_auth_retries > 0\n \n - name: configure tally2\n@@ -43,12 +43,16 @@\n   when: (ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu') and not os_auth_pam_passwdqc_enable and os_auth_retries == 0\n \n - name: remove pam_cracklib, because it does not play nice with passwdqc\n-  yum: name='{{os_packages_pam_cracklib}}' state=absent\n-  when: (ansible_distribution == 'RedHat' or ansible_distribution == 'Oracle Linux') and os_auth_pam_passwdqc_enable\n+  yum: name='{{os_packages_pam_cracklib}}' state='absent'\n+  when: ((ansible_distribution == 'RedHat' or ansible_distribution == 'Oracle Linux' and ansible_distribution_version <= '7')) and os_auth_pam_passwdqc_enable\n \n - name: install the package for strong password checking\n   yum: name='{{os_packages_pam_passwdqc}}' state='installed'\n-  when: (ansible_distribution == 'RedHat' or ansible_distribution == 'Oracle Linux') and os_auth_pam_passwdqc_enable\n+  when: ((ansible_distribution == 'RedHat' or ansible_distribution == 'Oracle Linux' and ansible_distribution_version <= '7')) and os_auth_pam_passwdqc_enable\n+\n+- name: install pam_pwquality on rhel7, replacement for pam_passwdqc and pam_cracklib\n+  yum: name='{{os_packages_pam_pwquality}}' state='installed'\n+  when: ((ansible_distribution == 'RedHat' or ansible_distribution == 'Oracle Linux' and ansible_distribution_version >= '7')) and os_auth_pam_passwdqc_enable\n \n - name: remove passwdqc\n   yum: name='{{os_packages_pam_passwdqc}}' state='absent'"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #94", "sha": "c9d0a3fd1dc920af84c1182539265ad47c629424", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/c9d0a3fd1dc920af84c1182539265ad47c629424", "parents": ["d449b97319b9bf3d4f058f53062285782d254340"], "files": [{"sha": "6fd1e261cd36b8c8e5f32728e3386b070e161cd8", "filename": "tasks/checks/compatibility-checks.yml", "previous_filename": null, "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/checks/compatibility-checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/checks/compatibility-checks.yml", "status": "modified", "patch": "@@ -9,7 +9,7 @@\n       triggers a bug (https://github.com/moby/moby/issues/35873). For now,\n       don't use both.\n   when:\n-    - docker_enable_mount_flag_fix\n+    - docker_enable_mount_flag_fix | bool\n     - docker_daemon_config['live-restore'] is defined\n     - docker_daemon_config['live-restore']\n \n@@ -23,8 +23,8 @@\n   when:\n     - _docker_os_dist == \"Debian\"\n     - _docker_os_dist_major_version == '7'\n-    - docker_stack|bool or\n-      docker_sdk|bool or\n-      docker_pip_upgrade|bool or\n-      (docker_compose|bool and not docker_compose_no_pip|bool) or\n+    - docker_stack | bool or\n+      docker_sdk | bool or\n+      docker_pip_upgrade | bool or\n+      (docker_compose | bool and not docker_compose_no_pip | bool) or\n       docker_additional_packages_pip|length > 0\n\\ No newline at end of file"}, {"sha": "7bd63021e9e0cf9ab0eec912e33758e9d80104dd", "filename": "tasks/main.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/main.yml", "status": "modified", "patch": "@@ -47,13 +47,13 @@\n     - name: Network access disabled\n       debug:\n         msg: \"Tasks requiring network access will be skipped!\"\n-      when: not docker_network_access\n+      when: not docker_network_access | bool\n \n     - name: Remove Docker versions before Docker CE\n       include_tasks: remove-pre-docker-ce.yml\n       when:\n         - docker_remove_pre_ce | bool\n-        - docker_network_access\n+        - docker_network_access | bool\n       tags: [\"install\"]\n \n     - name: Setup Docker package repositories\n@@ -62,7 +62,7 @@\n \n     - name: Install Docker\n       include_tasks: install-docker.yml\n-      when: docker_network_access\n+      when: docker_network_access | bool\n       tags: [\"install\"]\n \n     - name: Configure audit logging\n@@ -79,7 +79,7 @@\n \n     - name: Postinstall tasks\n       include_tasks: postinstall.yml\n-      when: docker_network_access\n+      when: docker_network_access | bool\n       tags: [\"install\", \"postinstall\"]\n   when: not docker_remove | bool\n "}, {"sha": "4496a113ca0109bc78721ccf96ccdaa143380cbe", "filename": "tasks/configure-docker/configure-docker-plugins.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/configure-docker/configure-docker-plugins.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/configure-docker/configure-docker-plugins.yml", "status": "modified", "patch": "@@ -32,7 +32,7 @@\n   register: _docker_plugin_install\n   changed_when: _docker_plugin_install.stdout_lines | last == 'installed'\n   when:\n-    - docker_network_access\n+    - docker_network_access | bool\n \n - name: Reset list of authorization plugins\n   set_fact:"}, {"sha": "8083bcef1356240b6a99969c0d7396005204fe15", "filename": "tasks/setup-audit.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/setup-audit.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/setup-audit.yml", "status": "modified", "patch": "@@ -7,8 +7,8 @@\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when:\n-    - docker_enable_audit\n-    - docker_network_access\n+    - docker_enable_audit | bool\n+    - docker_network_access | bool\n     - _docker_os_dist == \"Ubuntu\" or _docker_os_dist == \"Debian\"\n \n - name: Copy Docker audit rules\n@@ -17,12 +17,12 @@\n     src: files/etc/audit/rules.d/docker.rules\n     dest: /etc/audit/rules.d/docker.rules\n   notify: restart auditd\n-  when: docker_enable_audit\n+  when: docker_enable_audit | bool\n \n - name: Ensure Docker audit rules are removed\n   become: yes\n   file:\n     path: /etc/audit/rules.d/docker.rules\n     state: absent\n   notify: restart auditd\n-  when: not docker_enable_audit\n+  when: not docker_enable_audit | bool"}, {"sha": "0b7061102b251de9017b7f85c3a71dc717a0e278", "filename": "tasks/setup-repository-CentOS.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/setup-repository-CentOS.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/setup-repository-CentOS.yml", "status": "modified", "patch": "@@ -9,7 +9,7 @@\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when:\n-    - docker_network_access\n+    - docker_network_access | bool\n     - _docker_os_dist == \"CentOS\" or _docker_os_dist == \"RedHat\"\n \n - name: Determine channels to be enabled and/or disabled\n@@ -29,7 +29,7 @@\n   register: _docker_repo\n   until: _docker_repo is succeeded\n   when:\n-    - docker_network_access\n+    - docker_network_access | bool\n     - _docker_os_dist == \"CentOS\" or\n       _docker_os_dist == \"Fedora\" or\n       _docker_os_dist == \"RedHat\""}, {"sha": "c5bb1284a46d5256943a51eeb58fa9055f5eca39", "filename": "tasks/setup-repository-Ubuntu.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/setup-repository-Ubuntu.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/setup-repository-Ubuntu.yml", "status": "modified", "patch": "@@ -7,7 +7,7 @@\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when:\n-    - docker_network_access\n+    - docker_network_access | bool\n \n - name: Ensure packages are installed for repository setup\n   become: true\n@@ -19,7 +19,7 @@\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when:\n-    - docker_network_access\n+    - docker_network_access | bool\n \n - name: Add Docker official GPG key\n   become: true\n@@ -29,7 +29,7 @@\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when:\n-    - docker_network_access\n+    - docker_network_access | bool\n     - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version > '14') or\n       (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version > '7')\n \n@@ -40,7 +40,7 @@\n     warn: false\n   changed_when: false\n   when:\n-    - docker_network_access\n+    - docker_network_access | bool\n     - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version == '14') or\n       (_docker_os_dist == \"Debian\" and  _docker_os_dist_major_version == '7')\n   tags:"}, {"sha": "da6bee6c04ca9f118baf7c663c0648b780a7b104", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c9d0a3fd1dc920af84c1182539265ad47c629424/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -10,6 +10,6 @@\n   changed_when: false\n   register: _result\n   until: _result is succeeded\n-  when: docker_network_access\n+  when: docker_network_access | bool\n   tags:\n     - skip_ansible_lint\n\\ No newline at end of file"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #86", "sha": "b1f0b3f98a0e03afb7b2aaf3789fd3a522714f16", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/b1f0b3f98a0e03afb7b2aaf3789fd3a522714f16", "parents": ["96a666df829ebcc7dd76bf39d53472a38633bdaf"], "files": [{"sha": "4def619176767703b409e555403d0ce2d9a797b4", "filename": "tasks/install-docker.yml", "previous_filename": null, "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b1f0b3f98a0e03afb7b2aaf3789fd3a522714f16/tasks/install-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b1f0b3f98a0e03afb7b2aaf3789fd3a522714f16/tasks/install-docker.yml", "status": "modified", "patch": "@@ -1,14 +1,28 @@\n ---\n-- name: Set docker-ce package state to latest\n+- name: Set version string\n+  set_fact:\n+    _docker_version_string: \"{{ docker_os_pkg_version_separator[_docker_os_dist] }}{{ docker_version }}\"\n+  when: docker_version != ''\n+\n+- name: Set packages state to latest\n   set_fact:\n     _docker_pkg_state: 'latest'\n   when: docker_latest_version | bool\n \n-- name: Ensure docker-ce is installed\n+- name: Filter out packages to match older Docker CE versions\n+  set_fact:\n+    _docker_packages:\n+      - docker-ce\n+  when:\n+    - docker_version != ''\n+    - docker_version | match('17.') or docker_version | match('18.03') or docker_version | match('18.06')\n+\n+- name: Ensure Docker CE is installed\n   become: true\n   package:\n-    name: \"{{ docker_pkg_name }}\"\n+    name: \"{{ (item | search('docker')) | ternary((item + _docker_version_string | default('')), item) }}\"\n     state: \"{{ _docker_pkg_state | default('present') }}\"\n+  with_items: \"{{ _docker_packages | default(docker_packages) }}\"\n   register: _pkg_result\n   until: _pkg_result|succeeded\n   notify: restart docker"}, {"sha": "e4fa3cb08c4e99ab84378e041eebcefcc8e9d912", "filename": "tasks/main.yml", "previous_filename": null, "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b1f0b3f98a0e03afb7b2aaf3789fd3a522714f16/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b1f0b3f98a0e03afb7b2aaf3789fd3a522714f16/tasks/main.yml", "status": "modified", "patch": "@@ -31,6 +31,12 @@\n     - docker_enable_ce_edge\n   tags: [\"always\"]\n \n+- name: Temporary handling of deprecated variable docker_pkg_name\n+  set_fact:\n+    docker_version: \"{{ docker_pkg_name | regex_replace('^docker-ce.(.+)$', '\\\\1') }}\"\n+  when: docker_pkg_name | match('docker-ce' + docker_os_pkg_version_separator[_docker_os_dist])\n+  tags: [\"always\"]\n+\n - name: Compatibility and distribution checks\n   include_tasks: checks.yml\n   when: docker_do_checks | bool"}, {"sha": "974a866315ca02e5fb2dcf5a386d90dfd3b5657a", "filename": "tasks/uninstall-docker.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/b1f0b3f98a0e03afb7b2aaf3789fd3a522714f16/tasks/uninstall-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/b1f0b3f98a0e03afb7b2aaf3789fd3a522714f16/tasks/uninstall-docker.yml", "status": "modified", "patch": "@@ -12,7 +12,7 @@\n   package:\n     name: \"{{ item }}\"\n     state: absent\n-  with_items: \"{{ docker_packages.versioned + docker_packages.dependencies }}\"\n+  with_items: \"{{ docker_packages }}\"\n   register: _pkg_result\n   until: _pkg_result|succeeded\n   when: _docker_os_dist != \"Ubuntu\" and\n@@ -24,7 +24,7 @@\n     name: \"{{ item }}\"\n     state: absent\n     purge: yes\n-  with_items: \"{{ docker_packages.versioned + docker_packages.dependencies }}\"\n+  with_items: \"{{ docker_packages }}\"\n   register: _pkg_result\n   until: _pkg_result|succeeded\n   when: _docker_os_dist == \"Ubuntu\" or"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjEwNTU3MzE4", "author_name": "Dan Jurgensmeyer", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "fix variable name (#143)", "sha": "f4f0e22738291a56093e4cb61c55706fec3a74d3", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/f4f0e22738291a56093e4cb61c55706fec3a74d3", "parents": ["e75cabae2d692a152ca21c185a313528b8bac3c8"], "files": [{"sha": "a107b04279d6228407950dc975e3daa94ead9dfd", "filename": "roles/ansible/tower/manage-job-templates/tasks/set-permissions.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/f4f0e22738291a56093e4cb61c55706fec3a74d3/roles/ansible/tower/manage-job-templates/tasks/set-permissions.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/f4f0e22738291a56093e4cb61c55706fec3a74d3/roles/ansible/tower/manage-job-templates/tasks/set-permissions.yml", "status": "modified", "patch": "@@ -9,12 +9,12 @@\n   with_items:\n   - \"{{ existing_teams_output.rest_output }}\"\n     \n-- name: \"Obtain user id based on the user name\"\n+- name: \"Obtain user id based on the username\"\n   set_fact:\n     object_id: \"{{ item.id }}\" \n   when:\n   - permissions_object == \"users\"\n-  - item.name|trim == permissions_value.name|trim\n+  - item.username|trim == permissions_value.name|trim\n   with_items:\n   - \"{{ existing_users_output.rest_output }}\"\n "}, {"sha": "00301ef527ab46c2cc1b3995eeb814a6db0abd08", "filename": "roles/ansible/tower/manage-job-templates/tests/inventory/group_vars/tower.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/f4f0e22738291a56093e4cb61c55706fec3a74d3/roles/ansible/tower/manage-job-templates/tests/inventory/group_vars/tower.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/f4f0e22738291a56093e4cb61c55706fec3a74d3/roles/ansible/tower/manage-job-templates/tests/inventory/group_vars/tower.yml", "status": "modified", "patch": "@@ -8,7 +8,7 @@ ansible_tower_job_templates:\n   inventory: \"Inventory1\"\n   project: \"Project1\"\n   playbook: \"playbooks/prep.yml\"\n-  credential: \"Credential1\"\n+  credential: \"Cred1\"\n   extra_vars: \"---\\\\nhello: world\\\\n\"\n   ask_variables_on_launch: true\n   permissions:"}]}, {"repo": "geerlingguy/ansible-role-security", "author_id": "MDQ6VXNlcjQ1OTYzMQ==", "author_name": "Fabian Pfaff", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #29 The use of 'include' for tasks has been deprecated\n\nThis change preserves the previous behavior.\n\n> Before 2.0 all includes were \u2018static\u2019, executed at play compile\n  time.\n\nhttps://docs.ansible.com/ansible/latest/include_module.html", "sha": "e65b117799560d3fd9ba998fcb50a85bd10e6178", "url": "https://api.github.com/repos/geerlingguy/ansible-role-security/commits/e65b117799560d3fd9ba998fcb50a85bd10e6178", "parents": ["3c8d04f3e0875a9baf1f1282f6665b2e7d6871a8"], "files": [{"sha": "f5616d2346e28c1360916d3296f6a0ff70477900", "filename": "meta/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/geerlingguy/ansible-role-security/blob/e65b117799560d3fd9ba998fcb50a85bd10e6178/meta/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-security/raw/e65b117799560d3fd9ba998fcb50a85bd10e6178/meta/main.yml", "status": "modified", "patch": "@@ -6,7 +6,7 @@ galaxy_info:\n   description: Security software installation and configuration.\n   company: \"Midwestern Mac, LLC\"\n   license: \"license (BSD, MIT)\"\n-  min_ansible_version: 2.0\n+  min_ansible_version: 2.4\n   platforms:\n     - name: EL\n       versions:"}, {"sha": "8e045e63fa0c3517700806f52f1df927d694cdc4", "filename": "tasks/main.yml", "previous_filename": null, "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/geerlingguy/ansible-role-security/blob/e65b117799560d3fd9ba998fcb50a85bd10e6178/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-security/raw/e65b117799560d3fd9ba998fcb50a85bd10e6178/tasks/main.yml", "status": "modified", "patch": "@@ -3,22 +3,22 @@\n   include_vars: \"{{ ansible_os_family }}.yml\"\n \n # Fail2Ban\n-- include: fail2ban-RedHat.yml\n+- import_tasks: fail2ban-RedHat.yml\n   when: ansible_os_family == 'RedHat' and security_fail2ban_enabled\n \n-- include: fail2ban-Debian.yml\n+- import_tasks: fail2ban-Debian.yml\n   when: ansible_os_family == 'Debian' and security_fail2ban_enabled\n \n - name: Ensure fail2ban is running and enabled on boot.\n   service: name=fail2ban state=started enabled=yes\n   when: security_fail2ban_enabled\n \n # SSH\n-- include: ssh.yml\n+- import_tasks: ssh.yml\n \n # Autoupdate\n-- include: autoupdate-RedHat.yml\n+- import_tasks: autoupdate-RedHat.yml\n   when: ansible_os_family == 'RedHat' and security_autoupdate_enabled\n \n-- include: autoupdate-Debian.yml\n+- import_tasks: autoupdate-Debian.yml\n   when: ansible_os_family == 'Debian' and security_autoupdate_enabled"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #28", "sha": "e64dfdb8be76c4a33d0c346f7a9bfd7110e6696c", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/e64dfdb8be76c4a33d0c346f7a9bfd7110e6696c", "parents": ["f7841e3847e34fb8c2790fe304a1c954eeb1bfce"], "files": [{"sha": "83ed0a7a7d95ebeb9046e12d311f06d163d98e80", "filename": "meta/main.yml", "previous_filename": null, "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/e64dfdb8be76c4a33d0c346f7a9bfd7110e6696c/meta/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/e64dfdb8be76c4a33d0c346f7a9bfd7110e6696c/meta/main.yml", "status": "modified", "patch": "@@ -1,7 +1,7 @@\n galaxy_info:\n   author: Bjorn Oscarsson\n   description: \"Installs and configures Docker Community Edition (CE)\"\n-  min_ansible_version: 2.1\n+  min_ansible_version: 2.3\n   license: MIT\n   platforms:\n   - name: Fedora\n@@ -26,6 +26,5 @@ galaxy_info:\n \n   galaxy_tags:\n     - docker\n-    - docker-ce\n \n dependencies: []"}, {"sha": "2c6626b499aba005c6c422365b9549fce3b07809", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/e64dfdb8be76c4a33d0c346f7a9bfd7110e6696c/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/e64dfdb8be76c4a33d0c346f7a9bfd7110e6696c/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -84,33 +84,33 @@\n   when: (docker_os_dist == \"CentOS\" or docker_os_dist == \"Fedora\" or docker_os_dist == \"RedHat\") and\n         fact_docker_ce_edge_enabled != docker_enable_ce_edge\n         \n-# disable rt-beta so we don't get a 403 error retrieving repomd.xml\n-- name: Check if rt-beta Repository is disabled (RedHat) # \n+# disable rt-beta so we don't get a 403 error retrieving repond.xml\n+- name: Check if rhel-7-server-rt-beta-rpms Repository is disabled (RedHat)\n   shell: \"subscription-manager repos --list-disabled | grep rhel-7-server-rt-beta-rpms\"\n   become: true\n   register: cmd_rhel_rt_beta_repo_disabled\n   when: docker_os_dist == \"RedHat\"\n   changed_when: false\n   failed_when: cmd_rhel_rt_beta_repo_disabled.rc not in [ 0, 1 ]\n \n-- name: Disable rt-beta Repository (RedHat)\n+- name: Disable rhel-7-server-rt-beta-rpms Repository (RedHat)\n   shell: \"subscription-manager repos --disable=rhel-7-server-rt-beta-rpms\"\n   become: true\n-  when: cmd_rhel_rt_beta_repo_disabled.rc == 1 and docker_os_dist == \"RedHat\"\n+  when: docker_os_dist == \"RedHat\" and cmd_rhel_rt_beta_repo_disabled.rc == 1\n \n # container-selinux package wants this\n-- name: Check if extras Repository is enabled (RedHat)\n+- name: Check if rhel-7-server-extras-rpms Repository is enabled (RedHat)\n   shell: \"subscription-manager repos --list-enabled | grep rhel-7-server-extras-rpms\"\n   become: true\n   register: cmd_rhel_extras_repo_enabled\n   when: docker_os_dist == \"RedHat\"\n   changed_when: false\n   failed_when: cmd_rhel_extras_repo_enabled.rc not in [ 0, 1 ]\n \n-- name: Disable rt-beta Repository (RedHat)\n+- name: Disable rhel-7-server-extras-rpms Repository (RedHat)\n   shell: \"subscription-manager repos --enable=rhel-7-server-extras-rpms\"\n   become: true\n-  when: cmd_rhel_extras_repo_enabled.rc == 1 and docker_os_dist == \"RedHat\"\n+  when: docker_os_dist == \"RedHat\" and cmd_rhel_extras_repo_enabled.rc == 1\n \n - name: Update repository cache\n   shell: \"{{ docker_cmd_update_repo_cache[docker_os_dist] }}\""}]}, {"repo": "NVIDIA/deepops", "author_id": "MDQ6VXNlcjExMzMzNjI0", "author_name": "Tony Fouchard", "committer_id": "MDQ6VXNlcjEwMzQzMA==", "committer_name": "Doug Holt", "committer_email": "doug.holt@gmail.com", "message": "Fix qwant (#39)\n\n* Fixed dgx-servers group and YML file name in README.md\r\n\r\n* Deepops provisioning through proxies", "sha": "30e72e8f702e8d9bec1351260ec992a071d09fe5", "url": "https://api.github.com/repos/NVIDIA/deepops/commits/30e72e8f702e8d9bec1351260ec992a071d09fe5", "parents": ["0abeba9c69c70823dbe73e7bcc5f69acfffffb90"], "files": [{"sha": "3b605c25a0dcb72402b636a8c788a6721bb94a1d", "filename": "playbooks/k8s-gpu.yml", "previous_filename": null, "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/NVIDIA/deepops/blob/30e72e8f702e8d9bec1351260ec992a071d09fe5/playbooks/k8s-gpu.yml", "raw_url": "https://github.com/NVIDIA/deepops/raw/30e72e8f702e8d9bec1351260ec992a071d09fe5/playbooks/k8s-gpu.yml", "status": "modified", "patch": "@@ -18,7 +18,8 @@\n     - name: nvidia-docker | apt key\n       apt_key:\n         url: https://nvidia.github.io/nvidia-docker/gpgkey\n-        state: latest\n+        state: present\n+      environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n     - name: nvidia-docker | apt repo\n       apt_repository:\n         repo: \"{{ item }}\"\n@@ -29,13 +30,15 @@\n         - \"deb https://nvidia.github.io/libnvidia-container/ubuntu16.04/amd64 /\"\n         - \"deb https://nvidia.github.io/nvidia-container-runtime/ubuntu16.04/amd64 /\"\n         - \"deb https://nvidia.github.io/nvidia-docker/ubuntu16.04/amd64 /\"\n+      environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n     - name: nvidia-docker | install\n       apt:\n         name: \"{{ item }}\"\n         state: present\n       with_items:\n         - \"nvidia-docker2=2.0.3+docker18.03.1-1\"\n         - \"nvidia-container-runtime=2.0.0+docker18.03.1-1\"\n+      environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n     - name: set docker default runtime\n       copy:\n         content: \"{{ daemon_json | to_nice_json }}\""}, {"sha": "81f9ad2da870785bbcc62c5d36855f4412bb3eae", "filename": "ansible/roles/dgx-software/tasks/main.yml", "previous_filename": null, "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/NVIDIA/deepops/blob/30e72e8f702e8d9bec1351260ec992a071d09fe5/ansible/roles/dgx-software/tasks/main.yml", "raw_url": "https://github.com/NVIDIA/deepops/raw/30e72e8f702e8d9bec1351260ec992a071d09fe5/ansible/roles/dgx-software/tasks/main.yml", "status": "modified", "patch": "@@ -27,6 +27,7 @@\n   with_items: \"{{ default_ubuntu_packages }}\"\n   tags:\n     - packages\n+  environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n \n - name: install smart monitoring tools\n   apt:\n@@ -37,6 +38,7 @@\n     - smartmontools\n   tags:\n     - packages\n+  environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n \n - name: install nvidia drivers and datacenter manager\n   apt:\n@@ -49,6 +51,7 @@\n     - nvidia-sysinfo-dgx\n   tags:\n     - packages\n+  environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n   when: not is_official\n \n - name: install nvidia peer memory\n@@ -60,5 +63,6 @@\n     - nvidia-peer-memory-dkms\n   tags:\n     - packages\n+  environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n   when: not is_official\n "}, {"sha": "538286690feb1269aa77f0ae6f8b98178ffae79d", "filename": "ansible/playbooks/bootstrap.yml", "previous_filename": null, "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/NVIDIA/deepops/blob/30e72e8f702e8d9bec1351260ec992a071d09fe5/ansible/playbooks/bootstrap.yml", "raw_url": "https://github.com/NVIDIA/deepops/raw/30e72e8f702e8d9bec1351260ec992a071d09fe5/ansible/playbooks/bootstrap.yml", "status": "modified", "patch": "@@ -7,7 +7,7 @@\n     ansible_python_interpreter: /usr/bin/python3\n   tasks:\n     - name: Install Python for Ansible\n-      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)\n+      raw: \"test -e /usr/bin/python || (http_proxy={{proxy_env.http_proxy if (proxy_env is defined and proxy_env.http_proxy is defined) else \\\"\\\"}} https_proxy={{proxy_env.https_proxy if (proxy_env is defined and proxy_env.https_proxy is defined) else \\\"\\\"}} apt -y update && apt install -y python-minimal)\"\n       register: output\n       changed_when: output.stdout != \"\"\n \n@@ -38,8 +38,10 @@\n       lineinfile: path=/etc/fstab regexp='swap' state=absent\n     - name: install nfs tools\n       apt: name=nfs-common state=latest\n+      environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n     - name: remove resolvconf\n       apt: name=resolvconf state=absent\n+      environment: \"{{proxy_env if proxy_env is defined else {}}}\"\n  \n # configure root ssh keys so local user home directory can be modified\n # root ssh keys should be set in group_vars/all"}, {"sha": "477fff98eb977df4eadff80b4016dddfd78496c6", "filename": "ansible/roles/ssh/tasks/install.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/NVIDIA/deepops/blob/30e72e8f702e8d9bec1351260ec992a071d09fe5/ansible/roles/ssh/tasks/install.yml", "raw_url": "https://github.com/NVIDIA/deepops/raw/30e72e8f702e8d9bec1351260ec992a071d09fe5/ansible/roles/ssh/tasks/install.yml", "status": "modified", "patch": "@@ -8,3 +8,4 @@\n     - openssh-server\n     - openssh-client\n   when: ansible_os_family == \"Debian\"\n+  environment: \"{{proxy_env if proxy_env is defined else {}}}\""}]}, {"repo": "geerlingguy/ansible-role-php-xdebug", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #17: Ansible 2.x notices.", "sha": "78b2c75d6f8ceb59e492a321484abfacadc5e7c9", "url": "https://api.github.com/repos/geerlingguy/ansible-role-php-xdebug/commits/78b2c75d6f8ceb59e492a321484abfacadc5e7c9", "parents": ["bac7acd0dd843aca7d65a5e4290673a620b98e93"], "files": [{"sha": "1cbea6d1f0c5b96a320b7e175219dd2072418fa3", "filename": "tasks/main.yml", "previous_filename": null, "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/geerlingguy/ansible-role-php-xdebug/blob/78b2c75d6f8ceb59e492a321484abfacadc5e7c9/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-php-xdebug/raw/78b2c75d6f8ceb59e492a321484abfacadc5e7c9/tasks/main.yml", "status": "modified", "patch": "@@ -7,10 +7,12 @@\n     url: \"http://xdebug.org/files/xdebug-{{ php_xdebug_version }}.tgz\"\n     dest: \"{{ workspace }}/xdebug-{{ php_xdebug_version }}.tgz\"\n \n+# TODO: In 2.0, we can set the 'src' to the URL from the get_url task above and\n+# cut out one extra task :)\n - name: Untar Xdebug.\n-  command: >\n-    tar -C {{ workspace }} -xvzf {{ workspace }}/xdebug-{{ php_xdebug_version }}.tgz\n-    creates={{ workspace }}/xdebug-{{ php_xdebug_version }}/README\n+  unarchive:\n+    src: \"{{ workspace }}/xdebug-{{ php_xdebug_version }}.tgz\"\n+    dest: \"{{ workspace }}/xdebug-{{ php_xdebug_version }}\"\n \n - name: Build Xdebug.\n   shell: >"}]}, {"repo": "cytopia/ansible-role-cloudformation", "author_id": "MDQ6VXNlcjEyNTMzOTk5", "author_name": "cytopia", "committer_id": "MDQ6VXNlcjEyNTMzOTk5", "committer_name": "cytopia", "committer_email": "cytopia@everythingcli.org", "message": "Fixes #21 Use termination_protection (requires to bump Ansible from 2.4 to 2.5", "sha": "af1b4f6c5adde980e027a8b8f38684b11ffbfa19", "url": "https://api.github.com/repos/cytopia/ansible-role-cloudformation/commits/af1b4f6c5adde980e027a8b8f38684b11ffbfa19", "parents": ["06debddee35d8fefbe5e636c03cbe6c619befb00"], "files": [{"sha": "fba1bb350bc6e088d98c3f3b0b0ff999c5725eb2", "filename": "tasks/run.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/cytopia/ansible-role-cloudformation/blob/af1b4f6c5adde980e027a8b8f38684b11ffbfa19/tasks/run.yml", "raw_url": "https://github.com/cytopia/ansible-role-cloudformation/raw/af1b4f6c5adde980e027a8b8f38684b11ffbfa19/tasks/run.yml", "status": "modified", "patch": "@@ -77,6 +77,7 @@\n     profile: \"{{ cloudformation.profile | default(cloudformation_defaults.profile | default(omit)) }}\"\n     region: \"{{ cloudformation.region | default(cloudformation_defaults.region | default(omit)) }}\"\n     notification_arns: \"{{ cloudformation.notification_arns | default(cloudformation_defaults.notification_arns | default(omit)) }}\"\n+    termination_protection: \"{{ cloudformation.termination_protextion | default(cloudformation_defaults.termination_protection | default(omit)) }}\"\n     template_parameters: \"{{ cloudformation.template_parameters | default(omit) }}\"\n     tags: \"{{ cloudformation.tags | default(omit) }}\"\n   when: not cloudformation_generate_only"}, {"sha": "1cdcad3eac647a1b95eb8defe0e622620e4c1730", "filename": "meta/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/cytopia/ansible-role-cloudformation/blob/af1b4f6c5adde980e027a8b8f38684b11ffbfa19/meta/main.yml", "raw_url": "https://github.com/cytopia/ansible-role-cloudformation/raw/af1b4f6c5adde980e027a8b8f38684b11ffbfa19/meta/main.yml", "status": "modified", "patch": "@@ -5,7 +5,7 @@ galaxy_info:\n   company: cytopia\n   license: MIT\n   description: Ansible role to render an arbitrary number of Jinja2 templates into cloudformation files and create any number of stacks.\n-  min_ansible_version: 2.4\n+  min_ansible_version: 2.5\n   platforms:\n     - name: Amazon\n       versions:"}]}, {"repo": "jloh/nagios-nrpe-server", "author_id": "MDQ6VXNlcjM2ODk1MzI=", "author_name": "James Loh", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix lint errors (#28)\n\n* Fix lint command\r\n\r\n* Lint fixes and use new syntax where applicable\r\n\r\n* Remove whitespace\r\n\r\n* Exclude whole meta/tests folder\r\n\r\n* Update galaxy tags", "sha": "17101b252ad40dd406c0a32ddd53ef364df01370", "url": "https://api.github.com/repos/jloh/nagios-nrpe-server/commits/17101b252ad40dd406c0a32ddd53ef364df01370", "parents": ["59681aa96d48e7b7044ffe6173d3f5593e4433aa"], "files": [{"sha": "f698f54b80af52a6b989abab3114929913db8001", "filename": "tasks/packages-Archlinux.yml", "previous_filename": null, "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/packages-Archlinux.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/packages-Archlinux.yml", "status": "modified", "patch": "@@ -1,8 +1,11 @@\n ---\n # Update pacman cache for Arch Linux based OS's\n - name: Update pacman cache [Arch Linux]\n-  pacman: update_cache=yes\n+  pacman:\n+    update_cache: yes\n \n # Nagios NRPE Server for Arch Linux based OS's\n - name: Install Nagios NRPE Server [Arch Linux]\n-  pacman: name=nrpe state=present\n+  pacman:\n+    name: nrpe\n+    state: present"}, {"sha": "9781f2b65c07a91486716c6f0ed96e0f25ca36a4", "filename": "handlers/main.yml", "previous_filename": null, "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/17101b252ad40dd406c0a32ddd53ef364df01370/handlers/main.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/17101b252ad40dd406c0a32ddd53ef364df01370/handlers/main.yml", "status": "modified", "patch": "@@ -4,4 +4,6 @@\n # different names, we use a variable set in vars/{{ ansible_os_family }}.yml\n \n - name: restart nagios-nrpe-server\n-  service: name=\"{{ nagios_nrpe_server_service }}\" state=restarted\n+  service:\n+    name: \"{{ nagios_nrpe_server_service }}\"\n+    state: restarted"}, {"sha": "d5d221c63bc81e8748e79de811eec540db023130", "filename": "tasks/packages-Debian.yml", "previous_filename": null, "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/packages-Debian.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/packages-Debian.yml", "status": "modified", "patch": "@@ -1,11 +1,16 @@\n ---\n # Update apt-cache for Debian based OS's\n - name: Update apt cache [Debian]\n-  apt: update_cache=yes\n+  apt:\n+    update_cache: yes\n \n # Nagios NRPE Server for Debian based OS's\n - name: Install Nagios NRPE Server [Debian]\n-  apt: name=nagios-nrpe-server state=present\n+  apt:\n+    name: nagios-nrpe-server\n+    state: present\n \n - name: Install nagios-plugins [Debian]\n-  apt: name=nagios-plugins state=present\n+  apt:\n+    name: nagios-plugins\n+    state: present"}, {"sha": "78822da8da3ef5f0775b30dd08d6b12b2b6782bb", "filename": "tasks/packages-RedHat.yml", "previous_filename": null, "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/packages-RedHat.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/packages-RedHat.yml", "status": "modified", "patch": "@@ -2,9 +2,13 @@\n # Nagios NRPE Server for RedHat based OS's\n # The EPEL repo is required for this package\n - name: Install Nagios NRPE Server [RedHat]\n-  yum: name=nrpe state=present\n+  yum:\n+    name: nrpe\n+    state: present\n \n # Nagios Plugins since they aren't installed as part of the package above\n - name: Install Nagios NRPE Plugins [RedHat]\n-  yum: name=nagios-plugins-all state=present\n+  yum:\n+    name: nagios-plugins-all\n+    state: present\n   notify: restart nagios-nrpe-server"}, {"sha": "fffcc907db3066de8c071a64956da2c2571d9575", "filename": "tasks/packages-Solaris.yml", "previous_filename": null, "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/packages-Solaris.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/packages-Solaris.yml", "status": "modified", "patch": "@@ -1,19 +1,26 @@\n ---\n - name: Ensure CSWpkgutil is installed\n-  svr4pkg: src=http://get.opencsw.org/now name=CSWpkgutil state=present\n+  svr4pkg:\n+    src: http://get.opencsw.org/now\n+    name: CSWpkgutil\n+    state: present\n \n # pkgutil module does not actually provide full path to pkgutil --\n # until that changes, it's necessary to make sure that /opt/csw/bin\n # is included in path:\n # Nagios NRPE Server for Solaris\n - name: Install Nagios NRPE Server [Solaris]\n-  pkgutil: name=CSWnrpe state=present \n-  environment: \n+  pkgutil:\n+    name: CSWnrpe\n+    state: present\n+  environment:\n     PATH: \"{{ ansible_env.PATH }}:/opt/csw/bin\"\n \n # Nagios Plugins\n - name: Install Nagios NRPE Plugins [Solaris]\n-  pkgutil: name=\"CSWnrpe-plugin\" state=present \n-  environment: \n+  pkgutil:\n+    name: \"CSWnrpe-plugin\"\n+    state: present\n+  environment:\n     PATH: \"{{ ansible_env.PATH }}:/opt/csw/bin\"\n   notify: restart nagios-nrpe-server"}, {"sha": "9170361b6fdedb0fc21f69d84693267776ecdf62", "filename": "meta/main.yml", "previous_filename": null, "additions": 22, "deletions": 17, "changes": 39, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/17101b252ad40dd406c0a32ddd53ef364df01370/meta/main.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/17101b252ad40dd406c0a32ddd53ef364df01370/meta/main.yml", "status": "modified", "patch": "@@ -1,26 +1,31 @@\n ---\n galaxy_info:\n-  author: Mooash\n+  author: James Loh\n   description: Nagios NRPE Server configuration Ansible Role\n   license: license (MIT)\n   min_ansible_version: 1.2\n   platforms:\n-  - name: Ubuntu\n-    versions:\n-    - raring\n-    - saucy\n-    - trusty\n-  - name: Debian\n-    versions:\n-    - squeeze\n-    - wheezy\n-  - name: ArchLinux\n-    versions:\n-    - all\n-  - name: Solaris\n-    versions:\n-    - 11.1\n-  categories:\n+    - name: EL\n+      versions:\n+        - 5\n+        - 6\n+        - 7\n+    - name: Ubuntu\n+      versions:\n+        - raring\n+        - saucy\n+        - trusty\n+    - name: Debian\n+      versions:\n+        - squeeze\n+        - wheezy\n+    - name: ArchLinux\n+      versions:\n+        - all\n+    - name: Solaris\n+  galaxy_tags:\n     - monitoring\n     - system\n+    - nagios\n+    - nrpe\n dependencies: []"}, {"sha": "9b346f6033e914f10ec1eff00d7c8a52b5ea3b07", "filename": "tasks/variables.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/variables.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/variables.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n # Variable configuration.\n - name: Include OS-specific variables.\n   include_vars: \"{{ ansible_os_family }}.yml\"\n-  \n+\n - name: Include OS-specific variables (RedHat).\n   include_vars: \"{{ ansible_os_family }}-{{ ansible_architecture }}.yml\"\n   when: ansible_os_family == 'RedHat'"}, {"sha": "7a772432b78fa27cc3cd2e6aea0620059231bf43", "filename": "tasks/main.yml", "previous_filename": null, "additions": 30, "deletions": 19, "changes": 49, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/main.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/17101b252ad40dd406c0a32ddd53ef364df01370/tasks/main.yml", "status": "modified", "patch": "@@ -1,5 +1,5 @@\n ---\n-# Nagios NRPE Server role by Mooash\n+# Nagios NRPE Server role by James Loh\n \n # Include variables at the start so they're in scope\n - name: Include OS-Specific variables\n@@ -10,36 +10,47 @@\n \n # Create our config\n - name: Create nrpe.cfg from template\n-  template: >\n-    src=\"nrpe.cfg.j2\"\n-    dest=\"{{ nagios_nrpe_server_dir }}/nrpe.cfg\"\n-    owner=root group=root mode=0644\n+  template:\n+    src: \"nrpe.cfg.j2\"\n+    dest: \"{{ nagios_nrpe_server_dir }}/nrpe.cfg\"\n+    owner: root\n+    group: root\n+    mode: 0644\n   notify: restart nagios-nrpe-server\n \n # Create nrpe_ansible.cfg\n - name: Create nrpe_ansible.cfg from template\n-  template: >\n-    src=\"nrpe_ansible.cfg.j2\"\n-    dest=\"{{ nagios_nrpe_server_dir }}/nrpe_ansible.cfg\"\n-    owner=root group=root mode=0644\n+  template:\n+    src: \"nrpe_ansible.cfg.j2\"\n+    dest: \"{{ nagios_nrpe_server_dir }}/nrpe_ansible.cfg\"\n+    owner: root\n+    group: root\n+    mode: 0644\n   notify: restart nagios-nrpe-server\n \n # Sync our plugins\n - name: Install global plugins\n-  copy: >\n-    src=\"{{ nagios_nrpe_server_plugins_src_dir }}/global/\"\n-    dest=\"{{ nagios_nrpe_server_plugins_dir }}\"\n-    owner=root group=root mode=0755\n+  copy:\n+    src: \"{{ nagios_nrpe_server_plugins_src_dir }}/global/\"\n+    dest: \"{{ nagios_nrpe_server_plugins_dir }}\"\n+    owner: root\n+    group: root\n+    mode: 0755\n   failed_when: false\n-  \n+\n # Install per-server plugins\n - name: Install per-server plugins\n-  copy: >\n-    src=\"{{ nagios_nrpe_server_plugins_src_dir }}/{{ inventory_hostname }}/\"\n-    dest=\"{{ nagios_nrpe_server_plugins_dir }}\"\n-    owner=root group=root mode=0755\n+  copy:\n+    src: \"{{ nagios_nrpe_server_plugins_src_dir }}/{{ inventory_hostname }}/\"\n+    dest: \"{{ nagios_nrpe_server_plugins_dir }}\"\n+    owner: root\n+    group: root\n+    mode: 0755\n   failed_when: false\n \n # Ensure NRPE server is running and will start at boot\n - name: Ensure NRPE server is running\n-  service: name=\"{{ nagios_nrpe_server_service }}\" state=started enabled=yes\n+  service:\n+    name: \"{{ nagios_nrpe_server_service }}\"\n+    state: started\n+    enabled: yes"}]}, {"repo": "florianutz/Ubuntu1604-CIS", "author_id": "MDQ6VXNlcjExOTYwNTg=", "author_name": "James Bach", "committer_id": "MDQ6VXNlcjEzNjgzNzQz", "committer_name": "Florian Utz", "committer_email": "florianutz@users.noreply.github.com", "message": "Fix grub handler (#17)", "sha": "38891b177e6fe36630e927ca0a4aa6ff245413eb", "url": "https://api.github.com/repos/florianutz/Ubuntu1604-CIS/commits/38891b177e6fe36630e927ca0a4aa6ff245413eb", "parents": ["0ce35bc96dee3ef3b4ddb7f5b2dad08b854f2575"], "files": [{"sha": "72fcf39d155dd20912816d19b9aeb5c2d0e07518", "filename": "tasks/prelim.yml", "previous_filename": null, "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/38891b177e6fe36630e927ca0a4aa6ff245413eb/tasks/prelim.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/38891b177e6fe36630e927ca0a4aa6ff245413eb/tasks/prelim.yml", "status": "modified", "patch": "@@ -210,3 +210,8 @@\n   register: rhnsd_service_status\n   changed_when: false\n   check_mode: false\n+\n+- name: \"PRELIM | Check the grub configuration\"\n+  stat:\n+    path: /boot/grub/grub.cfg\n+  register: grub_cfg"}, {"sha": "acd6e50847fa46e8f5aeae2b1d49ce8c4c87d0bd", "filename": "handlers/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/florianutz/Ubuntu1604-CIS/blob/38891b177e6fe36630e927ca0a4aa6ff245413eb/handlers/main.yml", "raw_url": "https://github.com/florianutz/Ubuntu1604-CIS/raw/38891b177e6fe36630e927ca0a4aa6ff245413eb/handlers/main.yml", "status": "modified", "patch": "@@ -38,7 +38,7 @@\n \n - name: generate new grub config\n   become: true\n-  command: grub2-mkconfig -o \"{{ grub_cfg.stat.lnk_source }}\"\n+  command: grub-mkconfig -o \"{{ grub_cfg.stat.path }}\"\n \n - name: restart firewalld\n   become: true"}]}, {"repo": "dev-sec/ansible-os-hardening", "author_id": "MDQ6VXNlcjczMTIyMzY=", "author_name": "J.M. Fern\u00e1ndez", "committer_id": "MDQ6VXNlcjMxOTg5NjE=", "committer_name": "Sebastian Gumprich", "committer_email": "rndmh3ro@users.noreply.github.com", "message": "Fix #247, cleanup conditions (#248)\n\nSigned-off-by: Jes\u00fas Fern\u00e1ndez <jmfernandez@ticnor.es>", "sha": "e674a6d589bf9da486c4fef04c9dd6a3799ad717", "url": "https://api.github.com/repos/dev-sec/ansible-os-hardening/commits/e674a6d589bf9da486c4fef04c9dd6a3799ad717", "parents": ["ce6af914c86406aa7e0cefadb7c6349d866f7c8d"], "files": [{"sha": "1beeac4200238b6f157fe9924cea33abf8ed1226", "filename": "tasks/pam.yml", "previous_filename": null, "additions": 45, "deletions": 17, "changes": 62, "blob_url": "https://github.com/dev-sec/ansible-os-hardening/blob/e674a6d589bf9da486c4fef04c9dd6a3799ad717/tasks/pam.yml", "raw_url": "https://github.com/dev-sec/ansible-os-hardening/raw/e674a6d589bf9da486c4fef04c9dd6a3799ad717/tasks/pam.yml", "status": "modified", "patch": "@@ -1,7 +1,7 @@\n ---\n - name: update pam on Debian systems\n   command: 'pam-auth-update --package'\n-  when: ansible_facts.distribution == 'Debian' or ansible_facts.distribution == 'Ubuntu'\n+  when: ansible_facts.distribution in ['Debian', 'Ubuntu']\n   changed_when: False\n   environment:\n     DEBIAN_FRONTEND: noninteractive\n@@ -19,14 +19,18 @@\n   apt:\n     name: '{{ os_packages_pam_cracklib }}'\n     state: 'absent'\n-  when: (ansible_facts.distribution == 'Debian' or ansible_facts.distribution == 'Ubuntu') and os_auth_pam_passwdqc_enable\n+  when:\n+    - ansible_facts.distribution in ['Debian', 'Ubuntu']\n+    - os_auth_pam_passwdqc_enable\n \n - name: install the package for strong password checking\n   apt:\n     name: '{{ os_packages_pam_passwdqc }}'\n     state: 'present'\n     update_cache: 'yes'\n-  when: (ansible_facts.distribution == 'Debian' or ansible_facts.distribution == 'Ubuntu') and os_auth_pam_passwdqc_enable\n+  when:\n+    - ansible_facts.distribution in ['Debian', 'Ubuntu']\n+    - os_auth_pam_passwdqc_enable\n \n - name: configure passwdqc\n   template:\n@@ -35,20 +39,26 @@\n     mode: '0644'\n     owner: 'root'\n     group: 'root'\n-  when: (ansible_facts.distribution == 'Debian' or ansible_facts.distribution == 'Ubuntu') and os_auth_pam_passwdqc_enable\n+  when:\n+    - ansible_facts.distribution in ['Debian', 'Ubuntu']\n+    - os_auth_pam_passwdqc_enable\n \n - name: remove passwdqc\n   apt:\n     name: '{{ os_packages_pam_passwdqc }}'\n     state: 'absent'\n-  when: (ansible_facts.distribution == 'Debian' or ansible_facts.distribution == 'Ubuntu') and not os_auth_pam_passwdqc_enable\n+  when:\n+    - ansible_facts.distribution in ['Debian', 'Ubuntu']\n+    - not os_auth_pam_passwdqc_enable\n \n - name: install tally2\n   apt:\n     name: 'libpam-modules'\n     state: 'present'\n-  when: (ansible_facts.distribution == 'Debian' or ansible_facts.distribution == 'Ubuntu') and\n-        not os_auth_pam_passwdqc_enable and os_auth_retries > 0\n+  when:\n+    - ansible_facts.distribution in ['Debian', 'Ubuntu']\n+    - not os_auth_pam_passwdqc_enable\n+    - os_auth_retries > 0\n \n - name: configure tally2\n   template:\n@@ -57,35 +67,47 @@\n     mode: '0644'\n     owner: 'root'\n     group: 'root'\n-  when: (ansible_facts.distribution == 'Debian' or ansible_facts.distribution == 'Ubuntu') and\n-        not os_auth_pam_passwdqc_enable and os_auth_retries > 0\n+  when:\n+    - ansible_facts.distribution in ['Debian', 'Ubuntu']\n+    - not os_auth_pam_passwdqc_enable\n+    - os_auth_retries > 0\n \n - name: delete tally2 when retries is 0\n   file:\n     path: '{{ tally2_path }}'\n     state: 'absent'\n-  when: (ansible_facts.distribution == 'Debian' or ansible_facts.distribution == 'Ubuntu') and\n-        not os_auth_pam_passwdqc_enable and os_auth_retries == 0\n+  when:\n+    - ansible_facts.distribution in ['Debian', 'Ubuntu']\n+    - not os_auth_pam_passwdqc_enable\n+    - os_auth_retries == 0\n \n - name: remove pam_cracklib, because it does not play nice with passwdqc\n   yum:\n     name: '{{ os_packages_pam_cracklib }}'\n     state: 'absent'\n-  when: (ansible_facts.os_family == 'RedHat' and ansible_facts.distribution_major_version|int is version('7', '<') and not ansible_facts.distribution == 'Amazon')\n-        and os_auth_pam_passwdqc_enable\n+  when:\n+    - ansible_facts.os_family == 'RedHat'\n+    - ansible_facts.distribution_major_version|int is version('7', '<')\n+    - ansible_facts.distribution != 'Amazon'\n+    - os_auth_pam_passwdqc_enable\n \n - name: install the package for strong password checking\n   yum:\n     name: '{{ os_packages_pam_passwdqc }}'\n     state: 'present'\n-  when: (ansible_facts.os_family == 'RedHat' and ansible_facts.distribution_major_version|int is version('7', '<') and not ansible_facts.distribution == 'Amazon')\n-        and os_auth_pam_passwdqc_enable\n+  when:\n+    - ansible_facts.os_family == 'RedHat'\n+    - ansible_facts.distribution_major_version|int is version('7', '<')\n+    - ansible_facts.distribution != 'Amazon'\n+    - os_auth_pam_passwdqc_enable\n \n - name: remove passwdqc\n   yum:\n     name: '{{ os_packages_pam_passwdqc }}'\n     state: 'absent'\n-  when: ansible_facts.os_family == 'RedHat' and not os_auth_pam_passwdqc_enable\n+  when:\n+    - ansible_facts.os_family == 'RedHat'\n+    - not os_auth_pam_passwdqc_enable\n \n - name: configure passwdqc and tally via central system-auth confic\n   template:\n@@ -94,11 +116,17 @@\n     mode: '0640'\n     owner: 'root'\n     group: 'root'\n+  when: ansible_facts.os_family == 'RedHat'\n+\n+- name: Gather package facts\n+  package_facts:\n+    manager: auto\n \n - name: NSA 2.3.3.5 Upgrade Password Hashing Algorithm to SHA-512\n   template:\n-    src: 'etc/rhel_libuser.conf.j2'\n+    src: 'etc/libuser.conf.j2'\n     dest: '/etc/libuser.conf'\n     mode: '0640'\n     owner: 'root'\n     group: 'root'\n+  when: \"'libuser' in ansible_facts.packages\""}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixed #45", "sha": "79974323f51920d3ab8bc76b23558ba15eb7e4c2", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/79974323f51920d3ab8bc76b23558ba15eb7e4c2", "parents": ["45971be8249cc4627ef8ddfacf55a661b7fc13ca"], "files": [{"sha": "645d83c9bbfccc0c2f7917f8136ec343ca2d4ca5", "filename": "tasks/configure-systemd.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/configure-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/configure-systemd.yml", "status": "modified", "patch": "@@ -37,7 +37,7 @@\n     docker_envs: \"{{ docker_service_envs }}\"\n \n - name: Force daemon reload of systemd\n-  systemd: \n+  systemd:\n     daemon_reload: yes\n   become: yes\n   notify: restart docker"}, {"sha": "856efa5272a2b6e42d7f889b59f268a79c0b1513", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -85,7 +85,7 @@\n   become: true\n   when: (_docker_os_dist == \"CentOS\" or _docker_os_dist == \"Fedora\" or _docker_os_dist == \"RedHat\") and\n         _fact_docker_ce_edge_enabled != docker_enable_ce_edge\n-        \n+\n # disable rt-beta so we don't get a 403 error retrieving repomd.xml\n - name: Check if rhel-7-server-rt-beta-rpms Repository is enabled (RedHat)\n   shell: \"subscription-manager repos --list-enabled | grep rhel-7-server-rt-beta-rpms\""}, {"sha": "a8b7be4fc0f1c1e5ad4159e3dd45657efe2d8fd4", "filename": "handlers/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/79974323f51920d3ab8bc76b23558ba15eb7e4c2/handlers/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/79974323f51920d3ab8bc76b23558ba15eb7e4c2/handlers/main.yml", "status": "modified", "patch": "@@ -10,7 +10,7 @@\n \n # Workaround because systemd cannot be used: https://github.com/ansible/ansible/issues/22171\n - name: restart auditd\n-  shell: service auditd restart\n+  command: service auditd restart\n   args:\n     warn: no\n   become: yes"}, {"sha": "b63cf087883540084d0ad8a1775b8e36a457d439", "filename": "tasks/checks.yml", "previous_filename": null, "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/checks.yml", "status": "modified", "patch": "@@ -2,6 +2,5 @@\n - include_tasks: distribution-checks.yml\n   when:\n     _docker_os_dist_check | bool\n-    \n-- include_tasks: compatibility-checks.yml\n \n+- include_tasks: compatibility-checks.yml"}, {"sha": "1cd33a375e479ddd832bb7effbfdf000c29907d0", "filename": "tasks/bug-tweaks.yml", "previous_filename": null, "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/bug-tweaks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/bug-tweaks.yml", "status": "modified", "patch": "@@ -13,7 +13,7 @@\n       reload: yes\n     become: yes\n     when: may_detach_mounts.stat.exists\n-  \n+\n   # Keep for compatibility reasons of this role. Now everything is in the same file.\n   - name: Remove systemd drop-in for Docker Mount Flags slave configuration (CentOS/RedHat)\n     file:\n@@ -32,5 +32,3 @@\n     - _docker_os_dist == \"CentOS\" or _docker_os_dist == \"RedHat\"\n     - docker_enable_mount_flag_fix | bool\n     - ansible_kernel | version_compare('4', '<')\n-\n-"}, {"sha": "c8d08f35f8c1e8bd91473e0b78c5325dbde65b82", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -61,4 +61,3 @@\n   notify: restart docker\n   changed_when: docker_service.status.SubState != \"running\"\n   when: docker_service.status is defined\n-"}, {"sha": "bd6e3ef84f074c04cfe4be5befd4859e63151a45", "filename": "tasks/main.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/79974323f51920d3ab8bc76b23558ba15eb7e4c2/tasks/main.yml", "status": "modified", "patch": "@@ -22,7 +22,7 @@\n - name: Determine usage of systemd\n   shell: \"ps -p1 | grep systemd 1>/dev/null && echo systemd || echo upstart\"\n   become: true\n-  changed_when: no  \n+  changed_when: no\n   register: _determine_systemd_usage\n \n - name: Set fact to indicate systemd is not used\n@@ -56,12 +56,12 @@\n \n - name: Configure systemd service\n   include_tasks: configure-systemd.yml\n-  when: _docker_systemd_used | bool  \n+  when: _docker_systemd_used | bool\n   tags: [\"configure\"]\n \n - name: Configure non-systemd service\n   include_tasks: configure-non-systemd.yml\n-  when: _docker_systemd_used | bool == false \n+  when: _docker_systemd_used | bool == false\n   tags: [\"configure\"]\n \n - name: Configure Docker"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjI1OTM5Njk2", "author_name": "Ben Kincaid", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "fixed idm password bug (#348)", "sha": "ce36ec3aacfcc35bb5219322a98013f895d95716", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/ce36ec3aacfcc35bb5219322a98013f895d95716", "parents": ["7fed0a1d9169d11cff72ef9f0306bd8e9b6ff1d3"], "files": [{"sha": "0640408025e4855c1723ad5179f26045bb94aef2", "filename": "roles/identity-management/manage-user-password/tasks/main.yml", "previous_filename": null, "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/ce36ec3aacfcc35bb5219322a98013f895d95716/roles/identity-management/manage-user-password/tasks/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/ce36ec3aacfcc35bb5219322a98013f895d95716/roles/identity-management/manage-user-password/tasks/main.yml", "status": "modified", "patch": "@@ -3,18 +3,18 @@\n - name: \"Process users that need a password generated\"\n   block:\n \n+    - name: \"Make sure the list_of_users is empty to start with\"\n+      set_fact:\n+        list_of_users: []\n+        users_with_passwords: []\n+\n     - include_tasks: generate-password.yml\n       with_items:\n         - \"{{ identities.users }}\"\n       when:\n         - item.generate_password is defined\n         - item.generate_password == True\n \n-    - name: \"Make sure the list_of_users is empty to start with\"\n-      set_fact:\n-        list_of_users: []\n-        users_with_passwords: []\n-\n     - name: \"Remove users from the list in preparation to update the list of users\"\n       set_fact:\n         list_of_users: \"{{ list_of_users + [ item ] }}\""}]}, {"repo": "jloh/nagios-nrpe-server", "author_id": "MDQ6VXNlcjM2ODk1MzI=", "author_name": "jloh", "committer_id": "MDQ6VXNlcjM2ODk1MzI=", "committer_name": "jloh", "committer_email": "github@jloh.co", "message": "Closes #23: Actually install nagios-plugins on Debain based OS'\n\nRefs #22\nI originally thought this was a hard dependency but it turns out it isn't at all.", "sha": "c33f3410e002f9d8506f0725f56b7d7afa1c5f74", "url": "https://api.github.com/repos/jloh/nagios-nrpe-server/commits/c33f3410e002f9d8506f0725f56b7d7afa1c5f74", "parents": ["96229df8914d81313a37c41fc063cddb8d9a5d49"], "files": [{"sha": "4346665b9013b29788ec163ca0e2ba27753c1f7e", "filename": "tasks/packages-Debian.yml", "previous_filename": null, "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/jloh/nagios-nrpe-server/blob/c33f3410e002f9d8506f0725f56b7d7afa1c5f74/tasks/packages-Debian.yml", "raw_url": "https://github.com/jloh/nagios-nrpe-server/raw/c33f3410e002f9d8506f0725f56b7d7afa1c5f74/tasks/packages-Debian.yml", "status": "modified", "patch": "@@ -6,3 +6,6 @@\n # Nagios NRPE Server for Debian based OS's\n - name: Install Nagios NRPE Server [Debian]\n   apt: name=nagios-nrpe-server state=present\n+\n+- name: Install nagios-plugins [Debian]\n+  apt: name=nagios-plugins state=present"}]}, {"repo": "elastic/ansible-elasticsearch", "author_id": "MDQ6VXNlcjY0MzYxNDM=", "author_name": "Jakob Reiter", "committer_id": "MDQ6VXNlcjY0MzYxNDM=", "committer_name": "Jakob Reiter", "committer_email": "jakob@elastic.co", "message": "Changed /etc/default/ to /etc/sysconfig/ on EL. Fixes #14", "sha": "2f3f84b6f30d1fe2582c7b5cdbf8b7a35c9399f0", "url": "https://api.github.com/repos/elastic/ansible-elasticsearch/commits/2f3f84b6f30d1fe2582c7b5cdbf8b7a35c9399f0", "parents": ["444cab9cd234efc041454091725db9efa2ff85aa"], "files": [{"sha": "68b972799e20396a52acdd37e5016405f34bcdcd", "filename": "tasks/elasticsearch-RedHat.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/elastic/ansible-elasticsearch/blob/2f3f84b6f30d1fe2582c7b5cdbf8b7a35c9399f0/tasks/elasticsearch-RedHat.yml", "raw_url": "https://github.com/elastic/ansible-elasticsearch/raw/2f3f84b6f30d1fe2582c7b5cdbf8b7a35c9399f0/tasks/elasticsearch-RedHat.yml", "status": "modified", "patch": "@@ -9,19 +9,19 @@\n   register: elasticsearch_install\n \n - name: RedHat - configure memory\n-  lineinfile: dest=/etc/default/elasticsearch regexp=\"^ES_HEAP_SIZE\" insertafter=\"^#ES_HEAP_SIZE\" line=\"ES_HEAP_SIZE={{ es_heap_size }}\"\n+  lineinfile: dest=/etc/sysconfig/elasticsearch regexp=\"^ES_HEAP_SIZE\" insertafter=\"^#ES_HEAP_SIZE\" line=\"ES_HEAP_SIZE={{ es_heap_size }}\"\n   when: es_heap_size is defined\n   register: elasticsearch_configure\n - name: RedHat - configure data store\n-  lineinfile: dest=/etc/default/elasticsearch regexp=\"^DATA_DIR\" insertafter=\"^#DATA_DIR\" line=\"DATA_DIR={{ es_data_dir }}\"\n+  lineinfile: dest=/etc/sysconfig/elasticsearch regexp=\"^DATA_DIR\" insertafter=\"^#DATA_DIR\" line=\"DATA_DIR={{ es_data_dir }}\"\n   when: es_data_dir is defined\n   register: elasticsearch_configure\n - name: RedHat - configure elasticsearch user\n-  lineinfile: dest=/etc/default/elasticsearch regexp=\"^ES_USER\" insertafter=\"^#ES_USER\" line=\"ES_USER={{ es_user }}\"\n+  lineinfile: dest=/etc/sysconfig/elasticsearch regexp=\"^ES_USER\" insertafter=\"^#ES_USER\" line=\"ES_USER={{ es_user }}\"\n   when: es_user is defined\n   register: elasticsearch_configure\n - name: RedHat - configure elasticsearch group\n-  lineinfile: dest=/etc/default/elasticsearch regexp=\"^ES_GROUP\" insertafter=\"^#ES_GROUP\" line=\"ES_GROUP={{ es_group }}\"\n+  lineinfile: dest=/etc/sysconfig/elasticsearch regexp=\"^ES_GROUP\" insertafter=\"^#ES_GROUP\" line=\"ES_GROUP={{ es_group }}\"\n   when: es_group is defined\n   register: elasticsearch_configure\n - name: RedHat - create data dir"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #109", "sha": "c2df7c9d9f5b8008d0f9b2b12ca6c8f086a41108", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/c2df7c9d9f5b8008d0f9b2b12ca6c8f086a41108", "parents": ["f6f8b96af47f0dd32d9e52cf43116cf05910ce7c"], "files": [{"sha": "0640ca8f692e1da3f929066bd4ac7c6e5a1531d6", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c2df7c9d9f5b8008d0f9b2b12ca6c8f086a41108/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c2df7c9d9f5b8008d0f9b2b12ca6c8f086a41108/tasks/main.yml", "status": "modified", "patch": "@@ -105,6 +105,7 @@\n \n     - name: Setup Docker package repositories\n       include_tasks: setup-repository.yml\n+      when: docker_setup_repos | bool\n       tags: [\"install\"]\n \n     - name: Install Docker"}]}, {"repo": "geerlingguy/ansible-role-security", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #48: Fix deprecation warning for security_fail2ban_enabled usage.", "sha": "656f46de9baec87a3baeb6d8165fb2131d9f05ce", "url": "https://api.github.com/repos/geerlingguy/ansible-role-security/commits/656f46de9baec87a3baeb6d8165fb2131d9f05ce", "parents": ["b46a333513787101700c943704573e3b673f3eec"], "files": [{"sha": "402404e3f88ff086997de81a606372598401ad90", "filename": "tasks/main.yml", "previous_filename": null, "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/geerlingguy/ansible-role-security/blob/656f46de9baec87a3baeb6d8165fb2131d9f05ce/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-security/raw/656f46de9baec87a3baeb6d8165fb2131d9f05ce/tasks/main.yml", "status": "modified", "patch": "@@ -4,21 +4,29 @@\n \n # Fail2Ban\n - include_tasks: fail2ban-RedHat.yml\n-  when: ansible_os_family == 'RedHat' and security_fail2ban_enabled\n+  when:\n+    - ansible_os_family == 'RedHat'\n+    - security_fail2ban_enabled | bool\n \n - include_tasks: fail2ban-Debian.yml\n-  when: ansible_os_family == 'Debian' and security_fail2ban_enabled\n+  when:\n+    - ansible_os_family == 'Debian'\n+    - security_fail2ban_enabled | bool\n \n - name: Ensure fail2ban is running and enabled on boot.\n   service: name=fail2ban state=started enabled=yes\n-  when: security_fail2ban_enabled\n+  when: security_fail2ban_enabled | bool\n \n # SSH\n - include_tasks: ssh.yml\n \n # Autoupdate\n - include_tasks: autoupdate-RedHat.yml\n-  when: ansible_os_family == 'RedHat' and security_autoupdate_enabled\n+  when:\n+    - ansible_os_family == 'RedHat'\n+    - security_autoupdate_enabled | bool\n \n - include_tasks: autoupdate-Debian.yml\n-  when: ansible_os_family == 'Debian' and security_autoupdate_enabled\n+  when:\n+    - ansible_os_family == 'Debian'\n+    - security_autoupdate_enabled | bool"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #57 #58 #59 #60 #61", "sha": "a94f9ce4fa32273fd0fad7492d36db4101423cc3", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/a94f9ce4fa32273fd0fad7492d36db4101423cc3", "parents": ["d944da6c34c3e510a807079256632482b53f00d2"], "files": [{"sha": "6c5b44d3000cd44e922d580077385bb9812fc632", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a94f9ce4fa32273fd0fad7492d36db4101423cc3/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a94f9ce4fa32273fd0fad7492d36db4101423cc3/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -46,7 +46,16 @@\n     append: true\n   with_items: \"{{ docker_users }}\"\n \n-- name: Ensure thin-provisioning-tools is installed when devicemapper is used (Ubuntu)\n+- name: Ensure lvm2 is installed when devicemapper is used (Fedora/Debian)\n+  become: true\n+  package:\n+    name: lvm2\n+    state: present\n+  when: (_docker_os_dist == \"Fedora\" or _docker_os_dist == \"Debian\") and\n+        docker_daemon_config['storage-driver'] is defined and\n+        docker_daemon_config['storage-driver'] == 'devicemapper'\n+\n+- name: Ensure thin-provisioning-tools is installed when devicemapper is used (Ubuntu/Debian)\n   become: true\n   package:\n     name: thin-provisioning-tools"}, {"sha": "c321bd17e98b7cb0ac9249a2ba1322954db1810b", "filename": "tasks/lvm-thinpool.yml", "previous_filename": null, "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a94f9ce4fa32273fd0fad7492d36db4101423cc3/tasks/lvm-thinpool.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a94f9ce4fa32273fd0fad7492d36db4101423cc3/tasks/lvm-thinpool.yml", "status": "modified", "patch": "@@ -1,3 +1,9 @@\n+- name: Ensure lvm2 is installed\n+  become: true\n+  package:\n+    name: lvm2\n+    state: present\n+\n - name: Create LVM volume group\n   become: true\n   lvg:"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #731 - Use option stdout to fix theme paths\n\n`wp_template_root` was just the registered Ansible var. The values\nneeded to be checked against the `stdout` which is the actual output of\nthe `wp get option` command.", "sha": "78ff762dec800fa75f369beb141232d762a010ca", "url": "https://api.github.com/repos/roots/trellis/commits/78ff762dec800fa75f369beb141232d762a010ca", "parents": ["ef361c2c4c322f489a3bd4f9de2b74db2cb5ebd3"], "files": [{"sha": "dc1c52665dacc48137e3c9d9330928a28497616a", "filename": "roles/deploy/hooks/finalize-after.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/78ff762dec800fa75f369beb141232d762a010ca/roles/deploy/hooks/finalize-after.yml", "raw_url": "https://github.com/roots/trellis/raw/78ff762dec800fa75f369beb141232d762a010ca/roles/deploy/hooks/finalize-after.yml", "status": "modified", "patch": "@@ -37,7 +37,7 @@\n   command: wp option set {{ item }} {{ deploy_helper.new_release_path }}/web/wp/wp-content/themes\n   args:\n     chdir: \"{{ deploy_helper.current_path }}\"\n-  when: wp_installed | success and wp_template_root != '/themes' and wp_template_root != ''\n+  when: wp_installed | success and wp_template_root.stdout != '' and wp_template_root.stdout != '/themes'\n   with_items:\n     - stylesheet_root\n     - template_root"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjEwNTU3MzE4", "author_name": "Dan Jurgensmeyer", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "Fix pxe for buggy UEFI (#54)", "sha": "5bfe61883e47a94b616c2b14d0b55adb0b51e75a", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/5bfe61883e47a94b616c2b14d0b55adb0b51e75a", "parents": ["1f090d167b17bd9c5ba938346dab7990530a904f"], "files": [{"sha": "84123fa4576057b137552f0227564b4b60e9857f", "filename": "roles/config-pxe/tasks/pxe.yml", "previous_filename": null, "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/5bfe61883e47a94b616c2b14d0b55adb0b51e75a/roles/config-pxe/tasks/pxe.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/5bfe61883e47a94b616c2b14d0b55adb0b51e75a/roles/config-pxe/tasks/pxe.yml", "status": "modified", "patch": "@@ -19,10 +19,16 @@\n   - \"/usr/share/syslinux/vesamenu.c32\"\n   - \"/usr/share/syslinux/menu.c32\"\n \n-# Note: the Ansible 'copy' module doesn't support resursive copy of directories as-is, hence the 'command'\n+# Note: the Ansible 'copy' module doesn't support resursive copy of remote src directories as-is, hence the 'command'\n - name: \"Copy in necessary PXE files for UEFI use\"\n   shell: \"cp -r {{ uefi_source }}/* {{ tftpserver_root_dir }}/pxelinux\"\n \n+- name: \"Workaround for buggy UEFI requiring lowercase\"\n+  copy: \n+    src: \"{{ tftpserver_root_dir }}/pxelinux/BOOTX64.EFI\"\n+    dest: \"{{ tftpserver_root_dir }}/pxelinux/bootx64.efi\"\n+    remote_src: True\n+\n - name: \"Ensure the hosted OS directories exists\"\n   file:\n     path: \"{{ tftpserver_root_dir }}/{{ item.destination }}\""}]}, {"repo": "nginxinc/ansible-role-nginx", "author_id": "MDQ6VXNlcjE1NjU0NTI1", "author_name": "Alessandro Fael Garcia", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix module install task (#89)\n\n* Fix module install task\r\n\r\n* Fix perl module", "sha": "6693791de25f89da90dd2227c5addba384b67d90", "url": "https://api.github.com/repos/nginxinc/ansible-role-nginx/commits/6693791de25f89da90dd2227c5addba384b67d90", "parents": ["1d3b03ea2b7165d6768c52e8c64627a641c6377c"], "files": [{"sha": "b55dc82a0c15cc35a98e5be67bdb9dd1e244080c", "filename": "tasks/modules/install-modules.yml", "previous_filename": null, "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/6693791de25f89da90dd2227c5addba384b67d90/tasks/modules/install-modules.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/6693791de25f89da90dd2227c5addba384b67d90/tasks/modules/install-modules.yml", "status": "modified", "patch": "@@ -1,21 +1,21 @@\n ---\n - import_tasks: install-njs.yml\n-  when: modules.njs | default(false)\n+  when: nginx_modules.njs | default(false)\n \n - import_tasks: install-perl.yml\n-  when: modules.perl | default(false)\n+  when: nginx_modules.perl | default(false)\n \n - import_tasks: install-geoip.yml\n-  when: modules.geoip | default(false)\n+  when: nginx_modules.geoip | default(false)\n \n - import_tasks: install-image-filter.yml\n-  when: modules.image_filter | default(false)\n+  when: nginx_modules.image_filter | default(false)\n \n - import_tasks: install-rtmp.yml\n-  when: modules.rtmp | default(false)\n+  when: nginx_modules.rtmp | default(false)\n \n - import_tasks: install-xslt.yml\n-  when: modules.xslt | default(false)\n+  when: nginx_modules.xslt | default(false)\n \n - import_tasks: install-waf.yml\n-  when: modules.waf | default(false) and nginx_type == \"plus\"\n+  when: nginx_modules.waf | default(false) and nginx_type == \"plus\""}, {"sha": "dc47e267d35233c47e2cc570b9a295731cb9744d", "filename": "tasks/modules/install-perl.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/6693791de25f89da90dd2227c5addba384b67d90/tasks/modules/install-perl.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/6693791de25f89da90dd2227c5addba384b67d90/tasks/modules/install-perl.yml", "status": "modified", "patch": "@@ -15,5 +15,5 @@\n   lineinfile:\n     path: /etc/nginx/nginx.conf\n     insertbefore: BOF\n-    line: load_module modules/ngx_http_perl.so;\n+    line: load_module modules/ngx_http_perl_module.so;\n   notify: \"(Handler: All OSs) Reload NGINX\""}]}, {"repo": "iiab/iiab", "author_id": "MDQ6VXNlcjI0NTg5MDc=", "author_name": "A Holt", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #420 from jvonau/sugar\n\nNodejs 6.X - npm is not available standalone\r\n\r\ncloses #419", "sha": "380a9dc7e4456910878c7fdc53d04da50d8e4645", "url": "https://api.github.com/repos/iiab/iiab/commits/380a9dc7e4456910878c7fdc53d04da50d8e4645", "parents": ["4e4926255fccd7d9424d9fe21d828e69713e7149", "908bb54145aa0e321fca37cee06b6176f686688c"], "files": [{"sha": "bc41f0977993efbd0ce7910e44c96cf2e624f47d", "filename": "roles/sugarizer/tasks/main.yml", "previous_filename": null, "additions": 7, "deletions": 15, "changes": 22, "blob_url": "https://github.com/iiab/iiab/blob/380a9dc7e4456910878c7fdc53d04da50d8e4645/roles/sugarizer/tasks/main.yml", "raw_url": "https://github.com/iiab/iiab/raw/380a9dc7e4456910878c7fdc53d04da50d8e4645/roles/sugarizer/tasks/main.yml", "status": "modified", "patch": "@@ -12,20 +12,24 @@\n         src={{ sugarizer_location }}/{{ sugarizer_version }}\n         state=link\n \n+- name: Set up apt sources on is_debuntu\n+  shell: curl -sL https://deb.nodesource.com/setup_6.x | bash -\n+  when: internet_available and is_debuntu\n+\n - name: Install sugarizer required packages - is_debuntu\n   package: name={{ item }}\n            state=present\n-  with_items:\n-    - node-gyp\n   when: internet_available and is_debuntu\n+  with_items:\n+    - nodejs\n \n - name: Install npm non is_debuntu\n   package: name={{ item }}\n            state=present\n+  when: internet_available and not is_debuntu\n   with_items:\n     - nodejs\n     - npm\n-  when: internet_available and not is_debuntu\n \n # attempting to reinstall npn is broken on raspbian 9\n - name: check for sugarizer already installed\n@@ -37,18 +41,6 @@\n      npm_exists: True\n   when: npm.stat.exists is defined and npm.stat.exists\n \n-- name: Set up apt sources on is_debuntu\n-  shell: curl -sL https://deb.nodesource.com/setup_6.x | bash -\n-  when: internet_available and is_debuntu\n-\n-- name: Actually get it installed on is_debuntu\n-  package: name={{ item }}\n-           state=present\n-  with_items:\n-    - nodejs\n-    - npm\n-  when: internet_available and is_debuntu\n-\n - name: Create systemd files and copy our ini file \n   template: src={{ item.src }}\n             dest={{ item.dest }}"}]}, {"repo": "dev-sec/ansible-os-hardening", "author_id": null, "author_name": "Sebastian Gumprich", "committer_id": null, "committer_name": "Sebastian Gumprich", "committer_email": "sebastian.gumprich@38.de", "message": "fix deprecation warning for undefined error. #99", "sha": "11c81971e16648db81df5d723c544880ee3bbc42", "url": "https://api.github.com/repos/dev-sec/ansible-os-hardening/commits/11c81971e16648db81df5d723c544880ee3bbc42", "parents": ["ca0bd549ff5ac1f52134a4da6ecec9aeaf974928"], "files": [{"sha": "128b095526531097a0872e083e316ac330520c49", "filename": "tasks/yum.yml", "previous_filename": null, "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/dev-sec/ansible-os-hardening/blob/11c81971e16648db81df5d723c544880ee3bbc42/tasks/yum.yml", "raw_url": "https://github.com/dev-sec/ansible-os-hardening/raw/11c81971e16648db81df5d723c544880ee3bbc42/tasks/yum.yml", "status": "modified", "patch": "@@ -16,11 +16,14 @@\n   stat: path='/etc/yum/pluginconf.d/rhnplugin.conf'\n   register: rhnplugin_file\n \n+  # for the \"default([])\" see here:\n+  # https://github.com/dev-sec/ansible-os-hardening/issues/99 and\n+  # https://stackoverflow.com/questions/37067827/ansible-deprecation-warning-for-undefined-variable-despite-when-clause\n - name: activate gpg-check for yum-repos\n   replace: dest='{{item}}' regexp='^\\s*gpgcheck=0' replace='gpgcheck=1'\n   with_items:\n-    - '{{ yum_repos.stdout_lines }}'\n     - '/etc/yum.conf'\n+    - '{{ yum_repos.stdout_lines| default([]) }}'\n \n - name: activate gpg-check for yum rhn if it exists\n   replace: dest='/etc/yum/pluginconf.d/rhnplugin.conf' regexp='^\\s*gpgcheck=0' replace='gpgcheck=1'"}]}, {"repo": "RedHat-EMEA-SSA-Team/stc", "author_id": "MDQ6VXNlcjM2NjA0", "author_name": "Robert Bohne", "committer_id": "MDQ6VXNlcjM2NjA0", "committer_name": "Robert Bohne", "committer_email": "robert.bohne@redhat.com", "message": "Fixed Issue #73 - do not remove ~/.ssh/known_hosts  anymore", "sha": "2f16ef611509cb3ee9885ae4558e98568ff00808", "url": "https://api.github.com/repos/RedHat-EMEA-SSA-Team/stc/commits/2f16ef611509cb3ee9885ae4558e98568ff00808", "parents": ["f0706344c63eba72b033128f955157e95dbcc95c"], "files": [{"sha": "2ac61eddffcf567f80298b669a46aad6d1a28cb1", "filename": "playbooks/prepare_ssh.yml", "previous_filename": null, "additions": 11, "deletions": 12, "changes": 23, "blob_url": "https://github.com/RedHat-EMEA-SSA-Team/stc/blob/2f16ef611509cb3ee9885ae4558e98568ff00808/playbooks/prepare_ssh.yml", "raw_url": "https://github.com/RedHat-EMEA-SSA-Team/stc/raw/2f16ef611509cb3ee9885ae4558e98568ff00808/playbooks/prepare_ssh.yml", "status": "modified", "patch": "@@ -17,20 +17,19 @@\n   vars_files:\n   - \"{{file_env}}\"\n   tasks:\n-  - set_fact:\n-      ssh_dir: /root/.ssh\n-    when: ssh_user == 'root'\n-  - set_fact:\n-      ssh_dir: \"/home/{{ssh_user}}/.ssh\"\n-    when: ssh_user != 'root'\n-  - name: Remove old known_hosts\n-    file:\n-      path: \"{{ssh_dir}}/known_hosts\"\n-      state: absent\n   - name: Add key to authorized_keys\n     authorized_key:\n       user: \"{{ssh_user}}\"\n       state: present\n-      key: \"{{ lookup('file', ssh_dir+'/id_rsa.pub') }}\"\n+      key: \"{{ lookup('file', '~/.ssh/id_rsa.pub') }}\"\n+  - name: Fetch hostkey\n+    connection: local\n+    command: \"ssh-keyscan {{ inventory_hostname }}\"\n+    register: hostkey\n   - name: Run ssh-keyscan to add keys to known_hosts\n-    local_action: \"shell ssh-keyscan {{ inventory_hostname }} >> {{ssh_dir}}/known_hosts\"\n+    connection: local\n+    known_hosts:\n+      name: \"{{ inventory_hostname }}\"\n+      key: \"{{ item }}\"\n+    with_items: \"{{ hostkey.stdout_lines }}\"\n+    when: hostkey.rc == 0"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #61: Add 'solr_remove_cruft' option.", "sha": "3a6d90f30f4a8267beee90369a47af54959209e5", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/3a6d90f30f4a8267beee90369a47af54959209e5", "parents": ["51d79d38e5f83c32148576605519c8a4f0991134"], "files": [{"sha": "32ae55f1295d334912992a8ffaf7afad085d271d", "filename": "tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/3a6d90f30f4a8267beee90369a47af54959209e5/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/3a6d90f30f4a8267beee90369a47af54959209e5/tasks/main.yml", "status": "modified", "patch": "@@ -54,10 +54,5 @@\n - include: configure.yml\n   when: \"solr_version.split('.')[0] >= '5'\"\n \n-- name: Remove the downloaded Solr archive.\n-  file:\n-    path: \"{{ item }}\"\n-    state: absent\n-  with_items:\n-    - \"{{ solr_workspace }}/{{ solr_filename }}.tgz\"\n-    - \"{{ solr_workspace }}/{{ solr_filename }}\"\n+- include: trim-fat.yml\n+  static: no"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "haxorof", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "haxorof", "committer_email": "bjorn.oscarsson@gmail.com", "message": "Fixes #4", "sha": "2f1ed84fec270723a1031cdc2b07b7a76a5a3bda", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/2f1ed84fec270723a1031cdc2b07b7a76a5a3bda", "parents": ["b11c4477d973b0cc87a296f6b028eaf9abab4686"], "files": [{"sha": "9600c1d1c7b551beb3dc0b826c32ba290854a471", "filename": "tasks/main-CentOS.yml", "previous_filename": null, "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2f1ed84fec270723a1031cdc2b07b7a76a5a3bda/tasks/main-CentOS.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2f1ed84fec270723a1031cdc2b07b7a76a5a3bda/tasks/main-CentOS.yml", "status": "modified", "patch": "@@ -19,4 +19,7 @@\n   become: true\n   when: yum_repo.changed\n \n+- include: main-Storage.yml\n+  when: docker_setup_devicemapper == true\n+\n - include: main-Generic.yml"}, {"sha": "638baddde388ee94327b295544d43e6e0c7b4dd0", "filename": "tasks/main-Fedora.yml", "previous_filename": null, "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2f1ed84fec270723a1031cdc2b07b7a76a5a3bda/tasks/main-Fedora.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2f1ed84fec270723a1031cdc2b07b7a76a5a3bda/tasks/main-Fedora.yml", "status": "modified", "patch": "@@ -18,4 +18,7 @@\n   become: true\n   changed_when: false\n \n+- include: main-Storage.yml\n+  when: docker_setup_devicemapper == true\n+\n - include: main-Generic.yml\n\\ No newline at end of file"}]}, {"repo": "dev-sec/ansible-os-hardening", "author_id": "MDQ6VXNlcjQ5Njg3Njkx", "author_name": "Oleg Kupriyanov", "committer_id": "MDQ6VXNlcjMxOTg5NjE=", "committer_name": "Sebastian Gumprich", "committer_email": "rndmh3ro@users.noreply.github.com", "message": "Fix error on applying the sysctl vars on containers (#243)\n\n* Add exception in sysctl task\r\n\r\nNo need apply sysctl in docker and openvz containers.\r\n\r\nSigned-off-by: Oleg Kupriyanov <okupriyanov@tradingview.com>\r\n\r\n* use block for sysctl tasks", "sha": "75935cbba14f385fbdb583dae8d7e631b266b932", "url": "https://api.github.com/repos/dev-sec/ansible-os-hardening/commits/75935cbba14f385fbdb583dae8d7e631b266b932", "parents": ["4228e8a157c780856bd03a548237fd5d18f8fe14"], "files": [{"sha": "0b565b359208cb80840eacdacbf7edaad315672a", "filename": "tasks/sysctl.yml", "previous_filename": null, "additions": 29, "deletions": 25, "changes": 54, "blob_url": "https://github.com/dev-sec/ansible-os-hardening/blob/75935cbba14f385fbdb583dae8d7e631b266b932/tasks/sysctl.yml", "raw_url": "https://github.com/dev-sec/ansible-os-hardening/raw/75935cbba14f385fbdb583dae8d7e631b266b932/tasks/sysctl.yml", "status": "modified", "patch": "@@ -35,31 +35,35 @@\n   when: ansible_facts.os_family == 'Debian' and os_security_kernel_enable_module_loading\n   register: initramfs\n \n-- name: create a combined sysctl-dict if overwrites are defined\n-  set_fact:\n-    sysctl_config: '{{ sysctl_config | combine(sysctl_overwrite) }}'\n-  when: sysctl_overwrite | default()\n-\n-- name: Change various sysctl-settings, look at the sysctl-vars file for documentation\n-  sysctl:\n-    name: '{{ item.key }}'\n-    value: '{{ item.value }}'\n-    sysctl_set: yes\n-    state: present\n-    reload: yes\n-    ignoreerrors: yes\n-  with_dict: '{{ sysctl_config }}'\n-\n-- name: Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation\n-  sysctl:\n-    name: '{{ item.key }}'\n-    value: '{{ item.value }}'\n-    state: present\n-    reload: yes\n-    ignoreerrors: yes\n-  with_dict: '{{ sysctl_rhel_config }}'\n-  when: ((ansible_facts.distribution == 'RedHat' or ansible_facts.distribution == 'Fedora' or ansible_facts.distribution == 'CentOS') and\n-        ansible_distribution_version|int is version('7', '<')) or ansible_facts.distribution == 'Amazon'\n+- name: change sysctls\n+  block:\n+    - name: create a combined sysctl-dict if overwrites are defined\n+      set_fact:\n+        sysctl_config: '{{ sysctl_config | combine(sysctl_overwrite) }}'\n+      when: sysctl_overwrite | default()\n+      \n+    - name: Change various sysctl-settings, look at the sysctl-vars file for documentation\n+      sysctl:\n+        name: '{{ item.key }}'\n+        value: '{{ item.value }}'\n+        sysctl_set: yes\n+        state: present\n+        reload: yes\n+        ignoreerrors: yes\n+      with_dict: '{{ sysctl_config }}'\n+      \n+    - name: Change various sysctl-settings on rhel6-hosts or older, look at the sysctl-vars file for documentation\n+      sysctl:\n+        name: '{{ item.key }}'\n+        value: '{{ item.value }}'\n+        state: present\n+        reload: yes\n+        ignoreerrors: yes\n+      with_dict: '{{ sysctl_rhel_config }}'\n+      when: ((ansible_facts.distribution == 'RedHat' or ansible_facts.distribution == 'Fedora' or ansible_facts.distribution == 'CentOS') and\n+            ansible_distribution_version|int is version('7', '<')) or ansible_facts.distribution == 'Amazon'\n+            \n+  when: ansible_virtualization_type not in ['docker', 'openvz', 'lxc']\n \n - name: Apply ufw defaults\n   template:"}]}, {"repo": "iiab/iiab", "author_id": "MDQ6VXNlcjgwODg5NQ==", "author_name": "Arky", "committer_id": "MDQ6VXNlcjgwODg5NQ==", "committer_name": "Arky", "committer_email": "hitmanarky@gmail.com", "message": "Adding 'no-cache-dir' extra argumuments\n\nPerhaps using no-cache-dir will preview out-of-memory errors on\nRaspberry Pi.\n\nFixes #908", "sha": "5c9ad5a9b451575b838963594b87293cbbac829d", "url": "https://api.github.com/repos/iiab/iiab/commits/5c9ad5a9b451575b838963594b87293cbbac829d", "parents": ["9e3783dac89261108975edd93b255a85420e75c9"], "files": [{"sha": "d2921a38a70b03f2dd315c66ea89035f78ed1386", "filename": "roles/kolibri/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/iiab/iiab/blob/5c9ad5a9b451575b838963594b87293cbbac829d/roles/kolibri/tasks/main.yml", "raw_url": "https://github.com/iiab/iiab/raw/5c9ad5a9b451575b838963594b87293cbbac829d/roles/kolibri/tasks/main.yml", "status": "modified", "patch": "@@ -23,6 +23,7 @@\n   pip:\n     name: kolibri\n     state: latest\n+    extra_args: --no-cache-dir\n   when: internet_available\n \n - name: Create kolibri systemd service file"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #12", "sha": "f26e6a5f816bc8f8672d0b80aa761ae8c459d30a", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/f26e6a5f816bc8f8672d0b80aa761ae8c459d30a", "parents": ["b79a990b9cc80f1d419cebc46be91029fde17f76"], "files": [{"sha": "f1fd40fea6cd8c57e4c62c5ad95db7d3e5426c56", "filename": "tasks/checks.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f26e6a5f816bc8f8672d0b80aa761ae8c459d30a/tasks/checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f26e6a5f816bc8f8672d0b80aa761ae8c459d30a/tasks/checks.yml", "status": "modified", "patch": "@@ -1,7 +1,7 @@\n ---\n-- include: distribution-checks.yml\n+- include_tasks: distribution-checks.yml\n   when:\n     _docker_os_dist_check | bool\n     \n-- include: compatibility-checks.yml\n+- include_tasks: compatibility-checks.yml\n "}, {"sha": "57c615f17e2de879aa2b8570210d10f4c8b33e3c", "filename": "meta/main.yml", "previous_filename": null, "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f26e6a5f816bc8f8672d0b80aa761ae8c459d30a/meta/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f26e6a5f816bc8f8672d0b80aa761ae8c459d30a/meta/main.yml", "status": "modified", "patch": "@@ -1,7 +1,7 @@\n galaxy_info:\n   author: Bjorn Oscarsson\n   description: \"Installs and configures Docker Community Edition (CE)\"\n-  min_ansible_version: 2.3\n+  min_ansible_version: 2.4\n   license: MIT\n   platforms:\n   - name: Fedora\n@@ -26,5 +26,7 @@ galaxy_info:\n \n   galaxy_tags:\n     - docker\n+    - ce\n+    - system\n \n dependencies: []"}, {"sha": "1d60273a0a9568f9c364273c0f2f0f9c96d53338", "filename": "tasks/main.yml", "previous_filename": null, "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f26e6a5f816bc8f8672d0b80aa761ae8c459d30a/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f26e6a5f816bc8f8672d0b80aa761ae8c459d30a/tasks/main.yml", "status": "modified", "patch": "@@ -17,25 +17,25 @@\n     _docker_os_dist_major_version == \"18\"\n   tags: [\"install\", \"configure\"]\n \n-- include: checks.yml\n+- include_tasks: checks.yml\n   tags: [\"install\", \"configure\"]\n \n-- include: setup-repository.yml\n+- include_tasks: setup-repository.yml\n   tags: [\"install\"]\n \n-- include: remove-pre-docker-ce.yml\n+- include_tasks: remove-pre-docker-ce.yml\n   when: docker_remove_pre_ce | bool\n   tags: [\"install\"]\n \n-- include: install-docker.yml\n+- include_tasks: install-docker.yml\n   tags: [\"install\"]\n \n-- include: setup-audit.yml\n+- include_tasks: setup-audit.yml\n   tags: [\"configure\"]\n \n-- include: kernel-3-mount-fixes.yml\n+- include_tasks: kernel-3-mount-fixes.yml\n   when: ansible_kernel | version_compare('4', '<')\n   tags: [\"configure\"]\n \n-- include: configure-docker.yml\n+- include_tasks: configure-docker.yml\n   tags: [\"configure\"]"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #42", "sha": "42872d84e97c9abee27d8aeda965fc16019e9385", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/42872d84e97c9abee27d8aeda965fc16019e9385", "parents": ["71cda5f377e4e4de8b037d066df6a45835637e3c"], "files": [{"sha": "726ae1731c4d80a7bb69911c3cde3add5e15e4ab", "filename": "tasks/main.yml", "previous_filename": null, "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/42872d84e97c9abee27d8aeda965fc16019e9385/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/42872d84e97c9abee27d8aeda965fc16019e9385/tasks/main.yml", "status": "modified", "patch": "@@ -33,6 +33,9 @@\n - include_tasks: setup-audit.yml\n   tags: [\"configure\"]\n \n+- include_tasks: configure-drop-ins.yml\n+  tags: [\"configure\"]\n+\n - include_tasks: kernel-3-mount-fixes.yml\n   when: ansible_kernel | version_compare('4', '<')\n   tags: [\"configure\"]"}, {"sha": "35c2ef6b07489e3f86d0755d24bdf68610bfa4a4", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/42872d84e97c9abee27d8aeda965fc16019e9385/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/42872d84e97c9abee27d8aeda965fc16019e9385/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -25,7 +25,7 @@\n         _docker_os_dist == \"CentOS\" or\n         _docker_os_dist == \"RedHat\"\n \n-- name: Add Docker\u2019s official GPG key\n+- name: Add Docker official GPG key\n   apt_key:\n     url: https://download.docker.com/linux/{{ _docker_os_dist|lower }}/gpg\n     state: present"}, {"sha": "c2f5ee36ce04dd6309a25f8b61897c45dd186ce1", "filename": "tasks/kernel-3-mount-fixes.yml", "previous_filename": null, "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/42872d84e97c9abee27d8aeda965fc16019e9385/tasks/kernel-3-mount-fixes.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/42872d84e97c9abee27d8aeda965fc16019e9385/tasks/kernel-3-mount-fixes.yml", "status": "modified", "patch": "@@ -12,13 +12,6 @@\n   become: yes\n   when: may_detach_mounts.stat.exists\n \n-- name: Ensure /etc/systemd/system/docker.service.d directory exists\n-  file:\n-    path: /etc/systemd/system/docker.service.d\n-    state: directory\n-    mode: 0755\n-  become: yes\n-\n - name: Copy systemd drop-in for Docker Mount Flags slave configuration to avoid 'Device or resource busy'\n   copy:\n     src: files/etc/systemd/system/docker.service.d/mountflags-slave.conf"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjUwNjI4Mw==", "author_name": "Daniel Widerin", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #35", "sha": "99ca923c69cb1a5af33452a44872dc2ef0a682c5", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/99ca923c69cb1a5af33452a44872dc2ef0a682c5", "parents": ["96d08490c5883297da11864d5297f02c32c94c63"], "files": [{"sha": "2310e238c7c4863133dece6bbc06b8a64e237955", "filename": "tasks/install.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/99ca923c69cb1a5af33452a44872dc2ef0a682c5/tasks/install.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/99ca923c69cb1a5af33452a44872dc2ef0a682c5/tasks/install.yml", "status": "modified", "patch": "@@ -12,7 +12,7 @@\n     -u {{ solr_user }}\n     -s {{ solr_service_name }}\n     -p {{ solr_port }}\n-    creates={{ solr_install_dir }}/solr/bin/solr\n+    creates={{ solr_install_dir }}/{{ solr_service_name }}/bin/solr\n   register: solr_install_script_result\n \n # Workaround for bug https://github.com/ansible/ansible-modules-core/issues/915."}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjk1MTE=", "author_name": "duritong", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "Fix #270 - make lvm size configurable (#274)\n\n* Fix #270 - Make lvm size configurable\r\n\r\n* make it possible to configure the fstype per lvm", "sha": "c3b8eb7ce2b79fb375e6c09ded01a4efd3d9fe00", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/c3b8eb7ce2b79fb375e6c09ded01a4efd3d9fe00", "parents": ["b7ee8a0c3030974856d0b2c2df37b8d13935853c"], "files": [{"sha": "d7b1e862aedad429ccd8a486cf9e01ff065a0ef3", "filename": "roles/config-lvm/tasks/lvm.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/c3b8eb7ce2b79fb375e6c09ded01a4efd3d9fe00/roles/config-lvm/tasks/lvm.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/c3b8eb7ce2b79fb375e6c09ded01a4efd3d9fe00/roles/config-lvm/tasks/lvm.yml", "status": "modified", "patch": "@@ -9,11 +9,11 @@\n   lvol: \n     vg: \"{{ item.vg_name }}\"\n     lv: \"{{ item.lv_name }}\"\n-    size: \"100%VG\"\n+    size: \"{{ item.lv_size | default(default_lv_size) }}\"\n \n - name: \"Create file system on share\"\n   filesystem:\n-    fstype: \"{{ lvm_fstype }}\"\n+    fstype: \"{{ item.lv_fstype | default(lvm_fstype) }}\"\n     dev: \"/dev/mapper/{{ item.vg_name }}-{{ item.lv_name }}\"\n \n - name: \"Ensure the mount dir exists\" \n@@ -23,7 +23,7 @@\n \n - name: \"Mount LVM to directory\"\n   mount:\n-    src: \"/dev/mapper/{{ item.vg_name }}-{{ item.lv_name }}\" \n+    src: \"/dev/mapper/{{ item.vg_name }}-{{ item.lv_name }}\"\n     path: \"{{ item.mount_path }}\"\n-    fstype: \"{{ lvm_fstype }}\" \n+    fstype: \"{{ item.lv_fstype | default(lvm_fstype) }}\"\n     state: mounted"}, {"sha": "2880c831929bdf8b1b788ee2fc79faa464a938e1", "filename": "roles/config-lvm/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/c3b8eb7ce2b79fb375e6c09ded01a4efd3d9fe00/roles/config-lvm/defaults/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/c3b8eb7ce2b79fb375e6c09ded01a4efd3d9fe00/roles/config-lvm/defaults/main.yml", "status": "modified", "patch": "@@ -1,3 +1,4 @@\n ---\n \n lvm_fstype: \"xfs\"\n+default_lv_size: \"100%VG\""}]}, {"repo": "cloudalchemy/ansible-fluentd", "author_id": "MDQ6VXNlcjM1MzE3NTg=", "author_name": "Pawe\u0142 Krupa", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #4 from cloudalchemy/systemd_workaround\n\n@jkrol2 after going through issues in ansible project, I think this is our root cause: https://github.com/ansible/ansible/issues/29520. Package tg-agent installs files for sysvinit (/etc/init.d/td-agent) *and* systemd file (/usr/lib/systemd/system/td-agent.service) and `systemd` module has problems with such installations.\r\n\r\nResolves #1", "sha": "59a6248e234c7ea22bb9e8989736023520d54e29", "url": "https://api.github.com/repos/cloudalchemy/ansible-fluentd/commits/59a6248e234c7ea22bb9e8989736023520d54e29", "parents": ["451b4aa57739d595550722949fd2443659011672", "4695dc357e09e35a568f49711336cc756f708fb7"], "files": [{"sha": "a38bea3c265e6fe4aac8675d89d171353892ed49", "filename": "tasks/configure.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/cloudalchemy/ansible-fluentd/blob/59a6248e234c7ea22bb9e8989736023520d54e29/tasks/configure.yml", "raw_url": "https://github.com/cloudalchemy/ansible-fluentd/raw/59a6248e234c7ea22bb9e8989736023520d54e29/tasks/configure.yml", "status": "modified", "patch": "@@ -29,7 +29,7 @@\n \n - name: Create custom configuration\n   template:\n-    src:  \"{{ item }}\"\n+    src:  \"{{ item }}.j2\"\n     dest: \"/etc/td-agent/conf.d/{{ item.split('/')[-1] }}\"\n     owner: td-agent\n     group: td-agent"}, {"sha": "9320d39881890c8b1f0477972eda5ea1a6959c27", "filename": "tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/cloudalchemy/ansible-fluentd/blob/59a6248e234c7ea22bb9e8989736023520d54e29/tasks/main.yml", "raw_url": "https://github.com/cloudalchemy/ansible-fluentd/raw/59a6248e234c7ea22bb9e8989736023520d54e29/tasks/main.yml", "status": "modified", "patch": "@@ -18,6 +18,7 @@\n - include: configure.yml\n \n - name: Ensure fluentd (td-agent) service is enabled\n-  systemd:\n+  service:\n     name: td-agent\n     enabled: yes\n+    use: service"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #727 - HSTS: default preload to off\n\nThe HSTS `preload` option defaulted to true. This turns it off by\ndefault since the HSTS preload list should be opt-in as it also requires\na submission to https://hstspreload.org.", "sha": "a86a02c49b29d5b5a5d32eb8c6162960af1304d8", "url": "https://api.github.com/repos/roots/trellis/commits/a86a02c49b29d5b5a5d32eb8c6162960af1304d8", "parents": ["a6f0793579913ee9121ba4be445f430ef266d54c"], "files": [{"sha": "a77ecfb80dccec6f1e9c3f5fc81cea210f439d47", "filename": "roles/nginx/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/a86a02c49b29d5b5a5d32eb8c6162960af1304d8/roles/nginx/defaults/main.yml", "raw_url": "https://github.com/roots/trellis/raw/a86a02c49b29d5b5a5d32eb8c6162960af1304d8/roles/nginx/defaults/main.yml", "status": "modified", "patch": "@@ -9,7 +9,7 @@ nginx_ssl_path: \"{{ nginx_path }}/ssl\"\n # HSTS defaults\n nginx_hsts_max_age: 31536000\n nginx_hsts_include_subdomains: true\n-nginx_hsts_preload: true\n+nginx_hsts_preload: false\n \n # Fastcgi cache params\n nginx_cache_path: /var/cache/nginx"}]}, {"repo": "lean-delivery/ansible-role-java", "author_id": "MDQ6VXNlcjQwMzAwNjQy", "author_name": "Timur Gadiev", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix download (#70)\n\n* Fix openjdk fetch\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>", "sha": "003ef19731dd9631e9959ce422ea9e4a6c5becd7", "url": "https://api.github.com/repos/lean-delivery/ansible-role-java/commits/003ef19731dd9631e9959ce422ea9e4a6c5becd7", "parents": ["02a698426c0c87880861589935baa0e7757f7ac6"], "files": [{"sha": "e0bdceb339c95e44de176ec27b350e8a631d0c54", "filename": "tasks/win_fetch/openjdk-fallback.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/003ef19731dd9631e9959ce422ea9e4a6c5becd7/tasks/win_fetch/openjdk-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/003ef19731dd9631e9959ce422ea9e4a6c5becd7/tasks/win_fetch/openjdk-fallback.yml", "status": "modified", "patch": "@@ -14,7 +14,7 @@\n   set_fact:\n     release_url: >-\n       {{ root_page['content'] |\n-      regex_findall('(https://download\\.oracle\\.com/java/GA/jdk' +\n+      regex_findall('(https://download[\\.\\w]+/java/GA/jdk' +\n       java_major_version|string +\n       '[.\\d]+/[\\d\\w]+/' +\n       java_major_version|string +"}, {"sha": "d5627320a9682c247ef5666be54a488a56b2b6ba", "filename": "tasks/fetch/openjdk-fallback.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/003ef19731dd9631e9959ce422ea9e4a6c5becd7/tasks/fetch/openjdk-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/003ef19731dd9631e9959ce422ea9e4a6c5becd7/tasks/fetch/openjdk-fallback.yml", "status": "modified", "patch": "@@ -13,7 +13,7 @@\n   set_fact:\n     release_url: >-\n       {{ root_page['content']\n-        | regex_findall('(https://download\\.oracle\\.com/java/GA/jdk'\n+        | regex_findall('(https://download[\\.\\w]+/java/GA/jdk'\n           + java_major_version|string + '[.\\d]+/[\\d\\w]+/'\n           + java_major_version|string + '/GPL/openjdk-'\n           + java_major_version|string + '[\\d._]+linux-x64_bin[\\w\\d.]+)')"}]}, {"repo": "PeterMosmans/ansible-role-virtualbox-guest", "author_id": "MDQ6VXNlcjE0NjUzMDI=", "author_name": "Peter Mosmans", "committer_id": "MDQ6VXNlcjE0NjUzMDI=", "committer_name": "Peter Mosmans", "committer_email": "support@go-forward.net", "message": "Rewrite jinja2 parameters to prevent warning, closes #12", "sha": "d32448526e791f603283d145bc8bdd531061408a", "url": "https://api.github.com/repos/PeterMosmans/ansible-role-virtualbox-guest/commits/d32448526e791f603283d145bc8bdd531061408a", "parents": ["e750ba2f5e2697f9db93c30346f571f23bfc7a67"], "files": [{"sha": "605b8e3191bd31d8ceffc197b208a33e4565d73f", "filename": "tasks/main.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/PeterMosmans/ansible-role-virtualbox-guest/blob/d32448526e791f603283d145bc8bdd531061408a/tasks/main.yml", "raw_url": "https://github.com/PeterMosmans/ansible-role-virtualbox-guest/raw/d32448526e791f603283d145bc8bdd531061408a/tasks/main.yml", "status": "modified", "patch": "@@ -22,7 +22,7 @@\n - name: Determine if (the requested version of) vboxguestadditions is installed\n   shell: modinfo vboxguest 2>/dev/null|awk '/^version/{print $2}'\n   register: vbox_guest_version\n-  changed_when: vbox_guest_version.stdout != \"{{ virtualbox_version }}\"\n+  changed_when: vbox_guest_version.stdout != virtualbox_version\n   ignore_errors: yes\n \n - block:\n@@ -71,7 +71,7 @@\n       opts=noauto\n       state=mounted\n     register: mounted_ISO\n-    when: mount_path is defined and \"{{ mount_path.stdout }}\" == \"\"\n+    when: mount_path is defined and mount_path.stdout == \"\"\n \n   - name: Check if VBoxGuest additions ISO is mounted\n     shell: mount -l 2>/dev/null|awk '/VBOXADDITIONS/{print $3}'\n@@ -170,4 +170,4 @@\n       line='{{ ISO_path }}\t{{ mount_path.stdout }}\tiso9660\tnoauto\t0\t0'\n       state=absent\n     when: mounted_ISO | changed\n-  when: (vbox_guest_version.stdout != \"{{ virtualbox_version }}\")\n+  when: (vbox_guest_version.stdout != virtualbox_version)"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjEwNTMxMDE2", "author_name": "Marcos Entenza", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "Fix deprecated options for Satellite Install (#405)", "sha": "1a9a976d8019447d2c6f1b442aeaad8270b5fdc7", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/1a9a976d8019447d2c6f1b442aeaad8270b5fdc7", "parents": ["7a64766d41b5c21791c04511092722803df6e4dd"], "files": [{"sha": "94ca74b5589abd5c7741b9e914561a808fa1f804", "filename": "roles/config-satellite/tasks/install.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/1a9a976d8019447d2c6f1b442aeaad8270b5fdc7/roles/config-satellite/tasks/install.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/1a9a976d8019447d2c6f1b442aeaad8270b5fdc7/roles/config-satellite/tasks/install.yml", "status": "modified", "patch": "@@ -2,11 +2,11 @@\n \n - name: \"Install Satellite with default parameters\"\n   command: > \n-    satellite-installer \n+    satellite-installer\n       --scenario satellite\n       --foreman-initial-organization \"{{ satellite_organization }}\"\n       --foreman-initial-location \"{{ satellite_location }}\"\n-      --foreman-admin-username \"{{ satellite_username }}\"\n-      --foreman-admin-password \"{{ satellite_password }}\"\n+      --foreman-initial-admin-username \"{{ satellite_username }}\"\n+      --foreman-initial-admin-password \"{{ satellite_password }}\"\n       --foreman-proxy-dns-managed=false\n       --foreman-proxy-dhcp-managed=false"}]}, {"repo": "RedHat-EMEA-SSA-Team/stc", "author_id": "MDQ6VXNlcjE0NDYxMjY=", "author_name": "Natale Vinto", "committer_id": "MDQ6VXNlcjE0NDYxMjY=", "committer_name": "Natale Vinto", "committer_email": "nvinto@redhat.com", "message": "Fix typo resolves #55", "sha": "ce0921cf63ee0aec70d171a4ade5e2acb6739c4c", "url": "https://api.github.com/repos/RedHat-EMEA-SSA-Team/stc/commits/ce0921cf63ee0aec70d171a4ade5e2acb6739c4c", "parents": ["786ebef5fb8b9dcbf1a7f45f5ed106ced683570a"], "files": [{"sha": "934dde6d4fd48b4887af50cd994392a0755d4615", "filename": "playbooks/roles/check_glusterfs/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/RedHat-EMEA-SSA-Team/stc/blob/ce0921cf63ee0aec70d171a4ade5e2acb6739c4c/playbooks/roles/check_glusterfs/tasks/main.yml", "raw_url": "https://github.com/RedHat-EMEA-SSA-Team/stc/raw/ce0921cf63ee0aec70d171a4ade5e2acb6739c4c/playbooks/roles/check_glusterfs/tasks/main.yml", "status": "modified", "patch": "@@ -11,6 +11,6 @@\n - name: Signal if NTP is not enable or synchronized\n   debug:\n     msg: |\n-      {{ ntp_enable.stdout }}\n+      {{ ntp_enabled.stdout }}\n   when: ntp_enabled.rc != 0 or ntp_synchronized.rc != 0\n "}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #353 - Allow insecure curl reqs for cron\n\nIn development with an https site, the curl command for WP cron will\nfail due to the \"insecure\" self-signed certificate.\n\nAdding the `-k` flag means curl will ignore this and continue on.", "sha": "308b55a95495182b363bf8d58ed7959b18c08a0b", "url": "https://api.github.com/repos/roots/trellis/commits/308b55a95495182b363bf8d58ed7959b18c08a0b", "parents": ["e1e3b77a7685d64d2db6cc80acdd8d130abd5284"], "files": [{"sha": "b73282e1e48b9917b7bd1d7ff691a1221dc48800", "filename": "roles/wordpress-setup/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/308b55a95495182b363bf8d58ed7959b18c08a0b/roles/wordpress-setup/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/308b55a95495182b363bf8d58ed7959b18c08a0b/roles/wordpress-setup/tasks/main.yml", "status": "modified", "patch": "@@ -26,7 +26,7 @@\n     name: \"{{ item.key }} WordPress cron\"\n     minute: \"*/15\"\n     user: \"{{ web_user }}\"\n-    job: \"curl -s {{ item.value.env.wp_siteurl }}/wp-cron.php > /dev/null 2>&1\"\n+    job: \"curl -k -s {{ item.value.env.wp_siteurl }}/wp-cron.php > /dev/null 2>&1\"\n     cron_file: \"wordpress-{{ item.key | replace('.', '_') }}\"\n   with_dict: wordpress_sites\n   when: item.value.env.disable_wp_cron | default(false) and not item.value.multisite.enabled | default(false)"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #100 #93 and added support for Raspbian", "sha": "31db975782345f7d679e1d8ddea1c0769d6f9d36", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/31db975782345f7d679e1d8ddea1c0769d6f9d36", "parents": ["5e7ddacd43ed728193f9a96ae81f46a0cec5659f"], "files": [{"sha": "a47a3d5a4de165bcec2ef085b2455675d92964b4", "filename": "tasks/setup-repository-Ubuntu.yml", "previous_filename": null, "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/setup-repository-Ubuntu.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/setup-repository-Ubuntu.yml", "status": "modified", "patch": "@@ -14,8 +14,7 @@\n   package:\n     name: \"{{ item }}\"\n     state: present\n-  with_items:\n-    - \"{{ docker_repository_related_packages[_docker_os_dist] }}\"\n+  loop: \"{{ docker_repository_related_packages[_docker_os_dist] }}\"\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when:\n@@ -30,8 +29,8 @@\n   until: _pkg_result is succeeded\n   when:\n     - docker_network_access | bool\n-    - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version > '14') or\n-      (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version > '7')\n+    - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version > 14) or\n+      (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version > 7)\n \n - name: Add Docker APT key (alternative for older Ubuntu systems without SNI).\n   become: true\n@@ -41,8 +40,8 @@\n   changed_when: false\n   when:\n     - docker_network_access | bool\n-    - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version == '14') or\n-      (_docker_os_dist == \"Debian\" and  _docker_os_dist_major_version == '7')\n+    - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version == 14) or\n+      (_docker_os_dist == \"Debian\" and  _docker_os_dist_major_version == 7)\n   tags:\n     - skip_ansible_lint\n \n@@ -57,7 +56,7 @@\n - name: Add Docker CE repository with correct channels (Ubuntu/Debian)\n   become: true\n   apt_repository:\n-    repo: \"deb [arch=amd64] https://download.docker.com/linux/{{ _docker_os_dist|lower }} \\\n+    repo: \"deb [arch={{ _docker_os_arch|lower }}] https://download.docker.com/linux/{{ _docker_os_dist|lower }} \\\n       {{ ansible_lsb.codename }} {{ _docker_enable_channels | join(' ') }}\"\n     state: present\n     filename: 'docker-ce'"}, {"sha": "2a9d5fece8a73eea11992ca2a6191d4c1f5ca6f3", "filename": "tasks/setup-repository-Fedora.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/setup-repository-Fedora.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/setup-repository-Fedora.yml", "status": "modified", "patch": "@@ -5,7 +5,7 @@\n   changed_when: false\n   when:\n     - docker_network_access | bool\n-    - ansible_python_version is version_compare('3', '<')\n+    - not _docker_python3\n \n - name: Include tasks from setup of repositories for CentOS\n   include_tasks: setup-repository-CentOS.yml\n\\ No newline at end of file"}, {"sha": "edeffb7772a4a662f6fd46afbb63f61ce6ec67ab", "filename": "tasks/configure-docker/configure-docker-plugins.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/configure-docker/configure-docker-plugins.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/configure-docker/configure-docker-plugins.yml", "status": "modified", "patch": "@@ -28,7 +28,7 @@\n   become: yes\n   shell: \"(docker plugin install --grant-all-permissions --alias {{ item.alias | default(item.name) }} {{ item.name }} \\\n     && echo 'installed') || echo 'nop'\"\n-  with_items: \"{{ docker_plugins }}\"\n+  loop: \"{{ docker_plugins }}\"\n   register: _docker_plugin_install\n   changed_when: _docker_plugin_install.stdout_lines | last == 'installed'\n   when:\n@@ -41,7 +41,7 @@\n - name: Create list of authorization plugins\n   set_fact:\n     _authz_plugins: \"{{ _authz_plugins + [item.alias | default(item.name)] }}\"\n-  with_items: \"{{ docker_plugins }}\"\n+  loop: \"{{ docker_plugins }}\"\n   when:\n     - item.type == 'authz'\n "}, {"sha": "2376e6f6523429fc6c8ca8d89c40e70896f1ad86", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -64,7 +64,7 @@\n     path: \"{{ item }}\"\n     regexp: '^dockremap'\n     line: 'dockremap:500000:65536'\n-  with_items:\n+  loop:\n     - /etc/subuid\n     - /etc/subgid\n   when: (_docker_os_dist == \"CentOS\" or _docker_os_dist == \"RedHat\") and\n@@ -79,7 +79,7 @@\n     name: \"{{ item }}\"\n     groups: docker\n     append: true\n-  with_items: \"{{ docker_users }}\"\n+  loop: \"{{ docker_users }}\"\n \n - name: Ensure devicemapper prerequisites are fulfilled\n   block:"}, {"sha": "f308af765c4259e6656a7658114aa5da8babcf1b", "filename": "tasks/install-docker.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/install-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/install-docker.yml", "status": "modified", "patch": "@@ -23,16 +23,16 @@\n       - docker-ce\n   when:\n     - _docker_packages is not defined\n-    - (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version < '9') or\n-      (_docker_os_dist == \"Fedora\" and _docker_os_dist_major_version < '27') or\n-      (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version < '16')\n+    - (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version | int < 9) or\n+      (_docker_os_dist == \"Fedora\" and _docker_os_dist_major_version | int < 27) or\n+      (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version | int < 16)\n \n - name: Ensure Docker CE is installed\n   become: true\n   package:\n     name: \"{{ (item is search('docker')) | ternary((item + _docker_version_string | default('')), item) }}\"\n     state: \"{{ _docker_pkg_state | default('present') }}\"\n-  with_items: \"{{ _docker_packages | default(docker_packages) }}\"\n+  loop: \"{{ _docker_packages | default(docker_packages) }}\"\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   notify: restart docker"}, {"sha": "a184869c89534f7f297df64416002d5926156a17", "filename": "tasks/checks/distribution-checks-CentOS.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-CentOS.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-CentOS.yml", "status": "modified", "patch": "@@ -2,4 +2,4 @@\n - name: Fail if unsupported CentOS version\n   fail:\n     msg: \"CentOS 7 or later is required!\"\n-  when: _docker_os_dist_major_version < '7'\n+  when: _docker_os_dist_major_version | int < 7"}, {"sha": "bb8855f54f58067874511cd988816d0003761a5b", "filename": "tasks/main.yml", "previous_filename": null, "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/main.yml", "status": "modified", "patch": "@@ -1,10 +1,12 @@\n ---\n-- name: Set distribution facts\n+- name: Set distribution and python facts\n   set_fact:\n     _docker_os_dist: \"{{ ansible_distribution }}\"\n     _docker_os_dist_release: \"{{ ansible_distribution_release }}\"\n     _docker_os_dist_major_version: \"{{ ansible_distribution_major_version }}\"\n+    _docker_os_arch: \"amd64\"\n     _docker_os_dist_check: yes\n+    _docker_python3: \"{{ ansible_python_version is version('3', '>=') }}\"\n   tags: [\"always\"]\n \n - name: Reinterpret distribution facts for Linux Mint 18\n@@ -17,6 +19,20 @@\n     _docker_os_dist_major_version == \"18\"\n   tags: [\"always\"]\n \n+- name: OS release info\n+  raw: cat /etc/os-release\n+  check_mode: no\n+  changed_when: no\n+  register: _docker_os_release_info  \n+  tags: [\"always\"]\n+\n+- name: Reinterpret distribution facts for Raspbian\n+  set_fact:\n+    _docker_os_arch: \"armhf\"\n+  when:\n+    - _os_release_info.stdout is search('raspbian')\n+  tags: [\"always\"]\n+\n - name: Reset role variables\n   set_fact:\n     docker_systemd_service_config_tweaks: []\n@@ -37,6 +53,12 @@\n   when: docker_pkg_name is match('docker-ce' + docker_os_pkg_version_separator[_docker_os_dist])\n   tags: [\"always\"]\n \n+- name: Print interpreted distribution information\n+  debug:\n+    msg: \"distribution={{ _docker_os_dist }}, release={{ _docker_os_dist_release }}, major_version={{ _docker_os_dist_major_version }}\"\n+    verbosity: 1\n+  tags: [\"always\"]\n+\n - name: Compatibility and distribution checks\n   include_tasks: checks.yml\n   when: docker_do_checks | bool"}, {"sha": "6249336235b4f6bca0946db3cee13bf63d2141d3", "filename": "tasks/checks/distribution-checks-Debian.yml", "previous_filename": null, "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-Debian.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-Debian.yml", "status": "modified", "patch": "@@ -2,5 +2,6 @@\n - name: Fail if unsupported Debian version\n   fail:\n     msg: \"Debian 7 (wheezy) or later is required!\"\n-  when: _docker_os_dist == \"Debian\" and\n-        _docker_os_dist_major_version < '7'\n+  when:\n+    - _docker_os_dist == \"Debian\"\n+    - _docker_os_dist_major_version | int < 7"}, {"sha": "d7c09706c9e7082369b7184d1735767ef160976e", "filename": "tasks/postinstall.yml", "previous_filename": null, "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/postinstall.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/postinstall.yml", "status": "modified", "patch": "@@ -3,7 +3,6 @@\n   set_fact:\n     _docker_additional_packages_os: []\n     _docker_additional_packages_pip: []\n-    _docker_python3: \"{{ ansible_python_version is version_compare('3', '>=') }}\"\n \n - name: Set facts to install Docker SDK for Python\n   set_fact:\n@@ -109,8 +108,7 @@\n   package:\n     name: \"{{ item }}\"\n     state: present\n-  with_items:\n-    - \"{{ _docker_additional_packages_os }}\"\n+  loop: \"{{ _docker_additional_packages_os }}\"\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when: _docker_additional_packages_os | length > 0\n@@ -130,8 +128,7 @@\n     name: \"{{ item }}\"\n     state: present\n     extra_args: \"{{ docker_pip_extra_args }}\"\n-  with_items:\n-    - \"{{ _docker_additional_packages_pip }}\"\n+  loop: \"{{ _docker_additional_packages_pip }}\"\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when: _docker_additional_packages_pip | length > 0"}, {"sha": "955c780d05df33492657dfb2e3d49978e501f37b", "filename": "tasks/checks/distribution-checks-Fedora.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-Fedora.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-Fedora.yml", "status": "modified", "patch": "@@ -3,4 +3,4 @@\n   fail:\n     msg: \"Fedora 24 or later is required!\"\n   when: _docker_os_dist == \"Fedora\" and\n-        _docker_os_dist_major_version < '24'\n+        _docker_os_dist_major_version | int < 24"}, {"sha": "2e2099fd0bd60e26a10e26cc7f330675add860a5", "filename": "tasks/setup-repository-CentOS.yml", "previous_filename": null, "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/setup-repository-CentOS.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/setup-repository-CentOS.yml", "status": "modified", "patch": "@@ -4,8 +4,7 @@\n   package:\n     name: \"{{ item }}\"\n     state: present\n-  with_items:\n-    - \"{{ docker_repository_related_packages[_docker_os_dist] }}\"\n+  loop: \"{{ docker_repository_related_packages[_docker_os_dist] }}\"\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when:\n@@ -39,7 +38,7 @@\n   shell: \"{{ docker_cmd_enable_disable_edge_repo[_docker_os_dist] }}\"\n   args:\n     warn: false\n-  with_items: \"{{ _docker_disable_channels }}\"\n+  loop: \"{{ _docker_disable_channels }}\"\n   changed_when: false\n   vars:\n     _item_enabled: false\n@@ -54,7 +53,7 @@\n   shell: \"{{ docker_cmd_enable_disable_edge_repo[_docker_os_dist] }}\"\n   args:\n     warn: false\n-  with_items: \"{{ _docker_enable_channels }}\"\n+  loop: \"{{ _docker_enable_channels }}\"\n   changed_when: false\n   vars:\n     _item_enabled: true"}, {"sha": "143612024688d8e798ddf4919f1249d26f43f905", "filename": "tasks/setup-repository-RedHat.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/setup-repository-RedHat.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/setup-repository-RedHat.yml", "status": "modified", "patch": "@@ -28,13 +28,13 @@\n         | grep {{ item.id }} && exit 0 \\\n         || {{ _rhel_cmd_enable_disable_repo[item.state][item.repo_manager] }}{{ item.id }} \\\n         && exit 2\"\n-      with_items: \"{{ _rhel_repos }}\"\n+      loop: \"{{ _rhel_repos }}\"\n       register: _cmd_rhel_repo_enabled_disabled\n       changed_when: _cmd_rhel_repo_enabled_disabled.rc == 2\n       failed_when: _cmd_rhel_repo_enabled_disabled.rc not in [ 0, 2 ]\n       tags:\n         - skip_ansible_lint\n \n-  when: \n+  when:\n     - docker_network_access | bool\n-    - _docker_os_dist_major_version == '7'\n\\ No newline at end of file\n+    - _docker_os_dist_major_version | int == 7\n\\ No newline at end of file"}, {"sha": "42ffcbda3b2251e5838e949dc8a66a3ef63170ee", "filename": "tasks/remove-docker.yml", "previous_filename": null, "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/remove-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/remove-docker.yml", "status": "modified", "patch": "@@ -12,7 +12,7 @@\n   package:\n     name: \"{{ item }}\"\n     state: absent\n-  with_items: \"{{ docker_packages }}\"\n+  loop: \"{{ docker_packages }}\"\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when: _docker_os_dist != \"Ubuntu\" and\n@@ -24,7 +24,7 @@\n     name: \"{{ item }}\"\n     state: absent\n     purge: yes\n-  with_items: \"{{ docker_packages }}\"\n+  loop: \"{{ docker_packages }}\"\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when: _docker_os_dist == \"Ubuntu\" or\n@@ -88,7 +88,7 @@\n   file:\n     path: \"{{ item }}\"\n     state: absent\n-  with_items:\n+  loop:\n     # all distributions\n     - \"{{ docker_envs_dir[_docker_os_dist] }}/docker\"\n     - \"{{ docker_envs_dir[_docker_os_dist] }}/docker-envs\"\n@@ -107,7 +107,7 @@\n   file:\n     path: \"{{ item }}\"\n     state: absent\n-  with_items:\n+  loop:\n     - /var/lib/docker\n     - /var/lib/docker-engine\n     - \"{{ docker_remove_additional }}\"\n@@ -135,7 +135,7 @@\n   file:\n     path: \"{{ item.path }}\"\n     state: absent\n-  with_items: \"{{ _remove_cache_dirs.files }}\"\n+  loop: \"{{ _remove_cache_dirs.files }}\"\n   when: _docker_os_dist == \"Fedora\" or\n         _docker_os_dist == \"CentOS\" or\n         _docker_os_dist == \"RedHat\""}, {"sha": "96ac3b41ed9facabb7ec6586f0dea5e9d8a73a8d", "filename": "tasks/checks/distribution-checks-Ubuntu.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-Ubuntu.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-Ubuntu.yml", "status": "modified", "patch": "@@ -3,4 +3,4 @@\n   fail:\n     msg: \"Ubuntu 14 or later is required!\"\n   when: _docker_os_dist == \"Ubuntu\" and\n-        _docker_os_dist_major_version < '14'\n+        _docker_os_dist_major_version | int < 14"}, {"sha": "bd0882e314f12ec0e4b0e68f5ea08c265c76ea42", "filename": "tasks/remove-pre-docker-ce.yml", "previous_filename": null, "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/remove-pre-docker-ce.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/remove-pre-docker-ce.yml", "status": "modified", "patch": "@@ -16,7 +16,7 @@\n   when:\n     - _cmd_docker_version.stdout_lines is defined\n     - _cmd_docker_version.stdout_lines[0] is defined\n-    - _cmd_docker_version.stdout_lines[0] is version('17', '<')\n+    - _cmd_docker_version.stdout_lines[0] | int is version(17, '<')\n \n - name: Check if Docker is running\n   become: true\n@@ -41,5 +41,4 @@\n   register: _pkg_result\n   until: _pkg_result is succeeded\n   when: _remove_old_docker | bool\n-  with_items:\n-    - \"{{ docker_old_packages[_docker_os_dist] }}\"\n+  loop: \"{{ docker_old_packages[_docker_os_dist] }}\""}, {"sha": "b3a445005238a4e20f25aea7358149d25857e068", "filename": "tasks/checks/distribution-checks-RedHat.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-RedHat.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/31db975782345f7d679e1d8ddea1c0769d6f9d36/tasks/checks/distribution-checks-RedHat.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - name: Fail if unsupported RedHat version\n   fail:\n     msg: \"RedHat 7 or later is required!\"\n-  when: _docker_os_dist_major_version < '7'\n+  when: _docker_os_dist_major_version | int < 7\n \n # https://github.com/haxorof/ansible-role-docker-ce/issues/97\n - name: Fail if Docker SDK/Stack/Compose shall be installed using PiP on RedHat"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #74 and #75", "sha": "93b060f3b89ba5b6c3a12f3c5c011d73a67272a0", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/93b060f3b89ba5b6c3a12f3c5c011d73a67272a0", "parents": ["b374f729d28f7b6671ea4e09e6a6b4f45d367e35"], "files": [{"sha": "3623709ec35bd933ff7d391934cb0476d7c82df2", "filename": "tasks/main.yml", "previous_filename": null, "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/93b060f3b89ba5b6c3a12f3c5c011d73a67272a0/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/93b060f3b89ba5b6c3a12f3c5c011d73a67272a0/tasks/main.yml", "status": "modified", "patch": "@@ -17,6 +17,11 @@\n     _docker_os_dist_major_version == \"18\"\n   tags: [\"install\", \"configure\"]\n \n+- name: Reset role variables\n+  set_fact:\n+    docker_systemd_service_config_tweaks: []\n+    docker_service_envs: {}\n+\n # https://wiki.ubuntu.com/SystemdForUpstartUsers\n # Important! systemd is only fully supported in Ubuntu 15.04 and later releases\n - name: Determine usage of systemd\n@@ -69,7 +74,7 @@\n \n - name: Configure non-systemd service\n   include_tasks: configure-non-systemd.yml\n-  when: _docker_systemd_used | bool\n+  when: not _docker_systemd_used | bool\n   tags: [\"configure\"]\n \n - name: Configure Docker"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "haxorof", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "haxorof", "committer_email": "bjorn.oscarsson@gmail.com", "message": "Fixes #3", "sha": "690360fffc5bdb505f7804c158dba0b37a23abb5", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/690360fffc5bdb505f7804c158dba0b37a23abb5", "parents": ["caab5a6cb327a68ef9dffbaca9fb5999e915f99b"], "files": [{"sha": "1ff1427e7fa766fcaf945369eb82b433b6e65ba3", "filename": "tasks/main-Fedora.yml", "previous_filename": null, "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/690360fffc5bdb505f7804c158dba0b37a23abb5/tasks/main-Fedora.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/690360fffc5bdb505f7804c158dba0b37a23abb5/tasks/main-Fedora.yml", "status": "modified", "patch": "@@ -2,12 +2,28 @@\n # tasks file for ansible-role-docker-ce\n \n - name: Add Docker CE repository\n-  shell: dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo\n-  args:\n-    creates: /etc/yum.repos.d/docker-ce.repo\n+  get_url:\n+    url: https://download.docker.com/linux/fedora/docker-ce.repo\n+    dest: /etc/yum.repos.d/docker-ce.repo\n+    mode: 0644\n   become: true\n   register: dnf_repo\n \n+- name: Determine Docker CE Edge repo status\n+  shell: dnf config-manager --dump docker-ce-edge | grep enabled\n+  ignore_errors: yes\n+  changed_when: false\n+  register: cmd_docker_ce_edge_enabled\n+\n+- name: Set current Docker CE Edge repo status fact\n+  set_fact:\n+    fact_docker_ce_edge_enabled: \"{{ cmd_docker_ce_edge_enabled.stdout == 'enabled = True' }}\"\n+\n+- name: Enable/Disable Docker CE Edge Repository\n+  shell: dnf config-manager --set-{{ (docker_enable_ce_edge == true) | ternary('enabled','disabled') }} docker-ce-edge\n+  become: true\n+  when: fact_docker_ce_edge_enabled != docker_enable_ce_edge\n+\n - name: Update dnf cache\n   shell: dnf makecache fast\n   become: true"}, {"sha": "230f132f50d5db53e973b6e6119b61c1d53e6d5b", "filename": "tasks/main-CentOS.yml", "previous_filename": null, "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/690360fffc5bdb505f7804c158dba0b37a23abb5/tasks/main-CentOS.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/690360fffc5bdb505f7804c158dba0b37a23abb5/tasks/main-CentOS.yml", "status": "modified", "patch": "@@ -8,12 +8,28 @@\n   become: true\n \n - name: Add Docker CE repository\n-  shell: yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n-  args:\n-    creates: /etc/yum.repos.d/docker-ce.repo\n+  get_url:\n+    url: https://download.docker.com/linux/centos/docker-ce.repo\n+    dest: /etc/yum.repos.d/docker-ce.repo\n+    mode: 0644\n   become: true\n   register: yum_repo\n \n+- name: Determine Docker CE Edge repo status\n+  shell: yum-config-manager docker-ce-edge | grep enabled\n+  ignore_errors: yes\n+  changed_when: false\n+  register: cmd_docker_ce_edge_enabled\n+\n+- name: Set current Docker CE Edge repo status fact\n+  set_fact:\n+    fact_docker_ce_edge_enabled: \"{{ cmd_docker_ce_edge_enabled.stdout == 'enabled = True' }}\"\n+\n+- name: Enable/Disable Docker CE Edge Repository\n+  shell: yum-config-manager --{{ (docker_enable_ce_edge == true) | ternary('enable','disable') }} docker-ce-edge\n+  become: true\n+  when: fact_docker_ce_edge_enabled != docker_enable_ce_edge\n+\n - name: Update yum cache\n   shell: yum makecache fast\n   become: true"}]}, {"repo": "zzet/ansible-rbenv-role", "author_id": "MDQ6VXNlcjEwMjMyMDMz", "author_name": "MatthiasWinkelmann", "committer_id": "MDQ6VXNlcjUxMDc4OA==", "committer_name": "Andrew Kumanyaev", "committer_email": "me@zzet.org", "message": "fixes permission error when installing rbenv system-wide (#62)\n\n* fixes permission error when installing rbenv system-wide", "sha": "7c574f3b148b4df43177a5c0fc398ce4bea6ae3e", "url": "https://api.github.com/repos/zzet/ansible-rbenv-role/commits/7c574f3b148b4df43177a5c0fc398ce4bea6ae3e", "parents": ["f4c9663fd9cba1b0bd8c3526cbc47c01bac36efd"], "files": [{"sha": "7b33bac707303b6e19f32cdde3bce60c84841f1b", "filename": "tasks/main.yml", "previous_filename": null, "additions": 30, "deletions": 25, "changes": 55, "blob_url": "https://github.com/zzet/ansible-rbenv-role/blob/7c574f3b148b4df43177a5c0fc398ce4bea6ae3e/tasks/main.yml", "raw_url": "https://github.com/zzet/ansible-rbenv-role/raw/7c574f3b148b4df43177a5c0fc398ce4bea6ae3e/tasks/main.yml", "status": "modified", "patch": "@@ -13,28 +13,31 @@\n \n \n - name: checkout rbenv_repo for system\n+  become: yes\n   git: >\n     repo={{ rbenv_repo }}\n     dest={{ rbenv_root }}\n     version={{ rbenv.version }}\n-    accept_hostkey=true\n+    accept_hostkey=yes\n     force=yes\n   when: rbenv.env == \"system\"\n   tags:\n     - rbenv\n \n - name: create plugins directory for system\n+  become: yes\n   file: state=directory path={{ rbenv_root }}/plugins\n   when: rbenv.env == \"system\"\n   tags:\n     - rbenv\n \n - name: install plugins for system\n+  become: yes\n   git: >\n     repo={{ item.repo }}\n     dest={{ rbenv_root }}/plugins/{{ item.name }}\n     version={{ item.version }}\n-    accept_hostkey=true\n+    accept_hostkey=yes\n     force=yes\n   with_items: \"{{ rbenv_plugins }}\"\n   when: rbenv.env == \"system\"\n@@ -46,23 +49,23 @@\n     repo={{ rbenv_repo }}\n     dest={{ rbenv_root }}\n     version={{ rbenv.version }}\n-    accept_hostkey=true\n+    accept_hostkey=yes\n     force=yes\n   with_items: \"{{ rbenv_users }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item }}\"\n   when: rbenv.env != \"system\"\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv\n \n - name: create plugins directory for selected users\n   file: state=directory path={{ rbenv_root }}/plugins\n   with_items: \"{{ rbenv_users }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item }}\"\n   when: rbenv.env != \"system\"\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv\n \n@@ -71,21 +74,21 @@\n     repo={{ item[1].repo }}\n     dest={{ rbenv_root }}/plugins/{{ item[1].name }}\n     version={{ item[1].version }}\n-    accept_hostkey=true\n+    accept_hostkey=yes\n     force=yes\n   with_nested:\n     - \"{{ rbenv_users }}\"\n     - \"{{ rbenv_plugins }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item[0] }}\"\n   when: rbenv.env != \"system\"\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv\n \n - name: add rbenv initialization to profile system-wide\n   template: src=rbenv.sh.j2 dest=/etc/profile.d/rbenv.sh owner=root group=root mode=0755\n-  become: true\n+  become: yes\n   when:\n     - ansible_os_family != 'OpenBSD'\n   tags:\n@@ -94,44 +97,44 @@\n - name: set default-gems for select users\n   copy: src=default-gems dest={{ rbenv_root }}/default-gems\n   with_items: \"{{ rbenv_users }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item }}\"\n   when:\n     - not \"system\" == \"{{ rbenv.env }}\"\n     - default_gems_file is not defined\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv\n \n - name: set custom default-gems for select users\n   copy: src={{ default_gems_file }} dest={{ rbenv_root }}/default-gems\n   with_items: \"{{ rbenv_users }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item }}\"\n   when:\n     - not \"system\" == \"{{ rbenv.env }}\"\n     - default_gems_file is defined\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv\n \n - name: set gemrc for select users\n   copy: src=gemrc dest=~/.gemrc\n   with_items: \"{{ rbenv_users }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item }}\"\n   when: rbenv.env != \"system\"\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv\n \n - name: set vars for select users\n   copy: src=vars dest={{ rbenv_root }}/vars\n   with_items: \"{{ rbenv_users }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item }}\"\n   when: rbenv.env != \"system\"\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv\n \n@@ -147,6 +150,7 @@\n \n - name: install ruby {{ rbenv.ruby_version }} for system\n   shell: bash -lc \"rbenv install {{ rbenv.ruby_version }}\"\n+  become: yes\n   when:\n     - rbenv.env == \"system\"\n     - ruby_installed.rc != 0\n@@ -164,6 +168,7 @@\n     - rbenv\n \n - name: set ruby {{ rbenv.ruby_version }} for system\n+  become: yes\n   shell: bash -lc \"rbenv global {{ rbenv.ruby_version }} && rbenv rehash\"\n   when:\n     - rbenv.env == \"system\"\n@@ -173,7 +178,7 @@\n \n - name: check ruby {{ rbenv.ruby_version }} installed for select users\n   shell: $SHELL -lc \"rbenv versions | grep {{ rbenv.ruby_version }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item }}\"\n   with_items: \"{{ rbenv_users }}\"\n   when: rbenv.env != \"system\"\n@@ -186,21 +191,21 @@\n \n - name: install ruby {{ rbenv.ruby_version }} for select users\n   shell: $SHELL -lc \"rbenv install {{ rbenv.ruby_version }}\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item[1] }}\"\n   with_together:\n     - \"{{ ruby_installed.results }}\"\n     - \"{{ rbenv_users }}\"\n   when:\n     - rbenv.env != \"system\"\n     - item[0].rc != 0\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv\n \n - name: check if user ruby version is {{ rbenv.ruby_version }}\n   shell: $SHELL -lc \"rbenv version | cut -d ' ' -f 1 | grep -Fx '{{ rbenv.ruby_version }}'\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item }}\"\n   with_items: \"{{ rbenv_users }}\"\n   when: rbenv.env != \"system\"\n@@ -213,14 +218,14 @@\n \n - name: set ruby {{ rbenv.ruby_version }} for select users\n   shell: $SHELL -lc \"rbenv global {{ rbenv.ruby_version }} && rbenv rehash\"\n-  become: true\n+  become: yes\n   become_user: \"{{ item[1] }}\"\n   with_together:\n     - \"{{ ruby_selected.results }}\"\n     - \"{{ rbenv_users }}\"\n   when:\n     - rbenv.env != \"system\"\n     - item[0].rc != 0\n-  ignore_errors: true\n+  ignore_errors: yes\n   tags:\n     - rbenv"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjEzMzUxMzc=", "author_name": "Justin Holmes", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "fix quotes (#344)", "sha": "f6e9b1c9c0cefd8bd1539b6dfd64d3973a7fcb75", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/f6e9b1c9c0cefd8bd1539b6dfd64d3973a7fcb75", "parents": ["ab65d9b96ab859feb0df03da9a468c54b4aa43d5"], "files": [{"sha": "41fc61a9e0d1f75350a2039807d3a88d56700a38", "filename": "roles/config-nexus/tasks/wait-for-nexus.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/f6e9b1c9c0cefd8bd1539b6dfd64d3973a7fcb75/roles/config-nexus/tasks/wait-for-nexus.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/f6e9b1c9c0cefd8bd1539b6dfd64d3973a7fcb75/roles/config-nexus/tasks/wait-for-nexus.yml", "status": "modified", "patch": "@@ -8,7 +8,7 @@\n     user: \"{{ nexus_user }}\"\n     password: \"{{ nexus_password }}\"\n     force_basic_auth: yes\n-    validate_certs: {{ nexus_validate_certs }}\n+    validate_certs: \"{{ nexus_validate_certs }}\"\n   register: nexus_server_check_result\n   until: nexus_server_check_result is success\n   retries: '{{ nexus_server_poll_retries }}'"}, {"sha": "4e165e89cc4dc78395505c5e5922ef995222aced", "filename": "roles/config-nexus/tasks/configure-repos.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/f6e9b1c9c0cefd8bd1539b6dfd64d3973a7fcb75/roles/config-nexus/tasks/configure-repos.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/f6e9b1c9c0cefd8bd1539b6dfd64d3973a7fcb75/roles/config-nexus/tasks/configure-repos.yml", "status": "modified", "patch": "@@ -8,7 +8,7 @@\n     password: \"{{ nexus_password }}\"\n     force_basic_auth: yes\n     status_code: 200,404\n-    validate_certs: {{ nexus_validate_certs }}\n+    validate_certs: \"{{ nexus_validate_certs }}\"\n   register: get_script_result\n \n - name: \"Delete Script if it Exists: {{ item.script_name }}\"\n@@ -19,7 +19,7 @@\n     password: \"{{ nexus_password }}\"\n     force_basic_auth: yes\n     status_code: 204\n-    validate_certs: {{ nexus_validate_certs }}\n+    validate_certs: \"{{ nexus_validate_certs }}\"\n   when: get_script_result.status == 200\n \n - name: \"Create New Script: {{ item.script_name }}\"\n@@ -31,7 +31,7 @@\n     body_format: json\n     body: \"{{ lookup('file', item.script_file )}}\"\n     force_basic_auth: yes\n-    validate_certs: {{ nexus_validate_certs }}\n+    validate_certs: \"{{ nexus_validate_certs }}\"\n     status_code: 204\n \n - name: \"Execute New Script: {{ item.script_name }}\"\n@@ -43,6 +43,6 @@\n     headers:\n       Content-Type: \"text/plain\"\n     force_basic_auth: yes\n-    validate_certs: {{ nexus_validate_certs }}\n+    validate_certs: \"{{ nexus_validate_certs }}\"\n     status_code: 200\n "}]}, {"repo": "lean-delivery/ansible-role-java", "author_id": "MDQ6VXNlcjQwMzAwNjQy", "author_name": "Timur Gadiev", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix default fallback (#88)\n\n* Test java ver\r\n\r\n* Add ga release detection\r\n\r\n* Add amazon linux tests\r\n\r\n* Fix verify\r\n\r\n* Add Windows openjdk fallback\r\n\r\n* Fix java_download_path\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>", "sha": "892b2386950bf02321ff63298bd7f2c6864faab3", "url": "https://api.github.com/repos/lean-delivery/ansible-role-java/commits/892b2386950bf02321ff63298bd7f2c6864faab3", "parents": ["5906ccb7ae3a7d39924368356deb5d17f45184fc"], "files": [{"sha": "3208285bbef12ebf0a66d4cd669a882d35ac5fda", "filename": "tasks/Linux/fetch/sapjvm-fallback.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/sapjvm-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/sapjvm-fallback.yml", "status": "modified", "patch": "@@ -17,7 +17,7 @@\n - name: 'Download artifact from {{ release_url[0] }}'\n   get_url:\n     url: '{{ sapjvm_root_page }}/{{ release_url[0] }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n     headers:\n       Cookie: eula_3_1_agreed=tools.hana.ondemand.com/developer-license-3_1.txt\n   register: file_downloaded"}, {"sha": "f421a24af4ec2621d2856842ec477aab5fe5453f", "filename": "tasks/Linux/fetch/openjdk-fallback.yml", "previous_filename": null, "additions": 22, "deletions": 4, "changes": 26, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/openjdk-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/openjdk-fallback.yml", "status": "modified", "patch": "@@ -1,16 +1,34 @@\n ---\n - name: 'Fetch root page {{ openjdk_root_page }}'\n   uri:\n-    url: '{{ openjdk_root_page }}/{{ java_major_version }}/'\n+    url: '{{ openjdk_root_page }}'\n     return_content: true\n   register: root_page\n \n+- name: Find GA release version\n+  set_fact:\n+    java_major_version: >-\n+      {{ root_page['content']\n+        | regex_findall('Ready for use:.*>JDK ([\\d]+)<')\n+        | first\n+      }}\n+\n+- name: Out java_major_version\n+  debug:\n+    var: java_major_version\n+\n+- name: Fetch GA release page\n+  uri:\n+    url: '{{ openjdk_root_page }}/{{ java_major_version }}/'\n+    return_content: true\n+  register: ga_release_page\n+\n - name: Find release url\n   set_fact:\n     release_url: >-\n-      {{ root_page['content']\n+      {{ ga_release_page['content']\n         | regex_findall('(https://download[\\.\\w]+/java/GA/jdk'\n-          + java_major_version|string + '[.\\d]+/[\\d\\w]+/'\n+          + java_major_version|string + '[.\\d]*/[\\d\\w]+/'\n           + '[.\\d]+/GPL/openjdk-'\n           + java_major_version|string + '[\\d._]+linux-x64_bin[\\w\\d.]+)')\n       }}\n@@ -29,7 +47,7 @@\n - name: 'Download artifact from {{ release_url[0] }}'\n   get_url:\n     url: '{{ release_url[0] }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n     checksum: 'sha256:{{ artifact_checksum.content }}'\n   register: file_downloaded\n   retries: 20"}, {"sha": "8c28c7ebbe725c2ccf726a39d2e9263fd58b2106", "filename": "tasks/Win32NT/fetch/local.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/local.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/local.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - name: Copy artifact to destination\n   win_copy:\n     src: '{{ transport_local }}'\n-    dest: '{{ download_path }}\\'\n+    dest: '{{ java_download_path }}\\'\n   register: file_downloaded\n   retries: 5\n   delay: 2"}, {"sha": "634f286caee070770883b5eaacad23033fa685a2", "filename": "tasks/Win32NT/system.yml", "previous_filename": null, "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/system.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/system.yml", "status": "modified", "patch": "@@ -16,6 +16,12 @@\n     use_regex: true\n   register: java_dir\n \n+- name: Find java_folders\n+  win_find:\n+    paths: '{{ java_path }}'\n+    recurse: true\n+  register: java_dirs\n+\n - name: Set actual java directory\n   set_fact:\n     java_act_path: \"{{ java_dir.files | map(attribute='path') | list | last }}\""}, {"sha": "f49335b92676307b2917ed8ba5fc14918e277121", "filename": "tasks/Win32NT/fetch/security-fetch/security-winfetch-oracle-fallback.yml", "previous_filename": null, "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/security-fetch/security-winfetch-oracle-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/security-fetch/security-winfetch-oracle-fallback.yml", "status": "modified", "patch": "@@ -3,9 +3,8 @@\n   win_get_url:\n     url: '{{ fallback_oracle_security_policy_artifacts[java_major_version|int] }}'\n     dest: >-\n-      {{ download_path }}\\{{ (fallback_oracle_security_policy_artifacts[java_major_version|int]\n+      {{ java_download_path }}\\{{ (fallback_oracle_security_policy_artifacts[java_major_version|int]\n         | urlsplit('path')).split('/')[-1] }}\n-    mode: 0755\n     headers:\n       Cookie: 'oraclelicense=accept-securebackup-cookie'\n     force: false"}, {"sha": "a91d851372ffca8a92ee7f12834e511a14049025", "filename": "tasks/Win32NT/fetch/security-fetch/security-winfetch-web.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/security-fetch/security-winfetch-web.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/security-fetch/security-winfetch-web.yml", "status": "modified", "patch": "@@ -3,7 +3,7 @@\n   win_get_url:\n     url: '{{ java_unlimited_policy_url }}'\n     dest: >-\n-      {{ download_path }}\\{{ (java_unlimited_policy_url\n+      {{ java_download_path }}\\{{ (java_unlimited_policy_url\n         | urlsplit('path')).split('/')[-1] }}\n     force: false\n   register: policy_file_downloaded"}, {"sha": "58954bf08c9ca695f62ac6eb3972a8aa94bb4760", "filename": "tasks/Linux/fetch/adoptopenjdk-fallback.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/adoptopenjdk-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/adoptopenjdk-fallback.yml", "status": "modified", "patch": "@@ -40,7 +40,7 @@\n - name: 'Download artifact from {{ release_url[0] }}'\n   get_url:\n     url: '{{ release_url[0] }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n     checksum: 'sha256:{{ artifact_checksum }}'\n   register: file_downloaded\n   retries: 20"}, {"sha": "d336e253039efc864e0ce9f5132acefe4c46ace1", "filename": "tasks/Win32NT/fetch/security-fetch/security-winfetch-local.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/security-fetch/security-winfetch-local.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/security-fetch/security-winfetch-local.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - name: Copy security policy artifact to destination\n   win_copy:\n     src: '{{ java_unlimited_policy_transport_local }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n   register: policy_file_downloaded\n   retries: 5\n   delay: 2"}, {"sha": "ab7bc4fdf7c71966ae738bf6c05ec00e519ee23e", "filename": "tasks/Win32NT/fetch/zulu-fallback.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/zulu-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/zulu-fallback.yml", "status": "modified", "patch": "@@ -28,7 +28,7 @@\n \n   - name: 'Get {{ checksum_alg }} checksum of file'\n     win_stat:\n-      path: '{{ download_path }}\\{{ artifact_basename }}'\n+      path: '{{ java_download_path }}\\{{ artifact_basename }}'\n       get_checksum: true\n       checksum_algorithm: '{{ checksum_alg }}'\n     register: artifact"}, {"sha": "30bf01be9656d2b8028e33b5c3dab3591489041f", "filename": "tasks/Linux/fetch/s3.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/s3.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/s3.yml", "status": "modified", "patch": "@@ -3,7 +3,7 @@\n   aws_s3:\n     bucket: '{{ transport_s3_bucket }}'\n     object: '{{ transport_s3_path }}'\n-    dest: '{{ download_path }}/{{ transport_s3_path | basename }}'\n+    dest: '{{ java_download_path }}/{{ transport_s3_path | basename }}'\n     aws_access_key: '{{ transport_s3_aws_access_key }}'\n     aws_secret_key: '{{ transport_s3_aws_secret_key }}'\n     mode: get\n@@ -15,4 +15,4 @@\n - name: Set downloaded artifact vars\n   set_fact:\n     file_downloaded:\n-      dest: '{{ download_path }}/{{ transport_s3_path | basename }}'\n+      dest: '{{ java_download_path }}/{{ transport_s3_path | basename }}'"}, {"sha": "b077be8b6e619accc50a7d4c69236f9c97e98e0e", "filename": "tasks/Linux/fetch/zulu-fallback.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/zulu-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/zulu-fallback.yml", "status": "modified", "patch": "@@ -24,7 +24,7 @@\n   - name: 'Download artifact from {{ release_url[0] }}'\n     get_url:\n       url: '{{ release_url[0] }}'\n-      dest: '{{ download_path }}'\n+      dest: '{{ java_download_path }}'\n       checksum: 'md5:{{ checksum[0] }}'\n     register: file_downloaded\n     retries: 20"}, {"sha": "0c411a69d34de1e274b279b9c47dfc9041916a61", "filename": "tasks/Win32NT/install/sapjvm_tarball.yml", "previous_filename": null, "additions": 37, "deletions": 23, "changes": 60, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/install/sapjvm_tarball.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/install/sapjvm_tarball.yml", "status": "modified", "patch": "@@ -6,31 +6,45 @@\n \n - name: Install java from tarball\n   block:\n-  - name: Mkdir for java installation\n-    win_file:\n-      path: '{{ java_path }}\\{{ java_folder }}'\n-      state: directory\n+    - name: Mkdir for java installation\n+      win_file:\n+        path: '{{ java_path }}\\{{ java_folder }}'\n+        state: directory\n \n-  - name: Create temporary directory\n-    win_tempfile:\n-      state: directory\n-    register: temp_dir_path\n+    - name: Create temporary directory\n+      win_tempfile:\n+        state: directory\n+      register: temp_dir_path\n \n-  - name: Unarchive to temporary directory\n-    win_unzip:\n-      src: '{{ java_artifact }}'\n-      dest: '{{ temp_dir_path }}'\n+    - name: Unarchive to temporary directory\n+      win_unzip:\n+        src: '{{ java_artifact }}'\n+        dest: '{{ temp_dir_path }}'\n \n-  - name: Find java_folder in temp\n-    win_find:\n-      paths: '{{ temp_dir_path }}'\n-      recurse: false\n-      file_type: directory\n-    register: java_temp_folder\n+    - name: Find java_folder in temp\n+      win_find:\n+        paths: '{{ temp_dir_path }}'\n+        recurse: false\n+        file_type: directory\n+      register: java_temp_folder\n \n-  - name: Copy from temporary directory\n-    win_copy:\n-      src: '{{ java_temp_folder.files | map(attribute=\"path\") | list | last }}\\'\n-      dest: '{{ java_path }}\\{{ java_folder }}'\n-      remote_src: true\n+    - name: Copy from temporary directory\n+      win_copy:\n+        src: '{{ java_temp_folder.files | map(attribute=\"path\") | list | last }}\\'\n+        dest: '{{ java_path }}\\{{ java_folder }}'\n+        remote_src: true\n+\n+    - name: Check choco\n+      win_chocolatey:\n+        name: chocolatey\n+        state: present\n+\n+    # https://help.sap.com/viewer/65de2977205c403bbc107264b8eccf4b/Cloud/en-US/76137f42711e1014839a8273b0e91070.html\n+    - name: 'Install vcredist package prior to using SAP JVM'\n+      win_chocolatey:\n+        name: vcredist2013\n+      register: choco_install\n+      retries: 15\n+      delay: 5\n+      until: choco_install is succeeded\n   when: not java_folder_bin.stat.exists"}, {"sha": "962b887b19d9682a42e535dff9a1943be1a8d8e5", "filename": "tasks/Linux/fetch/local.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/local.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/local.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - name: Copy artifact to destination\n   copy:\n     src: '{{ transport_local }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n   register: file_downloaded\n   retries: 5\n   delay: 2"}, {"sha": "4b80962e325aaecc2da6b438474426b9541e7df5", "filename": "tasks/Linux/fetch/security-fetch/security-fetch-oracle-fallback.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/security-fetch/security-fetch-oracle-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/security-fetch/security-fetch-oracle-fallback.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - name: Download security policy artifact from Oracle OTN\n   get_url:\n     url: '{{ fallback_oracle_security_policy_artifacts[java_major_version|int] }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n     mode: 0755\n     headers:\n       Cookie: >-"}, {"sha": "8b2f6721b3113b665688926630d91da3d0f20e8e", "filename": "tasks/Win32NT/fetch/fetch_checksum.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/fetch_checksum.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/fetch_checksum.yml", "status": "modified", "patch": "@@ -2,12 +2,12 @@\n - name: 'Download artifact from {{ artifact_url }}'\n   win_get_url:\n     url: '{{ artifact_url }}'\n-    dest: '{{ download_path }}\\{{ artifact_basename }}'\n+    dest: '{{ java_download_path }}\\{{ artifact_basename }}'\n     force: true\n \n - name: 'Get {{ checksum_alg }} checksum of file'\n   win_stat:\n-    path: '{{ download_path }}\\{{ artifact_basename }}'\n+    path: '{{ java_download_path }}\\{{ artifact_basename }}'\n     get_checksum: true\n     checksum_algorithm: '{{ checksum_alg }}'\n   register: artifact"}, {"sha": "47b4585cfee8d9a2ca3bd06f9cc5ed22a3878a17", "filename": "tasks/Win32NT/fetch/adoptopenjdk-fallback.yml", "previous_filename": null, "additions": 22, "deletions": 30, "changes": 52, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/adoptopenjdk-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/adoptopenjdk-fallback.yml", "status": "modified", "patch": "@@ -1,5 +1,5 @@\n ---\n-- name: 'Fetch download page'\n+- name: Fetch download page\n   win_uri:\n     url: \"{{ adoptopenjdk_api_page }}\\\n       info/releases/\\\n@@ -12,14 +12,14 @@\n     follow_redirects: all\n   register: download_page\n \n-- name: 'Find release url'\n+- name: Find release url\n   set_fact:\n     release_url: >-\n       {{ download_page['content'] |\n       regex_findall('(https://github.com/AdoptOpenJDK/.*\\.zip[.sha256.txt]*)')\n       }}\n \n-- name: 'Exit if AdobtOpenJDK version is not found'\n+- name: Exit if AdobtOpenJDK version is not found\n   fail:\n     msg: 'AdoptOpenJDK version {{ java_major_version }} not found'\n   when: release_url[0] is not defined\n@@ -32,33 +32,25 @@\n \n - name: 'Get artifact checksum from file {{ release_url[1] }}'\n   set_fact:\n-    artifact_checksum: >-\n-      {{ artifact_checksum_file['content'] |\n-      regex_search('([^\\s]+)')\n-      }}\n-\n-- name: 'Set artifact basename'\n-  set_fact:\n-    artifact_url: '{{ release_url[0] }}'\n-    artifact_basename: \"{{ (release_url[0] | urlsplit('path')).split('/')[-1] }}\"\n-\n-- name: 'Get {{ checksum_alg }} checksum of file'\n-  win_stat:\n-    path: '{{ download_path }}\\{{ artifact_basename }}'\n-    get_checksum: true\n-    checksum_algorithm: '{{ checksum_alg }}'\n-  register: artifact\n-\n-- name: 'Download with checksum validation'\n-  include_tasks: fetch_checksum.yml\n-  when: |\n-    not artifact.stat.exists | bool\n-    or artifact.stat.checksum != artifact_checksum\n+    artifact_checksum:\n+      content: >-\n+        {{ artifact_checksum_file['content'] |\n+          regex_search('([^\\s]+)')\n+        }}\n+\n+- name: 'Download artifact from {{ release_url[0] }}'\n+  win_get_url:\n+    url: '{{ release_url[0] }}'\n+    dest: '{{ java_download_path }}'\n+    force: true\n+    checksum: '{{ artifact_checksum.content }}'\n+    checksum_algorithm: sha256\n+  register: file_downloaded\n   retries: 20\n   delay: 5\n-  until: artifact.stat.checksum == artifact_checksum\n+  until: file_downloaded is succeeded\n+  when: ansible_version.full is version('2.8.0', '>=')\n \n-- name: 'Set downloaded artifact vars'\n-  set_fact:\n-    file_downloaded:\n-      dest: '{{ artifact.stat.path }}'\n+- name: Old fetch (Ansible < 2.8)\n+  include_tasks: fetch_fallback_old.yml\n+  when: ansible_version.full is version('2.8.0', '<')"}, {"sha": "1c899585b0a887d149a183218fb2befdb99845f1", "filename": "tasks/Linux/system.yml", "previous_filename": null, "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/system.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/system.yml", "status": "modified", "patch": "@@ -3,7 +3,7 @@\n   block:\n     - name: Install requirements\n       package:\n-        name: '{{ requirements }}'\n+        name: '{{ java_package_requirements }}'\n         state: present\n       register: installed_packages\n       until: installed_packages is succeeded\n@@ -17,7 +17,6 @@\n         - 'install/{{ ansible_os_family }}.yml'\n       loop_control:\n         loop_var: install_task\n-      ignore_errors: true\n \n     - name: Find java_folder\n       find:"}, {"sha": "45b3998a181551dd87ca694f58812b0aca998d28", "filename": "tasks/Linux/fetch/security-fetch/security-fetch-web.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/security-fetch/security-fetch-web.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/security-fetch/security-fetch-web.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - name: Download security policy artifact from web\n   get_url:\n     url: '{{ java_unlimited_policy_url }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n   register: policy_file_downloaded\n   retries: 3\n   delay: 2"}, {"sha": "ee4d6746b44114fc557a675a2eeb7182f1d8a34b", "filename": "meta/main.yml", "previous_filename": null, "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/meta/main.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/meta/main.yml", "status": "modified", "patch": "@@ -20,6 +20,10 @@ galaxy_info:\n       versions:\n         - \"6\"\n         - \"7\"\n+    - name: \"Amazon\"\n+      versions:\n+        - \"2017.12\"\n+        - \"Candidate\"\n     - name: \"Windows\"\n       versions:\n         - \"all\""}, {"sha": "5f9ffe66e17c9791f02825e4be8c5dec92990e55", "filename": "tasks/Win32NT/fetch/sapjvm-fallback.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/sapjvm-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/sapjvm-fallback.yml", "status": "modified", "patch": "@@ -14,12 +14,12 @@\n           + '[\\d.]+-windows-x64.zip)')\n       }}\n \n-- name: 'Download artifact '\n+- name: Download sapjvm artifact\n   win_get_url:\n     url: '{{ sapjvm_root_page }}/{{ release_url[0] }}'\n     headers:\n       Cookie: eula_3_1_agreed=tools.hana.ondemand.com/developer-license-3_1.txt\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n     force: false\n   register: file_downloaded\n   retries: 20"}, {"sha": "9a3f717c8fae226b9a9e8adf524b721e5c7622fe", "filename": "tasks/Linux/fetch/security-fetch/security-fetch-local.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/security-fetch/security-fetch-local.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/security-fetch/security-fetch-local.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - name: Copy security policy artifact to destination\n   copy:\n     src: '{{ java_unlimited_policy_transport_local }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n   register: policy_file_downloaded\n   retries: 5\n   delay: 2"}, {"sha": "aeb19aff80ab35b2f96c988c40576875d3981797", "filename": "tasks/Linux/fetch/security-fetch/security-fetch-s3.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/security-fetch/security-fetch-s3.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/security-fetch/security-fetch-s3.yml", "status": "modified", "patch": "@@ -3,7 +3,7 @@\n   aws_s3:\n     bucket: '{{ java_unlimited_policy_transport_s3_bucket }}'\n     object: '{{ java_unlimited_policy_transport_s3_path }}'\n-    dest: \"{{ download_path }}/\\\n+    dest: \"{{ java_download_path }}/\\\n       {{ java_unlimited_policy_transport_s3_path|basename }}\"\n     aws_access_key: '{{ transport_s3_aws_access_key }}'\n     aws_secret_key: '{{ transport_s3_aws_secret_key }}'\n@@ -15,5 +15,5 @@\n - name: Downloaded security policy artifact\n   set_fact:\n     security_policy_java_artifact: >\n-      {{ download_path }}/{{ java_unlimited_policy_transport_s3_path\n+      {{ java_download_path }}/{{ java_unlimited_policy_transport_s3_path\n                              | basename }}"}, {"sha": "388e8270b3eb0ae20924b478d6a59f8c54b92b0f", "filename": "tasks/Win32NT/fetch/web.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/web.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/web.yml", "status": "modified", "patch": "@@ -3,7 +3,7 @@\n   win_get_url:\n     url: '{{ transport_web }}'\n     dest: >-\n-      {{ download_path }}\\{{ (transport_web | urlsplit('path')).split('/')[-1] }}\n+      {{ java_download_path }}\\{{ (transport_web | urlsplit('path')).split('/')[-1] }}\n     force: false\n   register: file_downloaded\n   retries: 5"}, {"sha": "2bb988448bf49568509575b2985ac70e42b3b8dc", "filename": "tasks/Win32NT/fetch/openjdk-fallback.yml", "previous_filename": null, "additions": 38, "deletions": 29, "changes": 67, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/openjdk-fallback.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Win32NT/fetch/openjdk-fallback.yml", "status": "modified", "patch": "@@ -1,18 +1,36 @@\n ---\n-- name: 'Fetch root page {{ java_root_page }}'\n+- name: 'Fetch root page {{ openjdk_root_page }}'\n+  win_uri:\n+    url: '{{ openjdk_root_page }}'\n+    return_content: true\n+  register: root_page\n+\n+- name: Find GA release version\n+  set_fact:\n+    java_major_version: >-\n+      {{ root_page['content']\n+        | regex_findall('Ready for use:.*>JDK ([\\d]+)<')\n+        | first\n+      }}\n+\n+- name: Out java_major_version\n+  debug:\n+    var: java_major_version\n+\n+- name: Fetch GA release page\n   win_uri:\n     url: '{{ openjdk_root_page }}/{{ java_major_version }}/'\n     return_content: true\n     follow_redirects: all\n-  register: root_page\n+  register: ga_release_page\n \n - name: Find release url\n   set_fact:\n     release_url: >-\n-      {{ root_page['content'] |\n+      {{ ga_release_page['content'] |\n       regex_findall('(https://download[\\.\\w]+/java/GA/jdk' +\n       java_major_version|string +\n-      '[.\\d]+/[\\d\\w]+/' +\n+      '[.\\d]*/[\\d\\w]+/' +\n       '[.\\d]+/GPL/openjdk-' +\n       java_major_version|string +\n       '[\\d._]+windows-x64_bin[\\w\\d.]+)')\n@@ -29,28 +47,19 @@\n     return_content: true\n   register: artifact_checksum\n \n-- name: Set artifact basename\n-  set_fact:\n-    artifact_url: '{{ release_url[0] }}'\n-    artifact_basename: \"{{ (release_url[0] | urlsplit('path')).split('/')[-1] }}\"\n-\n-- name: 'Get {{ checksum_alg }} checksum of file'\n-  win_stat:\n-    path: '{{ download_path }}\\{{ artifact_basename }}'\n-    get_checksum: true\n-    checksum_algorithm: '{{ checksum_alg }}'\n-  register: artifact\n-\n-- name: Download with checksum validation\n-  include_tasks: fetch_checksum.yml\n-  when: |\n-    not artifact.stat.exists\n-    or artifact.stat.checksum != artifact_checksum.content\n-  retries: 15\n-  delay: 2\n-  until: artifact.stat.checksum == artifact_checksum.content\n-\n-- name: Set downloaded artifact vars\n-  set_fact:\n-    file_downloaded:\n-      dest: '{{ artifact.stat.path }}'\n+- name: 'Download artifact from {{ release_url[0] }}'\n+  win_get_url:\n+    url: '{{ release_url[0] }}'\n+    dest: '{{ java_download_path }}'\n+    force: true\n+    checksum: '{{ artifact_checksum.content }}'\n+    checksum_algorithm: sha256\n+  register: file_downloaded\n+  retries: 20\n+  delay: 5\n+  until: file_downloaded is succeeded\n+  when: ansible_version.full is version('2.8.0', '>=')\n+\n+- name: Old fetch (Ansible < 2.8)\n+  include_tasks: fetch_fallback_old.yml\n+  when: ansible_version.full is version('2.8.0', '<')"}, {"sha": "a7425708f691a73345558f219456c9e98fa8963e", "filename": "tasks/Linux/fetch/web.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/web.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/892b2386950bf02321ff63298bd7f2c6864faab3/tasks/Linux/fetch/web.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - name: Download artifact from web\n   get_url:\n     url: '{{ transport_web }}'\n-    dest: '{{ download_path }}'\n+    dest: '{{ java_download_path }}'\n   register: file_downloaded\n   retries: 5\n   delay: 2"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": null, "author_name": "Rasmus Werling", "committer_id": null, "committer_name": "Rasmus Werling", "committer_email": "rasmus.werling@druid.fi", "message": "Fixes #53: systemd service usage failing with Ansible 2.2 and Solr < 5.", "sha": "a77a8900bb9032eb97498fbb9149d4504e73b0b5", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/a77a8900bb9032eb97498fbb9149d4504e73b0b5", "parents": ["8697b27085612cde54f2a9486f00e3d1b996a8f4"], "files": [{"sha": "27e9b447a06b40cd8027a0d8d8773ecb49d962f2", "filename": "tasks/install-pre5.yml", "previous_filename": null, "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/a77a8900bb9032eb97498fbb9149d4504e73b0b5/tasks/install-pre5.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/a77a8900bb9032eb97498fbb9149d4504e73b0b5/tasks/install-pre5.yml", "status": "modified", "patch": "@@ -68,3 +68,16 @@\n - name: Ensure daemon is installed (Debian).\n   apt: name=daemon state=installed\n   when: ansible_os_family == \"Debian\"\n+\n+- name: Copy solr systemd unit file into place (for systemd systems).\n+  template:\n+    src: solr.unit.j2\n+    dest: /etc/systemd/system/solr.service\n+    owner: root\n+    group: root\n+    mode: 0755\n+  when: >\n+    (ansible_distribution == 'Ubuntu' and ansible_distribution_version == '16.04') or\n+    (ansible_distribution == 'Debian' and ansible_distribution_version|int >= 8) or\n+    (ansible_distribution == 'CentOS' and ansible_distribution_version|int >= 7) or\n+    (ansible_distribution == 'Fedora')"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fixes #122 - Add SMTP role\n\nThis uses ssmtp as a simple mail delivery tool for forwarding mail to an\nexternal SMTP server.", "sha": "5dce6aa8001fa8b4b4606179dd71561667942ac1", "url": "https://api.github.com/repos/roots/trellis/commits/5dce6aa8001fa8b4b4606179dd71561667942ac1", "parents": ["9072529b36b6a08f277f3e1bcb687cf41b511174"], "files": [{"sha": "1e1ce23a2640216955260ff422d1c1352d0631b8", "filename": "roles/php/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/roots/trellis/blob/5dce6aa8001fa8b4b4606179dd71561667942ac1/roles/php/defaults/main.yml", "raw_url": "https://github.com/roots/trellis/raw/5dce6aa8001fa8b4b4606179dd71561667942ac1/roles/php/defaults/main.yml", "status": "modified", "patch": "@@ -11,6 +11,7 @@ php_max_input_time: 300\n php_post_max_size: 25M\n php_upload_max_filesize: 25M\n php_max_input_vars: 1000\n+php_sendmail_path: /usr/sbin/ssmtp -t\n \n php_opcache_enable: 1\n php_opcache_memory_consumption: 128"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjczMzg1MTM=", "author_name": "Phil Nelson", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix conditional for dynamic HostKeyAlgorithms msg (#822)\n\nWhen the set_fact task runs, it has status 'ok', not 'changed'.\r\nThus to check whether the ansible_ssh_extra_args var was dynamically set,\r\nthe condition must check whether or not the set_fact task skipped.", "sha": "4da9d734a760d3e6264ea0b4034ecc42e11bd5b3", "url": "https://api.github.com/repos/roots/trellis/commits/4da9d734a760d3e6264ea0b4034ecc42e11bd5b3", "parents": ["c1371e3bc231141e5703a4334f2048ef70486a95"], "files": [{"sha": "c7f6df9cc122abd44d767c4926316d8b8db77bc5", "filename": "roles/connection/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/4da9d734a760d3e6264ea0b4034ecc42e11bd5b3/roles/connection/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/4da9d734a760d3e6264ea0b4034ecc42e11bd5b3/roles/connection/tasks/main.yml", "status": "modified", "patch": "@@ -59,7 +59,7 @@\n     debug:\n       msg: |\n         Note: Ansible will attempt connections as user = {{ ansible_user }}\n-        {% if preferred_host_key_algorithms | changed %}\n+        {% if not preferred_host_key_algorithms | skipped %}\n \n         Note: The host `{{ ansible_host }}` was not detected in known_hosts\n         so Trellis prompted the host to offer a key type that will work with"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #563 - Improve remote databases\n\nPreviously you had to manually toggle the remote database option via\n`mysql_remote_database` (which also didn't fully work).\n\nNow Trellis automatically detects if the sites are using a remote\n`db_host` or not (aka not `localhost`) and handles things accordingly.\n\nThis also installs the mysql-client now regardless.", "sha": "255c461f1d5d2c1378ce1a71fd0feadae3f49cb6", "url": "https://api.github.com/repos/roots/trellis/commits/255c461f1d5d2c1378ce1a71fd0feadae3f49cb6", "parents": ["ed6c63587adb3ffbdd60f64644470d9f7d81d13d"], "files": [{"sha": "32b3d530d433c3cde2d993f8b4afb3a548d1f059", "filename": "roles/mariadb/defaults/main.yml", "previous_filename": null, "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/roots/trellis/blob/255c461f1d5d2c1378ce1a71fd0feadae3f49cb6/roles/mariadb/defaults/main.yml", "raw_url": "https://github.com/roots/trellis/raw/255c461f1d5d2c1378ce1a71fd0feadae3f49cb6/roles/mariadb/defaults/main.yml", "status": "modified", "patch": "@@ -1,4 +1,8 @@\n-keyserver_fingerprint: \"0xcbcb082a1bb943db\"\n-mirror: nyc2.mirrors.digitalocean.com\n-version: \"10.0\"\n-binary_logging_disabled: true\n+mariadb_binary_logging_disabled: true\n+mariadb_keyserver_fingerprint: \"0xcbcb082a1bb943db\"\n+mariadb_mirror: nyc2.mirrors.digitalocean.com\n+mariadb_version: \"10.0\"\n+mariadb_dist: trusty\n+mysql_root_user: root\n+\n+sites_using_remote_db: \"[{% for name, site in wordpress_sites.iteritems() if site.env is defined and site.env.db_host | default('localhost') != 'localhost' %}'{{ name }}',{% endfor %}]\""}, {"sha": "63db5b5cbcc936341624c66a5f7f221673962718", "filename": "roles/wordpress-setup/tasks/database.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/roots/trellis/blob/255c461f1d5d2c1378ce1a71fd0feadae3f49cb6/roles/wordpress-setup/tasks/database.yml", "raw_url": "https://github.com/roots/trellis/raw/255c461f1d5d2c1378ce1a71fd0feadae3f49cb6/roles/wordpress-setup/tasks/database.yml", "status": "modified", "patch": "@@ -7,7 +7,7 @@\n     login_user: \"{{ mysql_root_user }}\"\n     login_password: \"{{ mysql_root_password }}\"\n   with_dict: \"{{ wordpress_sites }}\"\n-  when: not mysql_remote_database and item.value.db_create | default(True)\n+  when: site_uses_local_db and item.value.db_create | default(True)\n \n - name: Create/assign database user to db and grant permissions\n   mysql_user:\n@@ -20,7 +20,7 @@\n     login_user: \"{{ mysql_root_user }}\"\n     login_password: \"{{ mysql_root_password }}\"\n   with_dict: \"{{ wordpress_sites }}\"\n-  when: not mysql_remote_database and item.value.db_create | default(True)\n+  when: site_uses_local_db and item.value.db_create | default(True)\n \n - name: Copy database dump\n   copy:"}, {"sha": "a957171a0ef9bc40ab1e297f190a96cdcd9ac245", "filename": "roles/mariadb/tasks/main.yml", "previous_filename": null, "additions": 57, "deletions": 49, "changes": 106, "blob_url": "https://github.com/roots/trellis/blob/255c461f1d5d2c1378ce1a71fd0feadae3f49cb6/roles/mariadb/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/255c461f1d5d2c1378ce1a71fd0feadae3f49cb6/roles/mariadb/tasks/main.yml", "status": "modified", "patch": "@@ -1,68 +1,76 @@\n ---\n - name: Add MariaDB MySQL apt-key\n   apt_key:\n-    url: \"http://keyserver.ubuntu.com/pks/lookup?op=get&fingerprint=on&search={{ keyserver_fingerprint }}\"\n+    url: \"http://keyserver.ubuntu.com/pks/lookup?op=get&fingerprint=on&search={{ mariadb_keyserver_fingerprint }}\"\n     state: present\n \n - name: Add MariaDB MySQL deb and deb-src\n   apt_repository:\n     repo: \"{{ item }}\"\n     state: present\n   with_items:\n-  - \"deb http://{{ mirror }}/mariadb/repo/{{ version }}/ubuntu {{ mariadb_dist | default(ansible_distribution_release) }} main\"\n-  - \"deb-src http://{{ mirror }}/mariadb/repo/{{ version }}/ubuntu {{ mariadb_dist | default(ansible_distribution_release) }} main\"\n+    - \"deb http://{{ mariadb_mirror }}/mariadb/repo/{{ mariadb_version }}/ubuntu {{ mariadb_dist | default(ansible_distribution_release) }} main\"\n+    - \"deb-src http://{{ mariadb_mirror }}/mariadb/repo/{{ mariadb_version }}/ubuntu {{ mariadb_dist | default(ansible_distribution_release) }} main\"\n \n-- name: Install MariaDB MySQL server\n+- name: Install MySQL client\n   apt:\n-    name: mariadb-server\n+    name: mariadb-client\n     state: present\n \n-- name: Disable MariaDB binary logging\n-  template:\n-    src: disable-binary-logging.cnf\n-    dest: /etc/mysql/conf.d\n-    owner: root\n-    group: root\n-  when: binary_logging_disabled\n+- block:\n+  - name: Install MariaDB MySQL server\n+    apt:\n+      name: mariadb-server\n+      state: present\n \n-- name: Restart MariaDB MySQL Server\n-  service:\n-    name: mysql\n-    state: restarted\n-    enabled: true\n+  - name: Disable MariaDB binary logging\n+    template:\n+      src: disable-binary-logging.cnf\n+      dest: /etc/mysql/conf.d\n+      owner: root\n+      group: root\n+    when: mariadb_binary_logging_disabled\n \n-- name: Set root user password\n-  mysql_user:\n-    name: root\n-    host: \"{{ item }}\"\n-    password: \"{{ mysql_root_password }}\"\n-    check_implicit_admin: yes\n-    state: present\n-  with_items:\n-    - \"{{ inventory_hostname }}\"\n-    - 127.0.0.1\n-    - ::1\n-    - localhost\n+  - name: Restart MariaDB MySQL Server\n+    service:\n+      name: mysql\n+      state: restarted\n+      enabled: true\n \n-- name: Copy .my.cnf file with root password credentials.\n-  template:\n-    src: my.cnf.j2\n-    dest: ~/.my.cnf\n-    owner: root\n-    group: root\n-    mode: 0600\n+  - name: Set root user password\n+    mysql_user:\n+      name: root\n+      host: \"{{ item }}\"\n+      password: \"{{ mysql_root_password }}\"\n+      check_implicit_admin: yes\n+      state: present\n+    with_items:\n+      - \"{{ inventory_hostname }}\"\n+      - 127.0.0.1\n+      - ::1\n+      - localhost\n \n-- name: Delete anonymous MySQL server users\n-  mysql_user:\n-    user: \"\"\n-    host: \"{{ item }}\"\n-    state: absent\n-  with_items:\n-    - localhost\n-    - \"{{ inventory_hostname }}\"\n-    - \"{{ ansible_hostname }}\"\n+  - name: Copy .my.cnf file with root password credentials.\n+    template:\n+      src: my.cnf.j2\n+      dest: ~/.my.cnf\n+      owner: root\n+      group: root\n+      mode: 0600\n+\n+  - name: Delete anonymous MySQL server users\n+    mysql_user:\n+      user: \"\"\n+      host: \"{{ item }}\"\n+      state: absent\n+    with_items:\n+      - localhost\n+      - \"{{ inventory_hostname }}\"\n+      - \"{{ ansible_hostname }}\"\n+\n+  - name: Remove the test database\n+    mysql_db:\n+      name: test\n+      state: absent\n \n-- name: Remove the test database\n-  mysql_db:\n-    name: test\n-    state: absent\n+  when: not sites_using_remote_db | count"}]}, {"repo": "jdauphant/ansible-role-ssl-certs", "author_id": "MDQ6VXNlcjEyMzgyNTQ=", "author_name": "Julien DAUPHANT", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix to sign certificat with SHA256 by default (#29)", "sha": "00104851b3724644a0cbef4ad8eb6333c90740e2", "url": "https://api.github.com/repos/jdauphant/ansible-role-ssl-certs/commits/00104851b3724644a0cbef4ad8eb6333c90740e2", "parents": ["3266d092e74707343e798255a19444bc594345b0"], "files": [{"sha": "802c64f5586b33abf5429bc01042bbf6232e87dd", "filename": "tasks/generate.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/jdauphant/ansible-role-ssl-certs/blob/00104851b3724644a0cbef4ad8eb6333c90740e2/tasks/generate.yml", "raw_url": "https://github.com/jdauphant/ansible-role-ssl-certs/raw/00104851b3724644a0cbef4ad8eb6333c90740e2/tasks/generate.yml", "status": "modified", "patch": "@@ -12,7 +12,7 @@\n     file: path={{ ssl_certs_csr_path }} owner={{ ssl_certs_path_owner }} group={{ ssl_certs_path_group }} mode={{ ssl_certs_mode }}\n \n   - name: Generate self-signed SSL certificate\n-    command: openssl req -nodes -x509 -days {{ ssl_certs_days }} -in {{ ssl_certs_csr_path }} -key {{ ssl_certs_privkey_path }} -out {{ ssl_certs_cert_path }} -extensions v3_ca creates={{ ssl_certs_cert_path }}\n+    command: openssl req -nodes -x509 -sha256 -days {{ ssl_certs_days }} -in {{ ssl_certs_csr_path }} -key {{ ssl_certs_privkey_path }} -out {{ ssl_certs_cert_path }} -extensions v3_ca creates={{ ssl_certs_cert_path }}\n     when: ssl_certs_generate_self_signed\n \n   - name: Self-signed SSL certificate file ownership"}]}, {"repo": "kubevirt/kubevirt-ansible", "author_id": "MDQ6VXNlcjE0MTg3MzQ=", "author_name": "Guohua Ouyang", "committer_id": "MDQ6VXNlcjE1MDU2ODQ=", "committer_name": "Lukas Bednar", "committer_email": "lukyn17@gmail.com", "message": "Fix task of remove firewalld package (#157)\n\nSigned-off-by: Guohua Ouyang <guohuaouyang@gmail.com>", "sha": "ebee4362303ed70050890906e3bb6ac232080be6", "url": "https://api.github.com/repos/kubevirt/kubevirt-ansible/commits/ebee4362303ed70050890906e3bb6ac232080be6", "parents": ["ca212d93b7739adc0aa87b93ac58801007b9f458"], "files": [{"sha": "3898dfba91007958dec43ecbf108f84f32342500", "filename": "roles/kubernetes-prerequisites/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/ebee4362303ed70050890906e3bb6ac232080be6/roles/kubernetes-prerequisites/tasks/main.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/ebee4362303ed70050890906e3bb6ac232080be6/roles/kubernetes-prerequisites/tasks/main.yml", "status": "modified", "patch": "@@ -10,6 +10,7 @@\n - name: remove firewalld package\n   package:\n     name: firewalld\n+    state: absent\n \n - name: stop and disable firewalld\n   register: result\n@@ -19,11 +20,6 @@\n     name: firewalld\n   failed_when: \"result|failed and not 'Could not find the requested service' in result.msg\"\n \n-- name: remove firewalld package\n-  package:\n-    name: firewalld\n-    state: absent\n-\n - name: Remove current swaps from fstab\n   lineinfile:\n     dest: /etc/fstab"}]}, {"repo": "anthcourtney/ansible-role-cis-amazon-linux", "author_id": "MDQ6VXNlcjI0ODkxOTcy", "author_name": "Lorens Kockum", "committer_id": "MDQ6VXNlcjI0ODkxOTcy", "committer_name": "Lorens Kockum", "committer_email": "lorens.kockum@schibsted.com", "message": "Fixes #36", "sha": "da521ee1d5a6577b12f9b4eecce45b3a6286f03a", "url": "https://api.github.com/repos/anthcourtney/ansible-role-cis-amazon-linux/commits/da521ee1d5a6577b12f9b4eecce45b3a6286f03a", "parents": ["31e7e59aed6155cc3ed6765b81289a65a35ba715"], "files": [{"sha": "45df21e07f19a6bfc1439a97904ada74723590a2", "filename": "tasks/level-1/5.5.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/anthcourtney/ansible-role-cis-amazon-linux/blob/da521ee1d5a6577b12f9b4eecce45b3a6286f03a/tasks/level-1/5.5.yml", "raw_url": "https://github.com/anthcourtney/ansible-role-cis-amazon-linux/raw/da521ee1d5a6577b12f9b4eecce45b3a6286f03a/tasks/level-1/5.5.yml", "status": "modified", "patch": "@@ -5,7 +5,7 @@\n \n - name: 5.5 - Ensure access to the su command is restricted\n   lineinfile:\n-    regexp: \"^auth\\\\s+\"\n+    regexp: \"^auth\\\\s.*\\\\spam_wheel.so\\\\s\"\n     line: \"auth required pam_wheel.so use_uid\"\n     dest: \"/etc/pam.d/su\"\n   tags:"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #41", "sha": "71cda5f377e4e4de8b037d066df6a45835637e3c", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/71cda5f377e4e4de8b037d066df6a45835637e3c", "parents": ["4a9c5644e154cd8e89c612b96e269eb080a58844"], "files": [{"sha": "632c334ca0429b8b4f250c590c594b8d0bb19b3e", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/71cda5f377e4e4de8b037d066df6a45835637e3c/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/71cda5f377e4e4de8b037d066df6a45835637e3c/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -8,6 +8,7 @@\n - name: Update APT cache\n   apt:\n     update_cache: yes\n+  changed_when: false\n   become: true\n   when: _docker_os_dist == \"Ubuntu\" or\n         _docker_os_dist == \"Debian\""}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #675 - Use log level strings for fail2ban", "sha": "91401bfbdfbdd4f17a82ed83b9e7f3c396f75533", "url": "https://api.github.com/repos/roots/trellis/commits/91401bfbdfbdd4f17a82ed83b9e7f3c396f75533", "parents": ["00fa27a9ba730bf4d36b9fcd05560fd7751a26c9"], "files": [{"sha": "e75e2b194de04cea3c1da10fc1bdd3cff0823c26", "filename": "roles/fail2ban/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/91401bfbdfbdd4f17a82ed83b9e7f3c396f75533/roles/fail2ban/defaults/main.yml", "raw_url": "https://github.com/roots/trellis/raw/91401bfbdfbdd4f17a82ed83b9e7f3c396f75533/roles/fail2ban/defaults/main.yml", "status": "modified", "patch": "@@ -1,5 +1,5 @@\n ---\n-fail2ban_loglevel: 3\n+fail2ban_loglevel: INFO\n fail2ban_logtarget: /var/log/fail2ban.log\n fail2ban_socket: /var/run/fail2ban/fail2ban.sock\n "}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #67", "sha": "8c72df4ecfaa4188202ab0872f4500384ffe5233", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/8c72df4ecfaa4188202ab0872f4500384ffe5233", "parents": ["8c4af8da901c68ce8c4bdd21c62e08cec5d3c23a"], "files": [{"sha": "af9c1c69700f43807fecab908888acb61b8a503e", "filename": "tasks/lvm-thinpool.yml", "previous_filename": null, "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/lvm-thinpool.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/lvm-thinpool.yml", "status": "modified", "patch": "@@ -45,4 +45,6 @@\n         -c 512K\n         --thinpool \"{{ pool.volume_group }}/{{ pool.name }}\"\n         --poolmetadata \"{{ pool.volume_group }}/{{ pool.name }}meta\"\n-  when: _datavolume_created | changed\n\\ No newline at end of file\n+  when: _datavolume_created | changed\n+  tags:\n+    - skip_ansible_lint\n\\ No newline at end of file"}, {"sha": "0e9045144bca23543912b9a3557fdd5f9c9ba165", "filename": "tasks/configure-systemd.yml", "previous_filename": null, "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/configure-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/configure-systemd.yml", "status": "modified", "patch": "@@ -15,7 +15,6 @@\n     src: drop-ins/default.conf.j2\n     dest: /etc/systemd/system/docker.service.d/default.conf\n   notify: restart docker\n-  register: _systemd_docker_dropin\n   vars:\n     systemd_envs_dir: \"{{ docker_envs_dir[_docker_os_dist] }}\"\n     systemd_service_conf: \"{{ _systemd_service_config }}\"\n@@ -35,10 +34,3 @@\n   notify: restart docker\n   vars:\n     docker_envs: \"{{ docker_service_envs }}\"\n-\n-- name: Force daemon reload of systemd\n-  become: true\n-  systemd:\n-    daemon_reload: yes\n-  notify: restart docker\n-  when: _systemd_docker_dropin|changed\n\\ No newline at end of file"}, {"sha": "132889d3222bdac5d6233bcf6d0930cc792b7044", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -36,7 +36,7 @@\n         ((docker_daemon_config is defined and\n         docker_daemon_config['userns-remap'] is defined and\n         docker_daemon_config['userns-remap'] == 'default') or\n-        docker_bug_usermod|bool == true)\n+        docker_bug_usermod | bool)\n \n - name: Ensure Docker users are added to the docker group\n   become: true"}, {"sha": "b2f928e721d66caebfcddf15dee782843cbee8c5", "filename": "meta/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/meta/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/meta/main.yml", "status": "modified", "patch": "@@ -1,5 +1,6 @@\n galaxy_info:\n   author: Bjorn Oscarsson\n+  company: none\n   description: \"Installs and configures Docker Community Edition (CE)\"\n   min_ansible_version: 2.4\n   license: MIT"}, {"sha": "88aef399bfc4458fff8b8cbe2df85df2ea9c4ac1", "filename": "tasks/main.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/main.yml", "status": "modified", "patch": "@@ -26,7 +26,7 @@\n   check_mode: no\n   register: _determine_systemd_usage\n \n-- name: Set fact to indicate systemd is not used\n+- name: Set fact to indicate systemd is used or not\n   set_fact:\n     _docker_systemd_used: \"{{ _determine_systemd_usage is defined and _determine_systemd_usage.stdout == 'systemd' }}\"\n \n@@ -35,7 +35,7 @@\n     docker_channel: edge\n   when:\n     - docker_enable_ce_edge is defined\n-    - docker_enable_ce_edge == true\n+    - docker_enable_ce_edge\n \n - name: Compatibility and distribution checks\n   include_tasks: checks.yml\n@@ -69,7 +69,7 @@\n \n - name: Configure non-systemd service\n   include_tasks: configure-non-systemd.yml\n-  when: _docker_systemd_used | bool == false\n+  when: _docker_systemd_used | bool\n   tags: [\"configure\"]\n \n - name: Configure Docker"}, {"sha": "38fd3d7d18624a4361694f5d1297ff1106282d4e", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -39,7 +39,8 @@\n   args:\n     warn: false\n   changed_when: false\n-  when: (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version == '14') or (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version == '7')\n+  when: (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version == '14') or (_docker_os_dist == \"Debian\" and\n+    _docker_os_dist_major_version == '7')\n \n - name: Determine channels to be enabled and/or disabled\n   set_fact:\n@@ -52,7 +53,8 @@\n - name: Add Docker CE repository with correct channels (Ubuntu/Debian)\n   become: true\n   apt_repository:\n-    repo: deb [arch=amd64] https://download.docker.com/linux/{{ _docker_os_dist|lower }} {{ _docker_os_dist_release }} {{ _docker_enable_channels | join(\" \") }}\n+    repo: \"deb [arch=amd64] https://download.docker.com/linux/{{ _docker_os_dist|lower }} \\\n+      {{ _docker_os_dist_release }} {{ _docker_enable_channels | join(' ') }}\"\n     state: present\n     filename: 'docker-ce'\n   when: _docker_os_dist == \"Ubuntu\" or\n@@ -88,6 +90,8 @@\n   when: _docker_os_dist == \"CentOS\" or\n         _docker_os_dist == \"Fedora\" or\n         _docker_os_dist == \"RedHat\"\n+  tags:\n+    - skip_ansible_lint\n \n - name: Enable Docker CE repository channels (Fedora/CentOS/RedHat)\n   become: true\n@@ -99,6 +103,8 @@\n   when: _docker_os_dist == \"CentOS\" or\n         _docker_os_dist == \"Fedora\" or\n         _docker_os_dist == \"RedHat\"\n+  tags:\n+    - skip_ansible_lint\n \n # disable rt-beta so we don't get a 403 error retrieving repomd.xml\n - name: Check if rhel-7-server-rt-beta-rpms Repository is enabled (RedHat)\n@@ -113,6 +119,8 @@\n   become: true\n   shell: \"subscription-manager repos --disable=rhel-7-server-rt-beta-rpms\"\n   when: _docker_os_dist == \"RedHat\" and cmd_rhel_rt_beta_repo_enabled.rc == 0\n+  tags:\n+    - skip_ansible_lint\n \n # container-selinux package wants this\n - name: Check if rhel-7-server-extras-rpms Repository is enabled (RedHat)\n@@ -127,10 +135,14 @@\n   become: true\n   shell: \"subscription-manager repos --enable=rhel-7-server-extras-rpms\"\n   when: _docker_os_dist == \"RedHat\" and cmd_rhel_extras_repo_enabled.rc == 1\n+  tags:\n+    - skip_ansible_lint\n \n - name: Update repository cache\n   become: true\n   shell: \"{{ docker_cmd_update_repo_cache[_docker_os_dist] }}\"\n   args:\n     warn: false\n-  changed_when: false\n\\ No newline at end of file\n+  changed_when: false\n+  tags:\n+    - skip_ansible_lint\n\\ No newline at end of file"}, {"sha": "79908bc1b9ecbed3c05c60f6b5301e51ecf6dedd", "filename": "tasks/bug-tweaks.yml", "previous_filename": null, "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/bug-tweaks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/bug-tweaks.yml", "status": "modified", "patch": "@@ -22,9 +22,10 @@\n       state: absent\n     notify: restart docker\n \n-  - name: Set systemd service MountFlags option to \"slave\" to prevent \"device busy\" errors on CentOS/RedHat 7.3 kernels (CentOS/RedHat)\n+  - name: Set MountFlags option to \"slave\" to prevent \"device busy\" errors on CentOS/RedHat 7.3 kernels (CentOS/RedHat)\n     set_fact:\n-      docker_systemd_service_config_tweaks: \"{{ docker_systemd_service_config_tweaks + _systemd_service_config_tweaks }}\"\n+      docker_systemd_service_config_tweaks: \"{{ docker_systemd_service_config_tweaks + \\\n+        _systemd_service_config_tweaks }}\"\n     vars:\n       _systemd_service_config_tweaks:\n         - 'MountFlags=slave'\n@@ -41,13 +42,15 @@\n       pool:\n         name: thinpool\n         volume_group: docker\n-        physical_volumes: \"{{ docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+') | list | regex_replace('dm.directlvm_device=\\\\s*(.+)', '\\\\1') }}\"\n+        physical_volumes: \"{{ docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+') \\\n+          | list | regex_replace('dm.directlvm_device=\\\\s*(.+)', '\\\\1') }}\"\n         metadata_size: \"1%VG\"\n         data_size: \"95%VG\"\n \n   - name: Modify storage-opts to handle problems with thinpool on Debian 8\n     set_fact:\n-      _modified_storage_config: \"{{ (docker_daemon_config['storage-opts'] | difference(_exclusions)) + ['dm.thinpooldev=/dev/mapper/docker-thinpool-tpool'] }}\"\n+      _modified_storage_config: \"{{ (docker_daemon_config['storage-opts'] | difference(_exclusions)) + \\\n+        ['dm.thinpooldev=/dev/mapper/docker-thinpool-tpool'] }}\"\n     vars:\n       _exclusions: \"{{ docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+') | list }}\"\n "}, {"sha": "5ce912fb8b7fe41f67104f36263310c8c0b6e2c2", "filename": "tasks/postinstall.yml", "previous_filename": null, "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/postinstall.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/postinstall.yml", "status": "modified", "patch": "@@ -12,19 +12,22 @@\n \n - name: Set facts to install Docker SDK for Python\n   set_fact:\n-    _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + docker_predefined_packages_pip[_docker_os_dist]['sdk'] }}\"\n+    _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + \\\n+      docker_predefined_packages_pip[_docker_os_dist]['sdk'] }}\"\n   when:\n     - docker_sdk\n \n - name: Set facts to install Docker Compose\n   set_fact:\n-    _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + docker_predefined_packages_pip[_docker_os_dist]['compose'] }}\"\n+    _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + \\\n+      docker_predefined_packages_pip[_docker_os_dist]['compose'] }}\"\n   when:\n     - docker_compose\n \n - name: Set facts to install Docker Stack dependencies ('docker_stack')\n   set_fact:\n-    _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + docker_predefined_packages_pip[_docker_os_dist]['stack'] }}\"\n+    _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + \\\n+      docker_predefined_packages_pip[_docker_os_dist]['stack'] }}\"\n   when:\n     - docker_stack\n \n@@ -83,8 +86,10 @@\n - name: Install docker-compose (Linux)\n   become: true\n   get_url:\n-    url: \"https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/docker-compose-{{ ansible_system }}-{{ ansible_architecture }}\"\n-    checksum: \"sha256:https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n+    url: \"https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/\\\n+      docker-compose-{{ ansible_system }}-{{ ansible_architecture }}\"\n+    checksum: \"sha256:https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/\\\n+      docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n     dest: /usr/local/bin/docker-compose\n     mode: 0755\n   when:"}, {"sha": "3360993201a4c5573dfda8be865e613dfd343915", "filename": "handlers/main.yml", "previous_filename": null, "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/handlers/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/handlers/main.yml", "status": "modified", "patch": "@@ -2,16 +2,22 @@\n # handlers file for ansible-role-docker-ce\n \n - name: restart docker\n+  become: yes\n   service:\n     name: docker\n     state: restarted\n-  become: yes\n+  tags: [\"install\", \"configure\"]\n+\n+- name: reload docker\n+  become: true\n+  systemd:\n+    daemon_reload: yes\n   tags: [\"install\", \"configure\"]\n \n # Workaround because systemd cannot be used: https://github.com/ansible/ansible/issues/22171\n - name: restart auditd\n+  become: yes\n   command: service auditd restart\n   args:\n     warn: no\n-  become: yes\n   tags: [\"install\", \"configure\"]"}, {"sha": "9f2d9bd09665de348e60f3c9089351b83c6b6895", "filename": "tasks/remove-pre-docker-ce.yml", "previous_filename": null, "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/remove-pre-docker-ce.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8c72df4ecfaa4188202ab0872f4500384ffe5233/tasks/remove-pre-docker-ce.yml", "status": "modified", "patch": "@@ -7,16 +7,17 @@\n \n - name: Set fact if old Docker installation shall be removed\n   set_fact:\n-    _remove_old_docker: \"{{ docker_remove_pre_ce | bool }} == true and {{ _cmd_docker_version.stdout_lines[0] | search('-ce') }} == false\"\n+    _remove_old_docker: \"{{ docker_remove_pre_ce | bool }} and not \\\n+      {{ _cmd_docker_version.stdout_lines[0] | search('-ce') }}\"\n   when: _cmd_docker_version.stdout_lines is defined and _cmd_docker_version.stdout_lines[0] is defined\n \n - name: Check if Docker is running\n   become: true\n-  command: systemctl status docker\n+  systemd:\n+    name: docker\n   ignore_errors: yes\n-  changed_when: false\n   register: _service_docker_status\n-  when: _remove_old_docker | default(False) | bool == true\n+  when: _remove_old_docker | default(False) | bool\n \n - name: Stop Docker service\n   service:"}]}, {"repo": "lean-delivery/ansible-role-java", "author_id": null, "author_name": "Pavel Pikta", "committer_id": "MDQ6VXNlcjg1MDMwMTM=", "committer_name": "Ivan Bogomazov", "committer_email": "ivan.bogomazov@gmail.com", "message": "fix links (#38)\n\n* add molecule default test\r\n\r\n* add lit\r\n\r\n* remove submodule\r\n\r\n* add pip upgrade\r\n\r\n* update requirements\r\n\r\n* Fix lint\r\n\r\n* use virtualenv\r\n\r\n* fix yamlint errors\r\n\r\n* Fix yamllint\r\n\r\n* Add custom ansible-lint config\r\n\r\n* Provide ansible-lint config\r\n\r\n* update exclude list\r\n\r\n* Change regex for ansible-lint\r\n\r\n* Disable lint fail on warn\r\n\r\n* Add debug for molecule\r\n\r\n* Change molecule version\r\n\r\n* degradate molecule version\r\n\r\n* Update .travis.yml\r\n\r\n* Change defaults to int\r\n\r\n* add molecule create.yml destroy.yml into ignor list\r\n\r\n* Replace with_items\r\n\r\n* Change test requrenments and header on fallback\r\n\r\n* Disable lint for debug\r\n\r\n* Delegate download to localhost\r\n\r\n* Enable lint\r\n\r\n* Add oracle disclaimer\r\n\r\n* Increase retry time and pause on OTN download\r\n\r\n* Add Ubuntu support\r\n\r\n* Update meta\r\n\r\n* Add build status and LICENSE to README.md\r\n\r\n* Fix linux install path\r\n\r\n* Add custom download path and fix variables\r\n\r\n* Release 8 181\r\n\r\n* Fix lint\r\n\r\n* Readme update - supported OS (#8)\r\n\r\n* add issue_template and set setting branch for pulling from ansible-lint-rules repo based on lint_version (#9)\r\n\r\n* Change path to split double slashes\r\n\r\n* Fix win task and fail on unsuported\r\n\r\n* Add s3 transport (#28)\r\n\r\n* Release tech dept fixes (#20)\r\n\r\n* add molecule default test\r\n\r\n* add lit\r\n\r\n* remove submodule\r\n\r\n* add pip upgrade\r\n\r\n* update requirements\r\n\r\n* Fix lint\r\n\r\n* use virtualenv\r\n\r\n* fix yamlint errors\r\n\r\n* Fix yamllint\r\n\r\n* Add custom ansible-lint config\r\n\r\n* Provide ansible-lint config\r\n\r\n* update exclude list\r\n\r\n* Change regex for ansible-lint\r\n\r\n* Disable lint fail on warn\r\n\r\n* Add debug for molecule\r\n\r\n* Change molecule version\r\n\r\n* degradate molecule version\r\n\r\n* Update .travis.yml\r\n\r\n* Change defaults to int\r\n\r\n* add molecule create.yml destroy.yml into ignor list\r\n\r\n* Replace with_items\r\n\r\n* Change test requrenments and header on fallback\r\n\r\n* Disable lint for debug\r\n\r\n* Delegate download to localhost\r\n\r\n* Enable lint\r\n\r\n* Add oracle disclaimer\r\n\r\n* Increase retry time and pause on OTN download\r\n\r\n* Add Ubuntu support\r\n\r\n* Update meta\r\n\r\n* Add build status and LICENSE to README.md\r\n\r\n* Fix linux install path\r\n\r\n* Add custom download path and fix variables\r\n\r\n* Release 8 181\r\n\r\n* Fix lint\r\n\r\n* Readme update - supported OS (#8)\r\n\r\n* add issue_template and set setting branch for pulling from ansible-lint-rules repo based on lint_version (#9)\r\n\r\n* Change path to split double slashes\r\n\r\n* Fix win task and fail on unsuported\r\n\r\n* README.md change required version from 2.4 to 2.5 (#22)\r\n\r\n README.md change required version from 2.4 to 2.5\r\n\r\n* Fix of issue #24 (#25)\r\n\r\n* Fix of issue #24\r\n\r\n* Fix yml files to align with new lint rule [E604] True/False should be started from capitalized letter\r\n\r\n* check for binary existence #23 (#26)\r\n\r\n* check for binary existence #23\r\n\r\n* changes to the task name\r\n\r\n* added jre links for 8.181 (#27)\r\n\r\n* Release jre 8.191\r\n\r\n* add s3 transport parameter\r\n\r\n* update travis file\r\n\r\n* fix error syntax error: expected <block end>, but found '<scalar>'\r\n\r\n* fix lint errors\r\n\r\n* revert booleans in molecule\r\n\r\nadd epel installation\r\n\r\n* correct epel installation conditions\r\n\r\n* fix [E602] Line too long (121 characters)\r\n\r\n* remove pip install from vars\r\n\r\n* fix merge issue\r\n\r\n* Added valid links for JRE and JDK both for Win and Linux with updates 191 and 192\r\n\r\n* Fix windows platform installation #34 (#35)\r\n\r\n* Fix windows platform installation\r\n\r\n* Update travis config to work around buggy pytest 3.10.0\r\n\r\n* Use Temp env variable value as a temporary directory\r\n\r\n* Fix jdk version\r\n\r\n* Fix vars duplicate\r\n\r\n* fix links\r\n\r\n* fix lint\r\n\r\n* fix windows platform installation", "sha": "38ccf158f15af9b2953abd1ec9c4a71505c63ccd", "url": "https://api.github.com/repos/lean-delivery/ansible-role-java/commits/38ccf158f15af9b2953abd1ec9c4a71505c63ccd", "parents": ["fa8eab8d7ae5ae376827cb0622a0620955a9c64f"], "files": [{"sha": "e1e2b3c5a207b0fcc3740b32fa3d5c92735b43b9", "filename": "tasks/system/Linux.yml", "previous_filename": null, "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/38ccf158f15af9b2953abd1ec9c4a71505c63ccd/tasks/system/Linux.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/38ccf158f15af9b2953abd1ec9c4a71505c63ccd/tasks/system/Linux.yml", "status": "modified", "patch": "@@ -12,6 +12,8 @@\n       package:\n         name: \"{{ requirements }}\"\n         state: \"present\"\n+      register: installed_packages\n+      until: installed_packages is succeeded\n \n     - name: \"Mkdir for java installation\"\n       file:"}, {"sha": "0672d5ff42bbb5ba4797bdec40544fed28564cae", "filename": "tasks/main.yml", "previous_filename": null, "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/38ccf158f15af9b2953abd1ec9c4a71505c63ccd/tasks/main.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/38ccf158f15af9b2953abd1ec9c4a71505c63ccd/tasks/main.yml", "status": "modified", "patch": "@@ -7,6 +7,8 @@\n   delegate_to: \"localhost\"\n   connection: \"local\"\n   run_once: True\n+  register: status\n+  until: status is succeeded\n   become: True\n   when:\n     - transport == \"s3\"\n@@ -19,22 +21,25 @@\n   delegate_to: \"localhost\"\n   connection: \"local\"\n   run_once: True\n+  register: status\n+  until: status is succeeded\n   become: True\n   when: transport == \"s3\"\n \n - name: \"Install boto module\"\n   pip:\n-    name: \"{{ item }}\"\n+    name:\n+      - \"pip\"\n+      - \"botocore\"\n+      - \"boto\"\n+      - \"boto3\"\n     state: present\n     extra_args: --upgrade\n-  with_items:\n-    - \"pip\"\n-    - \"botocore\"\n-    - \"boto\"\n-    - \"boto3\"\n   delegate_to: \"localhost\"\n   connection: \"local\"\n   run_once: True\n+  register: status\n+  until: status is succeeded\n   become: True\n   when: transport == \"s3\"\n "}, {"sha": "abba917abe4050a2d51a86f97d9de9343f157df2", "filename": "tasks/system/Win32NT.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/38ccf158f15af9b2953abd1ec9c4a71505c63ccd/tasks/system/Win32NT.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/38ccf158f15af9b2953abd1ec9c4a71505c63ccd/tasks/system/Win32NT.yml", "status": "modified", "patch": "@@ -23,6 +23,7 @@\n         path: \"{{ java_artifact }}\"\n         state: \"present\"\n         creates_path: \"C:\\\\Program Files\\\\Java\"\n+        arguments: \"/s\"\n \n     - name: \"Get installed java directory\"\n       win_shell: \"Get-ChildItem -Path 'C:\\\\Program Files\\\\Java' |\\"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #58: Combine download and expand role tasks.", "sha": "0b1126b9c4fb5223ad2962bcafc5afd3fb069aaa", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/0b1126b9c4fb5223ad2962bcafc5afd3fb069aaa", "parents": ["d6975ce0821cb79bcdd4d0714033f0f0615d81f7"], "files": [{"sha": "0a7a80cbd0819d9fab78f52949d0753678e3af16", "filename": "tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/0b1126b9c4fb5223ad2962bcafc5afd3fb069aaa/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/0b1126b9c4fb5223ad2962bcafc5afd3fb069aaa/tasks/main.yml", "status": "modified", "patch": "@@ -12,18 +12,12 @@\n     solr_filename: \"apache-solr-{{ solr_version }}\"\n   when: \"solr_version.split('.')[0] == '3'\"\n \n-- name: Download Solr.\n-  get_url:\n-    url: \"{{ solr_mirror }}/lucene/solr/{{ solr_version }}/{{ solr_filename }}.tgz\"\n-    dest: \"{{ solr_workspace }}/{{ solr_filename }}.tgz\"\n-    force: no\n-\n - name: Expand Solr.\n   unarchive:\n-    src: \"{{ solr_workspace }}/{{ solr_filename }}.tgz\"\n+    src: \"{{ solr_mirror }}/lucene/solr/{{ solr_version }}/{{ solr_filename }}.tgz\"\n     dest: \"{{ solr_workspace }}\"\n+    remote_src: true\n     creates: \"{{ solr_workspace }}/{{ solr_filename }}/CHANGES.txt\"\n-    copy: no\n \n # Install Solr < 5.\n - include: install-pre5.yml"}]}, {"repo": "ansible-ThoTeam/nexus3-oss", "author_id": "MDQ6VXNlcjE3Njc3Ng==", "author_name": "Olivier Clavel", "committer_id": "MDQ6VXNlcjIxMzQwMzE1", "committer_name": "Samuel Herv\u00e9", "committer_email": "samuel.herve@savoirfairelinux.com", "message": "Fix symlinking of backup/restore scripts (#23)", "sha": "c91fa75a41d9ac08c30dc828986133cbd54144e7", "url": "https://api.github.com/repos/ansible-ThoTeam/nexus3-oss/commits/c91fa75a41d9ac08c30dc828986133cbd54144e7", "parents": ["9836737811cce6c1d780ad7c46934a2b73024c4d"], "files": [{"sha": "db00865dc84566423fba551f3fda9f82e1838aad", "filename": "tasks/nexus_install.yml", "previous_filename": null, "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/ansible-ThoTeam/nexus3-oss/blob/c91fa75a41d9ac08c30dc828986133cbd54144e7/tasks/nexus_install.yml", "raw_url": "https://github.com/ansible-ThoTeam/nexus3-oss/raw/c91fa75a41d9ac08c30dc828986133cbd54144e7/tasks/nexus_install.yml", "status": "modified", "patch": "@@ -171,22 +171,25 @@\n # - name: Enable nexus service\n #   systemd: name=nexus daemon_reload=yes enabled=yes state=started\n \n+- name: \"Register scripts to be deployed\"\n+  set_fact:\n+    nexus_deployed_scripts:\n+      - nexus-blob-backup.sh\n+      - nexus-blob-restore.sh\n+\n - name: \"Deploy scripts\"\n   template:\n     src: \"{{ item }}.j2\"\n     dest: \"{{ nexus_script_dir }}/{{ item }}\"\n     mode: 0755\n-  with_items:\n-    - nexus-blob-backup.sh\n-    - nexus-blob-restore.sh\n+  with_items: \"{{ nexus_deployed_scripts }}\"\n \n - name: \"Symlink scripts to /sbin\"\n   file:\n-    src: \"{{ item }}\"\n-    dest: \"/sbin/{{ item | basename }}\"\n+    src: \"{{ nexus_script_dir }}/{{ item }}\"\n+    dest: \"/sbin/{{ item }}\"\n     state: link\n-  with_fileglob:\n-    - \"{{ nexus_script_dir }}/*.sh\"\n+  with_items: \"{{ nexus_deployed_scripts }}\"\n \n - name: 'Check if data directory is empty (first-time install)'\n   command: \"ls {{ nexus_data_dir }}\""}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #718 - change method of updating theme paths\n\nAfter a deploy we were running `switch_theme` would had the side effect\nof sometimes making sidebar widgets inactive.\n\nThis uses a simpler, more direct method of updating `stylesheet_root` and\n`template_root` which should be less error-prone since it does less.", "sha": "632bbe84497584cf25ea3556b987a6cb63aec31b", "url": "https://api.github.com/repos/roots/trellis/commits/632bbe84497584cf25ea3556b987a6cb63aec31b", "parents": ["7f77ecfd904304d137e24dbeb36a6b6446896a4f"], "files": [{"sha": "1914b98a7be3549d9316a3141aa0931d45215d2d", "filename": "roles/deploy/hooks/finalize-after.yml", "previous_filename": null, "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/roots/trellis/blob/632bbe84497584cf25ea3556b987a6cb63aec31b/roles/deploy/hooks/finalize-after.yml", "raw_url": "https://github.com/roots/trellis/raw/632bbe84497584cf25ea3556b987a6cb63aec31b/roles/deploy/hooks/finalize-after.yml", "status": "modified", "patch": "@@ -24,12 +24,24 @@\n     chdir: \"{{ deploy_helper.current_path }}\"\n   when: wp_installed | success and project.multisite.enabled | default(false)\n \n-- name: Update WP theme paths\n-  command: wp eval 'wp_clean_themes_cache(); switch_theme(get_stylesheet());'\n+- name: Get WP theme template root\n+  command: wp option get template_root\n   args:\n     chdir: \"{{ deploy_helper.current_path }}\"\n+  register: wp_template_root\n+  changed_when: false\n+  failed_when: wp_template_root.stderr != \"\"\n   when: wp_installed | success\n \n+- name: Update WP theme paths\n+  command: wp option set {{ item }} {{ deploy_helper.new_release_path }}/web/wp/wp-content/themes\n+  args:\n+    chdir: \"{{ deploy_helper.current_path }}\"\n+  when: wp_installed | success and wp_template_root != '/themes' and wp_template_root != ''\n+  with_items:\n+    - stylesheet_root\n+    - template_root\n+\n - name: Reload php-fpm\n   shell: sudo service php7.1-fpm reload\n   args:"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #18", "sha": "35c4af9fd84d7a7e6bc093adc944b352e68d6ff1", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/35c4af9fd84d7a7e6bc093adc944b352e68d6ff1", "parents": ["41231a43e2531086c3fb9f7499cbc44aacbe7792"], "files": [{"sha": "3d2f823ce63e949a0aea3d3873f0f8c3eeb5f4b5", "filename": "tasks/main-CentOS.yml", "previous_filename": null, "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/35c4af9fd84d7a7e6bc093adc944b352e68d6ff1/tasks/main-CentOS.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/35c4af9fd84d7a7e6bc093adc944b352e68d6ff1/tasks/main-CentOS.yml", "status": "modified", "patch": "@@ -37,16 +37,21 @@\n   become: true\n   when: yum_repo.changed\n \n+- name: Stat /proc/sys/fs/may_detach_mounts\n+  stat:\n+    path: /proc/sys/fs/may_detach_mounts\n+  register: may_detach_mounts\n+\n - name: Ensure fs.may_detach_mounts is set to avoid 'Device or resource busy'\n   sysctl:\n     name: fs.may_detach_mounts\n     value: 1\n     sysctl_file: /etc/sysctl.d/99-docker.conf\n     reload: yes\n   become: true\n-  when: ansible_kernel | version_compare('4', '<')\n+  when: ansible_kernel|version_compare('4', '<') and may_detach_mounts.stat.exists\n \n - include: main-Mountflags.yml\n-  when: ansible_kernel | version_compare('4', '<')\n+  when: ansible_kernel|version_compare('4', '<')\n \n - include: main-Generic.yml"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #65 - Replace dots in cron file names\n\nDebian and Ubuntu will ignore cron files with dots in the filenames.\n\nSee http://manpages.ubuntu.com/manpages/trusty/en/man8/cron.8.html", "sha": "1ef316fba467bcc9e49b7cd9decd37843f03bc08", "url": "https://api.github.com/repos/roots/trellis/commits/1ef316fba467bcc9e49b7cd9decd37843f03bc08", "parents": ["afbaee2dde5a26458b4d7b6795ae8bf82d56c1ca"], "files": [{"sha": "1faf9f773c26585172cdc0168f5c42fc4112a56f", "filename": "roles/wordpress-sites/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/1ef316fba467bcc9e49b7cd9decd37843f03bc08/roles/wordpress-sites/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/1ef316fba467bcc9e49b7cd9decd37843f03bc08/roles/wordpress-sites/tasks/main.yml", "status": "modified", "patch": "@@ -77,6 +77,6 @@\n         minute=\"*/15\"\n         user=\"{{ item.user }}\"\n         job=\"curl -s {{ item.env.wp_siteurl }}/wp-cron.php\"\n-        cron_file=\"wordpress_{{ item.site_name }}\"\n+        cron_file=\"wordpress-{{ item.site_name|replace('.', '_') }}\"\n   with_items: wordpress_sites\n   when: item.system_cron|default(False) == True"}]}, {"repo": "elastic/ansible-elasticsearch", "author_id": "MDQ6VXNlcjg1ODIzNTE=", "author_name": "Julien Mailleret", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "fix ''dict object has no attribute dict_keys\" issue with python3 (#578)\n\nIn Python2, the dict.keys(), dict.values(), and dict.items() methods returns a list. Jinja2 returns that to Ansible via a string representation that Ansible can turn back into a list. In Python3, those methods return a dictionary view object.\r\nresource: https://docs.ansible.com/ansible/2.4/playbooks_python_version.html#dictionary-views", "sha": "5b1d028bd2f81e343f7dc90c4f5b8b23ad8e80e5", "url": "https://api.github.com/repos/elastic/ansible-elasticsearch/commits/5b1d028bd2f81e343f7dc90c4f5b8b23ad8e80e5", "parents": ["b137ebd6ec29b77e28d8eab667b0f9c81aeb4c68"], "files": [{"sha": "ab77be1cbb35f90fba39992bcf6f1214982d0c09", "filename": "tasks/xpack/security/elasticsearch-security-file.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/elastic/ansible-elasticsearch/blob/5b1d028bd2f81e343f7dc90c4f5b8b23ad8e80e5/tasks/xpack/security/elasticsearch-security-file.yml", "raw_url": "https://github.com/elastic/ansible-elasticsearch/raw/5b1d028bd2f81e343f7dc90c4f5b8b23ad8e80e5/tasks/xpack/security/elasticsearch-security-file.yml", "status": "modified", "patch": "@@ -1,6 +1,6 @@\n ---\n - name: set fact manage_file_users\n-  set_fact: manage_file_users=es_users is defined and es_users.file is defined and es_users.file.keys() | length > 0\n+  set_fact: manage_file_users=es_users is defined and es_users.file is defined and es_users.file.keys() | list | length > 0\n \n - name: Check if old users file exists\n   stat:\n@@ -35,7 +35,7 @@\n   check_mode: no\n \n - name: set fact users_to_remove\n-  set_fact: users_to_remove={{ current_file_users.stdout_lines | difference (es_users.file.keys()) }}\n+  set_fact: users_to_remove={{ current_file_users.stdout_lines | difference (es_users.file.keys() | list) }}\n   when: manage_file_users\n \n #Remove users\n@@ -51,7 +51,7 @@\n     ES_HOME: \"{{es_home}}\"\n \n - name: set fact users_to_add\n-  set_fact: users_to_add={{ es_users.file.keys() | difference (current_file_users.stdout_lines) }}\n+  set_fact: users_to_add={{ es_users.file.keys() | list | difference (current_file_users.stdout_lines) }}\n   when: manage_file_users\n \n #Add users\n@@ -72,7 +72,7 @@\n   become: yes\n   command: >\n     {{es_home}}/bin/{{es_xpack_users_command}} passwd {{ item }} -p {{es_users.file[item].password}}\n-  with_items: \"{{ es_users.file.keys() | default([]) }}\"\n+  with_items: \"{{ es_users.file.keys() | list }}\"\n   when: manage_file_users\n   #Currently no easy way to figure out if the password has changed or to know what it currently is so we can skip.\n   changed_when: False"}, {"sha": "f20c2d2e0d10b39e8c98d4b993e8562374d1bce1", "filename": "tasks/elasticsearch-parameters.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/elastic/ansible-elasticsearch/blob/5b1d028bd2f81e343f7dc90c4f5b8b23ad8e80e5/tasks/elasticsearch-parameters.yml", "raw_url": "https://github.com/elastic/ansible-elasticsearch/raw/5b1d028bd2f81e343f7dc90c4f5b8b23ad8e80e5/tasks/elasticsearch-parameters.yml", "status": "modified", "patch": "@@ -22,8 +22,8 @@\n     - es_api_basic_auth_password is not defined\n \n - name: set fact file_reserved_users\n-  set_fact: file_reserved_users={{ es_users.file.keys() | intersect (reserved_xpack_users) }}\n-  when: es_users is defined and es_users.file is defined and (es_users.file.keys() | length > 0) and (es_users.file.keys() | intersect (reserved_xpack_users) | length > 0)\n+  set_fact: file_reserved_users={{ es_users.file.keys() | list | intersect (reserved_xpack_users) }}\n+  when: es_users is defined and es_users.file is defined and (es_users.file.keys() | list | length > 0) and (es_users.file.keys() | list | intersect (reserved_xpack_users) | length > 0)\n \n - name: fail when changing users through file realm\n   fail:"}, {"sha": "6235952eca5fc2e428d3e7fedd592f191ea0e5c5", "filename": "tasks/xpack/security/elasticsearch-security-native.yml", "previous_filename": null, "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/elastic/ansible-elasticsearch/blob/5b1d028bd2f81e343f7dc90c4f5b8b23ad8e80e5/tasks/xpack/security/elasticsearch-security-native.yml", "raw_url": "https://github.com/elastic/ansible-elasticsearch/raw/5b1d028bd2f81e343f7dc90c4f5b8b23ad8e80e5/tasks/xpack/security/elasticsearch-security-native.yml", "status": "modified", "patch": "@@ -7,14 +7,14 @@\n \n - name: set fact manage_native_users to true\n   set_fact: manage_native_users=true\n-  when: es_users is defined and es_users.native is defined and es_users.native.keys() | length > 0\n+  when: es_users is defined and es_users.native is defined and es_users.native.keys() | list | length > 0\n \n - name: set fact manage_native_role to false\n   set_fact: manage_native_roles=false\n \n - name: set fact manange_native_roles to true\n   set_fact: manage_native_roles=true\n-  when: es_roles is defined and es_roles.native is defined and es_roles.native.keys() | length > 0\n+  when: es_roles is defined and es_roles.native is defined and es_roles.native.keys() | list | length > 0\n \n #If the node has just has security installed it maybe either stopped or started 1. if stopped, we need to start to load native realms 2. if started, we need to restart to load\n \n@@ -37,7 +37,7 @@\n \n #Current users not inc. those reserved\n - name: set fact current_users equals user_list_response.json.keys not including reserved\n-  set_fact: current_users={{ user_list_response.json.keys() | difference (reserved_users) }}\n+  set_fact: current_users={{ user_list_response.json.keys() | list | difference (reserved_users) }}\n   when: manage_native_users\n \n #We are changing the es_api_basic_auth_username password, so we need to do it first and update the param\n@@ -67,7 +67,7 @@\n \n #Identify users that are present in ES but not declared and thus should be removed\n - name: set fact users_to_remove\n-  set_fact: users_to_remove={{ current_users | difference ( native_users.keys() ) }}\n+  set_fact: users_to_remove={{ current_users | difference ( native_users.keys() | list) }}\n   when: manage_native_users\n \n #Delete all non required users NOT inc. reserved\n@@ -83,7 +83,7 @@\n   with_items: \"{{ users_to_remove | default([]) }}\"\n \n - name: set fact users_to_ignore\n-  set_fact: users_to_ignore={{ native_users.keys() | intersect (reserved_users) }}\n+  set_fact: users_to_ignore={{ native_users.keys() | list | intersect (reserved_users) }}\n   when: manage_native_users\n \n - name: debug message\n@@ -107,7 +107,7 @@\n   with_items: \"{{ users_to_ignore | default([]) }}\"\n \n - name: set fact users_to_modify\n-  set_fact: users_to_modify={{ native_users.keys() | difference (reserved_users) }}\n+  set_fact: users_to_modify={{ native_users.keys() | list | difference (reserved_users) }}\n   when: manage_native_users\n \n #Overwrite all other users NOT inc. those reserved\n@@ -146,11 +146,11 @@\n   when: manage_native_roles\n \n - name: set fact current roles\n-  set_fact: current_roles={{ role_list_response.json.keys() | difference (reserved_roles) }}\n+  set_fact: current_roles={{ role_list_response.json.keys() | list | difference (reserved_roles) }}\n   when: manage_native_roles\n \n - name: set fact roles to ignore\n-  set_fact: roles_to_ignore={{ es_roles.native.keys() | intersect (reserved_roles) | default([]) }}\n+  set_fact: roles_to_ignore={{ es_roles.native.keys() | list | intersect (reserved_roles) | default([]) }}\n   when: manage_native_roles\n \n - name: debug message\n@@ -159,7 +159,7 @@\n   when: manage_native_roles and roles_to_ignore | length > 0\n \n - name: set fact roles_to_remove\n-  set_fact: roles_to_remove={{ current_roles | difference ( es_roles.native.keys()  ) }}\n+  set_fact: roles_to_remove={{ current_roles | difference ( es_roles.native.keys() | list) }}\n   when: manage_native_roles\n \n #Delete all non required roles NOT inc. reserved\n@@ -175,7 +175,7 @@\n   with_items: \"{{roles_to_remove | default([]) }}\"\n \n - name: set fact roles_to_modify\n-  set_fact: roles_to_modify={{ es_roles.native.keys() | difference (reserved_roles) }}\n+  set_fact: roles_to_modify={{ es_roles.native.keys() | list | difference (reserved_roles) }}\n   when: manage_native_roles\n \n #Update other roles - NOT inc. reserved roles"}]}, {"repo": "angstwad/docker.ubuntu", "author_id": "MDQ6VXNlcjEyNDA3NDA=", "author_name": "Paul Durivage", "committer_id": "MDQ6VXNlcjEyNDA3NDA=", "committer_name": "Paul Durivage", "committer_email": "pauldurivage@gmail.com", "message": "Fixes #22; previous state was a no-op", "sha": "0183b10864f53eb0cf3405fb2a3a92a07d573349", "url": "https://api.github.com/repos/angstwad/docker.ubuntu/commits/0183b10864f53eb0cf3405fb2a3a92a07d573349", "parents": ["ef44a28a33e2fea1d2a2b61b1af060d51a8439d7"], "files": [{"sha": "2d26b2b711e694f8ee3e489373e90b2a9234f913", "filename": "tasks/main.yml", "previous_filename": null, "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/angstwad/docker.ubuntu/blob/0183b10864f53eb0cf3405fb2a3a92a07d573349/tasks/main.yml", "raw_url": "https://github.com/angstwad/docker.ubuntu/raw/0183b10864f53eb0cf3405fb2a3a92a07d573349/tasks/main.yml", "status": "modified", "patch": "@@ -63,15 +63,12 @@\n     update_cache: yes\n     state: present\n \n-- name: Install (or update) docker.io\n+- name: Install (or update) docker\n   apt: \n-    name: \"{{ docker_io_pkg }}\"\n+    name: \"{{ docker_pkg_name }}\"\n     state: latest\n     update_cache: yes\n-      \n-- name: Install Docker\n-  apt: pkg={{ docker_lxc_pkg }}\n-  notify: \"Start Docker\"\n+    cache_valid_time: 600\n \n - name: Expose docker host\n   copy:"}]}, {"repo": "cloudalchemy/ansible-fluentd", "author_id": "MDQ6VXNlcjExNzgwMA==", "author_name": "Fabian Schuh", "committer_id": "MDQ6VXNlcjM1MzE3NTg=", "committer_name": "Pawe\u0142 Krupa", "committer_email": "pawel@krupa.net.pl", "message": "Fix issue when comparing string with int (#19)\n\nSimilar to this:\r\nhttps://github.com/cloudalchemy/ansible-prometheus/issues/116", "sha": "ea1be193db9b2d598347de5ece2fed5cec8d7db9", "url": "https://api.github.com/repos/cloudalchemy/ansible-fluentd/commits/ea1be193db9b2d598347de5ece2fed5cec8d7db9", "parents": ["d64642f3b7997ca489a0d4905a99117a309b484c"], "files": [{"sha": "5336f574fccc5b1c7711954ca848462c8404b037", "filename": "tasks/preflight.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/cloudalchemy/ansible-fluentd/blob/ea1be193db9b2d598347de5ece2fed5cec8d7db9/tasks/preflight.yml", "raw_url": "https://github.com/cloudalchemy/ansible-fluentd/raw/ea1be193db9b2d598347de5ece2fed5cec8d7db9/tasks/preflight.yml", "status": "modified", "patch": "@@ -22,4 +22,4 @@\n - name: Fail on too small number of file descriptors\n   fail:\n     msg: \"Increase number of file descriptors to more than 1024. Follow instructions at https://docs.fluentd.org/v0.14/articles/before-install\"\n-  when: file_descriptors.stdout < 1025\n+  when: file_descriptors.stdout < \"1025\""}]}, {"repo": "ansible-ThoTeam/nexus3-oss", "author_id": "MDQ6VXNlcjE3Njc3Ng==", "author_name": "Olivier Clavel", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #154 from zeitounator/fix/httpProxyConfigBeforeBlobStores\n\nhttp proxy must be configured before blob stores for S3\r\n\r\nAlso embarks 2 minor doc and bugfix\r\n\r\nFixes #152 \r\nFixes #149", "sha": "4edec440368818740c0204173f21a156804e1ca9", "url": "https://api.github.com/repos/ansible-ThoTeam/nexus3-oss/commits/4edec440368818740c0204173f21a156804e1ca9", "parents": ["986403ad49c421cfd1f11c33f9d634ac7bda5cbb", "44ce2c517b37fdfb49f99b8f84be28a8f00e5069"], "files": [{"sha": "31f696f436a40ef8039266f3736ae898ef0a0c9c", "filename": "tasks/main.yml", "previous_filename": null, "additions": 18, "deletions": 16, "changes": 34, "blob_url": "https://github.com/ansible-ThoTeam/nexus3-oss/blob/4edec440368818740c0204173f21a156804e1ca9/tasks/main.yml", "raw_url": "https://github.com/ansible-ThoTeam/nexus3-oss/raw/4edec440368818740c0204173f21a156804e1ca9/tasks/main.yml", "status": "modified", "patch": "@@ -30,6 +30,24 @@\n - include_tasks: httpd_reverse_proxy_config.yml\n   when: httpd_setup_enable\n \n+- name: Configure nexus http proxy\n+  include_tasks: call_script.yml\n+  vars:\n+    script_name: setup_http_proxy\n+    args:\n+      with_http_proxy: \"{{ nexus_with_http_proxy }}\"\n+      http_proxy_host: \"{{ nexus_http_proxy_host }}\"\n+      http_proxy_port: \"{{ nexus_http_proxy_port }}\"\n+      http_proxy_username: \"{{ nexus_http_proxy_username }}\"\n+      http_proxy_password: \"{{ nexus_http_proxy_password }}\"\n+      with_https_proxy: \"{{ nexus_with_https_proxy }}\"\n+      https_proxy_host: \"{{ nexus_https_proxy_host }}\"\n+      https_proxy_port: \"{{ nexus_https_proxy_port }}\"\n+      https_proxy_username: \"{{ nexus_https_proxy_username }}\"\n+      https_proxy_password: \"{{ nexus_https_proxy_password }}\"\n+      proxy_exclude_hosts: \"{{ nexus_proxy_exclude_hosts }}\"\n+  when: nexus_with_http_proxy or nexus_with_https_proxy\n+\n - name: Deleting default repositories\n   include_tasks: delete_repo_each.yml\n   with_items:\n@@ -150,22 +168,6 @@\n     args:\n       base_url: \"{{ nexus_public_scheme }}://{{ nexus_public_hostname }}/\"\n \n-- include_tasks: call_script.yml\n-  vars:\n-    script_name: setup_http_proxy\n-    args:\n-      with_http_proxy: \"{{ nexus_with_http_proxy }}\"\n-      http_proxy_host: \"{{ nexus_http_proxy_host }}\"\n-      http_proxy_port: \"{{ nexus_http_proxy_port }}\"\n-      http_proxy_username: \"{{ nexus_http_proxy_username }}\"\n-      http_proxy_password: \"{{ nexus_http_proxy_password }}\"\n-      with_https_proxy: \"{{ nexus_with_https_proxy }}\"\n-      https_proxy_host: \"{{ nexus_https_proxy_host }}\"\n-      https_proxy_port: \"{{ nexus_https_proxy_port }}\"\n-      https_proxy_username: \"{{ nexus_https_proxy_username }}\"\n-      https_proxy_password: \"{{ nexus_https_proxy_password }}\"\n-      proxy_exclude_hosts: \"{{ nexus_proxy_exclude_hosts }}\"\n-\n - include_tasks: call_script.yml\n   vars:\n     script_name: setup_realms"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjQzNTQ5NDg=", "author_name": "Patrick C", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "Fix atlassian var names (#293)\n\n* change atlassian.user to atlassian.users\r\n\r\n* change jira_admin to admin_group\r\n\r\n* update to dynamically build the permissions list instead of using a static jinja file, get rid of camel case, clarify naming of vars\r\n\r\n* update readme\r\n\r\n* update to simplify\r\n\r\n* update with oystein changes", "sha": "abc45ed164c9b2ac57eea0edda8515673a9942ea", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/abc45ed164c9b2ac57eea0edda8515673a9942ea", "parents": ["9925a1fe9dadb982563155b57b6001182f7fe617"], "files": [{"sha": "c727a85274b28b3668fce7125bb18b9e197c080b", "filename": "roles/manage-jira/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/abc45ed164c9b2ac57eea0edda8515673a9942ea/roles/manage-jira/tasks/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/abc45ed164c9b2ac57eea0edda8515673a9942ea/roles/manage-jira/tasks/main.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n - include_tasks: prepare_vars.yml \n \n - include_tasks: create_project_category.yml\n- \n+\n - include_tasks: create_permission_scheme.yml\n \n - include_tasks: create_project.yml"}, {"sha": "81567832cd082af86f301dcf592456b2f1476fb3", "filename": "roles/manage-jira/tasks/create_permission_scheme.yml", "previous_filename": null, "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/abc45ed164c9b2ac57eea0edda8515673a9942ea/roles/manage-jira/tasks/create_permission_scheme.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/abc45ed164c9b2ac57eea0edda8515673a9942ea/roles/manage-jira/tasks/create_permission_scheme.yml", "status": "modified", "patch": "@@ -7,14 +7,17 @@\n     password: \"{{ jira_password }}\"\n     return_content: yes\n     force_basic_auth: yes\n-    body_format: json\n     header:\n       - Accept: 'application/json'\n       - Content-Type: 'application/json'\n-    body: \"{{ lookup('template','permissionScheme.json.j2') }}\"\n+    body_format: json\n+    body:\n+      name: \"{{ atlassian.jira.permission_scheme.name }}\"\n+      description: \"{{ atlassian.jira.permission_scheme.description }}\"\n+      permissions: \"{{ permission_list }}\"\n     status_code: 201\n-  register: permissionScheme\n+  register: permission_scheme_output\n \n - name: Set fact for Permission Scheme ID\n   set_fact:\n-    PermissionScheme: \"{{ permissionScheme.json.id }}\"\n+    default_permission_scheme_id: \"{{ permission_scheme_output.json.id }}\""}, {"sha": "258d2733fee1293ebbf56f96f54178c701a0bacd", "filename": "roles/manage-jira/tasks/create_project.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/abc45ed164c9b2ac57eea0edda8515673a9942ea/roles/manage-jira/tasks/create_project.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/abc45ed164c9b2ac57eea0edda8515673a9942ea/roles/manage-jira/tasks/create_project.yml", "status": "modified", "patch": "@@ -19,7 +19,7 @@\n              'lead': '{{ atlassian.jira.lead }}',\n              'assigneeType': 'PROJECT_LEAD',\n              'avatarId': 10200,\n-             'permissionScheme': '{{ atlassian.jira.permission_scheme.id | default(PermissionScheme) }}',\n+             'permissionScheme': '{{ atlassian.jira.permission_scheme.id | default(default_permission_scheme_id) }}',\n              'notificationScheme': 10000, \n              'categoryId': '{{ CategoryID }}' \n            }\""}, {"sha": "2b9e64f1609e7cfa8b2fcd76c1758b7b0025a76d", "filename": "roles/manage-jira/tasks/prepare_vars.yml", "previous_filename": null, "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/abc45ed164c9b2ac57eea0edda8515673a9942ea/roles/manage-jira/tasks/prepare_vars.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/abc45ed164c9b2ac57eea0edda8515673a9942ea/roles/manage-jira/tasks/prepare_vars.yml", "status": "modified", "patch": "@@ -4,3 +4,9 @@\n     jira_url: \"{{ atlassian.jira.url | default(atlassian.url) }}\"\n     jira_username: \"{{ atlassian.jira.username | default(atlassian.username) }}\"\n     jira_password: \"{{ atlassian.jira.password | default(atlassian.password) }}\"\n+\n+- name: Build permission list variable\n+  include_tasks: build_permissions_list.yml\n+  loop: \"{{ atlassian.jira.groups | default([]) }}\"\n+  loop_control:\n+    loop_var: group"}]}, {"repo": "kubevirt/kubevirt-ansible", "author_id": "MDQ6VXNlcjE3MTk0OTQz", "author_name": "Marek Libra", "committer_id": "MDQ6VXNlcjY3OTUyMTM=", "committer_name": "Ryan Hallisey", "committer_email": "rhallise@redhat.com", "message": "Fix kubevirt-web-ui for kubevirt-apb (#464)\n\n* Web ui fixes for containerized env\r\n\r\nThe playbook runs in a container already authenticated with\r\nthe cluster.  Remove root and remove copying around the config.\r\n\r\n* Make kubevirt-web-ui namespace configurable\r\n\r\nThe default is still kubevirt-web-ui.\r\n\r\n* Do not gather facts\r\n\r\nNot needed and causing issues in some environments.", "sha": "587bbca312d1e3841027c257dc62fba3559e3ccb", "url": "https://api.github.com/repos/kubevirt/kubevirt-ansible/commits/587bbca312d1e3841027c257dc62fba3559e3ccb", "parents": ["25d96207047cd4ba046f36738584681031817eec"], "files": [{"sha": "f83eb96aa7409dfe044bbe9f470c84fbc19ed97b", "filename": "roles/kubevirt_web_ui/tasks/provision.yml", "previous_filename": null, "additions": 7, "deletions": 14, "changes": 21, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/587bbca312d1e3841027c257dc62fba3559e3ccb/roles/kubevirt_web_ui/tasks/provision.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/587bbca312d1e3841027c257dc62fba3559e3ccb/roles/kubevirt_web_ui/tasks/provision.yml", "status": "modified", "patch": "@@ -1,23 +1,17 @@\n ---\n-- name: Check if kubevirt-web-ui project exists\n-  shell: \"{{ openshift_client_binary }} projects -q | grep -w kubevirt-web-ui | awk '{ print $1 }'\"\n+- name: Check if project for kubevirt-web-ui exists\n+  shell: \"{{ openshift_client_binary }} projects -q | grep -w {{ kubevirt_web_ui_namespace }} | awk '{ print $1 }'\"\n   register: ns\n \n - name: Create kubevirt-web-ui project\n-  shell: \"{{ openshift_client_binary }} new-project kubevirt-web-ui\"\n-  when: ns.stdout != \"kubevirt-web-ui\"\n+  shell: \"{{ openshift_client_binary }} new-project {{ kubevirt_web_ui_namespace }}\"\n+  when: ns.stdout == \"\"\n \n - name: Make temp directory for console templates\n   command: mktemp -d /tmp/console-ansible-XXXXXX\n   register: mktemp\n   changed_when: False\n \n-- name: Copy admin client config\n-  command: >\n-    cp {{ openshift.common.config_base }}/master/admin.kubeconfig {{ mktemp.stdout }}/admin.kubeconfig\n-  become: true\n-  changed_when: false\n-\n - name: Copy console templates to temp directory\n   copy:\n     src: \"{{ item }}\"\n@@ -31,7 +25,7 @@\n # contents so we don't overwrite changes.\n \n - name: Read the existing console config map\n-  shell: \"{{ openshift_client_binary }} get configmap console-config -n kubevirt-web-ui -o jsonpath='{.data}' | true\"\n+  shell: \"{{ openshift_client_binary }} get configmap console-config -n {{ kubevirt_web_ui_namespace }} -o jsonpath='{.data}' | true\"\n   register: console_config_map\n \n - set_fact:\n@@ -68,19 +62,18 @@\n   register: updated_console_config\n \n - name: Apply the console template file\n-  become: true\n   shell: >\n     {{ openshift_client_binary }} process -f \"{{ mktemp.stdout }}/{{ __console_template_file }}\"\n     --param IMAGE=\"{{ kubevirt_web_ui_image_name }}\"\n+    --param NAMESPACE=\"{{ kubevirt_web_ui_namespace }}\"\n     --param NODE_SELECTOR={{ kubevirt_web_ui_nodeselector | to_json | quote }}\n     --param SERVER_CONFIG=\"{{ updated_console_config['content'] | b64decode }}\"\n     --param REPLICA_COUNT=\"{{ kubevirt_web_ui_replica_count }}\"\n     --param CONSOLE_HOSTNAME=\"{{ kubevirt_web_ui_hostname }}\"\n     --param TLS_CERT=\"{{ console_cert | default('') }}\"\n     --param TLS_KEY=\"{{ console_key | default('') }}\"\n     --param TLS_CA_CERT=\"{{ console_ca_cert | default('') }}\"\n-    --config={{ mktemp.stdout }}/admin.kubeconfig\n-    | {{ openshift_client_binary }} apply --config={{ mktemp.stdout }}/admin.kubeconfig -f -\n+    | {{ openshift_client_binary }} apply -f -\n \n - name: Remove temp directory\n   file:"}, {"sha": "9460e0541e59803aa4fe40f6cc7e66e92c8749a9", "filename": "roles/kubevirt_web_ui/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/587bbca312d1e3841027c257dc62fba3559e3ccb/roles/kubevirt_web_ui/defaults/main.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/587bbca312d1e3841027c257dc62fba3559e3ccb/roles/kubevirt_web_ui/defaults/main.yml", "status": "modified", "patch": "@@ -1,6 +1,7 @@\n ---\n openshift_client_binary: \"oc\"\n apb_action: \"provision\"\n+kubevirt_web_ui_namespace: \"kubevirt-web-ui\"\n \n # Deviation from openshift-console: the kubevirt/web-ui is installed to an _existing_ openshift cluster,\n # so \"defaultNodeSelector\" (see master config) takes effect causing scheduler to find no \"master and compute\" node."}, {"sha": "94ca5317d4f5a2e1e53ce66c3b83391b718642f3", "filename": "roles/kubevirt_web_ui/tasks/deprovision.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/587bbca312d1e3841027c257dc62fba3559e3ccb/roles/kubevirt_web_ui/tasks/deprovision.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/587bbca312d1e3841027c257dc62fba3559e3ccb/roles/kubevirt_web_ui/tasks/deprovision.yml", "status": "modified", "patch": "@@ -1,6 +1,6 @@\n ---\n - name: Remove kubevirt-web-ui project\n-  shell: \"{{ openshift_client_binary }} delete project kubevirt-web-ui\"\n+  shell: \"{{ openshift_client_binary }} delete project {{ kubevirt_web_ui_namespace }}\"\n \n - name: Remove Kubevirt Web UI OAuth client\n   shell: \"{{ openshift_client_binary }} delete oauthclient kubevirt-web-ui\""}, {"sha": "ba5e8b25017d1ca84e94a2fcf28cd9e4b885e810", "filename": "playbooks/kubevirt-web-ui/private/config.yml", "previous_filename": null, "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/587bbca312d1e3841027c257dc62fba3559e3ccb/playbooks/kubevirt-web-ui/private/config.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/587bbca312d1e3841027c257dc62fba3559e3ccb/playbooks/kubevirt-web-ui/private/config.yml", "status": "modified", "patch": "@@ -1,7 +1,7 @@\n ---\n - name: Kubevirt Web UI Install Checkpoint Start\n   hosts: all\n-  gather_facts: false\n+  gather_facts: False\n   tasks:\n   - name: Set Console install 'In Progress'\n     run_once: true\n@@ -17,6 +17,7 @@\n - name: Kubevirt Web UI\n   # hosts: oo_first_master\n   hosts: masters[0]\n+  gather_facts: False\n   vars:\n     first_master: \"{{ masters[0] }}\"\n   tasks:\n@@ -26,7 +27,7 @@\n \n - name: Kubevirt Web UI Install Checkpoint End\n   hosts: all\n-  gather_facts: false\n+  gather_facts: False\n   tasks:\n   - name: Set Console install 'Complete'\n     run_once: true"}, {"sha": "49c0840e9c3e87c95ed87c6edea8650baff4ec4c", "filename": "roles/kubevirt_web_ui/tasks/start.yml", "previous_filename": null, "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/587bbca312d1e3841027c257dc62fba3559e3ccb/roles/kubevirt_web_ui/tasks/start.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/587bbca312d1e3841027c257dc62fba3559e3ccb/roles/kubevirt_web_ui/tasks/start.yml", "status": "modified", "patch": "@@ -4,8 +4,7 @@\n   # A zero return code indicates the rollout succeeded.\n   # https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#complete-deployment\n   command: >\n-    {{ openshift_client_binary }} rollout status deployment/console --config={{ openshift.common.config_base }}/master/admin.kubeconfig -n kubevirt-web-ui\n+    {{ openshift_client_binary }} rollout status deployment/console -n {{ kubevirt_web_ui_namespace }}\n   changed_when: false\n-  become: true\n   # deviation from openshift-ansible: fail first and let the user gather troubleshooting info manually via `oc status`, `oc get pods`, `oc get events`, and `oc logs deployment/console`\n "}]}, {"repo": "lean-delivery/ansible-role-java", "author_id": "MDQ6VXNlcjEyNDQyMTM=", "author_name": "Dmitriy Stoyanov", "committer_id": "MDQ6VXNlcjIwMjIyNzM3", "committer_name": "Anastacia Maletskaya", "committer_email": "Anastacia_Maletskaya@epam.com", "message": "Fix of issue #24 (#25)\n\n* Fix of issue #24\r\n\r\n* Fix yml files to align with new lint rule [E604] True/False should be started from capitalized letter", "sha": "29d6d51f112d59920a2bcda68a48fd585695c693", "url": "https://api.github.com/repos/lean-delivery/ansible-role-java/commits/29d6d51f112d59920a2bcda68a48fd585695c693", "parents": ["ed3393f47be912906eff72650f34365bceef1dc5"], "files": [{"sha": "1324b8aa27b19ca1d84c7759470c7a507a1d00b3", "filename": "tasks/fetch/web.yml", "previous_filename": null, "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/29d6d51f112d59920a2bcda68a48fd585695c693/tasks/fetch/web.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/29d6d51f112d59920a2bcda68a48fd585695c693/tasks/fetch/web.yml", "status": "modified", "patch": "@@ -7,6 +7,8 @@\n   retries: 3\n   delay: 2\n   register: FILE_DOWNLOADED\n+  delegate_to: \"localhost\"\n+  connection: \"local\"\n \n - name: \"Downloaded artifact\"\n   set_fact:"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjI5NDk3MTQ3", "author_name": "Tyler Auerbeck", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "Fix IDM User Management Errors (#220)", "sha": "3e8a830bb525d818ed2aa2cdb10c8589e5e2ceba", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/3e8a830bb525d818ed2aa2cdb10c8589e5e2ceba", "parents": ["155dade983c6ce867dac38a9ae62e471ad13437f"], "files": [{"sha": "4c5d3a408407ea7a8c1787c296fb8f6777f7df8e", "filename": "playbooks/manage-users/add-users.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/3e8a830bb525d818ed2aa2cdb10c8589e5e2ceba/playbooks/manage-users/add-users.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/3e8a830bb525d818ed2aa2cdb10c8589e5e2ceba/playbooks/manage-users/add-users.yml", "status": "modified", "patch": "@@ -5,7 +5,7 @@\n   gather_facts: no\n   roles:\n     - user-management/populate-users\n-    - user-management/manage-users\n+    - user-management/manage-idm-users\n     - user-management/manage-user-passwd\n \n - name: \"Notify users\""}, {"sha": "1d25ceb676c6c0716597e7b295893975c5d3af59", "filename": "roles/user-management/manage-idm-users/tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/3e8a830bb525d818ed2aa2cdb10c8589e5e2ceba/roles/user-management/manage-idm-users/tasks/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/3e8a830bb525d818ed2aa2cdb10c8589e5e2ceba/roles/user-management/manage-idm-users/tasks/main.yml", "status": "modified", "patch": "@@ -1,11 +1,6 @@\n ---\n \n-- import_tasks: create_user.yml\n+- import_tasks: configure_user.yml\n \n-- import_tasks: create_group.yml\n-\n-- include_tasks: add_user_to_group.yml\n-  with_items: \"{{ user_groups }}\"\n-  loop_control:\n-    loop_var: \"this_group\"\n+- import_tasks: configure_group.yml\n "}]}, {"repo": "Icinga/ansible-icinga2", "author_id": "MDQ6VXNlcjE3NzM0MjE=", "author_name": "Arjan Oosting", "committer_id": "MDQ6VXNlcjE1MDcyMDcx", "committer_name": "Assaf Flatto", "committer_email": "aflatto@users.noreply.github.com", "message": "Fix ansible lint issues (#38)\n\n* Add spaces to fix warning\r\n* Remove categories\r\n* Jinja2 templates should use dict.items()to be compatible with both Python2 and Python3\r\n* Enable EPEL", "sha": "d2c53070e481259c0099d42d572b85fa8cf8af63", "url": "https://api.github.com/repos/Icinga/ansible-icinga2/commits/d2c53070e481259c0099d42d572b85fa8cf8af63", "parents": ["0c8478433bff40d6c1eda61fe14b98ae904996b1"], "files": [{"sha": "f70a63f9663639ddf9d3ccb248f88e91bf7980f1", "filename": "tasks/icinga2-RedHat.yml", "previous_filename": null, "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Icinga/ansible-icinga2/blob/d2c53070e481259c0099d42d572b85fa8cf8af63/tasks/icinga2-RedHat.yml", "raw_url": "https://github.com/Icinga/ansible-icinga2/raw/d2c53070e481259c0099d42d572b85fa8cf8af63/tasks/icinga2-RedHat.yml", "status": "modified", "patch": "@@ -9,6 +9,13 @@\n     gpgcheck: yes\n   when: i2_manage_repository\n \n+- name: RedHat - Ensure EPEL is enabled\n+  become: True\n+  yum:\n+    name: epel-release\n+    state: present\n+  when: i2_manage_package\n+\n - name: RedHat - Ensure icinga2 is installed\n   become: yes\n   yum:"}, {"sha": "c20b4eb08dfaa0554b100b9f8eb350957f52fd3e", "filename": "meta/main.yml", "previous_filename": null, "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Icinga/ansible-icinga2/blob/d2c53070e481259c0099d42d572b85fa8cf8af63/meta/main.yml", "raw_url": "https://github.com/Icinga/ansible-icinga2/raw/d2c53070e481259c0099d42d572b85fa8cf8af63/meta/main.yml", "status": "modified", "patch": "@@ -18,8 +18,6 @@ galaxy_info:\n       versions:\n         - 16.04\n         - 18.04\n-  categories:\n-    - system\n   galaxy_tags:\n     - monitoring\n     - icinga"}, {"sha": "4a5d52cdd9edbdd0a6cebd9e25727615d4ce6434", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Icinga/ansible-icinga2/blob/d2c53070e481259c0099d42d572b85fa8cf8af63/tasks/main.yml", "raw_url": "https://github.com/Icinga/ansible-icinga2/raw/d2c53070e481259c0099d42d572b85fa8cf8af63/tasks/main.yml", "status": "modified", "patch": "@@ -1,6 +1,6 @@\n ---\n - name: Include OS specific vars\n-  include_vars: \"{{ansible_os_family}}.yml\"\n+  include_vars: \"{{ ansible_os_family }}.yml\"\n   tags:\n     - feature-handler\n     - config"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #51", "sha": "d7fbb1f61d1191166152acc249d0e910859619ca", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/d7fbb1f61d1191166152acc249d0e910859619ca", "parents": ["d6e8fe0dad9afc88eb88e0e34a7607042552df74"], "files": [{"sha": "e3c641e09c82d2eed0ed5605d56432f9ab603515", "filename": "tasks/compatibility-checks.yml", "previous_filename": null, "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/d7fbb1f61d1191166152acc249d0e910859619ca/tasks/compatibility-checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/d7fbb1f61d1191166152acc249d0e910859619ca/tasks/compatibility-checks.yml", "status": "modified", "patch": "@@ -8,6 +8,7 @@\n       and `live-restore=true` (docker_daemon_config['live-restore']: true)\n       triggers a bug (https://github.com/moby/moby/issues/35873). For now,\n       don't use both.\n-  when: docker_enable_mount_flag_fix\n-        and (docker_daemon_config['live-restore'] is defined\n-        and docker_daemon_config['live-restore'])\n+  when:\n+    - docker_enable_mount_flag_fix\n+    - docker_daemon_config['live-restore'] is defined\n+    - docker_daemon_config['live-restore']"}, {"sha": "c5d463dcd3632f0b0f9fe7cea264276b11435e81", "filename": "tasks/bug-tweaks.yml", "previous_filename": null, "additions": 35, "deletions": 2, "changes": 37, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/d7fbb1f61d1191166152acc249d0e910859619ca/tasks/bug-tweaks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/d7fbb1f61d1191166152acc249d0e910859619ca/tasks/bug-tweaks.yml", "status": "modified", "patch": "@@ -1,5 +1,5 @@\n-# Configuration to avoid 'Device or resource busy'\n-- block:\n+- name: Configuration to avoid 'Device or resource busy'\n+  block:\n   - name: Stat /proc/sys/fs/may_detach_mounts (CentOS/RedHat)\n     stat:\n       path: /proc/sys/fs/may_detach_mounts\n@@ -32,3 +32,36 @@\n     - _docker_os_dist == \"CentOS\" or _docker_os_dist == \"RedHat\"\n     - docker_enable_mount_flag_fix | bool\n     - ansible_kernel | version_compare('4', '<')\n+\n+- name: Best effort handling to directlvm for Debian 8 to get uniform behavior across distributions\n+  block:\n+  - name: Create LVM thinpool for Docker according to Docker documentation\n+    include_tasks: lvm-thinpool.yml\n+    vars:\n+      pool:\n+        name: thinpool\n+        volume_group: docker\n+        physical_volumes: \"{{ docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+') | list | regex_replace('dm.directlvm_device=\\\\s*(.+)', '\\\\1') }}\"\n+        metadata_size: \"1%VG\"\n+        data_size: \"95%VG\"\n+\n+  - name: Modify storage-opts to handle problems with thinpool on Debian 8\n+    set_fact:\n+      _modified_storage_config: \"{{ (docker_daemon_config['storage-opts'] | difference(_exclusions)) + ['dm.thinpooldev=/dev/mapper/docker-thinpool-tpool'] }}\"\n+    vars:\n+      _exclusions: \"{{ docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+') | list }}\"\n+\n+  - name: Update Docker daemon configuration to handle consistency between distributions\n+    set_fact:\n+      docker_daemon_config: \"{{ docker_daemon_config | combine(_updated_item, recursive=true) }}\"\n+    vars:\n+      _updated_item: \"{ 'storage-opts': {{ _modified_storage_config }} }\"\n+\n+  - name: Updated Docker daemon configuration\n+    debug:\n+      var: docker_daemon_config\n+  when:\n+    - _docker_os_dist == \"Debian\"\n+    - _docker_os_dist_major_version == '8'\n+    - docker_daemon_config['storage-opts'] is defined\n+    - docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+')"}]}, {"repo": "kubevirt/kubevirt-ansible", "author_id": "MDQ6VXNlcjE0MTg3MzQ=", "author_name": "Guohua Ouyang", "committer_id": "MDQ6VXNlcjYzMTkxOTg=", "committer_name": "Irina", "committer_email": "alexxa@users.noreply.github.com", "message": "Fix deploy kubernetes cluster issues (#161)\n\n* Move 'remove firewalld' task after 'stop and disable firewalld' task\r\n* Change flag --skip-preflight-checks to --ignore-preflight-errors=all\r\n* Change the command cp kubeconfig to scp, so it wouldn't fail\r\n* Remove update_cache from package manager as it's not working on Fedora\r\n* Disable epel repo for Fedora\r\n* Fix Kubeadm join, fix #89\r\n\r\nSigned-off-by: Guohua Ouyang <guohuaouyang@gmail.com>", "sha": "10e583062151370dde3007b1e7e5b057d1bea737", "url": "https://api.github.com/repos/kubevirt/kubevirt-ansible/commits/10e583062151370dde3007b1e7e5b057d1bea737", "parents": ["58949cbe8ec04e85ec451ecbc66f1c85f64a8eb7"], "files": [{"sha": "1ddb063a69569dd468ec6c3697a45b9d0f350ec8", "filename": "roles/kubernetes-master/tasks/main.yml", "previous_filename": null, "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/10e583062151370dde3007b1e7e5b057d1bea737/roles/kubernetes-master/tasks/main.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/10e583062151370dde3007b1e7e5b057d1bea737/roles/kubernetes-master/tasks/main.yml", "status": "modified", "patch": "@@ -3,7 +3,6 @@\n   package:\n     name: \"{{ item }}\"\n     state: present\n-    update_cache: yes\n   with_items:\n     - cockpit\n     - cockpit-kubernetes"}, {"sha": "ba3e5cc9fca297d8cf0a0a1da8aec085abf79cbb", "filename": "roles/kubernetes-prerequisites/tasks/main.yml", "previous_filename": null, "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/10e583062151370dde3007b1e7e5b057d1bea737/roles/kubernetes-prerequisites/tasks/main.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/10e583062151370dde3007b1e7e5b057d1bea737/roles/kubernetes-prerequisites/tasks/main.yml", "status": "modified", "patch": "@@ -7,11 +7,6 @@\n     policy: targeted\n     state: permissive\n \n-- name: remove firewalld package\n-  package:\n-    name: firewalld\n-    state: absent\n-\n - name: stop and disable firewalld\n   register: result\n   service:\n@@ -20,6 +15,11 @@\n     name: firewalld\n   failed_when: \"result|failed and not 'Could not find the requested service' in result.msg\"\n \n+- name: remove firewalld package\n+  package:\n+    name: firewalld\n+    state: absent\n+\n - name: Remove current swaps from fstab\n   lineinfile:\n     dest: /etc/fstab\n@@ -34,6 +34,8 @@\n   package:\n     name: \"{{ epel_repo_rpm }}\"\n     state: present\n+  when:\n+    - ansible_distribution in [\"CentOS\",\"RedHat\"]\n \n - name: import kubernetes rpm keys\n   rpm_key:\n@@ -59,7 +61,6 @@\n   package: \n     name: \"{{ item }}\"\n     state: present\n-    update_cache: yes\n   with_items:\n     - \"{{ kubernetes_packages }}\"\n "}, {"sha": "146a4a65f71bdd17b8977ec1e648efc99bb49f80", "filename": "roles/kubernetes-node/tasks/main.yml", "previous_filename": null, "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/10e583062151370dde3007b1e7e5b057d1bea737/roles/kubernetes-node/tasks/main.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/10e583062151370dde3007b1e7e5b057d1bea737/roles/kubernetes-node/tasks/main.yml", "status": "modified", "patch": "@@ -1,4 +1,7 @@\n ---\n-- name: deploy host as kubernetes node\n-  command: \"kubeadm join --token {{ kubernetes_token }} {{ groups['masters'][0] }}:6443 --skip-preflight-checks\"\n+- name: retrieve token ca cert hash\n+  shell: openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'\n+  register: sha\n \n+- name: deploy host as kubernetes node\n+  command: \"kubeadm join --token {{ kubernetes_token }} {{ groups['masters'][0] }}:6443 --discovery-token-ca-cert-hash sha256:{{sha.stdout}} --ignore-preflight-errors=all\""}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #77: Change behavior of solr_remove_cruft so it works on Solr < 5.", "sha": "c0bf4b7577771e6d9cd9f162e7588a1a8f8e302e", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/c0bf4b7577771e6d9cd9f162e7588a1a8f8e302e", "parents": ["efc7a259af6812ee966a7809e84684ebf8b5f52c"], "files": [{"sha": "f5a87e55e4826da242a3d88e68d40227bd28f115", "filename": "tasks/trim-fat.yml", "previous_filename": null, "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/c0bf4b7577771e6d9cd9f162e7588a1a8f8e302e/tasks/trim-fat.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/c0bf4b7577771e6d9cd9f162e7588a1a8f8e302e/tasks/trim-fat.yml", "status": "modified", "patch": "@@ -7,11 +7,16 @@\n     - \"{{ solr_workspace }}/{{ solr_filename }}.tgz\"\n     - \"{{ solr_workspace }}/{{ solr_filename }}\"\n \n-- name: Remove extra cruft, if configured.\n+- name: Remove docs, if not needed.\n   file:\n-    path: \"{{ item }}\"\n+    path: \"{{ solr_install_path }}/docs\"\n     state: absent\n-  with_items:\n-    - \"{{ solr_install_path }}/docs\"\n-    - \"{{ solr_install_path }}/example\"\n   when: solr_remove_cruft\n+\n+- name: Remove example dir, if not needed.\n+  file:\n+    path: \"{{ solr_install_path }}/example\"\n+    state: absent\n+  when:\n+    - solr_remove_cruft\n+    - solr_version.split('.')[0] >= '5'"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #25: Add ability to create cores if they don't exist.", "sha": "e178ea22df7fe951770beedfd5b0968a76cc190c", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/e178ea22df7fe951770beedfd5b0968a76cc190c", "parents": ["4ca11b1b8a6adeb3cf2e68b559f85def2aee67de"], "files": [{"sha": "dced2319cf6c193d9d31a5085a3b11c8c3ae3cac", "filename": "tasks/main.yml", "previous_filename": null, "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/e178ea22df7fe951770beedfd5b0968a76cc190c/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/e178ea22df7fe951770beedfd5b0968a76cc190c/tasks/main.yml", "status": "modified", "patch": "@@ -38,3 +38,7 @@\n     name: \"{{ solr_service_name }}\"\n     state: started\n     enabled: yes\n+\n+# Create cores, if any are configured.\n+- include: cores.yml\n+  when: \"solr_cores and solr_version.split('.')[0] >= '5'\""}]}, {"repo": "dev-sec/ansible-os-hardening", "author_id": null, "author_name": "Sebastian Gumprich", "committer_id": null, "committer_name": "Sebastian Gumprich", "committer_email": "sebastian.gumprich@38.de", "message": "fix wrong permissions passwdqc #170", "sha": "b7c6bfe0369646ca69beeb3dfe07e8218d61c940", "url": "https://api.github.com/repos/dev-sec/ansible-os-hardening/commits/b7c6bfe0369646ca69beeb3dfe07e8218d61c940", "parents": ["f4408034296e2e7cf358226617b514c0a1101b93"], "files": [{"sha": "ed0423a016b37fa31f3fb5bd160c11e90a007c5b", "filename": "tasks/pam.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/dev-sec/ansible-os-hardening/blob/b7c6bfe0369646ca69beeb3dfe07e8218d61c940/tasks/pam.yml", "raw_url": "https://github.com/dev-sec/ansible-os-hardening/raw/b7c6bfe0369646ca69beeb3dfe07e8218d61c940/tasks/pam.yml", "status": "modified", "patch": "@@ -35,7 +35,7 @@\n   template:\n     src: 'pam_passwdqc.j2'\n     dest: '{{ passwdqc_path }}'\n-    mode: '0640'\n+    mode: '0644'\n     owner: 'root'\n     group: 'root'\n   when: (ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu') and os_auth_pam_passwdqc_enable\n@@ -56,7 +56,7 @@\n   template:\n     src: 'pam_tally2.j2'\n     dest: '{{ tally2_path }}'\n-    mode: '0640'\n+    mode: '0644'\n     owner: 'root'\n     group: 'root'\n   when: (ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu') and not os_auth_pam_passwdqc_enable and os_auth_retries > 0"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #612 - Bump nginx_fastcgi_buffer_size\n\n`admin-ajax.php` apparently causes huge headers causing Nginx errors:\n\n> upstream sent too big header while reading response header from upstream\n\nBumping this default value to `8k` fixes the issues.", "sha": "abea208185e564ce65fb484649d2dfa954f5178d", "url": "https://api.github.com/repos/roots/trellis/commits/abea208185e564ce65fb484649d2dfa954f5178d", "parents": ["9f7db4c7fa5139db661f39663d3e51f292f7d0c8"], "files": [{"sha": "0f63702625efad23d4a420735c8661d89a421873", "filename": "roles/nginx/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/abea208185e564ce65fb484649d2dfa954f5178d/roles/nginx/defaults/main.yml", "raw_url": "https://github.com/roots/trellis/raw/abea208185e564ce65fb484649d2dfa954f5178d/roles/nginx/defaults/main.yml", "status": "modified", "patch": "@@ -3,7 +3,7 @@ nginx_path: /etc/nginx\n nginx_logs_root: /var/log/nginx\n nginx_user: www-data\n nginx_fastcgi_buffers: 8 8k\n-nginx_fastcgi_buffer_size: 4k\n+nginx_fastcgi_buffer_size: 8k\n nginx_ssl_path: \"{{ nginx_path }}/ssl\"\n \n # HSTS defaults"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #550 - Properly skip permalink setup for MU", "sha": "3cad79f7ded349127fa0d183402e5c35b10d0f37", "url": "https://api.github.com/repos/roots/trellis/commits/3cad79f7ded349127fa0d183402e5c35b10d0f37", "parents": ["9527520e6647e4b7708689c48d42fe928a7e7c68"], "files": [{"sha": "cb5999a3b9fb349dbbd12c78744a1583b3a34dee", "filename": "roles/wordpress-install/tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/roots/trellis/blob/3cad79f7ded349127fa0d183402e5c35b10d0f37/roles/wordpress-install/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/3cad79f7ded349127fa0d183402e5c35b10d0f37/roles/wordpress-install/tasks/main.yml", "status": "modified", "patch": "@@ -40,12 +40,11 @@\n   changed_when: \"'WordPress is already installed.' not in wp_install_results.stdout\"\n \n - name: Setup Permalink Structure\n-  command: wp rewrite structure {{ item.value.initial_permalink_structure | default(\"/%postname%/\") }}\n-           --allow-root\n+  command: wp rewrite structure {{ item.value.initial_permalink_structure | default(\"/%postname%/\") }} --allow-root\n   args:\n     chdir: \"{{ www_root }}/{{ item.key }}/current/\"\n   with_dict: \"{{ wordpress_sites }}\"\n-  when: wp_install_results | changed and not wp_install_results | skipped\n+  when: wp_install_results | changed and not item.value.multisite.enabled | default(false)\n \n - name: Install WP Multisite\n   command: wp core multisite-install"}]}, {"repo": "geerlingguy/ansible-role-security", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #54: Just start the timer, not the service.", "sha": "4bf582e8a87813ddd8024a8bd41d4032e6641bbd", "url": "https://api.github.com/repos/geerlingguy/ansible-role-security/commits/4bf582e8a87813ddd8024a8bd41d4032e6641bbd", "parents": ["f3dd45a61b08de1b3351140cc442a705cb2fad82"], "files": [{"sha": "bb4e615c2f2efd283132f1c3cd606942e1d5a60d", "filename": "tasks/autoupdate-RedHat.yml", "previous_filename": null, "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/geerlingguy/ansible-role-security/blob/4bf582e8a87813ddd8024a8bd41d4032e6641bbd/tasks/autoupdate-RedHat.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-security/raw/4bf582e8a87813ddd8024a8bd41d4032e6641bbd/tasks/autoupdate-RedHat.yml", "status": "modified", "patch": "@@ -2,12 +2,14 @@\n - name: Set correct automatic update utility vars (RHEL 8).\n   set_fact:\n     update_utility: dnf-automatic\n+    update_service: dnf-automatic-install.timer\n     update_conf_path: /etc/dnf/automatic.conf\n   when: ansible_distribution_major_version | int == 8\n \n - name: Set correct automatic update utility vars (RHEL <= 7).\n   set_fact:\n     update_utility: yum-cron\n+    update_service: yum-cron\n     update_conf_path: /etc/yum/yum-cron.conf\n   when: ansible_distribution_major_version | int <= 7\n \n@@ -18,7 +20,7 @@\n \n - name: Ensure automatic update utility is running and enabled on boot.\n   service:\n-    name: '{{ update_utility }}'\n+    name: '{{ update_service }}'\n     state: started\n     enabled: true\n "}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #52: Solr 6.3.0 temporary files permissions fix.", "sha": "8697b27085612cde54f2a9486f00e3d1b996a8f4", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/8697b27085612cde54f2a9486f00e3d1b996a8f4", "parents": ["dbb2cd21013287aab42227b0ea14184ec53971c4"], "files": [{"sha": "aa32ea430b8f0dfdd6c46e29e7c90543c6a83dc9", "filename": "tasks/install.yml", "previous_filename": null, "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/8697b27085612cde54f2a9486f00e3d1b996a8f4/tasks/install.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/8697b27085612cde54f2a9486f00e3d1b996a8f4/tasks/install.yml", "status": "modified", "patch": "@@ -3,6 +3,9 @@\n   yum: name=lsof state=present\n   when: ansible_os_family == \"RedHat\"\n \n+- name: Ensure setfacl support is present.\n+  package: name=acl state=present\n+\n - name: Run Solr installation script.\n   shell: >\n     {{ solr_workspace }}/{{ solr_filename }}/bin/install_solr_service.sh"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #17", "sha": "41231a43e2531086c3fb9f7499cbc44aacbe7792", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/41231a43e2531086c3fb9f7499cbc44aacbe7792", "parents": ["dfc0ba24f91ba11cb33f713bd44c861c8070c006"], "files": [{"sha": "d8e42a7b6123f8b4f98df13ed0207bd0c30c3420", "filename": "tasks/main-Generic.yml", "previous_filename": null, "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/41231a43e2531086c3fb9f7499cbc44aacbe7792/tasks/main-Generic.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/41231a43e2531086c3fb9f7499cbc44aacbe7792/tasks/main-Generic.yml", "status": "modified", "patch": "@@ -55,10 +55,15 @@\n     - docker-selinux\n     - docker-engine\n \n-- name: Ensure docker-ce is the latest version\n+- name: Set docker-ce package state to latest\n+  set_fact:\n+    docker_pkg_state: 'latest'\n+  when: docker_latest_version|bool\n+\n+- name: Ensure docker-ce is installed\n   package:\n     name: docker-ce\n-    state: latest\n+    state: \"{{ docker_pkg_state|default('present') }}\"\n   become: true\n   notify: restart docker\n "}]}, {"repo": "nginxinc/ansible-role-nginx", "author_id": "MDQ6VXNlcjE1NjU0NTI1", "author_name": "Alessandro Fael Garcia", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix OSS Alpine installation and add Alpine test coverage (#190)", "sha": "59e0170313922c2092ea9754f7f89914ac359c4b", "url": "https://api.github.com/repos/nginxinc/ansible-role-nginx/commits/59e0170313922c2092ea9754f7f89914ac359c4b", "parents": ["16f21c5c7c51314eea1d023a46bcaad8c889cd46"], "files": [{"sha": "a7f9bd3443c924e20ee75efac6f11b1b132fd1d9", "filename": "tasks/opensource/setup-suse.yml", "previous_filename": null, "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/setup-suse.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/setup-suse.yml", "status": "modified", "patch": "@@ -1,5 +1,15 @@\n ---\n+- name: \"(Install: SUSE) Set Default SUSE NGINX Repository\"\n+  set_fact:\n+    default_repository: >-\n+      https://nginx.org/packages/{{ (nginx_branch == 'mainline')\n+      | ternary('mainline/', '') }}sles/{{ ansible_distribution_major_version }}\n+\n+- name: \"(Install: SUSE) Set SUSE NGINX Repository\"\n+  set_fact:\n+    repository: \"{{ nginx_repository | default(default_repository) }}\"\n+\n - name: \"(Install: SUSE) Add NGINX Repository\"\n   zypper_repository:\n     name: \"nginx-{{ nginx_branch }}\"\n-    repo: \"{{ nginx_repository.suse }}\"\n+    repo: \"{{ repository }}\""}, {"sha": "be74eb98fd7d419ba65eff68e0a89ea8c4a88630", "filename": "tasks/plus/install-plus.yml", "previous_filename": null, "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/plus/install-plus.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/plus/install-plus.yml", "status": "modified", "patch": "@@ -1,21 +1,21 @@\n ---\n - import_tasks: setup-license.yml\n \n+- import_tasks: setup-alpine.yml\n+  when: ansible_os_family == \"Alpine\"\n+\n - import_tasks: setup-debian.yml\n   when: ansible_os_family == \"Debian\"\n \n+- import_tasks: setup-freebsd.yml\n+  when: ansible_os_family == \"FreeBSD\"\n+\n - import_tasks: setup-redhat.yml\n   when: ansible_os_family == \"RedHat\"\n \n - import_tasks: setup-suse.yml\n   when: ansible_os_family == \"Suse\"\n \n-- import_tasks: setup-freebsd.yml\n-  when: ansible_os_family == \"FreeBSD\"\n-\n-- import_tasks: setup-alpine.yml\n-  when: ansible_os_family == \"Alpine\"\n-\n - name: \"(Install: All OSs) Install NGINX Plus\"\n   package:\n     name: \"nginx-plus{{ nginx_version | default('') }}\""}, {"sha": "51364af265aa8169ed509cfb0fc9c6daa26382a5", "filename": "tasks/opensource/setup-redhat.yml", "previous_filename": null, "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/setup-redhat.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/setup-redhat.yml", "status": "modified", "patch": "@@ -1,8 +1,19 @@\n ---\n+- name: \"(Install: CentOS/RedHat) Set Default YUM NGINX Repository\"\n+  set_fact:\n+    default_repository: >-\n+      https://nginx.org/packages/{{ (nginx_branch == 'mainline')\n+      | ternary('mainline/', '') }}{{ (ansible_distribution == \"RedHat\")\n+      | ternary('rhel', 'centos') }}/{{ ansible_distribution_major_version }}/$basearch/\n+\n+- name: \"(Install: CentOS/RedHat) Set YUM NGINX Repository\"\n+  set_fact:\n+    repository: \"{{ nginx_repository | default(default_repository) }}\"\n+\n - name: \"(Install: CentOS/RedHat) Add NGINX Repository\"\n   yum_repository:\n     name: nginx\n-    baseurl: \"{{ nginx_repository.redhat }}\"\n+    baseurl: \"{{ repository }}\"\n     description: NGINX Repository\n     enabled: yes\n     gpgcheck: yes"}, {"sha": "3b6046f610f61aa717ed7fe4fb4b4f11e2dce4ca", "filename": "tasks/opensource/setup-debian.yml", "previous_filename": null, "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/setup-debian.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/setup-debian.yml", "status": "modified", "patch": "@@ -1,6 +1,20 @@\n ---\n+- name: \"(Install: Debian/Ubuntu) Set Default APT NGINX Repository\"\n+  set_fact:\n+    default_repository:\n+      - >-\n+        deb https://nginx.org/packages/{{ (nginx_branch == 'mainline')\n+        | ternary('mainline/', '') }}{{ ansible_distribution | lower }}/ {{ ansible_distribution_release }} nginx\n+      - >-\n+        deb-src https://nginx.org/packages/{{ (nginx_branch == 'mainline')\n+        | ternary('mainline/', '') }}{{ ansible_distribution | lower }}/ {{ ansible_distribution_release }} nginx\n+\n+- name: \"(Install: Debian/Ubuntu) Set APT NGINX Repository\"\n+  set_fact:\n+    repository: \"{{ nginx_repository | default(default_repository) }}\"\n+\n - name: \"(Install: Debian/Ubuntu) Add NGINX Repository\"\n   apt_repository:\n     repo: \"{{ item }}\"\n   with_items:\n-    - \"{{ nginx_repository.debian }}\"\n+    - \"{{ repository }}\""}, {"sha": "131634d4e614066337dd36ba981b9bd9f36358f2", "filename": "tasks/keys/apk-key.yml", "previous_filename": null, "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/keys/apk-key.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/keys/apk-key.yml", "status": "modified", "patch": "@@ -1,5 +1,13 @@\n ---\n+- name: \"(Install: APK OSs) Set Default APK NGINX Signing Key URL\"\n+  set_fact:\n+    default_keysite: https://nginx.org/keys/nginx_signing.rsa.pub\n+\n+- name: \"(Install: APK OSs) Set APK NGINX Signing Key URL\"\n+  set_fact:\n+    keysite: \"{{ nginx_signing_key | default(default_keysite) }}\"\n+\n - name: \"(Install: APK OSs) Download NGINX Signing Key\"\n   get_url:\n-    url: https://nginx.org/keys/nginx_signing.rsa.pub\n+    url: \"{{ keysite }}\"\n     dest: /etc/apk/keys/nginx_signing.rsa.pub"}, {"sha": "86e4d001ad3be37722b87d1eb25e81a6f1ae1885", "filename": "tasks/opensource/setup-alpine.yml", "previous_filename": null, "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/setup-alpine.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/setup-alpine.yml", "status": "modified", "patch": "@@ -1,6 +1,16 @@\n ---\n-- name: \"(Install: Alpine Linux) Add NGINX Plus Repository\"\n+- name: \"(Install: Alpine) Set Default APK NGINX Repository\"\n+  set_fact:\n+    default_repository: >-\n+      https://nginx.org/packages/{{ (nginx_branch == 'mainline')\n+      | ternary('mainline/', '') }}alpine/v{{ ansible_distribution_version.split('.')[0] }}.{{ ansible_distribution_version.split('.')[1] }}/main\n+\n+- name: \"(Install: Alpine) Set APK NGINX Repository\"\n+  set_fact:\n+    repository: \"{{ nginx_repository | default(default_repository) }}\"\n+\n+- name: \"(Install: Alpine) Add NGINX Repository\"\n   lineinfile:\n     path: /etc/apk/repositories\n     insertafter: EOF\n-    line: \"{{ nginx_repository.alpine }}\"\n+    line: \"{{ repository }}\""}, {"sha": "2650b16e6e9a8f1fffc59d20b7fef13e9655bf24", "filename": "tasks/opensource/install-oss-linux.yml", "previous_filename": null, "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/nginxinc/ansible-role-nginx/blob/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/install-oss-linux.yml", "raw_url": "https://github.com/nginxinc/ansible-role-nginx/raw/59e0170313922c2092ea9754f7f89914ac359c4b/tasks/opensource/install-oss-linux.yml", "status": "modified", "patch": "@@ -2,6 +2,9 @@\n - name: \"(Install: Linux) Configure NGINX repo\"\n   block:\n \n+    - import_tasks: setup-alpine.yml\n+      when: ansible_os_family == \"Alpine\"\n+\n     - import_tasks: setup-debian.yml\n       when: ansible_os_family == \"Debian\"\n "}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes related to #82", "sha": "c0180d4afa36d233a6d3235cd38d7bbc6574d5d4", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/c0180d4afa36d233a6d3235cd38d7bbc6574d5d4", "parents": ["bd5f2bd7a5d4f8c53cef80a1c2acd56be758bea0"], "files": [{"sha": "1221fb50b46231b5ddfd5524377442629d4be9a4", "filename": "tasks/remove-docker.yml", "previous_filename": "tasks/uninstall-docker.yml", "additions": 23, "deletions": 12, "changes": 35, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c0180d4afa36d233a6d3235cd38d7bbc6574d5d4/tasks/remove-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c0180d4afa36d233a6d3235cd38d7bbc6574d5d4/tasks/remove-docker.yml", "status": "renamed", "patch": "@@ -32,10 +32,13 @@\n \n - name: Remove network interface docker0\n   become: yes\n-  net_interface:\n-    name: docker0\n-    state: absent\n+  command: ip link del docker0\n+  args:\n+    warn: no\n   ignore_errors: yes\n+  changed_when: no\n+  tags:\n+    - skip_ansible_lint\n \n - name: Remove dockerd from alternatives configuration\n   become: yes\n@@ -46,6 +49,7 @@\n     - skip_ansible_lint\n \n - name: Clean yum cache (CentOS/RedHat)\n+  become: yes\n   command: yum clean all --enablerepo=\\*\n   args:\n     warn: no\n@@ -71,37 +75,44 @@\n     - skip_ansible_lint\n \n - name: Remove repository docker specific repo file\n+  become: yes\n   yum_repository:\n     name: docker-ce\n     file: docker-ce\n     state: absent\n   when: _docker_os_dist != \"Ubuntu\" and\n         _docker_os_dist != \"Debian\"\n \n-- name: Ensure additional files and directories managed by this roles are removed\n+- name: Ensure Docker CE and configuration files are removed\n   become: yes\n   file:\n     path: \"{{ item }}\"\n     state: absent\n   with_items:\n-    # centos\n+    # all distributions\n     - \"{{ docker_envs_dir[_docker_os_dist] }}/docker\"\n     - \"{{ docker_envs_dir[_docker_os_dist] }}/docker-envs\"\n-    - /etc/yum.repos.d/docker-ce.repo\n     - /etc/audit/rules.d/docker.rules\n+    # centos\n+    - /etc/yum.repos.d/docker-ce.repo\n     - /etc/systemd/system/docker.service.d\n     - /etc/docker\n     - /usr/bin/dockerd\n-    - /var/lib/docker\n-    - /var/lib/docker-engine\n     - /run/docker\n-    - /var/lib/yum/repos/x86_64/7/docker-ce-test\n-    - /var/lib/yum/repos/x86_64/7/docker-ce-edge\n-    - /var/lib/yum/repos/x86_64/7/docker-ce-nightly\n-    - /var/lib/yum/repos/x86_64/7/docker-ce-stable\n     # ubuntu/debian\n     - /etc/apt/sources.list.d/docker-ce.list\n \n+- name: Ensure additional files and data directories are removed\n+  become: yes\n+  file:\n+    path: \"{{ item }}\"\n+    state: absent\n+  with_items:\n+    - /var/lib/docker\n+    - /var/lib/docker-engine\n+    - \"{{ docker_remove_additional }}\"\n+  when: docker_remove_all | bool\n+\n - name: Find Docker related diretories in package cache\n   become: yes\n   find:"}, {"sha": "8599f426b7eee38f44c54346cace058c6c28f1c2", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c0180d4afa36d233a6d3235cd38d7bbc6574d5d4/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c0180d4afa36d233a6d3235cd38d7bbc6574d5d4/tasks/main.yml", "status": "modified", "patch": "@@ -75,5 +75,5 @@\n   when: not docker_remove | bool\n \n - name: Remove Docker CE and related configuration\n-  include_tasks: uninstall-docker.yml\n+  include_tasks: remove-docker.yml\n   when: docker_remove | bool"}]}, {"repo": "ansible-ThoTeam/nexus3-oss", "author_id": "MDQ6VXNlcjE3Njc3Ng==", "author_name": "Olivier Clavel", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #104 from zeitounator/fix/restartOnPreextractedUpgrade\n\nMake sure nexus is restarted on several config/upgrade changes\r\nFixes #98", "sha": "e14b5a521cae632ac6866ce9200d703b8e700e9d", "url": "https://api.github.com/repos/ansible-ThoTeam/nexus3-oss/commits/e14b5a521cae632ac6866ce9200d703b8e700e9d", "parents": ["5404962535c1adcfe95bff1536d60dc05fa32e0c", "fb558b94ed9a8daeacd2b314a99610d3feefb124"], "files": [{"sha": "cc88f95da826ef0c94fad4097d41511be3143510", "filename": "tasks/nexus_install.yml", "previous_filename": null, "additions": 22, "deletions": 2, "changes": 24, "blob_url": "https://github.com/ansible-ThoTeam/nexus3-oss/blob/e14b5a521cae632ac6866ce9200d703b8e700e9d/tasks/nexus_install.yml", "raw_url": "https://github.com/ansible-ThoTeam/nexus3-oss/raw/e14b5a521cae632ac6866ce9200d703b8e700e9d/tasks/nexus_install.yml", "status": "modified", "patch": "@@ -66,8 +66,6 @@\n   notify:\n     - nexus-service-stop\n \n-- meta: flush_handlers\n-\n - name: Update symlink nexus-latest\n   file:\n     path: \"{{ nexus_installation_dir }}/nexus-latest\"\n@@ -77,6 +75,10 @@\n     state: link\n     follow: false\n   register: nexus_latest_version\n+  notify:\n+    - nexus-service-stop\n+\n+- meta: flush_handlers\n \n - name: Delete unpacked data directory\n   file:\n@@ -157,18 +159,24 @@\n     dest: \"{{ nexus_installation_dir }}/nexus-latest/bin/nexus.vmoptions\"\n     regexp: \"^-Dkaraf.data=.*\"\n     line: \"-Dkaraf.data={{ nexus_data_dir }}\"\n+  notify:\n+    - nexus-service-stop\n \n - name: Setup JVM logfile directory\n   lineinfile:\n     dest: \"{{ nexus_installation_dir }}/nexus-latest/bin/nexus.vmoptions\"\n     regexp: \"^-XX:LogFile=.*\"\n     line: \"-XX:LogFile={{ nexus_data_dir }}/log/jvm.log\"\n+  notify:\n+    - nexus-service-stop\n \n - name: Setup Nexus default timezone\n   lineinfile:\n     dest: \"{{ nexus_installation_dir }}/nexus-latest/bin/nexus.vmoptions\"\n     regexp: \"^-Duser.timezone=.*\"\n     line: \"-Duser.timezone={{ nexus_timezone }}\"\n+  notify:\n+    - nexus-service-stop\n \n - name: Setup Nexus JVM min heap size\n   lineinfile:\n@@ -206,37 +214,49 @@\n     dest: \"{{ nexus_installation_dir }}/nexus-latest/bin/nexus.vmoptions\"\n     regexp: \"^-Djava.io.tmpdir=.*\"\n     line: \"-Djava.io.tmpdir={{ nexus_tmp_dir }}\"\n+  notify:\n+    - nexus-service-stop\n \n - name: Set NEXUS_HOME for the service user\n   lineinfile:\n     dest: \"/home/{{ nexus_os_user }}/.bashrc\"\n     regexp: \"^export NEXUS_HOME=.*\"\n     line: \"export NEXUS_HOME={{ nexus_installation_dir }}/nexus-latest\"\n+  notify:\n+    - nexus-service-stop\n \n - name: Set nexus user\n   lineinfile:\n     dest: \"{{ nexus_installation_dir }}/nexus-latest/bin/nexus.rc\"\n     regexp: \".*run_as_user=.*\"\n     line: \"run_as_user=\\\"{{ nexus_os_user }}\\\"\"\n+  notify:\n+    - nexus-service-stop\n \n - name: Set nexus port\n   lineinfile:\n     dest: \"{{ nexus_default_settings_file }}\"\n     regexp: \"^application-port=.*\"\n     line: \"application-port={{ nexus_default_port }}\"\n+  notify:\n+    - nexus-service-stop\n \n - name: Set nexus context path\n   lineinfile:\n     dest: \"{{ nexus_default_settings_file }}\"\n     regexp: \"^nexus-context-path=.*\"\n     line: \"nexus-context-path={{ nexus_default_context_path }}\"\n+  notify:\n+    - nexus-service-stop\n \n - name: Bind nexus service to 127.0.0.1 only\n   lineinfile:\n     dest: \"{{ nexus_default_settings_file }}\"\n     regexp: \"^application-host=.*\"\n     line: \"application-host=127.0.0.1\"\n   when: httpd_setup_enable\n+  notify:\n+    - nexus-service-stop\n \n - name: Create systemd service configuration\n   template:"}]}, {"repo": "NVIDIA/deepops", "author_id": "MDQ6VXNlcjY4NzI2OQ==", "author_name": "Luke Yeager", "committer_id": "MDQ6VXNlcjEwMzQzMA==", "committer_name": "Doug Holt", "committer_email": "doug.holt@gmail.com", "message": "Fix driver PPA package names (#79)\n\nFixes error introduced by 7ef791f4cb0fe65aad3a058ee28fd31a43cd1e96", "sha": "644a9dba5ad3bd7893f83918671aa9de4e0832bb", "url": "https://api.github.com/repos/NVIDIA/deepops/commits/644a9dba5ad3bd7893f83918671aa9de4e0832bb", "parents": ["2019d9b0edf0e1abf7a09f56904b7f06f2ed1a13"], "files": [{"sha": "d1e8d279f6ae99e27d7b068981f8fc586c08c734", "filename": "playbooks/nvidia-gpu-driver.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/NVIDIA/deepops/blob/644a9dba5ad3bd7893f83918671aa9de4e0832bb/playbooks/nvidia-gpu-driver.yml", "raw_url": "https://github.com/NVIDIA/deepops/raw/644a9dba5ad3bd7893f83918671aa9de4e0832bb/playbooks/nvidia-gpu-driver.yml", "status": "modified", "patch": "@@ -20,8 +20,8 @@\n         update_cache: yes\n         cache_valid_time: 3600\n         state: latest\n-      with_items:\n-        - nvidia-410\n+      # The PPA has different package names for different distros\n+      with_items: \"{{ (ansible_facts['distribution_major_version'] == '18') | ternary(['nvidia-driver-410', 'nvidia-utils-410'], 'nvidia-410') }}\"\n     - name: load nvidia driver\n       modprobe:\n         name: nvidia"}]}, {"repo": "geerlingguy/ansible-role-security", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #8: Syntax error when adding accounts to passworded sudoers.", "sha": "3390a4e60b049970ffa25f1e3eb27312a1be9349", "url": "https://api.github.com/repos/geerlingguy/ansible-role-security/commits/3390a4e60b049970ffa25f1e3eb27312a1be9349", "parents": ["cbc033321e72fba149274586a87ed1e0d697defd"], "files": [{"sha": "47be08cf1561963cbd52f10c1962726f8268f3e1", "filename": "tasks/ssh.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/geerlingguy/ansible-role-security/blob/3390a4e60b049970ffa25f1e3eb27312a1be9349/tasks/ssh.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-security/raw/3390a4e60b049970ffa25f1e3eb27312a1be9349/tasks/ssh.yml", "status": "modified", "patch": "@@ -28,7 +28,7 @@\n   lineinfile:\n     dest: /etc/sudoers\n     regexp: '^{{ item }}'\n-    line: '{{ item }} ALL=(ALL)'\n+    line: '{{ item }} ALL=(ALL) ALL'\n     state: present\n     validate: 'visudo -cf %s'\n   with_items: security_sudoers_passworded"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #99", "sha": "24943321a3ac3eedade34045a2e7874ced52c390", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/24943321a3ac3eedade34045a2e7874ced52c390", "parents": ["03dddcd78fb6d8b2d17def65876489107c3a067a"], "files": [{"sha": "a0f5f9eb3fbd1d4f3459cbf1c74c99d53a4128ce", "filename": "tasks/configure-docker/configure-docker-plugins.yml", "previous_filename": null, "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/24943321a3ac3eedade34045a2e7874ced52c390/tasks/configure-docker/configure-docker-plugins.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/24943321a3ac3eedade34045a2e7874ced52c390/tasks/configure-docker/configure-docker-plugins.yml", "status": "modified", "patch": "@@ -1,5 +1,5 @@\n - name: Fetch Docker daemon status\n-  become: true\n+  become: yes\n   service:\n     name: docker\n   register: _docker_status\n@@ -15,7 +15,7 @@\n     - _docker_status.status.SubState != \"running\"\n \n - name: Wait for Docker daemon to started\n-  become: true\n+  become: yes\n   shell: docker info\n   register: _docker_info\n   until: _docker_info.rc == 0\n@@ -25,7 +25,7 @@\n     - skip_ansible_lint\n \n - name: Install Docker plugins\n-  become: true\n+  become: yes\n   shell: \"(docker plugin install --grant-all-permissions --alias {{ item.alias | default(item.name) }} {{ item.name }} \\\n     && echo 'installed') || echo 'nop'\"\n   with_items: \"{{ docker_plugins }}\"\n@@ -47,14 +47,14 @@\n \n - name: Update Docker daemon configuration with authorization plugins\n   set_fact:\n-    docker_daemon_config: \"{{ docker_daemon_config | combine(_updated_item, recursive=true) }}\"\n+    _docker_daemon_config: \"{{ docker_daemon_config | combine(_updated_item, recursive=true) }}\"\n   vars:\n     _updated_item: \"{ 'authorization-plugins': {{ _authz_plugins | list }} }\"\n \n - name: Update Docker daemon (variables)\n-  become: true\n+  become: yes\n   copy:\n-    content: \"{{ docker_daemon_config | to_nice_json }}\"\n+    content: \"{{ _docker_daemon_config | to_nice_json }}\"\n     dest: /etc/docker/daemon.json\n   notify: restart docker\n   when:"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "haxorof", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "haxorof", "committer_email": "bjorn.oscarsson@gmail.com", "message": "Fixes #6", "sha": "c7c535a861f356695bc29768c55779d00084d291", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/c7c535a861f356695bc29768c55779d00084d291", "parents": ["af995622de049010a8c2fc9e12f4151430b4ae0b"], "files": [{"sha": "9d4f5c692a03b880d39d60aded85503292f05423", "filename": "tasks/main-Storage.yml", "previous_filename": null, "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/c7c535a861f356695bc29768c55779d00084d291/tasks/main-Storage.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/c7c535a861f356695bc29768c55779d00084d291/tasks/main-Storage.yml", "status": "modified", "patch": "@@ -49,6 +49,13 @@\n     - /etc/subuid\n     - /etc/subgid\n \n+- name: Ensure /etc/systemd/system/docker.service.d directory exists\n+  file: \n+    path: /etc/systemd/system/docker.service.d\n+    state: directory\n+    mode: 0755\n+  become: yes\n+\n - name: Copy systemd drop-in for Docker storage configuration\n   copy:\n     src: files/etc/systemd/system/docker.service.d/docker-storage.conf"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #8: Complete rewrite for modern Solr installation.", "sha": "bfcfb80eb911615cefc03429f8d103aba0bb6eef", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/bfcfb80eb911615cefc03429f8d103aba0bb6eef", "parents": ["68e1f56935cb8743bbbb75ff8ab28914a81b199d"], "files": [{"sha": "43a9157019e3b8feca382d4914bf50d8071ab14b", "filename": "tasks/main.yml", "previous_filename": null, "additions": 24, "deletions": 77, "changes": 101, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/bfcfb80eb911615cefc03429f8d103aba0bb6eef/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/bfcfb80eb911615cefc03429f8d103aba0bb6eef/tasks/main.yml", "status": "modified", "patch": "@@ -1,92 +1,39 @@\n ---\n-- name: Include OS-specific variables.\n-  include_vars: \"{{ ansible_os_family }}.yml\"\n+- include: user.yml\n+  when: solr_create_user\n \n - name: Set solr_filename for Solr 4.x.\n-  set_fact: >\n-    solr_filename=solr-{{ solr_version }}\n+  set_fact:\n+    \"solr_filename=solr-{{ solr_version }}\"\n   when: \"solr_version.split('.')[0] == '4'\"\n \n - name: Set solr_filename for Solr 3.x.\n-  set_fact: >\n-    solr_filename=apache-solr-{{ solr_version }}\n+  set_fact:\n+    solr_filename: \"apache-solr-{{ solr_version }}\"\n   when: \"solr_version.split('.')[0] == '3'\"\n \n - name: Download Solr.\n-  get_url: >\n-    url=http://archive.apache.org/dist/lucene/solr/{{ solr_version }}/{{ solr_filename }}.tgz\n-    dest={{ workspace }}/{{ solr_filename }}.tgz\n-    force=no\n+  get_url:\n+    url: \"http://archive.apache.org/dist/lucene/solr/{{ solr_version }}/{{ solr_filename }}.tgz\"\n+    dest: \"{{ solr_workspace }}/{{ solr_filename }}.tgz\"\n+    force: no\n \n - name: Expand Solr.\n   command: >\n-    tar -C {{ workspace }} -xvzf {{ workspace }}/{{ solr_filename }}.tgz\n-    creates={{ workspace }}/{{ solr_filename }}/dist/{{ solr_filename }}.war\n+    tar -C {{ solr_workspace }} -xvzf {{ solr_workspace }}/{{ solr_filename }}.tgz\n+    creates={{ solr_workspace }}/{{ solr_filename }}/dist/{{ solr_filename }}.war\n \n - name: Copy Solr into place.\n   command: >\n-    cp -r {{ workspace }}/{{ solr_filename }} {{ solr_path }}\n-    creates={{ solr_path }}/dist/{{ solr_filename }}.war\n-\n-- name: Copy Solr war file into place.\n-  command: >\n-    cp {{ solr_path }}/dist/{{ solr_filename }}.war {{ solr_path }}/solr.war\n-    creates={{ solr_path }}/solr.war\n-  notify: restart tomcat\n-\n-- name: Copy solr.xml into Tomcat.\n-  template: >\n-    src=Catalina/solr.xml.j2\n-    dest=/etc/tomcat6/Catalina/{{ tomcat6_hostname }}/solr.xml\n-    owner={{ tomcat_user }} group={{ tomcat_user }} mode=755\n-  notify: restart tomcat\n-\n-- name: Copy Solr multicore example into place.\n-  command: >\n-    cp -R {{ solr_path }}/example/multicore {{ solr_path }}/cores\n-    creates={{ solr_path }}/cores/README.txt\n-  notify: restart tomcat\n-\n-- name: Check if solr.xml file already exists.\n-  stat: \"path={{ solr_path }}/solr.xml\"\n-  register: solr_file\n-\n-- name: Copy Solr core XML file into place.\n-  template: >\n-    src=solr.xml.j2\n-    dest={{ solr_path }}/solr.xml\n-    owner={{ tomcat_user }}\n-    group={{ tomcat_user }}\n-    mode=755\n-    backup=yes\n-  when: solr_file.stat.exists == false\n-  notify: restart tomcat\n-\n-- name: Check if setup-complete file exists.\n-  stat: \"path={{ solr_path }}/setup-complete\"\n-  register: setup_complete\n-\n-- name: Copy logging jar files and configuration into place for Solr 4.x.\n-  shell: \"{{ item }}\"\n-  with_items:\n-    - \"cp -n {{ solr_path }}/example/lib/ext/* {{ tomcat_lib_path }}\"\n-    - \"cp -n {{ solr_path }}/example/resources/log4j.properties {{ tomcat_lib_path }}\"\n-  when: \"(setup_complete.stat.exists == false) and (solr_version.split('.')[0] == '4')\"\n-  notify: restart tomcat\n-\n-- name: Fix file permissions.\n-  file: >\n-    path={{ solr_path }}\n-    state=directory\n-    owner={{ tomcat_user }} group={{ tomcat_user }} mode=0755\n-    recurse=yes\n-  when: setup_complete.stat.exists == false\n-\n-- name: Create file to indicate Solr install completion.\n-  file: >\n-    path={{ solr_path }}/setup-complete\n-    state=touch\n-    owner={{ tomcat_user }}\n-    group={{ tomcat_user }}\n-    mode=755\n-  when: setup_complete.stat.exists == false\n+    cp -r {{ solr_workspace }}/{{ solr_filename }} {{ solr_install_path }}\n+    creates={{ solr_install_path }}/dist/{{ solr_filename }}.war\n+\n+- name: Ensure Solr install files are owned by the solr_user.\n+  file:\n+    path: \"{{ solr_install_path }}\"\n+    owner: \"{{ solr_user }}\"\n+    group: \"{{ solr_user }}\"\n+    recurse: yes\n+\n+- include: solr-home.yml\n+- include: init.yml"}, {"sha": "9c4eff9d3ea6a9207ec9d5cd49585fab068abf0e", "filename": "meta/main.yml", "previous_filename": null, "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/bfcfb80eb911615cefc03429f8d103aba0bb6eef/meta/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/bfcfb80eb911615cefc03429f8d103aba0bb6eef/meta/main.yml", "status": "modified", "patch": "@@ -1,10 +1,9 @@\n ---\n-dependencies:\n-  - { role: geerlingguy.tomcat6 }\n+dependencies: []\n \n galaxy_info:\n   author: geerlingguy\n-  description: Apache Solr for RHEL/CentOS and Debian/Ubuntu.\n+  description: Apache Solr for Linux.\n   company: \"Midwestern Mac, LLC\"\n   license: \"license (BSD, MIT)\"\n   min_ansible_version: 1.4"}]}, {"repo": "NVIDIA/deepops", "author_id": "MDQ6VXNlcjY4NzI2OQ==", "author_name": "Luke Yeager", "committer_id": "MDQ6VXNlcjEwMzQzMA==", "committer_name": "Doug Holt", "committer_email": "doug.holt@gmail.com", "message": "Fix warning about ssh role syntax (#66)", "sha": "292beaebc7ccbf548c012e15e4867e0b5b9f5429", "url": "https://api.github.com/repos/NVIDIA/deepops/commits/292beaebc7ccbf548c012e15e4867e0b5b9f5429", "parents": ["08e99e2fd312f5fead6903c49417d0af18585784"], "files": [{"sha": "81df19584544963e9bd4caf75549f246f9092e63", "filename": "ansible/roles/ssh/handlers/main.yml", "previous_filename": null, "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/NVIDIA/deepops/blob/292beaebc7ccbf548c012e15e4867e0b5b9f5429/ansible/roles/ssh/handlers/main.yml", "raw_url": "https://github.com/NVIDIA/deepops/raw/292beaebc7ccbf548c012e15e4867e0b5b9f5429/ansible/roles/ssh/handlers/main.yml", "status": "modified", "patch": "@@ -5,10 +5,8 @@\n \n - name: restart ssh\n   action: service name=ssh state=restarted\n-  when: ssh_service_state != 'stopped'\n-  when: ansible_os_family == \"Debian\"\n+  when: (ssh_service_state != 'stopped' and ansible_os_family == \"Debian\")\n \n - name: restart ssh\n   action: service name=sshd state=restarted\n-  when: ssh_service_state != 'stopped'\n-  when: ansible_os_family == \"Redhat\"\n+  when: (ssh_service_state != 'stopped' and ansible_os_family == \"Redhat\")"}]}, {"repo": "NVIDIA/deepops", "author_id": "MDQ6VXNlcjY4NzI2OQ==", "author_name": "Luke Yeager", "committer_id": "MDQ6VXNlcjEwMzQzMA==", "committer_name": "Doug Holt", "committer_email": "doug.holt@gmail.com", "message": "Fix nvidia-docker repo for xenial (#76)", "sha": "a88b40fbf6c5fd5af2b284d8385081067e618066", "url": "https://api.github.com/repos/NVIDIA/deepops/commits/a88b40fbf6c5fd5af2b284d8385081067e618066", "parents": ["f607a149478c5a7383368d256cb90eb8440e9d9e"], "files": [{"sha": "83f084893785dd8ff5b6c94cc085eb45cc5c0ed3", "filename": "playbooks/nvidia-container-runtime.yml", "previous_filename": null, "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/NVIDIA/deepops/blob/a88b40fbf6c5fd5af2b284d8385081067e618066/playbooks/nvidia-container-runtime.yml", "raw_url": "https://github.com/NVIDIA/deepops/raw/a88b40fbf6c5fd5af2b284d8385081067e618066/playbooks/nvidia-container-runtime.yml", "status": "modified", "patch": "@@ -7,13 +7,22 @@\n       apt_key:\n         url: https://nvidia.github.io/nvidia-docker/gpgkey\n         state: present\n+    - name: add nvidia-docker repo source\n+      get_url:\n+        url: https://nvidia.github.io/nvidia-docker/ubuntu16.04/nvidia-docker.list\n+        dest: /etc/apt/sources.list.d/nvidia-docker.list\n+        mode: 0644\n+        owner: root\n+        group: root\n+      when: (ansible_facts['distribution'] == 'Ubuntu' and ansible_facts['distribution_major_version'] == '16')\n     - name: add nvidia-docker repo source\n       get_url:\n         url: https://nvidia.github.io/nvidia-docker/ubuntu18.04/nvidia-docker.list\n         dest: /etc/apt/sources.list.d/nvidia-docker.list\n         mode: 0644\n         owner: root\n         group: root\n+      when: (ansible_facts['distribution'] == 'Ubuntu' and ansible_facts['distribution_major_version'] == '18')\n     - name: install nvidia-docker2\n       apt:\n         name: nvidia-docker2"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjUwNjI4Mw==", "author_name": "Daniel Widerin", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #34", "sha": "ef3c6c3b3b414b3ca1ad27ea5a4a8c79f80c8a64", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/ef3c6c3b3b414b3ca1ad27ea5a4a8c79f80c8a64", "parents": ["fd7c9d0ab9580a7b012367c9ab1213df0a08679c"], "files": [{"sha": "463bdb377c2f4ebd67c15b1b77a831b8831993da", "filename": "tasks/cores.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/ef3c6c3b3b414b3ca1ad27ea5a4a8c79f80c8a64/tasks/cores.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/ef3c6c3b3b414b3ca1ad27ea5a4a8c79f80c8a64/tasks/cores.yml", "status": "modified", "patch": "@@ -7,7 +7,7 @@\n \n - name: Ensure Solr conf directories exist.\n   file:\n-    path: \"/var/solr/data/{{ item }}/conf\"\n+    path: \"{{ solr_home }}/data/{{ item }}/conf\"\n     state: directory\n     owner: \"{{ solr_user }}\"\n     group: \"{{ solr_user }}\"\n@@ -16,7 +16,7 @@\n   with_items: \"{{ solr_cores }}\"\n \n - name: Ensure core configuration directories exist.\n-  shell: \"cp -r {{ solr_install_path }}/example/files/conf/ /var/solr/data/{{ item }}/\"\n+  shell: \"cp -r {{ solr_install_path }}/example/files/conf/ {{ solr_home }}/data/{{ item }}/\"\n   when: \"'{{ item }}' not in '{{ solr_cores_current.content }}'\"\n   with_items: \"{{ solr_cores }}\"\n "}]}, {"repo": "angstwad/docker.ubuntu", "author_id": "MDQ6VXNlcjgzMDcxNA==", "author_name": "Felix B\u00f6rner", "committer_id": "MDQ6VXNlcjEyNDA3NDA=", "committer_name": "Paul Durivage", "committer_email": "pauldurivage@gmail.com", "message": "Fix proxy settings for Docker daemon (#196)\n\n* fix: is_systemd toggle\r\n\r\nthe wrong fact was used to get distribution name\r\n\r\n* fix: systemd proxy configuration\r\n\r\nIt is possible to use multiple Environment statements\r\nA single Environment statement with multiple variables does not work", "sha": "473befb0b909e7cc76b0343b052b505dca191341", "url": "https://api.github.com/repos/angstwad/docker.ubuntu/commits/473befb0b909e7cc76b0343b052b505dca191341", "parents": ["5fe2526a300cda6dae0aea4472e7287c12553ca6"], "files": [{"sha": "ca0043799fd7c14e553e29ea088f1acb861aa7bb", "filename": "tasks/main.yml", "previous_filename": null, "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/angstwad/docker.ubuntu/blob/473befb0b909e7cc76b0343b052b505dca191341/tasks/main.yml", "raw_url": "https://github.com/angstwad/docker.ubuntu/raw/473befb0b909e7cc76b0343b052b505dca191341/tasks/main.yml", "status": "modified", "patch": "@@ -59,7 +59,7 @@\n     state: present\n     update_cache: yes\n     cache_valid_time: \"{{ docker_apt_cache_valid_time }}\"\n-  \n+\n - name: Add Docker repository key\n   apt_key:\n     id: \"{{ apt_key_sig }}\"\n@@ -100,7 +100,7 @@\n - name: Set systemd playbook var\n   set_fact:\n     is_systemd: true\n-  when: ( ansible_distribution_release == \"Ubuntu\" and ansible_distribution_version|version_compare('15.04', '>=') or ansible_distribution == \"Debian\" )\n+  when: ( ansible_distribution == \"Ubuntu\" and ansible_distribution_version|version_compare('15.04', '>=') or ansible_distribution == \"Debian\" )\n   tags: always\n \n - name: Set docker_http_proxy_defined flag\n@@ -277,7 +277,9 @@\n   copy:\n     content: |\n       [Service]\n-      Environment=\"{% if docker_http_proxy_defined %}http_proxy={{ docker_http_proxy }}{% endif %} {% if docker_https_proxy_defined %}https_proxy={{ docker_https_proxy }}{% endif %} no_proxy={{ docker_no_proxy | default('') }}\"\n+      Environment=\"{% if docker_http_proxy_defined %}http_proxy={{ docker_http_proxy }}{% endif %}\"\n+      Environment=\"{% if docker_https_proxy_defined %}https_proxy={{ docker_https_proxy }}{% endif %}\"\n+      Environment=\"no_proxy={{ docker_no_proxy | default('') }}\"\n     dest: /etc/systemd/system/docker.service.d/proxy.conf\n     owner: root\n     group: root"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #77", "sha": "27c8543338544c4700ddfc742d89a86d0b94798a", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/27c8543338544c4700ddfc742d89a86d0b94798a", "parents": ["fa9e89f81fa0afc0c182af06aca1e3ce16f28e23"], "files": [{"sha": "754680dddbe8523b40e375a6ee9b3ba2d1d03510", "filename": "tasks/postinstall.yml", "previous_filename": null, "additions": 31, "deletions": 7, "changes": 38, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/27c8543338544c4700ddfc742d89a86d0b94798a/tasks/postinstall.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/27c8543338544c4700ddfc742d89a86d0b94798a/tasks/postinstall.yml", "status": "modified", "patch": "@@ -166,12 +166,36 @@\n #   when: ansible_version.full is version_compare('2.7', '>=')\n \n # Official installation of docker-compose (Linux): https://docs.docker.com/compose/install/#install-compose\n-- name: Install docker-compose (Linux)\n-  become: true\n-  get_url:\n-    url: \"{{ _docker_compose_url }}\"\n-    checksum: \"{{ _docker_compose_checksum }}\"\n-    dest: /usr/local/bin/docker-compose\n-    mode: 0755\n+- name: Install docker-compose\n+  block:\n+    - name: Install docker-compose (Linux)\n+      become: true\n+      get_url:\n+        url: \"{{ _docker_compose_url }}\"\n+        checksum: \"{{ _docker_compose_checksum }}\"\n+        dest: /usr/local/bin/docker-compose\n+        mode: 0755\n+\n+    - name: Create symlink for docker-compose to work with sudo in some distributions\n+      become: true\n+      file:\n+        src: /usr/local/bin/docker-compose\n+        dest: /usr/bin/docker-compose\n+        state: link\n   when:\n     - docker_compose\n+\n+- name: Uninstall docker-compose\n+  block:\n+  - name: Remove /usr/local/bin/docker-compose\n+    file:\n+      become: true\n+      path: /usr/local/bin/docker-compose\n+      state: absent\n+  - name: Remove /usr/bin/docker-compose\n+    file:\n+      become: true\n+      path: /usr/bin/docker-compose\n+      state: absent\n+  when:\n+    - not docker_compose"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #37", "sha": "4bb324dad34f7ca25ea79574927165bc3637aef8", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/4bb324dad34f7ca25ea79574927165bc3637aef8", "parents": ["88bdba8210b22182635497a6af5eef16e7d46e49"], "files": [{"sha": "6610a68efe253e94a5af8d5b3449b73039591ba3", "filename": "handlers/main.yml", "previous_filename": null, "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/4bb324dad34f7ca25ea79574927165bc3637aef8/handlers/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/4bb324dad34f7ca25ea79574927165bc3637aef8/handlers/main.yml", "status": "modified", "patch": "@@ -6,10 +6,12 @@\n     name: docker\n     state: restarted\n   become: yes\n+  tags: [\"install\", \"configure\"]\n \n # Workaround because systemd cannot be used: https://github.com/ansible/ansible/issues/22171\n - name: restart auditd\n   shell: service auditd restart\n   args:\n     warn: no\n   become: yes\n+  tags: [\"install\", \"configure\"]"}, {"sha": "55b33a1306a92d3e1647363795743c0ceba8ff64", "filename": "tasks/main.yml", "previous_filename": null, "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/4bb324dad34f7ca25ea79574927165bc3637aef8/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/4bb324dad34f7ca25ea79574927165bc3637aef8/tasks/main.yml", "status": "modified", "patch": "@@ -5,6 +5,7 @@\n     _docker_os_dist_release: \"{{ ansible_distribution_release }}\"\n     _docker_os_dist_major_version: \"{{ ansible_distribution_major_version }}\"\n     _docker_os_dist_check: yes\n+  tags: [\"install\", \"configure\"]\n \n - name: Reinterpret distribution facts for Linux Mint 18\n   set_fact:\n@@ -14,19 +15,27 @@\n   when:\n     _docker_os_dist == \"Linux Mint\" and\n     _docker_os_dist_major_version == \"18\"\n+  tags: [\"install\", \"configure\"]\n \n - include: checks.yml\n+  tags: [\"install\", \"configure\"]\n \n - include: setup-repository.yml\n-\n-- include: kernel-3-mount-fixes.yml\n-  when: ansible_kernel | version_compare('4', '<')\n-\n-- include: setup-audit.yml\n+  tags: [\"install\"]\n \n - include: remove-pre-docker-ce.yml\n   when: docker_remove_pre_ce | bool\n+  tags: [\"install\"]\n \n - include: install-docker.yml\n+  tags: [\"install\"]\n+\n+- include: setup-audit.yml\n+  tags: [\"configure\"]\n+\n+- include: kernel-3-mount-fixes.yml\n+  when: ansible_kernel | version_compare('4', '<')\n+  tags: [\"configure\"]\n \n - include: configure-docker.yml\n+  tags: [\"configure\"]"}, {"sha": "755cf1983c97243016c5e43ac5c6c0917654530b", "filename": "tasks/kernel-3-mount-fixes.yml", "previous_filename": null, "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/4bb324dad34f7ca25ea79574927165bc3637aef8/tasks/kernel-3-mount-fixes.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/4bb324dad34f7ca25ea79574927165bc3637aef8/tasks/kernel-3-mount-fixes.yml", "status": "modified", "patch": "@@ -24,11 +24,13 @@\n     src: files/etc/systemd/system/docker.service.d/mountflags-slave.conf\n     dest: /etc/systemd/system/docker.service.d/mountflags-slave.conf\n   become: yes\n+  notify: restart docker\n   when: docker_enable_mount_flag_fix\n   \n - name: Remove systemd drop-in for Docker Mount Flags slave configuration\n   file:\n     path: /etc/systemd/system/docker.service.d/mountflags-slave.conf\n     state: absent\n   become: yes\n+  notify: restart docker\n   when: not docker_enable_mount_flag_fix"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjExOTEyODU=", "author_name": "Andrew Block", "committer_id": "MDQ6VXNlcjc1NDk3ODU=", "committer_name": "\u00d8ystein Bedin", "committer_email": "oybed@users.noreply.github.com", "message": "Fix conditional logic for generating variables without values (#202)", "sha": "e005198769366648182cf2c2a94a8e6de9604e31", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/e005198769366648182cf2c2a94a8e6de9604e31", "parents": ["713581e72f316f187c0c70afdba3b9a76695ecee"], "files": [{"sha": "06de77e0a2917b03ede1eef237802127e0f1d10c", "filename": "roles/config-postgresql/tasks/install_containerized.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/e005198769366648182cf2c2a94a8e6de9604e31/roles/config-postgresql/tasks/install_containerized.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/e005198769366648182cf2c2a94a8e6de9604e31/roles/config-postgresql/tasks/install_containerized.yml", "status": "modified", "patch": "@@ -3,23 +3,23 @@\n - name: Generate Random DB Username\n   set_fact:\n     postgresql_username: \"{{ lookup('password', '/dev/null length=5 chars=ascii_letters') | lower }}\"\n-  when: postgresql_username is undefined and postgresql_username|trim == \"\"\n+  when: postgresql_username is undefined or postgresql_username|trim == \"\"\n \n - name: Generate Random DB Admin Username\n   set_fact:\n     postgresql_admin_user: \"{{ lookup('password', '/dev/null length=5 chars=ascii_letters') | lower }}\"\n-  when: postgresql_admin_user is undefined and postgresql_admin_user|trim == \"\"\n+  when: postgresql_admin_user is undefined or postgresql_admin_user|trim == \"\"\n \n \n - name: Generate Random DB Password\n   set_fact:\n     postgresql_password: \"{{ lookup('password', '/dev/null length=10 chars=ascii_letters,digits,hexdigits') }}\"\n-  when: postgresql_password is undefined and postgresql_password|trim == \"\"\n+  when: postgresql_password is undefined or postgresql_password|trim == \"\"\n \n - name: Generate Random Admin DB Password\n   set_fact:\n     postgresql_admin_password: \"{{ lookup('password', '/dev/null length=10 chars=ascii_letters,digits,hexdigits') }}\"\n-  when: postgresql_admin_password is undefined and postgresql_admin_password|trim == \"\"\n+  when: postgresql_admin_password is undefined or postgresql_admin_password|trim == \"\"\n \n - name: Configure Storage Directory\n   file:"}, {"sha": "d25761965bf4e0077b067c3690ff96f157f4ab62", "filename": "roles/config-mysql/tasks/install_containerized.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/e005198769366648182cf2c2a94a8e6de9604e31/roles/config-mysql/tasks/install_containerized.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/e005198769366648182cf2c2a94a8e6de9604e31/roles/config-mysql/tasks/install_containerized.yml", "status": "modified", "patch": "@@ -3,25 +3,25 @@\n - name: Generate Random DB Username\n   set_fact:\n     mysql_username: \"{{ lookup('password', '/dev/null length=5 chars=ascii_letters') | lower }}\"\n-  when: mysql_username is undefined and mysql_username|trim == \"\"\n+  when: mysql_username is undefined or mysql_username|trim == \"\"\n   run_once: True\n \n - name: Generate Random DB Admin Username\n   set_fact:\n     mysql_root_username: \"root\"\n-  when: mysql_root_username is undefined and mysql_root_username|trim == \"\"\n+  when: mysql_root_username is undefined or mysql_root_username|trim == \"\"\n   run_once: True\n \n - name: Generate Random DB Password\n   set_fact:\n     mysql_password: \"{{ lookup('password', '/dev/null length=10 chars=ascii_letters,digits,hexdigits') }}\"\n-  when: mysql_password is undefined and mysql_password|trim == \"\"\n+  when: mysql_password is undefined or mysql_password|trim == \"\"\n   run_once: True\n \n - name: Generate Random Admin DB Password\n   set_fact:\n     mysql_root_password: \"{{ lookup('password', '/dev/null length=10 chars=ascii_letters,digits,hexdigits') }}\"\n-  when: mysql_root_password is undefined and mysql_root_password|trim == \"\"\n+  when: mysql_root_password is undefined or mysql_root_password|trim == \"\"\n   run_once: True\n \n - name: Configure Storage Directory"}]}, {"repo": "jdauphant/ansible-role-ssl-certs", "author_id": "MDQ6VXNlcjMxMzUzMg==", "author_name": "Morel S\u00e9bastien", "committer_id": "MDQ6VXNlcjMxMzUzMg==", "committer_name": "Morel S\u00e9bastien", "committer_email": "morel.seb@gmail.com", "message": "Fix #6: 'ssl_certs_local_cert_data' is undefined", "sha": "ff439c076dcf8e80c35e3da3e89a531916b01b51", "url": "https://api.github.com/repos/jdauphant/ansible-role-ssl-certs/commits/ff439c076dcf8e80c35e3da3e89a531916b01b51", "parents": ["96ad5f81b21efe129d0ff734ef947956838d2fce"], "files": [{"sha": "d5afca1b6b33b358d783a002d4a301e0439d050d", "filename": "tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/jdauphant/ansible-role-ssl-certs/blob/ff439c076dcf8e80c35e3da3e89a531916b01b51/tasks/main.yml", "raw_url": "https://github.com/jdauphant/ansible-role-ssl-certs/raw/ff439c076dcf8e80c35e3da3e89a531916b01b51/tasks/main.yml", "status": "modified", "patch": "@@ -63,8 +63,8 @@\n       mode: \"{{ ssl_certs_mode }}\"\n     when: ssl_certs_local_privkey_data is defined and ssl_certs_local_cert_data is defined\n     with_items:\n-      - { content: \"{{ ssl_certs_local_cert_data }}\", dest: \"{{ ssl_certs_cert_path }}\" }\n-      - { content: \"{{ ssl_certs_local_privkey_data }}\", dest: \"{{ ssl_certs_privkey_path }}\" }\n+      - { content: \"{{ ssl_certs_local_cert_data|default }}\", dest: \"{{ ssl_certs_cert_path }}\" }\n+      - { content: \"{{ ssl_certs_local_privkey_data|default }}\", dest: \"{{ ssl_certs_privkey_path }}\" }\n     no_log: true\n     tags: [ssl-certs,configuration]\n "}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #44", "sha": "561013b2ca04671cf43aef35e20fcb633fe56c0e", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/561013b2ca04671cf43aef35e20fcb633fe56c0e", "parents": ["6fe5be0e3e0aa762221af0cc581db1afd3e5f6d0"], "files": [{"sha": "585bb7651d0d95602288230fc358f80f250641c5", "filename": "tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/561013b2ca04671cf43aef35e20fcb633fe56c0e/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/561013b2ca04671cf43aef35e20fcb633fe56c0e/tasks/main.yml", "status": "modified", "patch": "@@ -33,11 +33,10 @@\n - include_tasks: setup-audit.yml\n   tags: [\"configure\"]\n \n-- include_tasks: configure-drop-ins.yml\n+- include_tasks: bug-tweaks.yml\n   tags: [\"configure\"]\n \n-- include_tasks: kernel-3-mount-fixes.yml\n-  when: ansible_kernel | version_compare('4', '<')\n+- include_tasks: configure-drop-ins.yml\n   tags: [\"configure\"]\n \n - include_tasks: configure-docker.yml"}, {"sha": "1b4a90a3adfab74e67cbe2365d906a2e014dbabb", "filename": "tasks/configure-drop-ins.yml", "previous_filename": null, "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/561013b2ca04671cf43aef35e20fcb633fe56c0e/tasks/configure-drop-ins.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/561013b2ca04671cf43aef35e20fcb633fe56c0e/tasks/configure-drop-ins.yml", "status": "modified", "patch": "@@ -1,3 +1,7 @@\n+- name: Combine all systemd service configuration options\n+  set_fact:\n+    _systemd_service_config: \"{{ docker_systemd_service_config_tweaks + docker_systemd_service_config }}\"\n+\n - name: Ensure /etc/systemd/system/docker.service.d directory exists\n   file:\n     path: /etc/systemd/system/docker.service.d\n@@ -10,21 +14,23 @@\n     src: drop-ins/default.conf.j2\n     dest: /etc/systemd/system/docker.service.d/default.conf\n   become: yes\n-  register: systemd_docker_dropin\n+  register: _systemd_docker_dropin\n   vars:\n     systemd_envs_dir: \"{{ docker_systemd_envs_dir[_docker_os_dist] }}\"\n+    systemd_service_conf: \"{{ _systemd_service_config }}\"\n \n - name: Setup Docker environment file {{ docker_systemd_envs_dir[_docker_os_dist] }}/docker-envs\n   template:\n     src: docker-envs.j2\n     dest: \"{{ docker_systemd_envs_dir[_docker_os_dist] }}/docker-envs\"\n   become: yes\n-  register: systemd_docker_env\n+  notify: restart docker\n   vars:\n     docker_opts: \"{{ docker_daemon_opts }}\"\n \n - name: Force daemon reload of systemd\n   systemd: \n     daemon_reload: yes\n   become: yes\n-  when: systemd_docker_dropin|changed or systemd_docker_env|changed\n\\ No newline at end of file\n+  notify: restart docker\n+  when: _systemd_docker_dropin|changed\n\\ No newline at end of file"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #71", "sha": "ef411087c4f3692d3571dbaec3f3e53263aa6139", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/ef411087c4f3692d3571dbaec3f3e53263aa6139", "parents": ["b1ea1f0bcea62e56cfb3171011740cc14e3ad69c"], "files": [{"sha": "597aed4d33e36dd07488de9d0ebc7ea63c0f351d", "filename": "tasks/postinstall.yml", "previous_filename": null, "additions": 16, "deletions": 12, "changes": 28, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/ef411087c4f3692d3571dbaec3f3e53263aa6139/tasks/postinstall.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/ef411087c4f3692d3571dbaec3f3e53263aa6139/tasks/postinstall.yml", "status": "modified", "patch": "@@ -10,18 +10,6 @@\n     _docker_python_system: true\n   when: ansible_python.executable | regex_search('^/bin') or ansible_python.executable | regex_search('^/usr/bin')\n \n-- name: Determine if pip exists in path\n-  become: true\n-  shell: type pip\n-  register: _docker_pip_cmd\n-  changed_when: false\n-  failed_when: false\n-\n-- name: Set fact to install Python PiP\n-  set_fact:\n-    _docker_additional_packages_os: \"{{ _docker_additional_packages_os + [docker_pip_package] }}\"\n-  when: _docker_pip_cmd.rc != 0\n-\n - name: Set facts to install Docker SDK for Python\n   set_fact:\n     _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + \\\n@@ -48,6 +36,22 @@\n     _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + docker_additional_packages_pip }}\"\n     _docker_additional_packages_os: \"{{ _docker_additional_packages_os + docker_additional_packages_os }}\"\n \n+- name: Determine if pip exists in path\n+  become: true\n+  shell: type pip\n+  register: _docker_pip_cmd\n+  changed_when: false\n+  failed_when: false\n+  when:\n+    - _docker_additional_packages_pip | length > 0\n+\n+- name: Set fact to install Python PiP\n+  set_fact:\n+    _docker_additional_packages_os: \"{{ _docker_additional_packages_os + [docker_pip_package] }}\"\n+  when:\n+    - _docker_additional_packages_pip | length > 0\n+    - _docker_pip_cmd.rc != 0\n+\n - name: Ensure EPEL release repository is installed\n   become: true\n   package:"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #110: Adds support and tests for Solr 8.x, and defaults to 8.2.0.", "sha": "c5a37bf5da48e5223309db7b4d0546f87629d17f", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/c5a37bf5da48e5223309db7b4d0546f87629d17f", "parents": ["4a9aaf0951e383c57077cf651b93e78eeea1b5ac"], "files": [{"sha": "b66209d8fa891d6ab054a9bc7e3e1ff2fe1ad17d", "filename": "meta/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/c5a37bf5da48e5223309db7b4d0546f87629d17f/meta/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/c5a37bf5da48e5223309db7b4d0546f87629d17f/meta/main.yml", "status": "modified", "patch": "@@ -12,6 +12,7 @@ galaxy_info:\n       versions:\n         - 6\n         - 7\n+        - 8\n     - name: Debian\n       versions:\n         - all"}]}, {"repo": "lean-delivery/ansible-role-java", "author_id": "MDQ6VXNlcjQwMzAwNjQy", "author_name": "Timur Gadiev", "committer_id": "MDQ6VXNlcjkzOTIwMzM=", "committer_name": "Pavel Pikta", "committer_email": "pavel_pikta@epam.com", "message": "Fix adopt win choco (#93)\n\n* Test adoptopenjdk win 13\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>\r\n\r\n* Change debug tasks\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>\r\n\r\n* Test updated regex\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>\r\n\r\n* Change adoptopenjdk_choco_folder\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>\r\n\r\n* Test java_package\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>\r\n\r\n* Enable all tests\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>\r\n\r\n* Updated test (shape m5)\r\n\r\nSigned-off-by: Timur Gadiev <Timur_Gadiev@epam.com>", "sha": "beb41b82405655aa385bb8297bf49ada1a4eb14c", "url": "https://api.github.com/repos/lean-delivery/ansible-role-java/commits/beb41b82405655aa385bb8297bf49ada1a4eb14c", "parents": ["f9310d340d7ef77d1b47df05e6d09619e5baa3f5"], "files": [{"sha": "5e84fc63ccb802e45e96d213b7f023005f791e45", "filename": "meta/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/beb41b82405655aa385bb8297bf49ada1a4eb14c/meta/main.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/beb41b82405655aa385bb8297bf49ada1a4eb14c/meta/main.yml", "status": "modified", "patch": "@@ -10,7 +10,6 @@ galaxy_info:\n   platforms:\n     - name: \"Ubuntu\"\n       versions:\n-        - \"trusty\"\n         - \"xenial\"\n         - \"bionic\"\n     - name: \"Debian\"\n@@ -26,7 +25,8 @@ galaxy_info:\n         - \"Candidate\"\n     - name: \"Windows\"\n       versions:\n-        - \"all\"\n+        - \"2016\"\n+        - \"2019\"\n \n   galaxy_tags:\n     - \"development\""}]}, {"repo": "Oefenweb/ansible-wordpress", "author_id": "MDQ6VXNlcjQwODA1Mg==", "author_name": "Mark van Driel", "committer_id": "MDQ6VXNlcjQwODA1Mg==", "committer_name": "Mark van Driel", "committer_email": "mvdriel@nlware.com", "message": "Added option to activate and deactivate themes and plugins, fixes #26", "sha": "79e29502fb4e0ff1c30c0b5396bfa1b48fb84a8e", "url": "https://api.github.com/repos/Oefenweb/ansible-wordpress/commits/79e29502fb4e0ff1c30c0b5396bfa1b48fb84a8e", "parents": ["6d10af54bdbf8e81c3d90a70ffea87b4d2c20eb2"], "files": [{"sha": "1dec1042836edd2615c720023ae0925eb22fa04b", "filename": "tasks/themes.yml", "previous_filename": null, "additions": 16, "deletions": 6, "changes": 22, "blob_url": "https://github.com/Oefenweb/ansible-wordpress/blob/79e29502fb4e0ff1c30c0b5396bfa1b48fb84a8e/tasks/themes.yml", "raw_url": "https://github.com/Oefenweb/ansible-wordpress/raw/79e29502fb4e0ff1c30c0b5396bfa1b48fb84a8e/tasks/themes.yml", "status": "modified", "patch": "@@ -1,27 +1,37 @@\n # tasks file for wordpress, themes\n ---\n - name: identify installation (theme)\n-  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' theme is-installed {{ item.1 }}\"\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' theme is-installed {{ item.1.name }}\"\n   register: check_installation_themes\n   failed_when: False\n   changed_when: False\n   with_subelements:\n     - wordpress_installs\n     - themes\n-  when: item.1\n+  when: item.1.name\n   tags: [configuration, wordpress, wordpress-themes, wordpress-is-installed-theme]\n \n - name: install (theme)\n-  shell: \"wp-cli --allow-root --no-color --path='{{ item.item.0.path }}' theme install {{ item.item.1 }} --activate\"\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.item.0.path }}' theme install {{ item.item.1.name }}\"\n   with_items: check_installation_themes.results\n-  when: check_installation_themes is defined and item.item.1 and item.rc != 0\n+  when: check_installation_themes is defined and item.item.1.name and item.rc != 0\n   tags: [configuration, wordpress, wordpress-themes, wordpress-install-theme]\n \n - name: check install (theme)\n-  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' theme is-installed {{ item.1 }}\"\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' theme is-installed {{ item.1.name }}\"\n   changed_when: False\n   with_subelements:\n     - wordpress_installs\n     - themes\n-  when: item.1\n+  when: item.1.name\n   tags: [configuration, wordpress, wordpress-themes, wordpress-install-theme-check]\n+\n+- name: activate (theme)\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' theme activate {{ item.1.name }}\"\n+  register: check_activate_theme\n+  changed_when: \"'Success: Switched to' in check_activate_theme.stdout\"\n+  with_subelements:\n+    - wordpress_installs\n+    - themes\n+  when: item.1.name and item.1.activate | default(false)\n+  tags: [configuration, wordpress, wordpress-themes, wordpress-activate-theme]"}, {"sha": "4f42f816c4ad1ff2dc5f8e7c8ec3fc3d915aa5ba", "filename": "tasks/plugins.yml", "previous_filename": null, "additions": 26, "deletions": 5, "changes": 31, "blob_url": "https://github.com/Oefenweb/ansible-wordpress/blob/79e29502fb4e0ff1c30c0b5396bfa1b48fb84a8e/tasks/plugins.yml", "raw_url": "https://github.com/Oefenweb/ansible-wordpress/raw/79e29502fb4e0ff1c30c0b5396bfa1b48fb84a8e/tasks/plugins.yml", "status": "modified", "patch": "@@ -1,7 +1,7 @@\n # tasks file for wordpress, plugins\n ---\n - name: identify installation (plugin)\n-  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' plugin is-installed {{ item.1 }}\"\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' plugin is-installed {{ item.1.name }}\"\n   register: check_installation_plugins\n   failed_when: False\n   changed_when: False\n@@ -12,16 +12,37 @@\n   tags: [configuration, wordpress, wordpress-plugins, wordpress-is-installed-plugin]\n \n - name: install (plugin)\n-  shell: \"wp-cli --allow-root --no-color --path='{{ item.item.0.path }}' plugin install {{ item.item.1 }} --activate\"\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.item.0.path }}' plugin install {{ item.item.1.name }} --activate\"\n   with_items: check_installation_plugins.results\n-  when: check_installation_plugins is defined and item.item.1 and item.rc != 0\n+  when: check_installation_plugins is defined and item.item.1.name and item.rc != 0\n   tags: [configuration, wordpress, wordpress-plugins, wordpress-install-plugin]\n \n - name: check install (plugin)\n-  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' plugin is-installed {{ item.1 }}\"\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' plugin is-installed {{ item.1.name }}\"\n   changed_when: False\n   with_subelements:\n     - wordpress_installs\n     - plugins\n-  when: item.1\n+  when: item.1.name\n   tags: [configuration, wordpress, wordpress-plugins, wordpress-install-plugin-check]\n+\n+- name: activate (plugin)\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' plugin activate {{ item.1.name }}\"\n+  register: check_activate_plugin\n+  changed_when: \"'Success: Plugin' in check_activate_plugin.stdout\"\n+  with_subelements:\n+    - wordpress_installs\n+    - plugins\n+  when: item.1.name and item.1.activate | default(true)\n+  tags: [configuration, wordpress, wordpress-plugins, wordpress-activate-plugin]\n+\n+- name: deactivate (plugin)\n+  shell: \"wp-cli --allow-root --no-color --path='{{ item.0.path }}' plugin deactivate {{ item.1.name }}\"\n+  register: check_activate_plugin\n+  changed_when: \"'Success: Plugin' in check_activate_plugin.stdout\"\n+  with_subelements:\n+    - wordpress_installs\n+    - plugins\n+  when: item.1.name and not item.1.activate | default(true)\n+  tags: [configuration, wordpress, wordpress-plugins, wordpress-deactivate-plugin]\n+  \n\\ No newline at end of file"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #93: Use include_tasks or import_tasks instead of include and static.", "sha": "0c050ee7f22968afdb69da3b859869efea2bfffa", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/0c050ee7f22968afdb69da3b859869efea2bfffa", "parents": ["669ef8a0840eb58b29fca67110f86c4e2d99eebc"], "files": [{"sha": "402f07b57386df4615209951a6456af37047403f", "filename": "meta/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/0c050ee7f22968afdb69da3b859869efea2bfffa/meta/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/0c050ee7f22968afdb69da3b859869efea2bfffa/meta/main.yml", "status": "modified", "patch": "@@ -6,7 +6,7 @@ galaxy_info:\n   description: Apache Solr for Linux.\n   company: \"Midwestern Mac, LLC\"\n   license: \"license (BSD, MIT)\"\n-  min_ansible_version: 2.2\n+  min_ansible_version: 2.4\n   platforms:\n     - name: EL\n       versions:"}, {"sha": "e18a6b05b2c9ac26ce3155146f2cc597ce22a23e", "filename": "tasks/main.yml", "previous_filename": null, "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/0c050ee7f22968afdb69da3b859869efea2bfffa/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/0c050ee7f22968afdb69da3b859869efea2bfffa/tasks/main.yml", "status": "modified", "patch": "@@ -1,5 +1,5 @@\n ---\n-- include: user.yml\n+- import_tasks: user.yml\n   when: solr_create_user\n \n - name: Set solr_filename for Solr 4+.\n@@ -33,11 +33,11 @@\n   when: solr_download_status.changed\n \n # Install Solr < 5.\n-- include: install-pre5.yml\n+- import_tasks: install-pre5.yml\n   when: \"solr_version.split('.')[0] < '5'\"\n \n # Install Solr 5+.\n-- include: install.yml\n+- import_tasks: install.yml\n   when: \"solr_version.split('.')[0] >= '5'\"\n \n - name: Ensure solr is started and enabled on boot if configured.\n@@ -48,12 +48,11 @@\n   when: solr_service_manage\n \n # Configure solr.\n-- include: configure.yml\n+- import_tasks: configure.yml\n   when: \"solr_version.split('.')[0] >= '5'\"\n \n # Create cores, if any are configured.\n-- include: cores.yml\n+- import_tasks: cores.yml\n   when: \"solr_cores and solr_version.split('.')[0] >= '5'\"\n \n-- include: trim-fat.yml\n-  static: no\n+- include_tasks: trim-fat.yml"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "haxorof", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "haxorof", "committer_email": "bjorn.oscarsson@gmail.com", "message": "Fixes #9", "sha": "f843dd69d94667c2cac56f5883730446662cfac4", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/f843dd69d94667c2cac56f5883730446662cfac4", "parents": ["9e7bed4aaef56159f148d24e4f7d7e8b53be632b"], "files": [{"sha": "58d2730abed6414b0f00bcf176ea8df4d8bf716c", "filename": "tasks/main-Storage.yml", "previous_filename": null, "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f843dd69d94667c2cac56f5883730446662cfac4/tasks/main-Storage.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f843dd69d94667c2cac56f5883730446662cfac4/tasks/main-Storage.yml", "status": "modified", "patch": "@@ -13,7 +13,7 @@\n - name: Clone project Atomic container-storage-setup\n   git:\n     repo: https://github.com/projectatomic/container-storage-setup.git\n-    version: 9b77bcb2cba8e272799fa21e2d484e9f6e7c34d0\n+    version: v0.6.0\n     dest: \"/tmp/container-storage-setup\"\n   become: yes\n   when: docker_stat_storage.stat.exists == false\n@@ -39,16 +39,6 @@\n   become: true\n   when: docker_stat_storage.stat.exists == false\n \n-- name: Ensure Docker default user namespace is defined in subuid and subgid\n-  lineinfile:\n-    path: \"{{ item }}\"\n-    regexp: '^dockremap'\n-    line: 'dockremap:500000:65536'\n-  become: yes\n-  with_items:\n-    - /etc/subuid\n-    - /etc/subgid\n-\n - name: Ensure /etc/systemd/system/docker.service.d directory exists\n   file: \n     path: /etc/systemd/system/docker.service.d"}, {"sha": "f4304222375ebc295e5ec770f8940729cb867e45", "filename": "tasks/main-Generic.yml", "previous_filename": null, "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f843dd69d94667c2cac56f5883730446662cfac4/tasks/main-Generic.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f843dd69d94667c2cac56f5883730446662cfac4/tasks/main-Generic.yml", "status": "modified", "patch": "@@ -86,6 +86,20 @@\n   when: docker_daemon_config_file is not defined and \n         docker_daemon_config is defined\n \n+- name: Ensure Docker default user namespace is defined in subuid and subgid\n+  lineinfile:\n+    path: \"{{ item }}\"\n+    regexp: '^dockremap'\n+    line: 'dockremap:500000:65536'\n+  become: yes\n+  with_items:\n+    - /etc/subuid\n+    - /etc/subgid\n+  when: (docker_daemon_config is defined and\n+        docker_daemon_config['userns-remap'] is defined and\n+        docker_daemon_config['userns-remap'] == 'default') or\n+        docker_bug_usermod|bool == true\n+\n - name: Enable and start Docker service\n   service:\n     name: docker"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #482 - Multisite is-installed deploy check\n\nOptionally add the `--network` option to properly check if a site is\ninstalled after deploys for both normal and multisite installs.\n\nRef: http://wp-cli.org/commands/core/is-installed/", "sha": "aec670bf22681f81d100c9dbdc6b502c19dab779", "url": "https://api.github.com/repos/roots/trellis/commits/aec670bf22681f81d100c9dbdc6b502c19dab779", "parents": ["a8cdb8bd610db76f4f3afa4831d7db624d22e3fc"], "files": [{"sha": "017bef2cc525db952684ab0ab74406ef4b0a6ab6", "filename": "roles/deploy/hooks/finalize-after.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/aec670bf22681f81d100c9dbdc6b502c19dab779/roles/deploy/hooks/finalize-after.yml", "raw_url": "https://github.com/roots/trellis/raw/aec670bf22681f81d100c9dbdc6b502c19dab779/roles/deploy/hooks/finalize-after.yml", "status": "modified", "patch": "@@ -1,6 +1,6 @@\n ---\n - name: WordPress Installed?\n-  command: wp core is-installed\n+  command: wp core is-installed {{ project.multisite.enabled | default(false) | ternary('--network', '') }}\n   args:\n     chdir: \"{{ deploy_helper.new_release_path }}\"\n   register: wp_installed"}]}, {"repo": "freeipa/ansible-freeipa", "author_id": "MDQ6VXNlcjE5Mzg4ODg=", "author_name": "David Sastre Medina", "committer_id": "MDQ6VXNlcjE5Mzg4ODg=", "committer_name": "David Sastre Medina", "committer_email": "david.sastre@redhat.com", "message": "Fixes #17 Improve how tasks manage package installation\n\nThe use of squash_actions to invoke a package module, such as \u201cyum\u201d, to\nonly invoke the module once is deprecated, and will be removed in\nAnsible 2.11.\nInstead of relying on implicit squashing, tasks should instead supply\nthe list directly to the name, pkg or package parameter of the module.\n\nSee [1] for a reference to the upstream documentation.\n\nThe ipa-krb5 and ipa-sssd modules include *_packages variables in both\ndefaults/ and vars/, additionally, the list of packages in ipa-sssd differs\nfrom one to the other.\nUnify list of packages into vars/\n\n[1]: https://docs.ansible.com/ansible/latest/porting_guides/porting_guide_2.7.html#using-a-loop-on-a-package-module-via-squash-actions", "sha": "20e5338ad5acbc47e7a492323b19c9a22bdef3ab", "url": "https://api.github.com/repos/freeipa/ansible-freeipa/commits/20e5338ad5acbc47e7a492323b19c9a22bdef3ab", "parents": ["b51397eb89ad0dbab1f8b81e58c841834d20fc07"], "files": [{"sha": "9acf558fe9c205da77df57baa52657b78713e6c3", "filename": "roles/ipareplica/tasks/install.yml", "previous_filename": null, "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/freeipa/ansible-freeipa/blob/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipareplica/tasks/install.yml", "raw_url": "https://github.com/freeipa/ansible-freeipa/raw/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipareplica/tasks/install.yml", "status": "modified", "patch": "@@ -5,22 +5,19 @@\n \n   - name: Install - Ensure IPA replica packages are installed\n     package:\n-      name: \"{{ item }}\"\n+      name: \"{{ ipareplica_packages }}\"\n       state: present\n-    with_items: \"{{ ipareplica_packages }}\"\n \n   - name: Install - Ensure IPA replica packages for dns are installed\n     package:\n-      name: \"{{ item }}\"\n+      name: \"{{ ipareplica_packages_dns }}\"\n       state: present\n-    with_items: \"{{ ipareplica_packages_dns }}\"\n     when: ipareplica_setup_dns | bool\n \n   - name: Install - Ensure IPA replica packages for adtrust are installed\n     package:\n-      name: \"{{ item }}\"\n+      name: \"{{ ipareplica_packages_adtrust }}\"\n       state: present\n-    with_items: \"{{ ipareplica_packages_adtrust }}\"\n     when: ipareplica_setup_adtrust | bool\n \n   when: ipareplica_install_packages | bool"}, {"sha": "095099a37f31608d62b599a1e3d0133be790fb43", "filename": "roles/ipaclient/tasks/uninstall.yml", "previous_filename": null, "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/freeipa/ansible-freeipa/blob/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipaclient/tasks/uninstall.yml", "raw_url": "https://github.com/freeipa/ansible-freeipa/raw/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipaclient/tasks/uninstall.yml", "status": "modified", "patch": "@@ -14,8 +14,7 @@\n   failed_when: uninstall.rc != 0 and uninstall.rc != 2\n   changed_when: uninstall.rc == 0\n \n-# - name: Remove IPA client package\n-#   package:\n-#     name: \"{{ item }}\"\n-#     state: absent\n-#   with_items: \"{{ ipaclient_packages }}\"\n+#- name: Remove IPA client package\n+#  package:\n+#    name: \"{{ ipaclient_packages }}\"\n+#    state: absent"}, {"sha": "65068e6f3b05730b239bee2b6cb591128c9fb9c1", "filename": "roles/ipareplica/tasks/uninstall.yml", "previous_filename": null, "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/freeipa/ansible-freeipa/blob/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipareplica/tasks/uninstall.yml", "raw_url": "https://github.com/freeipa/ansible-freeipa/raw/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipareplica/tasks/uninstall.yml", "status": "modified", "patch": "@@ -34,8 +34,7 @@\n #  failed_when: False\n #  delegate_to: \"{{ groups.ipaserver[0] | default(fail) }}\"\n \n-# - name: Remove IPA replica packages\n-#   package:\n-#     name: \"{{ item }}\"\n-#     state: absent\n-#   with_items: \"{{ ipareplica_packages }}\"\n+#- name: Remove IPA replica packages\n+#  package:\n+#    name: \"{{ ipareplica_packages }}\"\n+#    state: absent"}, {"sha": "3ca47397f0703e66bff36e20501e5e1b5e8fc466", "filename": "roles/ipaserver/tasks/install.yml", "previous_filename": null, "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/freeipa/ansible-freeipa/blob/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipaserver/tasks/install.yml", "raw_url": "https://github.com/freeipa/ansible-freeipa/raw/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipaserver/tasks/install.yml", "status": "modified", "patch": "@@ -4,22 +4,19 @@\n - block:\n   - name: Install - Ensure that IPA server packages are installed\n     package:\n-      name: \"{{ item }}\"\n+      name: \"{{ ipaserver_packages }}\"\n       state: present\n-    with_items: \"{{ ipaserver_packages }}\"\n \n   - name: Install - Ensure that IPA server packages for dns are installed\n     package:\n-      name: \"{{ item }}\"\n+      name: \"{{ ipaserver_packages_dns }}\"\n       state: present\n-    with_items: \"{{ ipaserver_packages_dns }}\"\n     when: ipaserver_setup_dns | bool\n \n   - name: Install - Ensure that IPA server packages for adtrust are installed\n     package:\n-      name: \"{{ item }}\"\n+      name: \"{{ ipaserver_packages_adtrust }}\"\n       state: present\n-    with_items: \"{{ ipaserver_packages_adtrust }}\"\n     when: ipaserver_setup_adtrust | bool\n \n   when: ipaserver_install_packages | bool"}, {"sha": "ee2948527acbfeb5ec16ccf770d014211dc7d907", "filename": "roles/ipaclient/tasks/install.yml", "previous_filename": null, "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/freeipa/ansible-freeipa/blob/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipaclient/tasks/install.yml", "raw_url": "https://github.com/freeipa/ansible-freeipa/raw/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipaclient/tasks/install.yml", "status": "modified", "patch": "@@ -3,9 +3,8 @@\n \n - name: Install - Ensure that IPA client packages are installed\n   package:\n-    name: \"{{ item }}\"\n+    name: \"{{ ipaclient_packages }}\"\n     state: present\n-  with_items: \"{{ ipaclient_packages }}\"\n   when: ipaclient_install_packages | bool\n \n #- name: Install - Include Python2/3 import test"}, {"sha": "d018429f158cab2b664bd98b00e50fe3380d9dfd", "filename": "roles/ipaserver/tasks/uninstall.yml", "previous_filename": null, "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/freeipa/ansible-freeipa/blob/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipaserver/tasks/uninstall.yml", "raw_url": "https://github.com/freeipa/ansible-freeipa/raw/20e5338ad5acbc47e7a492323b19c9a22bdef3ab/roles/ipaserver/tasks/uninstall.yml", "status": "modified", "patch": "@@ -17,8 +17,7 @@\n   failed_when: uninstall.rc != 0 and uninstall.rc != 1\n   changed_when: uninstall.rc == 0\n \n-# - name: Remove IPA server packages\n-#   package:\n-#     name: \"{{ item }}\"\n-#     state: absent\n-#   with_items: \"{{ ipaserver_packages }}\"\n+#- name: Remove IPA server packages\n+#  package:\n+#    name: \"{{ ipaserver_packages }}\"\n+#    state: absent"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #48 and #49", "sha": "96adc61e360141bb718b75d48c387b3680a8471b", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/96adc61e360141bb718b75d48c387b3680a8471b", "parents": ["a8ade5b4788a5c3a0b5a65b2ca1845a65be8b451"], "files": [{"sha": "d9768af55f5e2ee9b5c04a49aa4c247eab0dba00", "filename": "tasks/main.yml", "previous_filename": null, "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/96adc61e360141bb718b75d48c387b3680a8471b/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/96adc61e360141bb718b75d48c387b3680a8471b/tasks/main.yml", "status": "modified", "patch": "@@ -67,3 +67,7 @@\n - name: Configure Docker\n   include_tasks: configure-docker.yml\n   tags: [\"configure\"]\n+\n+- name: Postinstall tasks\n+  include_tasks: postinstall.yml\n+  tags: [\"install\"]\n\\ No newline at end of file"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #13", "sha": "dfc0ba24f91ba11cb33f713bd44c861c8070c006", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/dfc0ba24f91ba11cb33f713bd44c861c8070c006", "parents": ["78b2001a2a68bb6526f50ae1e73f13e0dea1cbbd"], "files": [{"sha": "1b8fbe88430435dd9ce0ba47202fc2118e108584", "filename": "tasks/main-CentOS.yml", "previous_filename": null, "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/dfc0ba24f91ba11cb33f713bd44c861c8070c006/tasks/main-CentOS.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/dfc0ba24f91ba11cb33f713bd44c861c8070c006/tasks/main-CentOS.yml", "status": "modified", "patch": "@@ -37,7 +37,16 @@\n   become: true\n   when: yum_repo.changed\n \n+- name: Ensure fs.may_detach_mounts is set to avoid 'Device or resource busy'\n+  sysctl:\n+    name: fs.may_detach_mounts\n+    value: 1\n+    sysctl_file: /etc/sysctl.d/99-docker.conf\n+    reload: yes\n+  become: true\n+  when: ansible_kernel | version_compare('4', '<')\n+\n - include: main-Mountflags.yml\n-  when: \"{{ ansible_kernel | version_compare('4', '<') }}\"\n+  when: ansible_kernel | version_compare('4', '<')\n \n - include: main-Generic.yml"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #10", "sha": "0315cffc003795f2a535005d2d2cb2f2d5ac4635", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/0315cffc003795f2a535005d2d2cb2f2d5ac4635", "parents": ["72713725929f57e25faeb46be51811d88c57f4b4"], "files": [{"sha": "f9e383461e8e4b24b6e376f5f1220b148380792f", "filename": "tasks/main-Fedora.yml", "previous_filename": null, "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/0315cffc003795f2a535005d2d2cb2f2d5ac4635/tasks/main-Fedora.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/0315cffc003795f2a535005d2d2cb2f2d5ac4635/tasks/main-Fedora.yml", "status": "modified", "patch": "@@ -36,7 +36,4 @@\n   become: true\n   changed_when: false\n \n-- include: main-Storage.yml\n-  when: docker_setup_devicemapper == true\n-\n - include: main-Generic.yml\n\\ No newline at end of file"}, {"sha": "0397f62e61187b3e4120b513bfadb81d3abf34f8", "filename": "tasks/main-CentOS.yml", "previous_filename": null, "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/0315cffc003795f2a535005d2d2cb2f2d5ac4635/tasks/main-CentOS.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/0315cffc003795f2a535005d2d2cb2f2d5ac4635/tasks/main-CentOS.yml", "status": "modified", "patch": "@@ -37,9 +37,6 @@\n   become: true\n   when: yum_repo.changed\n \n-- include: main-Storage.yml\n-  when: docker_setup_devicemapper == true\n-\n - include: main-Mountflags.yml\n   when: \"{{ ansible_kernel | version_compare('4', '<') }}\"\n "}]}, {"repo": "kubevirt/kubevirt-ansible", "author_id": "MDQ6VXNlcjY3OTUyMTM=", "author_name": "Ryan Hallisey", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix deprovision for glusterfs after recent changes (#200)", "sha": "857bf53094db020c885933d3f72ac2fa4b1be095", "url": "https://api.github.com/repos/kubevirt/kubevirt-ansible/commits/857bf53094db020c885933d3f72ac2fa4b1be095", "parents": ["50058e3475e6781c225f7530234ccf4eccabe80b"], "files": [{"sha": "67e65105fc0b9fe18988478784d559160505fdfc", "filename": "roles/storage-glusterfs/tasks/deprovision.yml", "previous_filename": null, "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/857bf53094db020c885933d3f72ac2fa4b1be095/roles/storage-glusterfs/tasks/deprovision.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/857bf53094db020c885933d3f72ac2fa4b1be095/roles/storage-glusterfs/tasks/deprovision.yml", "status": "modified", "patch": "@@ -5,23 +5,29 @@\n         and admin_user is defined\n         and admin_password is defined\n \n-- block:\n-  - name: Copy glusterfile provisioner YAML\n-    copy:\n-      src: glusterfile-provisioner.yml\n-      dest: /tmp/glusterfile-provisioner.yml\n+- set_fact:\n+    glusterfs_name_label: \"{{ glusterfs_name }}{% if glusterfs_name %}-{% endif %}\"\n+\n+- name: Determine the heketi route\n+  command: \"oc get route -n {{ glusterfs_namespace }} -l heketi={{ glusterfs_name_label }}route -o jsonpath='{.items[0].spec.host}'\"\n+  register: route_cmd\n+  when:\n+    - cluster == 'openshift'\n+    - heketi_url is not defined\n \n-  - name: Delete glusterfile provisioner pod\n-    command: \"kubectl delete -n {{ namespace }} -f /tmp/glusterfile-provisioner.yml --ignore-not-found\"\n-  when: external_provisioner\n+- set_fact:\n+    heketi_url: \"{{ route_cmd.stdout }}\"\n+  when: route_cmd is defined\n \n - name: Get heketi admin key\n-  command: \"oc get secret {{ heketi_secret_name }} -n {{ namespace }} -o jsonpath='{.data.key}'\"\n+  shell: \"kubectl get pod -n {{ glusterfs_namespace }} -l heketi={{ glusterfs_name_label }}pod -o jsonpath='{.items[0].spec.containers[0].env[?(@.name==\\\"HEKETI_ADMIN_KEY\\\")].value}' | base64 -\"\n   register: key_cmd\n+  when: heketi_admin_key is not defined\n \n - set_fact:\n     heketi_admin_key: \"{{ key_cmd.stdout }}\"\n-    \n+  when: heketi_admin_key is not defined\n+\n - name: Render storage-glusterfs deployment yaml\n   template:\n     src: storage-glusterfs.yml.j2"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjg5MjkyMzM=", "author_name": "Wolfgang Kulhanek", "committer_id": "MDQ6VXNlcjExOTEyODU=", "committer_name": "Andrew Block", "committer_email": "andy.block@gmail.com", "message": "Fixed ssl_local_tmp_dir.stdout in Task Set Fact for Custom SSL Certificates (#247)\n\n* Rearranged variables\r\n\r\n* Fixed logic when to generate passwords\r\n\r\n* Fixed firewall port variables and firewalld command\r\n\r\n* Fixed Firewalld config command\r\n\r\n* Fixed quay service name\r\n\r\n* Fixed service name\r\n\r\n* Fixed port variable and firewalld command\r\n\r\n* Fixed location of inventory\r\n\r\n* Fixed postgres service name\r\n\r\n* Fixed template names\r\n\r\n* Fixed port variable names, fixed firewalld command\r\n\r\n* Minor formatting updates (quay -> Quay)\r\n\r\n* Fixed quay service variable name\r\n\r\n* Added become:True where appropriate, changed database parameters to MySQL database, added postgresql_admin_user to postgres tasks, removed block around clair database, added logic to set quay hostname for clair when lb defined\r\n\r\n* Fixed wrong quay_ssl_local_tmp_dir variable in Task Set Fact for Custom SSL Certificates", "sha": "50c8452cf5028af3b0855bd16c48a04249603b8a", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/50c8452cf5028af3b0855bd16c48a04249603b8a", "parents": ["83a79a9f8c1054117e69e39e9e562803241dc7bc"], "files": [{"sha": "f8b3cf0a809199f0ade31c169b04c1244a0db43a", "filename": "roles/config-quay-enterprise/tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/50c8452cf5028af3b0855bd16c48a04249603b8a/roles/config-quay-enterprise/tasks/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/50c8452cf5028af3b0855bd16c48a04249603b8a/roles/config-quay-enterprise/tasks/main.yml", "status": "modified", "patch": "@@ -48,8 +48,8 @@\n \n - name: Set Fact for Custom SSL Certificates\n   set_fact:\n-    quay_ssl_cert_file: \"{{ ssl_local_tmp_dir.stdout }}/ssl.cert\"\n-    quay_ssl_key_file: \"{{ ssl_local_tmp_dir.stdout }}/ssl.key\"\n+    quay_ssl_cert_file: \"{{ quay_ssl_local_tmp_dir.stdout }}/ssl.cert\"\n+    quay_ssl_key_file: \"{{ quay_ssl_local_tmp_dir.stdout }}/ssl.key\"\n   when: quay_ssl_enable|bool and (quay_ssl_key_file is defined and quay_ssl_key_file|trim != \"\" and quay_ssl_cert_file is defined and quay_ssl_cert_file|trim != \"\")\n \n - name: Create SSL Certificates"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjIyNTk4MzQ=", "author_name": "Tang Rufus", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix `DEPLOY_UNFINISHED` not being copied over to `release` (#1145)\n\nFix `DEPLOY_UNFINISHED` not being copied over to `release`", "sha": "1bc2bf16e7f89f92f002c2e04d3769373ee9778d", "url": "https://api.github.com/repos/roots/trellis/commits/1bc2bf16e7f89f92f002c2e04d3769373ee9778d", "parents": ["ab70d8ed84ef54054de2024e5c2639e047c0b905", "6cc4fc763dd7be8ad4a430a0b31dc05833d7be73"], "files": [{"sha": "2d05f4df8e77d5445e65dfa59759fd4671c0388d", "filename": "roles/deploy/tasks/prepare.yml", "previous_filename": null, "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/roots/trellis/blob/1bc2bf16e7f89f92f002c2e04d3769373ee9778d/roles/deploy/tasks/prepare.yml", "raw_url": "https://github.com/roots/trellis/raw/1bc2bf16e7f89f92f002c2e04d3769373ee9778d/roles/deploy/tasks/prepare.yml", "status": "modified", "patch": "@@ -5,11 +5,6 @@\n     loop_var: include_path\n   tags: deploy-prepare-before\n \n-- name: write unfinished file\n-  file:\n-    path: \"{{ project_source_path }}/{{ deploy_helper.unfinished_filename }}\"\n-    state: touch\n-\n - name: Check for project repo subtree\n   stat:\n     path: \"{{ project_source_path }}/{{ project.repo_subtree_path }}\"\n@@ -38,6 +33,11 @@\n     chdir: \"{{ project_source_path }}\"\n   when: project.repo_subtree_path is defined\n \n+- name: write unfinished file\n+  file:\n+    path: \"{{ deploy_helper.new_release_path }}/{{ deploy_helper.unfinished_filename }}\"\n+    state: touch\n+\n - include_tasks: \"{{ include_path }}\"\n   with_items: \"{{ deploy_prepare_after | default([]) }}\"\n   loop_control:"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #82", "sha": "d2f56ff7e3ee0b349c65ebc6ccf42c5a0cd9fbbf", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/d2f56ff7e3ee0b349c65ebc6ccf42c5a0cd9fbbf", "parents": ["7cf1d9b6695a2348109e7fb11e68a0505d58cfd4"], "files": [{"sha": "d20be8736af548d03e2c94dbc0f9822c876499ca", "filename": "tasks/main.yml", "previous_filename": null, "additions": 29, "deletions": 22, "changes": 51, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/d2f56ff7e3ee0b349c65ebc6ccf42c5a0cd9fbbf/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/d2f56ff7e3ee0b349c65ebc6ccf42c5a0cd9fbbf/tasks/main.yml", "status": "modified", "patch": "@@ -36,31 +36,38 @@\n   when: docker_do_checks | bool\n   tags: [\"always\"]\n \n-- name: Setup Docker package repositories\n-  include_tasks: setup-repository.yml\n-  tags: [\"install\"]\n+- name: Install and configure Docker CE\n+  block:\n+    - name: Setup Docker package repositories\n+      include_tasks: setup-repository.yml\n+      tags: [\"install\"]\n \n-- name: Remove Docker versions before Docker CE\n-  include_tasks: remove-pre-docker-ce.yml\n-  when: docker_remove_pre_ce | bool\n-  tags: [\"install\"]\n+    - name: Remove Docker versions before Docker CE\n+      include_tasks: remove-pre-docker-ce.yml\n+      when: docker_remove_pre_ce | bool\n+      tags: [\"install\"]\n \n-- name: Install Docker\n-  include_tasks: install-docker.yml\n-  tags: [\"install\"]\n+    - name: Install Docker\n+      include_tasks: install-docker.yml\n+      tags: [\"install\"]\n \n-- name: Configure audit logging\n-  include_tasks: setup-audit.yml\n-  tags: [\"configure\"]\n+    - name: Configure audit logging\n+      include_tasks: setup-audit.yml\n+      tags: [\"configure\"]\n \n-- name: Apply workarounds for bugs and/or tweaks\n-  include_tasks: bug-tweaks.yml\n-  tags: [\"configure\"]\n+    - name: Apply workarounds for bugs and/or tweaks\n+      include_tasks: bug-tweaks.yml\n+      tags: [\"configure\"]\n \n-- name: Configure Docker\n-  include_tasks: configure-docker.yml\n-  tags: [\"configure\"]\n+    - name: Configure Docker\n+      include_tasks: configure-docker.yml\n+      tags: [\"configure\"]\n \n-- name: Postinstall tasks\n-  include_tasks: postinstall.yml\n-  tags: [\"install\"]\n\\ No newline at end of file\n+    - name: Postinstall tasks\n+      include_tasks: postinstall.yml\n+      tags: [\"install\"]\n+  when: not docker_remove | bool\n+\n+- name: Remove Docker CE and related configuration\n+  include_tasks: uninstall-docker.yml\n+  when: docker_remove | bool"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #68", "sha": "613c3eff6ea2eed2ea9300362f8cbf2314040cf2", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/613c3eff6ea2eed2ea9300362f8cbf2314040cf2", "parents": ["c3465ba3178bd0acfd8c0e06e9f7529be506008b"], "files": [{"sha": "9d3889542142d4468c9f7b3cc8e70c8c84ee7d83", "filename": "tasks/postinstall.yml", "previous_filename": null, "additions": 56, "deletions": 8, "changes": 64, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/613c3eff6ea2eed2ea9300362f8cbf2314040cf2/tasks/postinstall.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/613c3eff6ea2eed2ea9300362f8cbf2314040cf2/tasks/postinstall.yml", "status": "modified", "patch": "@@ -79,18 +79,66 @@\n     url: https://api.github.com/repos/docker/compose/releases/latest\n     body_format: json\n   register: _github_docker_compose\n-  when:\n-    - docker_compose_no_pip\n+  until: _github_docker_compose.status == 200\n+  retries: 10\n+  when: \n+    - docker_compose\n+\n+- name: Set common facts related to docker-compose\n+  set_fact:\n+    _docker_compose_shasum_url: \"https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/\\\n+      docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n+    _docker_compose_url: \"https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/\\\n+      docker-compose-{{ ansible_system }}-{{ ansible_architecture }}\"\n+  when: \n+    - docker_compose\n+\n+- name: Fetch docker-compose SHA265 sum file\n+  get_url: \n+    url: \"{{ _docker_compose_shasum_url }}\"\n+    dest: \"/tmp/ansible.docker-compose-sha256\"\n+  register: _github_docker_compose_shasum_file\n+  changed_when: false\n+  until: _github_docker_compose_shasum_file.status_code == 200\n+  retries: 10\n+  when: \n+    - docker_compose\n+\n+- name: Dump SHA256 file contents to variable\n+  command: cat /tmp/ansible.docker-compose-sha256\n+  register: _github_docker_compose_shasum\n+  changed_when: false\n+  when: \n+    - docker_compose\n+\n+- name: Remove temporary file for SHA256 sum\n+  file:\n+    path: \"/tmp/ansible.docker-compose-sha256\"\n+    state: absent\n+  changed_when: false\n+  when: \n+    - docker_compose\n+\n+- name: Set SHA256 facts related to docker-compose\n+  set_fact:\n+    _docker_compose_checksum: \"sha256:{{ _github_docker_compose_shasum.stdout | regex_replace('^([0-9a-zA-Z]*)[\\\\s\\\\t]+.+', '\\\\1') }}\"\n+  when: \n+    - docker_compose\n+\n+# Use when moving to Ansible 2.7 as minimum version\n+# - name: Set SHA256 facts related to docker-compose (Ansible >= 2.7)\n+#   set_fact:\n+#     _docker_compose_checksum: \"sha256:https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/\\\n+#       docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n+#   when: ansible_version.full is version_compare('2.7', '>=')\n \n # Official installation of docker-compose (Linux): https://docs.docker.com/compose/install/#install-compose\n - name: Install docker-compose (Linux)\n   become: true\n   get_url:\n-    url: \"https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/\\\n-      docker-compose-{{ ansible_system }}-{{ ansible_architecture }}\"\n-    checksum: \"sha256:https://github.com/docker/compose/releases/download/{{ _github_docker_compose.json.tag_name }}/\\\n-      docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n+    url: \"{{ _docker_compose_url }}\"\n+    checksum: \"{{ _docker_compose_checksum }}\"\n     dest: /usr/local/bin/docker-compose\n     mode: 0755\n-  when:\n-    - docker_compose_no_pip\n+  when: \n+    - docker_compose"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #53", "sha": "8ed96ef6058f3dd9aef8b0e697aa91038e376f09", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/8ed96ef6058f3dd9aef8b0e697aa91038e376f09", "parents": ["0bcae9c149da81c95791b18394d0c789e65ef417"], "files": [{"sha": "7eb51932988fa7e4e7e55e89411775ad69a1669e", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/8ed96ef6058f3dd9aef8b0e697aa91038e376f09/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/8ed96ef6058f3dd9aef8b0e697aa91038e376f09/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -38,6 +38,14 @@\n         docker_daemon_config['userns-remap'] == 'default') or\n         docker_bug_usermod|bool == true)\n \n+- name: Ensure Docker users are added to the docker group\n+  become: true\n+  user:\n+    name: \"{{ item }}\"\n+    groups: docker\n+    append: true\n+  with_items: \"{{ docker_users }}\"\n+\n - name: Ensure thin-provisioning-tools is installed when devicemapper is used (Ubuntu)\n   become: true\n   package:"}]}, {"repo": "iiab/iiab", "author_id": "MDQ6VXNlcjI0NTg5MDc=", "author_name": "A Holt", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #955 from holta/nextcloud-download-wo-cert\n\nTEMP Fixes #954 [download.nextcloud.com's SSL/TLS cert expired 2018-07-22 preventing MEDIUM+BIG IIAB installs]", "sha": "e81d4a6c8b579efb8fbd0e6e69566d1b30270538", "url": "https://api.github.com/repos/iiab/iiab/commits/e81d4a6c8b579efb8fbd0e6e69566d1b30270538", "parents": ["772a200a5ccd3a91eec54fe17ab86086d60269cb", "881783dee2bad2dc82aded0089c3eb34a1f65902"], "files": [{"sha": "136bfea1aa88de195524f4815dd0265eaaf0cbc3", "filename": "roles/nextcloud/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/iiab/iiab/blob/e81d4a6c8b579efb8fbd0e6e69566d1b30270538/roles/nextcloud/tasks/main.yml", "raw_url": "https://github.com/iiab/iiab/raw/e81d4a6c8b579efb8fbd0e6e69566d1b30270538/roles/nextcloud/tasks/main.yml", "status": "modified", "patch": "@@ -18,6 +18,7 @@\n     url: \"{{ nextcloud_dl_url }}/{{ nextcloud_orig_src_file }}\"\n     dest: \"{{ downloads_dir }}/{{ nextcloud_src_file }}\"\n     force: yes\n+    validate_certs: False    # TEMPORARY ON/AFTER 2018-07-22 AS download.nextcloud.com CERT EXPIRED: https://github.com/iiab/iiab/issues/954\n     timeout: \"{{ download_timeout }}\"\n   when: internet_available and nextcloud_force_install\n   async: 900"}]}, {"repo": "geerlingguy/ansible-role-security", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #17: Add UseDNS option, default to 'no'.", "sha": "61357eda4b21a48e16239ce3a696b33fbe8c0106", "url": "https://api.github.com/repos/geerlingguy/ansible-role-security/commits/61357eda4b21a48e16239ce3a696b33fbe8c0106", "parents": ["350d4b474eefedf96be99a949b110b53214c45f2"], "files": [{"sha": "7303efd90a32a99bb92f4c0605de1f8d718a5c57", "filename": "tasks/ssh.yml", "previous_filename": null, "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/geerlingguy/ansible-role-security/blob/61357eda4b21a48e16239ce3a696b33fbe8c0106/tasks/ssh.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-security/raw/61357eda4b21a48e16239ce3a696b33fbe8c0106/tasks/ssh.yml", "status": "modified", "patch": "@@ -12,6 +12,8 @@\n       line: \"PermitRootLogin {{ security_ssh_permit_root_login }}\"\n     - regexp: \"^Port\"\n       line: \"Port {{ security_ssh_port }}\"\n+    - regexp: \"^UseDNS\"\n+      line: \"UseDNS {{ security_ssh_usedns }}\"\n   notify: restart ssh\n \n - name: Add configured user accounts to passwordless sudoers."}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "haxorof", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "haxorof", "committer_email": "bjorn.oscarsson@gmail.com", "message": "Fixes #2", "sha": "23d89498e8b43ab624b6e832c34b722ae49f106d", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/23d89498e8b43ab624b6e832c34b722ae49f106d", "parents": ["ea2d350c7988c8583069d78ff3453c033754724d"], "files": [{"sha": "1c319c0956b5987c5ad722c9e6a5f7f1d3cd6b4b", "filename": "tasks/main-Generic.yml", "previous_filename": null, "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/23d89498e8b43ab624b6e832c34b722ae49f106d/tasks/main-Generic.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/23d89498e8b43ab624b6e832c34b722ae49f106d/tasks/main-Generic.yml", "status": "modified", "patch": "@@ -46,6 +46,13 @@\n   become: true\n   notify: restart docker\n \n+- name: Ensure /etc/docker directory exists\n+  file:\n+    path: /etc/docker\n+    state: directory\n+    mode: 0755\n+  become: true\n+\n - name: Configure Docker daemon\n   copy:\n     content: \"{{docker_daemon_config | to_nice_json}}\""}]}, {"repo": "ansible-ThoTeam/nexus3-oss", "author_id": "MDQ6VXNlcjE3Njc3Ng==", "author_name": "Olivier Clavel", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #27 from ansible-ThoTeam/fix_deleteDefaultYumBlobstore\n\nFix delete default yum blobstore\r\n\r\nFixes #25", "sha": "9be2150751e520e30029b63a32380e7241182b2b", "url": "https://api.github.com/repos/ansible-ThoTeam/nexus3-oss/commits/9be2150751e520e30029b63a32380e7241182b2b", "parents": ["332a49aab4cd78a3427bf2944906cb452b69e292", "bea94ffb523c8f6fe8a8b1984e5058d2d049e52b"], "files": [{"sha": "21cf630da2ecfe9f63d0657aa133006246bfd090", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ansible-ThoTeam/nexus3-oss/blob/9be2150751e520e30029b63a32380e7241182b2b/tasks/main.yml", "raw_url": "https://github.com/ansible-ThoTeam/nexus3-oss/raw/9be2150751e520e30029b63a32380e7241182b2b/tasks/main.yml", "status": "modified", "patch": "@@ -47,6 +47,7 @@\n     - name: \"{{ nexus_blob_names.nuget.blob }}\"\n     - name: \"{{ nexus_blob_names.mvn.blob }}\"\n     - name: \"{{ nexus_blob_names.gitlfs.blob }}\"\n+    - name: \"{{ nexus_blob_names.yum.blob }}\"\n   when: nexus_data_dir_contents.stdout == \"\" and nexus_delete_default_blobstore\n \n - include: setup_ldap_each.yml"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #95 #94 #87", "sha": "f25f869adbb0c5fc2f4012afe6d06ea6f3c58361", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/f25f869adbb0c5fc2f4012afe6d06ea6f3c58361", "parents": ["678ab977f1395c4051c8c2eed112bcbf4e86ec92"], "files": [{"sha": "3c84f289e292dec7eaea3cc6236a69e6e72d974b", "filename": "tasks/setup-repository-Fedora.yml", "previous_filename": null, "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f25f869adbb0c5fc2f4012afe6d06ea6f3c58361/tasks/setup-repository-Fedora.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f25f869adbb0c5fc2f4012afe6d06ea6f3c58361/tasks/setup-repository-Fedora.yml", "status": "modified", "patch": "@@ -4,7 +4,8 @@\n   raw: dnf install -y python2 python2-dnf libselinux-python\n   changed_when: false\n   when:\n-    - docker_network_access\n+    - docker_network_access | bool\n+    - ansible_python_version is version_compare('3', '<')\n \n - name: Include tasks from setup of repositories for CentOS\n   include_tasks: setup-repository-CentOS.yml\n\\ No newline at end of file"}, {"sha": "124870f1801fb4025f9627b35d1d9be3460a5bd5", "filename": "tasks/setup-repository-Debian.yml", "previous_filename": null, "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f25f869adbb0c5fc2f4012afe6d06ea6f3c58361/tasks/setup-repository-Debian.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f25f869adbb0c5fc2f4012afe6d06ea6f3c58361/tasks/setup-repository-Debian.yml", "status": "modified", "patch": "@@ -1,12 +1,3 @@\n ---\n - name: Include tasks from setup of repositories for Ubuntu\n   include_tasks: setup-repository-Ubuntu.yml\n-\n-# Backport is required but not documented by Docker: https://github.com/moby/moby/issues/16878\n-- name: Add backport repository for Debian Wheezy\n-  become: true\n-  apt_repository:\n-    repo: deb [arch=amd64] http://ftp.debian.org/debian wheezy-backports main\n-    state: present\n-    filename: 'debian-backport'\n-  when: _docker_os_dist_major_version == '7'\n\\ No newline at end of file"}, {"sha": "3e4ac911d2f1bfa99db2a1a892209c171754ba3d", "filename": "tasks/postinstall.yml", "previous_filename": null, "additions": 131, "deletions": 94, "changes": 225, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/f25f869adbb0c5fc2f4012afe6d06ea6f3c58361/tasks/postinstall.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/f25f869adbb0c5fc2f4012afe6d06ea6f3c58361/tasks/postinstall.yml", "status": "modified", "patch": "@@ -3,57 +3,86 @@\n   set_fact:\n     _docker_additional_packages_os: []\n     _docker_additional_packages_pip: []\n-    _docker_python_system: false\n-\n-- name: Do best effort detection and set fact to indicate system Python environment is used\n-  set_fact:\n-    _docker_python_system: true\n-  when: ansible_python.executable | regex_search('^/bin') or ansible_python.executable | regex_search('^/usr/bin')\n+    _docker_python3: \"{{ ansible_python_version is version_compare('3', '>=') }}\"\n \n - name: Set facts to install Docker SDK for Python\n   set_fact:\n     _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + \\\n       docker_predefined_packages_pip[_docker_os_dist]['sdk'] }}\"\n   when:\n-    - docker_sdk\n+    - docker_sdk | bool\n \n - name: Set facts to install Docker Compose\n   set_fact:\n     _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + \\\n       docker_predefined_packages_pip[_docker_os_dist]['compose'] }}\"\n   when:\n-    - docker_compose and not docker_compose_no_pip\n+    - docker_compose | bool and not docker_compose_no_pip | bool\n \n - name: Set facts to install Docker Stack dependencies ('docker_stack')\n   set_fact:\n     _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + \\\n       docker_predefined_packages_pip[_docker_os_dist]['stack'] }}\"\n   when:\n-    - docker_stack\n+    - docker_stack | bool\n \n - name: Set facts with additional package to be installed\n   set_fact:\n     _docker_additional_packages_pip: \"{{ _docker_additional_packages_pip + docker_additional_packages_pip }}\"\n     _docker_additional_packages_os: \"{{ _docker_additional_packages_os + docker_additional_packages_os }}\"\n \n-- name: Determine if pip exists in path\n-  become: true\n-  shell: type pip\n-  register: _docker_pip_cmd\n-  changed_when: false\n-  failed_when: false\n-  check_mode: no\n-  tags:\n-    - skip_ansible_lint\n-  when:\n-    - _docker_additional_packages_pip | length > 0\n-\n-- name: Set fact to install Python PiP\n-  set_fact:\n-    _docker_additional_packages_os: \"{{ _docker_additional_packages_os + [docker_pip_package] }}\"\n+- name: Ensure required OS packages will be installed for PiP\n+  block:\n+    - name: Determine if pip/pip3 exists in path\n+      become: true\n+      shell: type {{ _docker_python3 | ternary('pip3', 'pip') }}\n+      register: _docker_pip_cmd\n+      changed_when: false\n+      failed_when: false\n+      check_mode: no\n+      tags:\n+        - skip_ansible_lint\n+\n+    - name: Set fact to install Python 2 PiP\n+      set_fact:\n+        _docker_additional_packages_os: \"{{ _docker_additional_packages_os + [docker_pip_package] }}\"\n+      when:\n+        - not _docker_python3 | bool\n+        - _docker_pip_cmd.rc != 0\n+\n+    - name: Set fact to install Python 3 PiP\n+      set_fact:\n+        _docker_additional_packages_os: \"{{ _docker_additional_packages_os + [docker_pip3_package] }}\"\n+      when:\n+        - _docker_python3 | bool\n+        - _docker_pip_cmd.rc != 0\n+\n+    - name: Set fact to install build libraries (CentOS/Fedora/RedHat)\n+      set_fact:\n+        _docker_additional_packages_os: \"{{ _docker_additional_packages_os + ['openssl-devel'] }}\"\n+      when:\n+        - (_docker_os_dist == \"CentOS\" or _docker_os_dist == \"Fedora\" or _docker_os_dist == \"RedHat\")\n+\n+    - name: Set fact to install build libraries [General] (Fedora)\n+      set_fact:\n+        _docker_additional_packages_os: \"{{ _docker_additional_packages_os + ['redhat-rpm-config','make','libffi-devel','gcc'] }}\"\n+      when:\n+        - _docker_os_dist == \"Fedora\"\n+\n+    - name: Set fact to install build libraries [Python 3] (Fedora)\n+      set_fact:\n+        _docker_additional_packages_os: \"{{ _docker_additional_packages_os + ['python3-devel'] }}\"\n+      when:\n+        - _docker_python3 | bool\n+        - _docker_os_dist == \"Fedora\"\n+\n+    - name: Set fact to install build libraries (Debian/Ubuntu)\n+      set_fact:\n+        _docker_additional_packages_os: \"{{ _docker_additional_packages_os + ['libffi-dev', 'libssl-dev'] }}\"\n+      when:\n+        - (_docker_os_dist == \"Debian\" or _docker_os_dist == \"Ubuntu\")\n   when:\n     - _docker_additional_packages_pip | length > 0\n-    - _docker_pip_cmd.rc != 0\n \n - name: Ensure python-pip-whl is present (Debian 8)\n   set_fact:\n@@ -93,7 +122,7 @@\n     state: forcereinstall\n   register: _pkg_result\n   until: _pkg_result is succeeded\n-  when: docker_pip_upgrade\n+  when: docker_pip_upgrade | bool\n \n - name: Install additional packages (PiP)\n   become: \"{{ docker_pip_sudo | bool }}\"\n@@ -109,70 +138,14 @@\n   environment:\n     PYTHONWARNINGS: ignore\n \n-# Not using github_release:  https://github.com/ansible/ansible/issues/45391\n-- name: Get latest release of docker-compose\n-  uri:\n-    url: https://api.github.com/repos/docker/compose/releases/latest\n-    body_format: json\n-  register: _github_docker_compose\n-  until: _github_docker_compose.status == 200\n-  retries: 10\n-  check_mode: no\n-  when:\n-    - docker_compose\n-\n-- name: Set common facts related to docker-compose\n-  set_fact:\n-    _docker_compose_shasum_url: \"https://github.com/docker/compose/releases/download/\\\n-      {{ _github_docker_compose.json.tag_name }}/docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n-    _docker_compose_url: \"https://github.com/docker/compose/releases/download/\\\n-      {{ _github_docker_compose.json.tag_name }}/docker-compose-{{ ansible_system }}-{{ ansible_architecture }}\"\n-  when:\n-    - docker_compose\n-\n-- name: Fetch docker-compose SHA265 sum file\n-  get_url:\n-    url: \"{{ _docker_compose_shasum_url }}\"\n-    dest: \"/tmp/ansible.docker-compose-sha256\"\n-  register: _github_docker_compose_shasum_file\n-  changed_when: false\n-  until: _github_docker_compose_shasum_file.status_code == 200\n-  retries: 10\n-  check_mode: no\n-  when:\n-    - docker_compose\n-\n-- name: Dump SHA256 file contents to variable\n-  command: cat /tmp/ansible.docker-compose-sha256\n-  register: _github_docker_compose_shasum\n-  changed_when: false\n-  check_mode: no\n-  when:\n-    - docker_compose\n-\n-- name: Remove temporary file for SHA256 sum\n-  file:\n-    path: \"/tmp/ansible.docker-compose-sha256\"\n-    state: absent\n-  changed_when: false\n-  check_mode: no\n-  when:\n-    - docker_compose\n-\n-- name: Set SHA256 facts related to docker-compose\n-  set_fact:\n-    _docker_compose_checksum: \"sha256:{{ _github_docker_compose_shasum.stdout | \\\n-      regex_replace('^([0-9a-zA-Z]*)[\\\\s\\\\t]+.+', '\\\\1') }}\"\n-  when:\n-    - docker_compose\n-\n-# Use when moving to Ansible 2.7 as minimum version\n-# - name: Set SHA256 facts related to docker-compose (Ansible >= 2.7)\n-#   set_fact:\n-#     _docker_compose_checksum: \"sha256:https://github.com/docker/compose/releases/download/\\\n-#       {{ _github_docker_compose.json.tag_name }}/\\\n-#       docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n-#   when: ansible_version.full is version_compare('2.7', '>=')\n+# https://github.com/docker/docker-py/issues/1502\n+- name: Workaround for issue - No module named ssl_match_hostname (Python 2.7)\n+  become: yes\n+  command: cp -r /usr/local/lib/python2.7/dist-packages/backports/ssl_match_hostname/ /usr/lib/python2.7/dist-packages/backports\n+  when: \n+    - docker_x_ssl_match_hostname | bool\n+    - _docker_additional_packages_pip | length > 0\n+    - not _docker_python3 | bool\n \n - name: Stat /usr/bin/docker-compose\n   stat:\n@@ -181,12 +154,75 @@\n   check_mode: no\n \n # Official installation of docker-compose (Linux): https://docs.docker.com/compose/install/#install-compose\n-- name: Install docker-compose\n+- name: Install docker-compose without PiP\n   block:\n-    - name: Install docker-compose (Linux)\n+    # Not using github_release:  https://github.com/ansible/ansible/issues/45391\n+    - name: Get latest release of docker-compose\n+      uri:\n+        url: https://api.github.com/repos/docker/compose/releases/latest\n+        body_format: json\n+      register: _github_docker_compose\n+      until: _github_docker_compose.status == 200\n+      retries: 10\n+      check_mode: no\n+      when:\n+        - docker_compose_no_pip_detect_version | bool\n+\n+    - name: Set detected docker-compose version\n+      set_fact:\n+        _docker_compose_version: \"{{ _github_docker_compose.json.tag_name }}\"\n+      when:\n+        - _github_docker_compose is defined\n+        - _github_docker_compose.json is defined\n+\n+    - name: Set fixed docker-compose version\n+      set_fact:\n+        _docker_compose_version: \"{{ docker_compose_no_pip_version }}\"\n+      when:\n+        - not docker_compose_no_pip_detect_version | bool\n+\n+    - name: Fetch docker-compose SHA265 sum file\n+      get_url:\n+        url: \"https://github.com/docker/compose/releases/download/\\\n+          {{ _docker_compose_version }}/docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n+        dest: \"/tmp/ansible.docker-compose-sha256\"\n+      register: _github_docker_compose_shasum_file\n+      changed_when: false\n+      until: _github_docker_compose_shasum_file.status_code == 200\n+      retries: 10\n+      check_mode: no\n+\n+    - name: Dump SHA256 file contents to variable\n+      command: cat /tmp/ansible.docker-compose-sha256\n+      register: _github_docker_compose_shasum\n+      changed_when: false\n+      check_mode: no\n+\n+    - name: Remove temporary file for SHA256 sum\n+      file:\n+        path: \"/tmp/ansible.docker-compose-sha256\"\n+        state: absent\n+      changed_when: false\n+      check_mode: no\n+\n+    - name: Set SHA256 facts related to docker-compose\n+      set_fact:\n+        _docker_compose_checksum: \"sha256:{{ _github_docker_compose_shasum.stdout | \\\n+          regex_replace('^([0-9a-zA-Z]*)[\\\\s\\\\t]+.+', '\\\\1') }}\"\n+\n+    # Use when moving to Ansible 2.7 as minimum version\n+    # - name: Set SHA256 facts related to docker-compose (Ansible >= 2.7)\n+    #   set_fact:\n+    #     _docker_compose_checksum: \"sha256:https://github.com/docker/compose/releases/download/\\\n+    #       {{ _github_docker_compose.json.tag_name }}/\\\n+    #       docker-compose-{{ ansible_system }}-{{ ansible_architecture }}.sha256\"\n+    #   when: ansible_version.full is version_compare('2.7', '>=')\n+    \n+    - name: Install docker-compose {{ _docker_compose_version }} (Linux)\n       become: true\n       get_url:\n-        url: \"{{ _docker_compose_url }}\"\n+        url: \"https://github.com/docker/compose/releases/download/\\\n+          {{ _docker_compose_version }}/docker-compose-{{ ansible_system }}-{{ ansible_architecture }}\"\n         checksum: \"{{ _docker_compose_checksum }}\"\n         dest: /usr/local/bin/docker-compose\n         mode: 0755\n@@ -198,5 +234,6 @@\n         dest: /usr/bin/docker-compose\n         state: link\n   when:\n-    - docker_compose\n+    - docker_compose | bool\n+    - docker_compose_no_pip | bool\n     - not _docker_compose_file.stat.exists"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "haxorof", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "haxorof", "committer_email": "bjorn.oscarsson@gmail.com", "message": "Fixes #5", "sha": "af995622de049010a8c2fc9e12f4151430b4ae0b", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/af995622de049010a8c2fc9e12f4151430b4ae0b", "parents": ["690360fffc5bdb505f7804c158dba0b37a23abb5"], "files": [{"sha": "bf37dee844c58fbf44cf1719821ca7176b912e00", "filename": "tasks/main-Fedora.yml", "previous_filename": null, "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/af995622de049010a8c2fc9e12f4151430b4ae0b/tasks/main-Fedora.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/af995622de049010a8c2fc9e12f4151430b4ae0b/tasks/main-Fedora.yml", "status": "modified", "patch": "@@ -11,6 +11,8 @@\n \n - name: Determine Docker CE Edge repo status\n   shell: dnf config-manager --dump docker-ce-edge | grep enabled\n+  args:\n+    warn: false\n   ignore_errors: yes\n   changed_when: false\n   register: cmd_docker_ce_edge_enabled"}, {"sha": "216eaa495d8af4dfe0ec808c9f6df3093bb0f22a", "filename": "handlers/main.yml", "previous_filename": null, "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/af995622de049010a8c2fc9e12f4151430b4ae0b/handlers/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/af995622de049010a8c2fc9e12f4151430b4ae0b/handlers/main.yml", "status": "modified", "patch": "@@ -5,4 +5,11 @@\n   service:\n     name: docker\n     state: restarted\n-  become: true\n\\ No newline at end of file\n+  become: true\n+\n+# Workaround because systemd cannot be used: https://github.com/ansible/ansible/issues/22171\n+- name: restart auditd\n+  shell: service auditd restart\n+  args:\n+    warn: false\n+  become: true"}, {"sha": "21e7709739185e0e50c917f3f947c9d33090d764", "filename": "tasks/main-Generic.yml", "previous_filename": null, "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/af995622de049010a8c2fc9e12f4151430b4ae0b/tasks/main-Generic.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/af995622de049010a8c2fc9e12f4151430b4ae0b/tasks/main-Generic.yml", "status": "modified", "patch": "@@ -1,6 +1,22 @@\n ---\n # tasks file for ansible-role-docker-ce\n \n+- name: Copy Docker audit rules\n+  copy:\n+    src: files/etc/audit/rules.d/docker.rules\n+    dest: /etc/audit/rules.d/docker.rules\n+  become: yes\n+  notify: restart auditd\n+  when: docker_enable_audit == true\n+\n+- name: Ensure Docker audit rules are removed\n+  file:\n+    path: /etc/audit/rules.d/docker.rules\n+    state: absent\n+  become: yes\n+  notify: restart auditd\n+  when: docker_enable_audit == false\n+\n - name: Determine Docker version\n   command: bash -c \"docker version | grep Version | awk '{print $2}'\"\n   ignore_errors: yes"}]}, {"repo": "lean-delivery/ansible-role-java", "author_id": "MDQ6VXNlcjEwMTM5NjQ1", "author_name": "Vitali Stanevich", "committer_id": "MDQ6VXNlcjg1MDMwMTM=", "committer_name": "Ivan Bogomazov", "committer_email": "ivan.bogomazov@gmail.com", "message": "fix issue #16 (#17)\n\n'ansible_facts.system' returns 'Win32' instead of 'Windows'\r\nso replaced with 'ansible_os_family'", "sha": "b6140f1c7f43ea012889046b2c4cce9700680198", "url": "https://api.github.com/repos/lean-delivery/ansible-role-java/commits/b6140f1c7f43ea012889046b2c4cce9700680198", "parents": ["e1188f4fa1eaff591507f285fee948ea86bbb378"], "files": [{"sha": "9997bedbcd3ebcfbd49999383a7a07937779c500", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/lean-delivery/ansible-role-java/blob/b6140f1c7f43ea012889046b2c4cce9700680198/tasks/main.yml", "raw_url": "https://github.com/lean-delivery/ansible-role-java/raw/b6140f1c7f43ea012889046b2c4cce9700680198/tasks/main.yml", "status": "modified", "patch": "@@ -11,7 +11,7 @@\n - name: \"Choose platform based task \"\n   include_tasks: \"{{ platform }}\"\n   with_first_found:\n-    - \"system/{{ ansible_facts.system }}.yml\"\n+    - \"system/{{ ansible_os_family }}.yml\"\n     - \"system/not-supported.yml\"\n   loop_control:\n     loop_var: platform"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fixes #374 - Remove composer vendor/bin from $PATH\n\nRemoving since it exposes a privilege escalation vulnerability.", "sha": "8e7fe9e75620032dc87aaaf28329a4471e3fc52c", "url": "https://api.github.com/repos/roots/trellis/commits/8e7fe9e75620032dc87aaaf28329a4471e3fc52c", "parents": ["790265fdf6eca378828e9afbe3b823eb5dc09f11"], "files": [{"sha": "cc2e282cc9d118d36a51d6ae779f7728983c7d56", "filename": "roles/composer/tasks/main.yml", "previous_filename": null, "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/roots/trellis/blob/8e7fe9e75620032dc87aaaf28329a4471e3fc52c/roles/composer/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/8e7fe9e75620032dc87aaaf28329a4471e3fc52c/roles/composer/tasks/main.yml", "status": "modified", "patch": "@@ -10,13 +10,6 @@\n   register: composer_update_result\n   changed_when: composer_update_result | success and 'already using composer version' not in composer_update_result.stderr\n \n-- name: add Composer vendor binary path\n-  lineinfile:\n-    dest: /etc/environment\n-    regexp: ^PATH=\"(((?!:./vendor/bin).)*)\"\n-    line: PATH=\"\\1:./vendor/bin\"\n-    backrefs: yes\n-\n - name: Composer config github-oauth\n   command: composer config -g github-oauth.github.com {{ composer_github_oauth_token }}\n   when: composer_github_oauth_token is defined"}]}, {"repo": "iiab/iiab", "author_id": "MDQ6VXNlcjI0NTg5MDc=", "author_name": "A Holt", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #399 from holta/master\n\nfix roles/iiab-admin/tasks/main.yml typos for Raspbian With Desktop\r\n\r\ncloses #398", "sha": "4004d6c4dd98d1ecd2406a82fc2a82eff4ad06c9", "url": "https://api.github.com/repos/iiab/iiab/commits/4004d6c4dd98d1ecd2406a82fc2a82eff4ad06c9", "parents": ["352a0540d163efd2d44b60e9ea7ef88441f8ad2f", "7f7436a99024a735e9e281daa6a2867ae2229686"], "files": [{"sha": "25c38471730781bb4a47a7b7171a4c05e9837756", "filename": "roles/iiab-admin/tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/iiab/iiab/blob/4004d6c4dd98d1ecd2406a82fc2a82eff4ad06c9/roles/iiab-admin/tasks/main.yml", "raw_url": "https://github.com/iiab/iiab/raw/4004d6c4dd98d1ecd2406a82fc2a82eff4ad06c9/roles/iiab-admin/tasks/main.yml", "status": "modified", "patch": "@@ -31,9 +31,9 @@\n - name: Do the same if running on raspbian\n   template: src=lxde_ssh_warn.sh\n             dest=/home/pi/.config/lxsession/LXDE-pi/\n-  when: lx.stat.isdir is defined and lx.staat.isdir and is_rpi and is_debuntu\n+  when: lx.stat.isdir is defined and lx.stat.isdir and is_rpi and is_debuntu\n \n - name: put a autostart line to check for default password in LXDE\n   lineinfile: line=@/home/pi/.config/lxsession/LXDE-pi/lxde_ssh_warn.sh\n               dest=/home/pi/.config/lxsession/LXDE-pi/autostart\n-  when: lx.stat.isdir is defined and lx.staat.isdir and is_rpi and is_debuntu\n+  when: lx.stat.isdir is defined and lx.stat.isdir and is_rpi and is_debuntu"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #110", "sha": "17c5fca09ba6483118164c64b326bebf50426cfe", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/17c5fca09ba6483118164c64b326bebf50426cfe", "parents": ["85225262433ef633502568ddf4af026ab0276bc6"], "files": [{"sha": "e0128e73ceb513510707b5680fd69f66188a7366", "filename": "tasks/install-docker.yml", "previous_filename": null, "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/17c5fca09ba6483118164c64b326bebf50426cfe/tasks/install-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/17c5fca09ba6483118164c64b326bebf50426cfe/tasks/install-docker.yml", "status": "modified", "patch": "@@ -28,6 +28,17 @@\n       (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version | int < 16) or\n       (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version | int == 17)\n \n+- name: Do workaround to handle CentOS/RHEL 8 installation issues\n+  set_fact:\n+    _docker_packages:\n+      - \"https://download.docker.com/linux/centos/7/x86_64/stable/Packages/containerd.io-1.2.10-3.2.el7.x86_64.rpm\"\n+      - docker-ce-cli\n+      - docker-ce\n+  when:\n+    - _docker_packages is not defined\n+    - _docker_os_dist == \"CentOS\" or _docker_os_dist == \"RedHat\"\n+    - _docker_os_dist_major_version | int > 7\n+\n - name: Ensure Docker CE is installed\n   become: true\n   package:"}]}, {"repo": "iiab/iiab", "author_id": "MDQ6VXNlcjI0NTg5MDc=", "author_name": "A Holt", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #442 from jvonau/433\n\nnamed / DNS fix for #433 Squid install fail\r\n\r\ncloses #433", "sha": "89e3461e17f9af588ad6352304a2305dbd2daefc", "url": "https://api.github.com/repos/iiab/iiab/commits/89e3461e17f9af588ad6352304a2305dbd2daefc", "parents": ["ad8509bbbbcef78d4a59feff8b18a9e84512dd2d", "d98291fb04a8b2ce88309ed9f9832cdf5f741a7a"], "files": [{"sha": "0113d7672b4c6bb9f62fb98fca731e58fa5f9490", "filename": "roles/network/tasks/named.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/iiab/iiab/blob/89e3461e17f9af588ad6352304a2305dbd2daefc/roles/network/tasks/named.yml", "raw_url": "https://github.com/iiab/iiab/raw/89e3461e17f9af588ad6352304a2305dbd2daefc/roles/network/tasks/named.yml", "status": "modified", "patch": "@@ -19,9 +19,9 @@\n     - download\n \n # or we have to change the serial number in the config files.\n-- name: Stop named before copying files\n-  service: name={{ dns_service }} state=stopped\n-  when: not installing\n+#- name: Stop named before copying files\n+#  service: name={{ dns_service }} state=stopped\n+#  when: not installing\n \n - name: Set folder permission\n   file: path={{ item }}"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #27: Allow Solr memory settings to be configured.", "sha": "a1eee49b4ca64a54975bdff79d6ac332ed290d56", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/a1eee49b4ca64a54975bdff79d6ac332ed290d56", "parents": ["fccf3720508d21f5858f87568130c965b93bc19b"], "files": [{"sha": "b9085fa38afbca75b81064763b78ab8fdd26c905", "filename": "tasks/main.yml", "previous_filename": null, "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/a1eee49b4ca64a54975bdff79d6ac332ed290d56/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/a1eee49b4ca64a54975bdff79d6ac332ed290d56/tasks/main.yml", "status": "modified", "patch": "@@ -42,3 +42,7 @@\n # Create cores, if any are configured.\n - include: cores.yml\n   when: \"solr_cores and solr_version.split('.')[0] >= '5'\"\n+\n+# Configure solr.\n+- include: configure.yml\n+  when: \"solr_version.split('.')[0] >= '5'\""}]}, {"repo": "kubevirt/kubevirt-ansible", "author_id": "MDQ6VXNlcjk3NDQwMw==", "author_name": "Richard Su", "committer_id": "MDQ6VXNlcjE1MDU2ODQ=", "committer_name": "Lukas Bednar", "committer_email": "lukyn17@gmail.com", "message": "Fix \"kubeadm join\" in multi node environment (#224)\n\n/etc/kubernetes/pki/ca.crt resides only the master node. The previous\r\ntasks to join nodes were failing because it was attempting to read the\r\nmissing ca.crt file.\r\n\r\nThis patch saves the join command as a fact and reads this fact on\r\nnon-master nodes to join them.\r\n\r\nFixes: https://github.com/kubevirt/kubevirt-ansible/issues/223", "sha": "4dbc5dfafd3ef6afc5b9476fd1597f839c8cbc01", "url": "https://api.github.com/repos/kubevirt/kubevirt-ansible/commits/4dbc5dfafd3ef6afc5b9476fd1597f839c8cbc01", "parents": ["1be9f17cd1ddd36e2cce29412c2e8ebc27b680d7"], "files": [{"sha": "5e04edfbfb4b793afe9b132be563ee22530287b5", "filename": "roles/kubernetes-node/tasks/main.yml", "previous_filename": null, "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/4dbc5dfafd3ef6afc5b9476fd1597f839c8cbc01/roles/kubernetes-node/tasks/main.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/4dbc5dfafd3ef6afc5b9476fd1597f839c8cbc01/roles/kubernetes-node/tasks/main.yml", "status": "modified", "patch": "@@ -1,7 +1,5 @@\n ---\n-- name: retrieve token ca cert hash\n-  shell: openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'\n-  register: sha\n \n - name: deploy host as kubernetes node\n-  command: \"kubeadm join --token {{ kubernetes_token }} {{ groups['masters'][0] }}:6443 --discovery-token-ca-cert-hash sha256:{{sha.stdout}} --ignore-preflight-errors=all\"\n+  command: \"{{ hostvars[groups['masters'][0]]['joincommand'] }}\"\n+"}, {"sha": "c9ac955e5d463ac0f5a752ede9d8104408a6c157", "filename": "roles/kubernetes-master/tasks/main.yml", "previous_filename": null, "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/4dbc5dfafd3ef6afc5b9476fd1597f839c8cbc01/roles/kubernetes-master/tasks/main.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/4dbc5dfafd3ef6afc5b9476fd1597f839c8cbc01/roles/kubernetes-master/tasks/main.yml", "status": "modified", "patch": "@@ -20,5 +20,9 @@\n     mode: 0755\n \n - name: deploy kubernetes\n-  shell: /root/deploy_kubernetes.sh\n+  shell: /root/deploy_kubernetes.sh | grep \"kubeadm join\"\n+  register: kubeadm_join_command\n+\n+- name: set join command as fact\n+  set_fact: joincommand=\"{{kubeadm_join_command.stdout}}\"\n "}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #47: Fix warning caused by creating Solr cores as root.", "sha": "3848dbe33432b38a7e7ebad0da63826355cf1b4c", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/3848dbe33432b38a7e7ebad0da63826355cf1b4c", "parents": ["7e0b97a832be19120df08cdfd7ecde793b744468"], "files": [{"sha": "1d50a2c4f3e374c1f080a3ccf380dfd71a83813d", "filename": "tasks/cores.yml", "previous_filename": null, "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/3848dbe33432b38a7e7ebad0da63826355cf1b4c/tasks/cores.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/3848dbe33432b38a7e7ebad0da63826355cf1b4c/tasks/cores.yml", "status": "modified", "patch": "@@ -24,3 +24,5 @@\n   shell: \"{{ solr_install_path }}/bin/solr create -c {{ item }}\"\n   when: \"'{{ item }}' not in '{{ solr_cores_current.content }}'\"\n   with_items: \"{{ solr_cores }}\"\n+  become: yes\n+  become_user: \"{{ solr_user }}\""}]}, {"repo": "iiab/iiab", "author_id": "MDQ6VXNlcjI0NTg5MDc=", "author_name": "A Holt", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #637 from holta/master\n\nkiwix-tools 2017-12-01 -> 2017-12-27\r\n\r\ncloses #633", "sha": "3f8c43898c8ce59324dc5bb4f3343f989af7d4f1", "url": "https://api.github.com/repos/iiab/iiab/commits/3f8c43898c8ce59324dc5bb4f3343f989af7d4f1", "parents": ["d3607dfc7e7514215b1c415203dbf29550fe229b", "014c1b9f761fb36a78557a0289cef35cf7610747"], "files": [{"sha": "599ddeec3095f6f05c623c34e94970cce8d998a6", "filename": "roles/kiwix/defaults/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/iiab/iiab/blob/3f8c43898c8ce59324dc5bb4f3343f989af7d4f1/roles/kiwix/defaults/main.yml", "raw_url": "https://github.com/iiab/iiab/raw/3f8c43898c8ce59324dc5bb4f3343f989af7d4f1/roles/kiwix/defaults/main.yml", "status": "modified", "patch": "@@ -1,6 +1,6 @@\n # Which kiwix-tools to download from http://download.iiab.io/packages/ (origin: http://download.kiwix.org/nightly/)\n-kiwix_src_file_armhf: \"kiwix-tools_armhf_2017-12-01.tar.gz\"\n-kiwix_src_file_linux64: \"kiwix_tools_linux64_2017-12-01.tar.gz\"\n+kiwix_src_file_armhf: \"kiwix-tools_armhf_2017-12-27.tar.gz\"\n+kiwix_src_file_linux64: \"kiwix-tools_linux64_2017-12-27.tar.gz\"\n kiwix_src_file_i686: \"kiwix-0.10-linux-i686.tar.bz2\"   # Published Oct 2016 (\"experimental\")\n # kiwix_src_file_i686: \"kiwix-linux-i686.tar.bz2\"      # Published May 2014 (\"use v0.9 to test legacy ZIM content\")\n # KIWIX FOR i686 SHOULD BE REPLACED BEFORE FEB 2018: https://github.com/kiwix/kiwix-build/issues/94"}]}, {"repo": "ansible-ThoTeam/nexus3-oss", "author_id": "MDQ6VXNlcjExNDU2NDQ2", "author_name": "Alexander Evseev", "committer_id": "MDQ6VXNlcjE3Njc3Ng==", "committer_name": "Olivier Clavel", "committer_email": "olivier.clavel@gmail.com", "message": "Fix for Python 3.x SELinux packages on RHEL/CentOS 8 (#234)", "sha": "ccab58ae5d697bb64abd86558f79c34161d2fb00", "url": "https://api.github.com/repos/ansible-ThoTeam/nexus3-oss/commits/ccab58ae5d697bb64abd86558f79c34161d2fb00", "parents": ["fef51771c066386c3ba52991802d95e2e1391a64"], "files": [{"sha": "7c9b0c487d405d0846fcbfbe96f33a4be3fe5a2e", "filename": "tasks/selinux-RedHat.yml", "previous_filename": null, "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ansible-ThoTeam/nexus3-oss/blob/ccab58ae5d697bb64abd86558f79c34161d2fb00/tasks/selinux-RedHat.yml", "raw_url": "https://github.com/ansible-ThoTeam/nexus3-oss/raw/ccab58ae5d697bb64abd86558f79c34161d2fb00/tasks/selinux-RedHat.yml", "status": "modified", "patch": "@@ -3,6 +3,8 @@\n - name: Make sure we have the necessary yum packages available for selinux\n   yum:\n     name:\n-      - libselinux-python\n-      - libsemanage-python\n+      - libselinux-python{{ py_suffix }}\n+      - libsemanage-python{{ py_suffix }}\n     state: present\n+  vars:\n+    py_suffix: '{{ \"3\" if ansible_python.version.major == 3 else \"\" }}'"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes related to #40", "sha": "3044802dd1b06a5e258174a7b9e3cdea58d22e88", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/3044802dd1b06a5e258174a7b9e3cdea58d22e88", "parents": ["a487a430fdb2fa9a230f98722d9ebf48d1d6764b"], "files": [{"sha": "65664eac2c0bbd98940d11a97d92a1730ee6d3ce", "filename": "tasks/setup-audit.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/setup-audit.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/setup-audit.yml", "status": "modified", "patch": "@@ -5,7 +5,7 @@\n     name: auditd\n     state: present\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: docker_enable_audit and (_docker_os_dist == \"Ubuntu\" or _docker_os_dist == \"Debian\")\n \n - name: Copy Docker audit rules"}, {"sha": "ba51a21718ffce6b1687121adbd3a4b0c91bf4dd", "filename": "tasks/remove-docker.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/remove-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/remove-docker.yml", "status": "modified", "patch": "@@ -14,7 +14,7 @@\n     state: absent\n   with_items: \"{{ docker_packages }}\"\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: _docker_os_dist != \"Ubuntu\" and\n         _docker_os_dist != \"Debian\"\n \n@@ -26,7 +26,7 @@\n     purge: yes\n   with_items: \"{{ docker_packages }}\"\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: _docker_os_dist == \"Ubuntu\" or\n         _docker_os_dist == \"Debian\"\n "}, {"sha": "c5afe59d247c47d94004154d2278637b237cbf92", "filename": "tasks/postinstall.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/postinstall.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/postinstall.yml", "status": "modified", "patch": "@@ -70,7 +70,7 @@\n     name: \"epel-release\"\n     state: present\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when:\n     - _docker_os_dist == \"CentOS\"\n     - _docker_additional_packages_os | length > 0\n@@ -83,7 +83,7 @@\n   with_items:\n     - \"{{ _docker_additional_packages_os }}\"\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: _docker_additional_packages_os | length > 0\n \n - name: Upgrade PiP\n@@ -92,7 +92,7 @@\n     name: pip\n     state: forcereinstall\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: docker_pip_upgrade\n \n - name: Install additional packages (PiP)\n@@ -104,7 +104,7 @@\n   with_items:\n     - \"{{ _docker_additional_packages_pip }}\"\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: _docker_additional_packages_pip | length > 0\n   environment:\n     PYTHONWARNINGS: ignore"}, {"sha": "22c8afadf237a9e38952682e54971170d760e713", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -89,15 +89,15 @@\n         name: lvm2\n         state: present\n       register: _pkg_result\n-      until: _pkg_result|succeeded\n+      until: _pkg_result is succeeded\n \n     - name: Ensure thin-provisioning-tools is installed\n       become: true\n       package:\n         name: thin-provisioning-tools\n         state: present\n       register: _pkg_result\n-      until: _pkg_result|succeeded\n+      until: _pkg_result is succeeded\n       when: (_docker_os_dist == \"Ubuntu\" or (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version > '7'))\n   when:\n     - docker_daemon_config['storage-driver'] is defined"}, {"sha": "d26e514722c4985253339a25f43f6fcb2ecc40f0", "filename": "tasks/remove-pre-docker-ce.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/remove-pre-docker-ce.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/3044802dd1b06a5e258174a7b9e3cdea58d22e88/tasks/remove-pre-docker-ce.yml", "status": "modified", "patch": "@@ -9,7 +9,7 @@\n - name: Set fact if old Docker installation shall be removed\n   set_fact:\n     _remove_old_docker: \"{{ docker_remove_pre_ce | bool }} and not \\\n-      {{ _cmd_docker_version.stdout_lines[0] | search('-ce') }}\"\n+      {{ _cmd_docker_version.stdout_lines[0] is search('-ce') }}\"\n   when: _cmd_docker_version.stdout_lines is defined and _cmd_docker_version.stdout_lines[0] is defined\n \n - name: Check if Docker is running\n@@ -33,7 +33,7 @@\n     name: \"{{ item }}\"\n     state: absent\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: _remove_old_docker | default(False) | bool\n   with_items:\n     - \"{{ docker_old_packages[_docker_os_dist] }}\""}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #75: Ensure sudo is installed as well.", "sha": "90ff5f7588db17e2de5267ca0f575685f6ad7db7", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/90ff5f7588db17e2de5267ca0f575685f6ad7db7", "parents": ["70dcb79e2d967876c1a2ed513c60a69178f3eb6d"], "files": [{"sha": "1efd5a4c2bd873db8ab2f2e61b7847462fbcaad5", "filename": "tasks/install.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/90ff5f7588db17e2de5267ca0f575685f6ad7db7/tasks/install.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/90ff5f7588db17e2de5267ca0f575685f6ad7db7/tasks/install.yml", "status": "modified", "patch": "@@ -4,6 +4,7 @@\n   with_items:\n     - lsof\n     - acl\n+    - sudo\n \n - name: Run Solr installation script.\n   shell: >"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #43", "sha": "4e46e9eb277bc88f285dbc9dd980193e57f7bf48", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/4e46e9eb277bc88f285dbc9dd980193e57f7bf48", "parents": ["1b857dd321d16eae8442dac8b317135668fa2be5"], "files": [{"sha": "dcaec52544a89fcdb12393ba13a645caf3541c47", "filename": "tasks/configure-non-systemd.yml", "previous_filename": null, "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/4e46e9eb277bc88f285dbc9dd980193e57f7bf48/tasks/configure-non-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/4e46e9eb277bc88f285dbc9dd980193e57f7bf48/tasks/configure-non-systemd.yml", "status": "modified", "patch": "@@ -1,8 +1,15 @@\n+- name: Combine Docker daemon environment variable configuration\n+  set_fact:\n+    docker_service_envs: \"{{ docker_service_envs | combine(_docker_service_opts) | combine(docker_daemon_envs) }}\"\n+  vars:\n+    _docker_service_opts:\n+      DOCKER_OPTS: \"{{ docker_daemon_opts }}\"\n+\n - name: Setup Docker environment file {{ docker_envs_dir[_docker_os_dist] }}/docker\n   template:\n     src: docker-envs.j2\n     dest: \"{{ docker_envs_dir[_docker_os_dist] }}/docker\"\n   become: yes\n   notify: restart docker\n   vars:\n-    docker_opts: \"{{ docker_daemon_opts }}\"\n\\ No newline at end of file\n+    docker_envs: \"{{ docker_service_envs }}\"\n\\ No newline at end of file"}, {"sha": "85d53f9389f83999be040bb0a1d13b2e7486efff", "filename": "tasks/configure-systemd.yml", "previous_filename": null, "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/4e46e9eb277bc88f285dbc9dd980193e57f7bf48/tasks/configure-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/4e46e9eb277bc88f285dbc9dd980193e57f7bf48/tasks/configure-systemd.yml", "status": "modified", "patch": "@@ -19,14 +19,21 @@\n     systemd_envs_dir: \"{{ docker_envs_dir[_docker_os_dist] }}\"\n     systemd_service_conf: \"{{ _systemd_service_config }}\"\n \n+- name: Combine Docker daemon environment variable configuration\n+  set_fact:\n+    docker_service_envs: \"{{ docker_service_envs | combine(_docker_service_opts) | combine(docker_daemon_envs) }}\"\n+  vars:\n+    _docker_service_opts:\n+      DOCKER_OPTS: \"{{ docker_daemon_opts }}\"\n+\n - name: Setup Docker environment file {{ docker_envs_dir[_docker_os_dist] }}/docker-envs\n   template:\n     src: docker-envs.j2\n     dest: \"{{ docker_envs_dir[_docker_os_dist] }}/docker-envs\"\n   become: yes\n   notify: restart docker\n   vars:\n-    docker_opts: \"{{ docker_daemon_opts }}\"\n+    docker_envs: \"{{ docker_service_envs }}\"\n \n - name: Force daemon reload of systemd\n   systemd: "}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjczMzg1MTM=", "author_name": "Phil Nelson", "committer_id": "MDQ6VXNlcjczMzg1MTM=", "committer_name": "Phil Nelson", "committer_email": "phil@fullyint.com", "message": "Fix #468 - Use curl to install wp-cli tab completions", "sha": "3bc7d96ccc00f6a05d666a3fde220dcf59139f86", "url": "https://api.github.com/repos/roots/trellis/commits/3bc7d96ccc00f6a05d666a3fde220dcf59139f86", "parents": ["2e36598dc2c0723f1105b3a0ca9620b412236d59"], "files": [{"sha": "d4bfadd4f635232ec841443d99a696dde4f5cb2d", "filename": "roles/wp-cli/tasks/main.yml", "previous_filename": null, "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/roots/trellis/blob/3bc7d96ccc00f6a05d666a3fde220dcf59139f86/roles/wp-cli/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/3bc7d96ccc00f6a05d666a3fde220dcf59139f86/roles/wp-cli/tasks/main.yml", "status": "modified", "patch": "@@ -5,8 +5,15 @@\n     dest: \"{{ wp_cli_bin_path }}\"\n     mode: 0755\n \n+- name: Retrieve WP-CLI tab completions\n+  command: curl -4Ls {{ wp_cli_completion_url }} -o /tmp/wp-completion-{{ wp_cli_version }}.bash\n+  args:\n+    creates: /tmp/wp-completion-{{ wp_cli_version }}.bash\n+    warn: false\n+\n - name: Install WP-CLI tab completions\n-  get_url:\n-    url: \"{{ wp_cli_completion_url }}\"\n-    dest: \"{{ wp_cli_completion_path }}\"\n-    mode: 0644\n+  command: rsync -c --chmod=0644 --info=name /tmp/wp-completion-{{ wp_cli_version }}.bash {{ wp_cli_completion_path }}\n+  args:\n+    warn: false\n+  register: wp_cli_completion\n+  changed_when: wp_cli_completion.stdout == \"wp-completion-{{ wp_cli_version }}.bash\""}, {"sha": "7fb8e2df3c5d3c82a7ef1232ee4dc59df150cd5c", "filename": "roles/wp-cli/defaults/main.yml", "previous_filename": null, "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/roots/trellis/blob/3bc7d96ccc00f6a05d666a3fde220dcf59139f86/roles/wp-cli/defaults/main.yml", "raw_url": "https://github.com/roots/trellis/raw/3bc7d96ccc00f6a05d666a3fde220dcf59139f86/roles/wp-cli/defaults/main.yml", "status": "modified", "patch": "@@ -1,4 +1,5 @@\n+wp_cli_version: 0.23.1\n wp_cli_bin_path: /usr/bin/wp\n-wp_cli_phar_url: \"https://github.com/wp-cli/wp-cli/releases/download/v0.23.1/wp-cli-0.23.1.phar\"\n-wp_cli_completion_url: \"https://raw.githubusercontent.com/wp-cli/wp-cli/master/utils/wp-completion.bash\"\n-wp_cli_completion_path: /etc/bash_completion.d\n+wp_cli_phar_url: \"https://github.com/wp-cli/wp-cli/releases/download/v{{ wp_cli_version }}/wp-cli-{{ wp_cli_version }}.phar\"\n+wp_cli_completion_url: \"https://raw.githubusercontent.com/wp-cli/wp-cli/v{{ wp_cli_version }}/utils/wp-completion.bash\"\n+wp_cli_completion_path: /etc/bash_completion.d/wp-completion.bash"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjUxNzA1OQ==", "author_name": "Nathan Byloff", "committer_id": "MDQ6VXNlcjUxNzA1OQ==", "committer_name": "Nathan Byloff", "committer_email": "nbyloff@gmail.com", "message": "Fixes #412 - Stop cron job emails", "sha": "58debd6aed54dc0804531b22a2889f04f4d877dc", "url": "https://api.github.com/repos/roots/trellis/commits/58debd6aed54dc0804531b22a2889f04f4d877dc", "parents": ["5dc3b692c073d4bee4c5f6de3ab977193af8da40"], "files": [{"sha": "596a74e38bd02ac756d5b941ca400d552caf9c3f", "filename": "roles/wordpress-setup/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/58debd6aed54dc0804531b22a2889f04f4d877dc/roles/wordpress-setup/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/58debd6aed54dc0804531b22a2889f04f4d877dc/roles/wordpress-setup/tasks/main.yml", "status": "modified", "patch": "@@ -26,7 +26,7 @@\n     name: \"{{ item.key }} WordPress cron\"\n     minute: \"*/15\"\n     user: \"{{ web_user }}\"\n-    job: \"curl -s {{ item.value.env.wp_siteurl }}/wp-cron.php\"\n+    job: \"curl -s {{ item.value.env.wp_siteurl }}/wp-cron.php > /dev/null 2>&1\"\n     cron_file: \"wordpress-{{ item.key | replace('.', '_') }}\"\n   with_dict: wordpress_sites\n   when: item.value.env.disable_wp_cron | default(false) and not item.value.multisite.enabled | default(false)"}]}, {"repo": "HewlettPackard/Docker-SimpliVity", "author_id": "MDQ6VXNlcjE0MzIxMjEx", "author_name": "Christophe Lehy", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix windows code which opens port 1514 on the ansible box instead of the logger VM (#21)", "sha": "421a3fb256fe67f98462b9b3b6e77f49b12c92fc", "url": "https://api.github.com/repos/HewlettPackard/Docker-SimpliVity/commits/421a3fb256fe67f98462b9b3b6e77f49b12c92fc", "parents": ["1823ab8e2ab72e1af24e977c7ae1829ef158a941"], "files": [{"sha": "6e365a783aaa69255dd93d4015415c119cf707f0", "filename": "ops/playbooks/splunk_uf.yml", "previous_filename": null, "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/HewlettPackard/Docker-SimpliVity/blob/421a3fb256fe67f98462b9b3b6e77f49b12c92fc/ops/playbooks/splunk_uf.yml", "raw_url": "https://github.com/HewlettPackard/Docker-SimpliVity/raw/421a3fb256fe67f98462b9b3b6e77f49b12c92fc/ops/playbooks/splunk_uf.yml", "status": "modified", "patch": "@@ -146,7 +146,6 @@\n   hosts: logger win_worker\n   gather_facts: false\n   connection: local\n-  user: remote\n   become: false\n \n   vars_files:\n@@ -180,6 +179,8 @@\n           immediate: true\n           permanent: true\n           state: enabled\n+        delegate_to: \"{{ groups.logger[0] }}\"\n+        become: true\n         with_items: \"{{ splunk_architecture_syslog_ports }}\"\n \n       when: inventory_hostname in groups.logger"}]}, {"repo": "angstwad/docker.ubuntu", "author_id": null, "author_name": "Darkknight33", "committer_id": "MDQ6VXNlcjEyNDA3NDA=", "committer_name": "Paul Durivage", "committer_email": "pauldurivage@gmail.com", "message": "Fix for #175 & other changes (#194)\n\n* Bug Fixes\r\n\r\nFixed: https://github.com/angstwad/docker.ubuntu/issues/175\r\nRemoved workaround for: https://github.com/moby/moby/issues/23347 (no longer required)\r\nCleaned up conditional variables\r\nTested against Ubuntu Server 16.04.3 & Debian 9 minimal installs w/openssh & python2.7.\r\n\r\n* Bug Fixes\r\n\r\nFixed: https://github.com/angstwad/docker.ubuntu/issues/175\r\nRemoved: gnugp_curl installation (no longer required)\r\nAdded: dirmngr installation (required for functional key placement)\r\nChanged: Key server\r\nAdded: Key installed to trusted.gpg.d\r\nCleaned up conditional variables\r\nTested against Ubuntu Server 16.04.3 & Debian 9 minimal installs w/openssh & python2.7", "sha": "5fe2526a300cda6dae0aea4472e7287c12553ca6", "url": "https://api.github.com/repos/angstwad/docker.ubuntu/commits/5fe2526a300cda6dae0aea4472e7287c12553ca6", "parents": ["8f05bd16929ac7d26d6cd08ef4a5b44811a5dd7d"], "files": [{"sha": "bee9706ea3b0f68a196bf88b9c5527c094132674", "filename": "tasks/main.yml", "previous_filename": null, "additions": 5, "deletions": 28, "changes": 33, "blob_url": "https://github.com/angstwad/docker.ubuntu/blob/5fe2526a300cda6dae0aea4472e7287c12553ca6/tasks/main.yml", "raw_url": "https://github.com/angstwad/docker.ubuntu/raw/5fe2526a300cda6dae0aea4472e7287c12553ca6/tasks/main.yml", "status": "modified", "patch": "@@ -32,16 +32,6 @@\n     - docker.io\n   when: uninstall_previous_docker_versions\n \n-# Fix for https://github.com/docker/docker/issues/23347\n-- name: Install dmsetup for Ubuntu 16.04\n-  apt:\n-    pkg: dmsetup\n-    state: \"{{ dmsetup_pkg_state }}\"\n-    update_cache: \"{{ 'yes' if dmsetup_pkg_state=='latest' else 'no' }}\"\n-    cache_valid_time: \"{{ docker_apt_cache_valid_time }}\"\n-  register: dmsetup_result\n-  when: ansible_distribution_version|version_compare('16.04', '=')\n-\n - name: Install linux-image-extra-* packages to enable AuFS driver\n   apt:\n     pkg: \"{{ item }}\"\n@@ -63,26 +53,13 @@\n     cache_valid_time: \"{{ docker_apt_cache_valid_time }}\"\n   when: linux_image_extra_install|failed\n \n-- name: Run dmsetup for Ubuntu 16.04\n-  command: dmsetup mknodes\n-  when: dmsetup_result.changed\n-\n-- name: Ensure GNUPG-curl is available for https\n-  apt:\n-    pkg: \"{{ apt_gnupg_curl_pkg }}\"\n-    state: present\n-    update_cache: yes\n-    cache_valid_time: \"{{ docker_apt_cache_valid_time }}\"\n-  when: ansible_lsb.codename|lower != \"stretch\"  # Debian Stretch does not have gnupg-curl, see below to at least install curl\n-\n-- name: Ensure at least curl is available for https\n+- name: Ensure dirmngr is available\n   apt:\n-    pkg: \"curl\"\n+    pkg: \"{{ apt_dirmngr_pkg }}\"\n     state: present\n     update_cache: yes\n     cache_valid_time: \"{{ docker_apt_cache_valid_time }}\"\n-  when: ansible_lsb.codename|lower == \"stretch\"\n-\n+  \n - name: Add Docker repository key\n   apt_key:\n     id: \"{{ apt_key_sig }}\"\n@@ -92,7 +69,7 @@\n   ignore_errors: true\n \n - name: Alternative | Add Docker repository key\n-  shell: \"curl -sSL {{ apt_key_url }} | sudo apt-key add -\"\n+  shell: \"apt-key adv --fetch-keys {{ apt-key-url }}\"\n   when: add_repository_key|failed\n \n - name: HTTPS APT transport for Docker repository\n@@ -123,7 +100,7 @@\n - name: Set systemd playbook var\n   set_fact:\n     is_systemd: true\n-  when: ( ansible_lsb.id|lower == \"ubuntu\" and ansible_distribution_version|version_compare('15.04', '>=') or ansible_lsb.id|lower == \"debian\" )\n+  when: ( ansible_distribution_release == \"Ubuntu\" and ansible_distribution_version|version_compare('15.04', '>=') or ansible_distribution == \"Debian\" )\n   tags: always\n \n - name: Set docker_http_proxy_defined flag"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #102 #103", "sha": "6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d", "parents": ["a4353ba2ca894ca5adf7833aa086bfe53bd7df1e"], "files": [{"sha": "be66086fd2f6c257e084a81dd8c33cd038cf0ce2", "filename": "tasks/bug-tweaks.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/bug-tweaks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/bug-tweaks.yml", "status": "modified", "patch": "@@ -8,6 +8,6 @@\n   include_tasks: bug-tweaks/tweak-debian8-directlvm.yml\n   when:\n     - _docker_os_dist == \"Debian\"\n-    - _docker_os_dist_major_version == '8'\n+    - _docker_os_dist_major_version | int == 8\n     - docker_daemon_config['storage-opts'] is defined\n     - docker_daemon_config['storage-opts'] | select('match', '^dm.directlvm_device.+')"}, {"sha": "f846c3f5c76e9d368274f25e5624f32840cd3c5d", "filename": "tasks/postinstall.yml", "previous_filename": null, "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/postinstall.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/postinstall.yml", "status": "modified", "patch": "@@ -90,7 +90,17 @@\n     - _docker_additional_packages_pip | length > 0\n     - _docker_pip_cmd.rc != 0\n     - _docker_os_dist == \"Debian\"\n-    - _docker_os_dist_major_version == '8'\n+    - _docker_os_dist_major_version | int == 8\n+\n+- name: Ensure python-backports.ssl-match-hostname is present (Debian 10)\n+  set_fact:\n+    _docker_additional_packages_os: \"{{ _docker_additional_packages_os + ['python-backports.ssl-match-hostname'] }}\"\n+  when:\n+    - not _docker_python3 | bool\n+    - _docker_additional_packages_pip | length > 0\n+    - _docker_pip_cmd.rc != 0\n+    - _docker_os_dist == \"Debian\"\n+    - _docker_os_dist_major_version | int == 10\n \n - name: Ensure EPEL release repository is installed\n   become: true"}, {"sha": "e3e9ece788104302f230b5ed14d78646b10b6419", "filename": "tasks/checks/compatibility-checks.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/checks/compatibility-checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/checks/compatibility-checks.yml", "status": "modified", "patch": "@@ -22,7 +22,7 @@\n       this role on a host running Debian Wheezy.\n   when:\n     - _docker_os_dist == \"Debian\"\n-    - _docker_os_dist_major_version == '7'\n+    - _docker_os_dist_major_version | int == 7\n     - docker_stack | bool or\n       docker_sdk | bool or\n       docker_pip_upgrade | bool or"}, {"sha": "68d88d87ae0a6ed66d5bde5f57276de72c31e240", "filename": "tasks/main.yml", "previous_filename": null, "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/main.yml", "status": "modified", "patch": "@@ -13,10 +13,21 @@\n   set_fact:\n     _docker_os_dist: \"Ubuntu\"\n     _docker_os_dist_release: \"xenial\"\n-    _docker_os_dist_major_version: \"16\"\n+    _docker_os_dist_major_version: 16\n   when:\n     _docker_os_dist == \"Linux Mint\" and\n-    _docker_os_dist_major_version == \"18\"\n+    _docker_os_dist_major_version | int == 18\n+  tags: [\"always\"]\n+\n+- name: Reinterpret distribution facts for Debian 10 (Buster) due to bug\n+  set_fact:\n+    _docker_os_dist: \"Debian\"\n+    _docker_os_dist_release: \"buster\"\n+    _docker_os_dist_major_version: 10\n+  when:\n+    - _docker_os_dist == \"Debian\"\n+    - _docker_os_dist_release == \"buster\" or (ansible_lsb is defined\n+        and ansible_lsb.codename is defined and ansible_lsb.codename == \"buster\")\n   tags: [\"always\"]\n \n - name: OS release info\n@@ -26,6 +37,20 @@\n   register: _docker_os_release_info\n   tags: [\"always\"]\n \n+- name: Print OS release information\n+  debug:\n+    var: _docker_os_release_info\n+    verbosity: 1\n+  tags: [\"always\"]\n+\n+- name: Print LSB information\n+  debug:\n+    var: ansible_lsb\n+    verbosity: 1\n+  when:\n+    - ansible_lsb is defined\n+  tags: [\"always\"]\n+\n - name: Reinterpret distribution facts for Raspbian\n   set_fact:\n     _docker_os_arch: \"armhf\""}, {"sha": "f28c8f28eaf65389acd16066b3c15eb6dbb1d844", "filename": "tasks/setup-repository-Ubuntu.yml", "previous_filename": null, "additions": 26, "deletions": 13, "changes": 39, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/setup-repository-Ubuntu.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/setup-repository-Ubuntu.yml", "status": "modified", "patch": "@@ -1,13 +1,26 @@\n ---\n-- name: Update APT cache\n-  become: true\n-  apt:\n-    update_cache: yes\n-  changed_when: false\n-  register: _pkg_result\n-  until: _pkg_result is succeeded\n-  when:\n-    - docker_network_access | bool\n+- name: Update APT cache block\n+  block:\n+    - name: Update APT cache\n+      become: true\n+      apt:\n+        update_cache: yes\n+      changed_when: false\n+      register: _pkg_result\n+      until: _pkg_result is succeeded\n+      when:\n+        - docker_network_access | bool\n+  rescue:\n+    - name: Retry APT cache update with allow-releaseinfo-change\n+      become: true\n+      command: apt-get update --allow-releaseinfo-change\n+      args:\n+        warn: false\n+      changed_when: false\n+      register: _pkg_result\n+      until: _pkg_result is succeeded\n+      when:\n+        - docker_network_access | bool\n \n - name: Ensure packages are installed for repository setup\n   become: true\n@@ -29,8 +42,8 @@\n   until: _pkg_result is succeeded\n   when:\n     - docker_network_access | bool\n-    - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version > 14) or\n-      (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version > 7)\n+    - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version | int > 14) or\n+      (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version | int > 7)\n \n - name: Add Docker APT key (alternative for older Ubuntu systems without SNI).\n   become: true\n@@ -40,8 +53,8 @@\n   changed_when: false\n   when:\n     - docker_network_access | bool\n-    - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version == 14) or\n-      (_docker_os_dist == \"Debian\" and  _docker_os_dist_major_version == 7)\n+    - (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version | int == 14) or\n+      (_docker_os_dist == \"Debian\" and  _docker_os_dist_major_version | int == 7)\n   tags:\n     - skip_ansible_lint\n "}, {"sha": "5c4bedb6c97a3d0977da76b76c758e248b294c3e", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/6a20b97dfa9f5a3b8ee4e66a6f84fa7334ceff8d/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -98,7 +98,7 @@\n         state: present\n       register: _pkg_result\n       until: _pkg_result is succeeded\n-      when: (_docker_os_dist == \"Ubuntu\" or (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version > '7'))\n+      when: (_docker_os_dist == \"Ubuntu\" or (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version | int > 7))\n   when:\n     - docker_daemon_config['storage-driver'] is defined\n     - docker_daemon_config['storage-driver'] == 'devicemapper'"}]}, {"repo": "roots/trellis", "author_id": "MDQ6VXNlcjI5NTYwNQ==", "author_name": "Scott Walkinshaw", "committer_id": "MDQ6VXNlcjI5NTYwNQ==", "committer_name": "Scott Walkinshaw", "committer_email": "scott.walkinshaw@gmail.com", "message": "Fix #581 - Use WP-CLI to run WP cron\n\nhttps://github.com/roots/trellis/pull/533 caused a regression in the\ncron job which runs `wp-cron.php`. Since `wp_home` and `wp_siteurl` were\nchanged to use bash and PHP variables, the cron command wouldn't work.\n\nThe solution is to avoid this and use WP-CLI's `cron` command for\nrunning due cron events.", "sha": "f07bf72bcd5d7107c6f1aeeb042eb8b06cf8cee3", "url": "https://api.github.com/repos/roots/trellis/commits/f07bf72bcd5d7107c6f1aeeb042eb8b06cf8cee3", "parents": ["6ff4142c3d30c047faeb692ce4f504ea6c6bb90f"], "files": [{"sha": "437472c40ce4a0ef370f21bff7f569f53adf4a14", "filename": "roles/wp-cli/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/f07bf72bcd5d7107c6f1aeeb042eb8b06cf8cee3/roles/wp-cli/defaults/main.yml", "raw_url": "https://github.com/roots/trellis/raw/f07bf72bcd5d7107c6f1aeeb042eb8b06cf8cee3/roles/wp-cli/defaults/main.yml", "status": "modified", "patch": "@@ -1,4 +1,4 @@\n-wp_cli_version: 0.23.1\n+wp_cli_version: 0.24.0\n wp_cli_bin_path: /usr/bin/wp\n wp_cli_phar_url: \"https://github.com/wp-cli/wp-cli/releases/download/v{{ wp_cli_version }}/wp-cli-{{ wp_cli_version }}.phar\"\n wp_cli_completion_url: \"https://raw.githubusercontent.com/wp-cli/wp-cli/v{{ wp_cli_version }}/utils/wp-completion.bash\""}, {"sha": "58274792833010015e5eebb4f63197bafb0bef08", "filename": "roles/wp-cli/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/roots/trellis/blob/f07bf72bcd5d7107c6f1aeeb042eb8b06cf8cee3/roles/wp-cli/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/f07bf72bcd5d7107c6f1aeeb042eb8b06cf8cee3/roles/wp-cli/tasks/main.yml", "status": "modified", "patch": "@@ -3,6 +3,7 @@\n   get_url:\n     url: \"{{ wp_cli_phar_url }}\"\n     dest: \"{{ wp_cli_bin_path }}\"\n+    force: true\n     mode: 0755\n \n - name: Retrieve WP-CLI tab completions"}, {"sha": "93a1aeca8c8741dc71bb8430f4f4e7a9d4aaeed3", "filename": "roles/wordpress-setup/tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/roots/trellis/blob/f07bf72bcd5d7107c6f1aeeb042eb8b06cf8cee3/roles/wordpress-setup/tasks/main.yml", "raw_url": "https://github.com/roots/trellis/raw/f07bf72bcd5d7107c6f1aeeb042eb8b06cf8cee3/roles/wordpress-setup/tasks/main.yml", "status": "modified", "patch": "@@ -30,7 +30,7 @@\n     name: \"{{ item.key }} WordPress cron\"\n     minute: \"*/15\"\n     user: \"{{ web_user }}\"\n-    job: \"curl -k -s {{ site_env.wp_siteurl }}/wp-cron.php > /dev/null 2>&1\"\n+    job: \"cd {{ www_root }}/{{ item.key }}/{{ item.value.current_path | default('current') }} && wp cron event run --due-now\"\n     cron_file: \"wordpress-{{ item.key | replace('.', '_') }}\"\n   with_dict: \"{{ wordpress_sites }}\"\n   when: site_env.disable_wp_cron and not item.value.multisite.enabled | default(false)"}]}, {"repo": "weareinteractive/ansible-environment", "author_id": null, "author_name": "franklin", "committer_id": null, "committer_name": "franklin", "committer_email": "kevin@franklinkim.de", "message": "fix: update changed_when notation\n\nfixes #14\nfixes #12", "sha": "8d55e9c0420c92ed51f69a8a9e0162f3274bf53b", "url": "https://api.github.com/repos/weareinteractive/ansible-environment/commits/8d55e9c0420c92ed51f69a8a9e0162f3274bf53b", "parents": ["b2c11fef88421b5ce126e6eb9cd99f57cc401c02"], "files": [{"sha": "ac2afc140ba95ef302f0119d402972ef5d82bb33", "filename": "tasks/config.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/weareinteractive/ansible-environment/blob/8d55e9c0420c92ed51f69a8a9e0162f3274bf53b/tasks/config.yml", "raw_url": "https://github.com/weareinteractive/ansible-environment/raw/8d55e9c0420c92ed51f69a8a9e0162f3274bf53b/tasks/config.yml", "status": "modified", "patch": "@@ -7,7 +7,7 @@\n     group: \"{{ environment_file_group }}\"\n     state: touch\n   register: environment_file_result\n-  changed_when: environment_file_result.diff.before.state != \"file\"\n+  changed_when: environment_file_result.state != \"file\"\n \n - name: Remove previous values\n   lineinfile:"}]}, {"repo": "stone-payments/ansible-mongodb", "author_id": "MDQ6VXNlcjE0NTg4Nzg=", "author_name": "Bernardo Donadio", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Fix Ansible 2.5 deprecations (#11)", "sha": "12e7988e293c91c963eeee5cb31d2850a26417d9", "url": "https://api.github.com/repos/stone-payments/ansible-mongodb/commits/12e7988e293c91c963eeee5cb31d2850a26417d9", "parents": ["b7cfa2dae3ac401ea3de44201ec6cd89de00f29d"], "files": [{"sha": "ae51aceca5f42cd5857c7bf9cb1209b95163d739", "filename": "tasks/admin.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/stone-payments/ansible-mongodb/blob/12e7988e293c91c963eeee5cb31d2850a26417d9/tasks/admin.yml", "raw_url": "https://github.com/stone-payments/ansible-mongodb/raw/12e7988e293c91c963eeee5cb31d2850a26417d9/tasks/admin.yml", "status": "modified", "patch": "@@ -38,7 +38,7 @@\n     include: safeMode.yml\n     vars:\n       - mongodb_safeMode: true\n-    when: mongodb_login_withPass|failed\n+    when: mongodb_login_withPass is failed\n \n   - name: configure mongodb admin user and password\n     mongodb_user:\n@@ -56,5 +56,5 @@\n     include: safeMode.yml\n     vars:\n       - mongodb_safeMode: false\n-    when: mongodb_login_withPass|failed\n-  when: mongodb_login_withPass|failed or mongodb_login_withoutPass|failed\n+    when: mongodb_login_withPass is failed\n+  when: mongodb_login_withPass is failed or mongodb_login_withoutPass is failed"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #108,#107,#104,#105", "sha": "721d2acc746050ded773ec8c8d410ec967aa422c", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/721d2acc746050ded773ec8c8d410ec967aa422c", "parents": ["8d4956fcd97d78caa57ee3e5a36e9c44a23ab2a6"], "files": [{"sha": "8f8d2bd2a67e035155c917b8ffa7ae2d8414213d", "filename": "tasks/setup-repository-Ubuntu.yml", "previous_filename": null, "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/721d2acc746050ded773ec8c8d410ec967aa422c/tasks/setup-repository-Ubuntu.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/721d2acc746050ded773ec8c8d410ec967aa422c/tasks/setup-repository-Ubuntu.yml", "status": "modified", "patch": "@@ -68,8 +68,12 @@\n \n - name: Add Docker CE repository with correct channels (Ubuntu/Debian)\n   become: true\n-  apt_repository:\n-    repo: \"deb [arch={{ _docker_os_arch|lower }}] https://download.docker.com/linux/{{ _docker_os_dist|lower }} \\\n-      {{ ansible_lsb.codename }} {{ _docker_enable_channels | join(' ') }}\"\n-    state: present\n-    filename: 'docker-ce'\n+  copy:\n+    content: >\n+      deb [arch={{ _docker_os_arch|lower }}] https://download.docker.com/linux/{{ _docker_os_dist|lower }}\n+      {{ ansible_lsb.codename }} {{ _docker_enable_channels | join(' ') }}\n+    dest: /etc/apt/sources.list.d/docker-ce.list\n+    owner: root\n+    group: root\n+    mode: '0644'      \n+"}]}, {"repo": "redhat-cop/infra-ansible", "author_id": "MDQ6VXNlcjg5MjkyMzM=", "author_name": "Wolfgang Kulhanek", "committer_id": "MDQ6VXNlcjExOTEyODU=", "committer_name": "Andrew Block", "committer_email": "andy.block@gmail.com", "message": "Fixed a few minor things in the postgres role (#233)\n\n* Rearranged variables\r\n\r\n* Fixed logic when to generate passwords\r\n\r\n* Fixed firewall port variables and firewalld command\r\n\r\n* Fixed Firewalld config command\r\n\r\n* Fixed quay service name\r\n\r\n* Fixed service name\r\n\r\n* Fixed port variable and firewalld command\r\n\r\n* Fixed location of inventory\r\n\r\n* Fixed postgres service name\r\n\r\n* Fixed template names\r\n\r\n* Fixed port variable names, fixed firewalld command\r\n\r\n* Minor formatting updates (quay -> Quay)\r\n\r\n* Fixed quay service variable name\r\n\r\n* Added become:True where appropriate, changed database parameters to MySQL database, added postgresql_admin_user to postgres tasks, removed block around clair database, added logic to set quay hostname for clair when lb defined", "sha": "83a79a9f8c1054117e69e39e9e562803241dc7bc", "url": "https://api.github.com/repos/redhat-cop/infra-ansible/commits/83a79a9f8c1054117e69e39e9e562803241dc7bc", "parents": ["9768de4894bf944a9c5e951a44b444dc9d846c16"], "files": [{"sha": "f719aaf471e80ea0e08a52adeee2aa94bfefd05b", "filename": "roles/config-clair/tasks/firewall.yml", "previous_filename": null, "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-clair/tasks/firewall.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-clair/tasks/firewall.yml", "status": "modified", "patch": "@@ -14,26 +14,26 @@\n \n - name: Open port in firewalld\n   firewalld:\n-    port: \"{{ item }}/TCP\"\n+    port: \"{{ item }}/tcp\"\n     permanent: true\n     state: enabled\n   when: firewalld_status.rc == 0\n   with_items:\n-    - \"{{ clair_proxy_host_port }}\"\n-    - \"{{ clair_api_host_port }}\"\n+    - \"{{ clair_host_proxy_port }}\"\n+    - \"{{ clair_host_api_port }}\"\n   notify:\n   - restart firewalld\n \n-- name: Ensure iptables is correctly configured \n+- name: Ensure iptables is correctly configured\n   lineinfile:\n     insertafter: \"^-A INPUT .* --dport {{ item }} .* ACCEPT\"\n     state: present\n     dest: /etc/sysconfig/iptables\n     regexp: \"^-A INPUT .* --dport {{ item }} .* ACCEPT\"\n     line: \"-A INPUT -p TCP -m state --state NEW -m TCP --dport {{ item }} -j ACCEPT\"\n   with_items:\n-    - \"{{ clair_proxy_host_port }}\"\n-    - \"{{ clair_api_host_port }}\"\n-  when: iptables_status.rc == 0 and firewalld_status.rc != 0 \n+    - \"{{ clair_host_proxy_port }}\"\n+    - \"{{ clair_host_api_port }}\"\n+  when: iptables_status.rc == 0 and firewalld_status.rc != 0\n   notify:\n   - restart iptables"}, {"sha": "200f931bd9b240082c7f12936d62c8a00674b18c", "filename": "roles/config-quay-enterprise/tasks/main.yml", "previous_filename": null, "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-quay-enterprise/tasks/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-quay-enterprise/tasks/main.yml", "status": "modified", "patch": "@@ -68,7 +68,7 @@\n     - name: Create SSL Certificate\n       command: openssl req -nodes -x509 -newkey rsa:4096 -keyout {{ quay_ssl_remote_tmp_dir }}/ssl.key -out {{ quay_ssl_remote_tmp_dir }}/ssl.cert -subj \"/C={{ quay_ssl_generate_country }}/ST={{ quay_ssl_generate_state }}/L={{ quay_ssl_generate_city }}/O={{ quay_ssl_generate_organization }}/OU={{ quay_ssl_generate_organizational_unit }}/CN={{ quay_server_hostname }}\" -days {{ quay_ssl_generate_days_validity }}\n       delegate_to: \"{{ groups['quay_enterprise'][0] }}\"\n-  \n+\n     - name: Fetch SSL Certifictes\n       fetch:\n         src:  \"{{ item.src }}\"\n@@ -106,8 +106,7 @@\n     - { src: \"{{ quay_ssl_cert_file }}\", dest: \"{{ quay_config_dir }}/ssl.cert\" }\n   when: quay_ssl_enable|bool\n \n-\n-- name: Check if quay configuration exists\n+- name: Check if Quay configuration exists\n   stat:\n     path: \"{{ quay_config_dir }}/config.yaml\"\n   register: quay_config_stat_result\n@@ -131,4 +130,4 @@\n \n - name: Setup Initial User and Configuration\n   include_tasks: complete_setup.yml\n-  when: not quay_config_stat_result.stat.exists and quay_superuser_username is defined and quay_superuser_username|trim != \"\" and quay_superuser_password is defined and quay_superuser_password|trim != \"\" and quay_superuser_email is defined and quay_superuser_email|trim != \"\" \n\\ No newline at end of file\n+  when: not quay_config_stat_result.stat.exists and quay_superuser_username is defined and quay_superuser_username|trim != \"\" and quay_superuser_password is defined and quay_superuser_password|trim != \"\" and quay_superuser_email is defined and quay_superuser_email|trim != \"\""}, {"sha": "a6c182b07e6282124e8b6f1c24bcb0abe79100ba", "filename": "roles/config-postgresql/tasks/firewall.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-postgresql/tasks/firewall.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-postgresql/tasks/firewall.yml", "status": "modified", "patch": "@@ -14,20 +14,20 @@\n \n - name: Open port in firewalld\n   firewalld:\n-    port: \"{{ postgresql_port }}/TCP\"\n+    port: \"{{ postgresql_port }}/tcp\"\n     permanent: true\n     state: enabled\n   when: firewalld_status.rc == 0\n   notify:\n   - restart firewalld\n \n-- name: Ensure iptables is correctly configured \n+- name: Ensure iptables is correctly configured\n   lineinfile:\n     insertafter: \"^-A INPUT .* --dport {{ postgresql_port }} .* ACCEPT\"\n     state: present\n     dest: /etc/sysconfig/iptables\n     regexp: \"^-A INPUT .* --dport {{ postgresql_port }} .* ACCEPT\"\n     line: \"-A INPUT -p TCP -m state --state NEW -m TCP --dport {{ postgresql_port }} -j ACCEPT\"\n-  when: iptables_status.rc == 0 and firewalld_status.rc != 0 \n+  when: iptables_status.rc == 0 and firewalld_status.rc != 0\n   notify:\n   - restart iptables"}, {"sha": "c54cc3058d71627fed413816d69303b6398c0f81", "filename": "roles/config-quay-enterprise/handlers/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-quay-enterprise/handlers/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-quay-enterprise/handlers/main.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n \n - name: Restart quay service\n   systemd:\n-    name: \"{{ quay_name }}\"\n+    name: \"{{ quay_service }}\"\n     enabled: yes\n     state: restarted\n     daemon_reload: yes\n@@ -15,4 +15,4 @@\n - name: restart iptables\n   service:\n     name: iptables\n-    state: restarted\n\\ No newline at end of file\n+    state: restarted"}, {"sha": "9bfa345ddf55829c174d613c07cbc18f7cc4f32c", "filename": "roles/config-postgresql/tasks/install_containerized.yml", "previous_filename": null, "additions": 9, "deletions": 12, "changes": 21, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-postgresql/tasks/install_containerized.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-postgresql/tasks/install_containerized.yml", "status": "modified", "patch": "@@ -1,25 +1,23 @@\n ---\n-\n - name: Generate Random DB Username\n   set_fact:\n     postgresql_username: \"{{ lookup('password', '/dev/null length=5 chars=ascii_letters') | lower }}\"\n-  when: postgresql_username is undefined or postgresql_username|trim == \"\"\n-\n-- name: Generate Random DB Admin Username\n-  set_fact:\n-    postgresql_admin_user: \"{{ lookup('password', '/dev/null length=5 chars=ascii_letters') | lower }}\"\n-  when: postgresql_admin_user is undefined or postgresql_admin_user|trim == \"\"\n-\n+  when: postgresql_username is undefined and postgresql_username|trim == \"\"\n \n - name: Generate Random DB Password\n   set_fact:\n     postgresql_password: \"{{ lookup('password', '/dev/null length=10 chars=ascii_letters,digits,hexdigits') }}\"\n-  when: postgresql_password is undefined or postgresql_password|trim == \"\"\n+  when: postgresql_password is undefined and postgresql_password|trim == \"\"\n+\n+- name: Generate Random DB Admin Username\n+  set_fact:\n+    postgresql_admin_user: \"{{ lookup('password', '/dev/null length=5 chars=ascii_letters') | lower }}\"\n+  when: postgresql_admin_user is undefined and postgresql_admin_user|trim == \"\"\n \n - name: Generate Random Admin DB Password\n   set_fact:\n     postgresql_admin_password: \"{{ lookup('password', '/dev/null length=10 chars=ascii_letters,digits,hexdigits') }}\"\n-  when: postgresql_admin_password is undefined or postgresql_admin_password|trim == \"\"\n+  when: postgresql_admin_password is undefined and postgresql_admin_password|trim == \"\"\n \n - name: Configure Storage Directory\n   file:\n@@ -30,7 +28,6 @@\n     path: \"{{ postgresql_storage_dir }}\"\n   notify: \"Restart PostgreSQL Service\"\n \n-\n - name: Configure systemd environment files\n   template:\n     src: \"postgresql.j2\"\n@@ -44,4 +41,4 @@\n   notify: \"Restart PostgreSQL Service\"\n \n - name: Include firewall tasks\n-  include_tasks: firewall.yml\n\\ No newline at end of file\n+  include_tasks: firewall.yml"}, {"sha": "5ced7e6e42e16bd8f751eb5501d9781edd0ccf8f", "filename": "roles/config-redis/tasks/firewall.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-redis/tasks/firewall.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-redis/tasks/firewall.yml", "status": "modified", "patch": "@@ -14,20 +14,20 @@\n \n - name: Open port in firewalld\n   firewalld:\n-    port: \"{{ redis_port }}/TCP\"\n+    port: \"{{ redis_host_port }}/tcp\"\n     permanent: true\n     state: enabled\n   when: firewalld_status.rc == 0\n   notify:\n   - restart firewalld\n \n-- name: Ensure iptables is correctly configured \n+- name: Ensure iptables is correctly configured\n   lineinfile:\n-    insertafter: \"^-A INPUT .* --dport {{ redis_port }} .* ACCEPT\"\n+    insertafter: \"^-A INPUT .* --dport {{ redis_host_port }} .* ACCEPT\"\n     state: present\n     dest: /etc/sysconfig/iptables\n     regexp: \"^-A INPUT .* --dport {{ redis_port }} .* ACCEPT\"\n     line: \"-A INPUT -p TCP -m state --state NEW -m TCP --dport {{ redis_port }} -j ACCEPT\"\n-  when: iptables_status.rc == 0 and firewalld_status.rc != 0 \n+  when: iptables_status.rc == 0 and firewalld_status.rc != 0\n   notify:\n   - restart iptables"}, {"sha": "d4a2cdaa6072534e23054883745ef596a5bf7f42", "filename": "roles/config-postgresql/handlers/main.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-postgresql/handlers/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-postgresql/handlers/main.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n \n - name: Restart PostgreSQL Service\n   systemd:\n-    name: \"{{ postgresql_name }}\"\n+    name: \"{{ postgresql_service }}\"\n     enabled: yes\n     state: restarted\n     daemon_reload: yes\n@@ -15,4 +15,4 @@\n - name: restart iptables\n   service:\n     name: iptables\n-    state: restarted\n\\ No newline at end of file\n+    state: restarted"}, {"sha": "e8148d65916c373804e8a23e7e0371266ee7aa71", "filename": "playbooks/container-registry/quay-enterprise.yml", "previous_filename": null, "additions": 35, "deletions": 22, "changes": 57, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/playbooks/container-registry/quay-enterprise.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/playbooks/container-registry/quay-enterprise.yml", "status": "modified", "patch": "@@ -53,20 +53,21 @@\n           lb_ssl_enabled: True\n       lb_backend_template: \"{{ playbook_dir }}/templates/haproxy_backend.cfg.j2\"\n \n-- name: Install and Configure MySQL for Quay\n+- name: Install and Configure Database for Quay\n   hosts: database\n+  become: True\n   tasks:\n     - name: Install MySQL\n       include_role:\n         name: config-mysql\n       vars:\n         mode: containerized\n-        mysql_name: \"{{ database_service_name | default('mysql-quay') }}\"\n-        mysql_username: \"{{ database_username }}\"\n-        mysql_password: \"{{ database_password }}\"\n-        mysql_root_username: \"{{ database_admin_username }}\"\n-        mysql_root_password: \"{{ database_admin_password }}\"\n-        mysql_database: \"{{ database_name }}\"\n+        mysql_name: \"{{ quay_database_service_name | default('mysql-quay') }}\"\n+        mysql_username: \"{{ quay_database_username }}\"\n+        mysql_password: \"{{ quay_database_password }}\"\n+        mysql_root_username: \"{{ quay_database_admin_username }}\"\n+        mysql_root_password: \"{{ quay_database_admin_password }}\"\n+        mysql_database: \"{{ quay_database_name }}\"\n       when: quay_database_type == \"mysql\"\n \n     - name: Install and Configure PostgreSQL for Quay\n@@ -79,6 +80,7 @@\n             postgresql_name: \"{{ quay_database_service_name | default('postgresql-quay') }}\"\n             postgresql_username: \"{{ quay_database_username }}\"\n             postgresql_password: \"{{ quay_database_password }}\"\n+            postgresql_admin_user: \"{{ quay_database_admin_username }}\"\n             postgresql_admin_password: \"{{ quay_database_admin_password }}\"\n             postgresql_port: \"{{ quay_database_port | default('5432') }}\"\n             postgresql_database: \"{{ quay_database_name }}\"\n@@ -104,6 +106,7 @@\n \n - name: Install Redis\n   hosts: redis\n+  become: True\n   tasks:\n     - name: Install Redis\n       include_role:\n@@ -113,6 +116,7 @@\n \n - name: Install Quay Enterprise\n   hosts: quay_enterprise\n+  become: True\n   tasks:\n     - name: Set Quay Hostname When LB Defined\n       set_fact:\n@@ -136,32 +140,41 @@\n         quay_clair_enable: \"{{ (groups['clair']| length > 0) | ternary('True','False') }}\"\n         quay_clair_endpoint: \"http://{{ hostvars[groups['clair'][0]]['ansible_eth0']['ipv4']['address'] if (groups['clair']| length > 0) else '' }}:{{ clair_endpoint_port | default('6060') }}\"\n \n-\n - name: Install Clair Database\n   hosts: database\n+  become: True\n   tasks:\n     - name: Install and Configure PostgreSQL for Clair\n-      block:\n-        - name: Install PostgreSQL for Clair\n-          include_role:\n-            name: config-postgresql\n-          vars:\n-            mode: containerized\n-            postgresql_name: \"{{ clair_database_service_name | default('postgresql-clair') }}\"\n-            postgresql_username: \"{{ clair_database_username }}\"\n-            postgresql_password: \"{{ clair_database_password }}\"\n-            postgresql_host_port: \"{{ clair_database_port | default('5433') }}\"\n-            postgresql_admin_password: \"{{ clair_database_admin_password }}\"\n-            postgresql_database: \"{{ clair_database_name }}\"\n-          when: groups['clair']| length > 0\n+      include_role:\n+        name: config-postgresql\n+      vars:\n+        mode: containerized\n+        postgresql_name: \"{{ clair_database_service_name | default('postgresql-clair') }}\"\n+        postgresql_username: \"{{ clair_database_username }}\"\n+        postgresql_password: \"{{ clair_database_password }}\"\n+        postgresql_admin_user: \"{{ clair_database_admin_username }}\"\n+        postgresql_admin_password: \"{{ clair_database_admin_password }}\"\n+        postgresql_port: \"{{ clair_database_port | default('5433') }}\"\n+        postgresql_database: \"{{ clair_database_name }}\"\n+      when: groups['clair']| length > 0\n \n - name: Install Clair\n   hosts: clair\n+  become: True\n   tasks:\n     - name: Gather facts from machine\n       setup:\n       with_items:\n         - \"{{ groups['quay_enterprise'] }}\"\n+    - name: Set Quay Hostname When LB Defined\n+      set_fact:\n+        quay_hostname: \"{{ hostvars[groups['lb'][0]]['inventory_hostname'] }}\"\n+      when: quay_hostname is undefined and groups['lb'] | length > 0\n+    - name: Set Quay Hostname When LB Defined\n+      set_fact:\n+        quay_hostname: \"{{ hostvars[groups['quay_enterprise'][0]]['inventory_hostname'] }}\"\n+      when: quay_hostname is undefined and groups['lb'] | length == 0\n+\n     - name: Install Clair\n       include_role:\n         name: config-clair\n@@ -171,4 +184,4 @@\n         clair_ssl_trust_configure: \"{{ hostvars[groups['quay_enterprise'][0]]['quay_ssl_enable']|bool }}\"\n         clair_ssl_trust_src_file: \"{{ hostvars[groups['quay_enterprise'][0]]['quay_ssl_cert_file'] if hostvars[groups['quay_enterprise'][0]]['quay_ssl_enable'] is defined and hostvars[groups['quay_enterprise'][0]]['quay_ssl_enable']|bool else '' }}\"\n         postgresql_port: \"{{ clair_database_port | default('5433') }}\"\n-        clair_host_proxy_port: \"{{ clair_endpoint_port | default('6060') }}\"\n\\ No newline at end of file\n+        clair_host_proxy_port: \"{{ clair_endpoint_port | default('6060') }}\""}, {"sha": "ba0fc09eb9ee8103644b736e909c16e697531662", "filename": "roles/config-quay-enterprise/tasks/complete_setup.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-quay-enterprise/tasks/complete_setup.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-quay-enterprise/tasks/complete_setup.yml", "status": "modified", "patch": "@@ -8,7 +8,7 @@\n \n     - name: Restart Quay\n       systemd:\n-        name: \"{{ quay_name }}\"\n+        name: \"{{ quay_service }}\"\n         enabled: yes\n         state: restarted\n         daemon_reload: yes\n@@ -24,8 +24,8 @@\n       retries: 30\n       delay: 10\n     - name: Write file\n-      copy: \n-        content: \"{{ uri_setup.content }}\" \n+      copy:\n+        content: \"{{ uri_setup.content }}\"\n         dest: \"{{ tmp_setup_file_location }}\"\n     - name: Extract csrf token\n       shell: cat /tmp/quay | grep \"__token\" | awk -F\\' '{print $(NF-1)}'\n@@ -60,4 +60,4 @@\n     owner: root\n     group: root\n     mode: g+rw\n-  notify: Restart quay service\n\\ No newline at end of file\n+  notify: Restart quay service"}, {"sha": "db625270140b73d90f2da1d7be4a9cadabbd34c1", "filename": "roles/config-quay-enterprise/tasks/firewall.yml", "previous_filename": null, "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-quay-enterprise/tasks/firewall.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-quay-enterprise/tasks/firewall.yml", "status": "modified", "patch": "@@ -14,26 +14,26 @@\n \n - name: Open port in firewalld\n   firewalld:\n-    port: \"{{ item }}/TCP\"\n+    port: \"{{ item }}/tcp\"\n     permanent: true\n     state: enabled\n   when: firewalld_status.rc == 0\n   with_items:\n-    - \"{{ quay_http_port }}\"\n-    - \"{{ quay_https_port }}\"\n+    - \"{{ quay_host_http_port }}\"\n+    - \"{{ quay_host_https_port }}\"\n   notify:\n   - restart firewalld\n \n-- name: Ensure iptables is correctly configured \n+- name: Ensure iptables is correctly configured\n   lineinfile:\n     insertafter: \"^-A INPUT .* --dport {{ item }} .* ACCEPT\"\n     state: present\n     dest: /etc/sysconfig/iptables\n     regexp: \"^-A INPUT .* --dport {{ item }} .* ACCEPT\"\n     line: \"-A INPUT -p TCP -m state --state NEW -m TCP --dport {{ item }} -j ACCEPT\"\n   with_items:\n-    - \"{{ quay_http_port }}\"\n-    - \"{{ quay_https_port }}\"\n-  when: iptables_status.rc == 0 and firewalld_status.rc != 0 \n+    - \"{{ quay_host_http_port }}\"\n+    - \"{{ quay_host_https_port }}\"\n+  when: iptables_status.rc == 0 and firewalld_status.rc != 0\n   notify:\n   - restart iptables"}, {"sha": "f42c601b0371afc9eedc0f5825209912f86ab8f0", "filename": "roles/config-redis/handlers/main.yml", "previous_filename": null, "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-redis/handlers/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-redis/handlers/main.yml", "status": "modified", "patch": "@@ -1,6 +1,8 @@\n+---\n+\n - name: Restart Redis Service\n   systemd:\n-    name: \"{{ redis_name }}\"\n+    name: \"{{ redis_service }}\"\n     enabled: yes\n     state: restarted\n     daemon_reload: yes\n@@ -13,4 +15,4 @@\n - name: restart iptables\n   service:\n     name: iptables\n-    state: restarted\n\\ No newline at end of file\n+    state: restarted"}, {"sha": "56d351e28a79f333da4a9fb5070d243e70f34da6", "filename": "roles/config-postgresql/defaults/main.yml", "previous_filename": null, "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/redhat-cop/infra-ansible/blob/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-postgresql/defaults/main.yml", "raw_url": "https://github.com/redhat-cop/infra-ansible/raw/83a79a9f8c1054117e69e39e9e562803241dc7bc/roles/config-postgresql/defaults/main.yml", "status": "modified", "patch": "@@ -1,5 +1,4 @@\n ---\n-\n mode: containerized\n \n postgresql_name: postgresql\n@@ -18,9 +17,9 @@ postgresql_container_port: 5432\n postgresql_host_port: 5432\n \n # These Values will be randomaly generated if not defined\n-#postgresql_admin_user: postgresqladmin\n #postgresql_username: postgresql\n #postgresql_password: postgresql\n+#postgresql_admin_user: postgresqladmin\n #postgresql_admin_password: postgresqladmin\n \n postgresql_db_uri: \"postgresql://{{ postgresql_admin_user }}:{{ postgresql_admin_password }}@{{ database_service }}/{{ postgresql_database }}\""}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #40", "sha": "a487a430fdb2fa9a230f98722d9ebf48d1d6764b", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/a487a430fdb2fa9a230f98722d9ebf48d1d6764b", "parents": ["a10c5f4577e6e74feb1fadec4bcbab039b8b180a"], "files": [{"sha": "657d1f456b60e91235ab02828d9566de61c2bdc9", "filename": "tasks/checks/distribution-checks.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/checks/distribution-checks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/checks/distribution-checks.yml", "status": "modified", "patch": "@@ -26,7 +26,7 @@\n - name: Fail if kernel version is lower than 3.10\n   fail:\n     msg: \"Kernel version 3.10 or later is required!\"\n-  when: ansible_kernel | version_compare(\"3.10\", '<')\n+  when: ansible_kernel is version_compare(\"3.10\", '<')\n \n - name: Fail if this roles does not support the distribution\n   fail:"}, {"sha": "26c01c2e65b7ccbfde25a2004c811bc732b27bc8", "filename": "tasks/bug-tweaks/lvm-thinpool.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/bug-tweaks/lvm-thinpool.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/bug-tweaks/lvm-thinpool.yml", "status": "modified", "patch": "@@ -4,7 +4,7 @@\n     name: lvm2\n     state: present\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n \n - name: Create LVM volume group\n   become: true\n@@ -36,7 +36,7 @@\n     lv: '{{ pool.name }}meta'\n     size: '{{ pool.metadata_size }}'\n     vg: '{{ pool.volume_group }}'\n-  when: _datavolume_created | changed\n+  when: _datavolume_created is changed\n \n - name: Convert data volume to thinpool\n   become: true\n@@ -47,6 +47,6 @@\n         -c 512K\n         --thinpool \"{{ pool.volume_group }}/{{ pool.name }}\"\n         --poolmetadata \"{{ pool.volume_group }}/{{ pool.name }}meta\"\n-  when: _datavolume_created | changed\n+  when: _datavolume_created is changed\n   tags:\n     - skip_ansible_lint\n\\ No newline at end of file"}, {"sha": "8ad537c6e6e891190fef8fca38f0af21935e9b20", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/main.yml", "status": "modified", "patch": "@@ -34,7 +34,7 @@\n - name: Temporary handling of deprecated variable docker_pkg_name\n   set_fact:\n     docker_version: \"{{ docker_pkg_name | regex_replace('^docker-ce.(.+)$', '\\\\1') }}\"\n-  when: docker_pkg_name | match('docker-ce' + docker_os_pkg_version_separator[_docker_os_dist])\n+  when: docker_pkg_name is match('docker-ce' + docker_os_pkg_version_separator[_docker_os_dist])\n   tags: [\"always\"]\n \n - name: Compatibility and distribution checks"}, {"sha": "212a57e1edb23ba29c33a964c25eea86acda5675", "filename": "tasks/configure-docker/configure-systemd.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/configure-docker/configure-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/configure-docker/configure-systemd.yml", "status": "modified", "patch": "@@ -41,6 +41,6 @@\n   systemd:\n     daemon_reload: yes\n   notify: restart docker\n-  when: _systemd_docker_dropin|changed\n+  when: _systemd_docker_dropin is changed\n   tags:\n     - skip_ansible_lint\n\\ No newline at end of file"}, {"sha": "55a5384ce2a71df8faa8d659b6d0d4894ab97577", "filename": "tasks/bug-tweaks.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/bug-tweaks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/bug-tweaks.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@\n   include_tasks: bug-tweaks/bug-centos7-resource-busy.yml\n   when:\n     - _docker_os_dist == \"CentOS\" or _docker_os_dist == \"RedHat\"\n-    - ansible_kernel | version_compare('4', '<')\n+    - ansible_kernel is version_compare('4', '<')\n \n - name: Best effort handling to directlvm for Debian 8 to get uniform behavior across distributions\n   include_tasks: bug-tweaks/tweak-debian8-directlvm.yml"}, {"sha": "72a7e31cc9ce860951f48df9c33f30ee51258a51", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -11,7 +11,7 @@\n     update_cache: yes\n   changed_when: false\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: _docker_os_dist == \"Ubuntu\" or\n         _docker_os_dist == \"Debian\"\n \n@@ -23,7 +23,7 @@\n   with_items:\n     - \"{{ docker_repository_related_packages[_docker_os_dist] }}\"\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: _docker_os_dist == \"Ubuntu\" or\n         _docker_os_dist == \"Debian\" or\n         _docker_os_dist == \"CentOS\" or\n@@ -35,7 +35,7 @@\n     url: https://download.docker.com/linux/{{ _docker_os_dist|lower }}/gpg\n     state: present\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   when: (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version > '14') or\n         (_docker_os_dist == \"Debian\" and _docker_os_dist_major_version > '7')\n "}, {"sha": "33f7e603914eba9ce3530ad0dbb77c877c90e371", "filename": "meta/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/meta/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/meta/main.yml", "status": "modified", "patch": "@@ -2,7 +2,7 @@ galaxy_info:\n   author: Bjorn Oscarsson\n   company: none\n   description: \"Installs and configures Docker Community Edition (CE)\"\n-  min_ansible_version: 2.4\n+  min_ansible_version: 2.5\n   license: MIT\n   platforms:\n   - name: Fedora"}, {"sha": "7cbb77952473c7af8ee3809a830c9dbf735af545", "filename": "tasks/install-docker.yml", "previous_filename": null, "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/install-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/a487a430fdb2fa9a230f98722d9ebf48d1d6764b/tasks/install-docker.yml", "status": "modified", "patch": "@@ -15,7 +15,7 @@\n       - docker-ce\n   when:\n     - docker_version != ''\n-    - docker_version | match('17.') or docker_version | match('18.03') or docker_version | match('18.06')\n+    - docker_version is match('17.') or docker_version is match('18.03') or docker_version is match('18.06')\n \n - name: Ensure some kind of compatibility for no longer officially supported distributions since Docker CE 18.09\n   set_fact:\n@@ -30,9 +30,9 @@\n - name: Ensure Docker CE is installed\n   become: true\n   package:\n-    name: \"{{ (item | search('docker')) | ternary((item + _docker_version_string | default('')), item) }}\"\n+    name: \"{{ (item is search('docker')) | ternary((item + _docker_version_string | default('')), item) }}\"\n     state: \"{{ _docker_pkg_state | default('present') }}\"\n   with_items: \"{{ _docker_packages | default(docker_packages) }}\"\n   register: _pkg_result\n-  until: _pkg_result|succeeded\n+  until: _pkg_result is succeeded\n   notify: restart docker"}]}, {"repo": "kubevirt/kubevirt-ansible", "author_id": "MDQ6VXNlcjYyODQwMDM=", "author_name": "Shiyang Wang", "committer_id": "MDQ6VXNlcjE1MDU2ODQ=", "committer_name": "Lukas Bednar", "committer_email": "lukyn17@gmail.com", "message": "fix kraken crash due to MON_IP with wrong value (#236)\n\nSigned-off-by: Shiyang Wang <shiywang@redhat.com>", "sha": "82918d7eb1be551b248ab1c072ce966d922ebf8e", "url": "https://api.github.com/repos/kubevirt/kubevirt-ansible/commits/82918d7eb1be551b248ab1c072ce966d922ebf8e", "parents": ["6d923ac07f1261a6126ae7d910c2b90a5f4abdec"], "files": [{"sha": "1895c4f701e57278752e0e07f2b642a705909279", "filename": "roles/storage-demo/templates/storage-demo.yml", "previous_filename": null, "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/82918d7eb1be551b248ab1c072ce966d922ebf8e/roles/storage-demo/templates/storage-demo.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/82918d7eb1be551b248ab1c072ce966d922ebf8e/roles/storage-demo/templates/storage-demo.yml", "status": "modified", "patch": "@@ -50,7 +50,9 @@ spec:\n         args: [\"demo\"]\n         env:\n         - name: MON_IP\n-          value: \"{{ storage_demo_node_hostname }}\"\n+          valueFrom:\n+            fieldRef:\n+              fieldPath: status.hostIP\n         - name: CEPH_PUBLIC_NETWORK\n           value: \"0.0.0.0/0\"\n         - name: RGW_CIVETWEB_PORT\n@@ -94,7 +96,9 @@ spec:\n         command: [\"/scripts/ceph-service.sh\"]\n         env:\n         - name: MON_IP\n-          value: \"{{ storage_demo_node_hostname }}\"\n+          valueFrom:\n+            fieldRef:\n+              fieldPath: status.hostIP\n         volumeMounts:\n         - name: cephetc\n           mountPath: \"/etc/ceph\""}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #10: Solr 5.x support.", "sha": "f32eb359341e98c23f09e76bc130c6366163c893", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/f32eb359341e98c23f09e76bc130c6366163c893", "parents": ["23a0c3241ae8c7ed5593671e8f89c05857296e50"], "files": [{"sha": "c5ccc7eea3beffeaa6753889a73b0551a2890dfe", "filename": "tasks/solr-home.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/f32eb359341e98c23f09e76bc130c6366163c893/tasks/solr-home.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/f32eb359341e98c23f09e76bc130c6366163c893/tasks/solr-home.yml", "status": "modified", "patch": "@@ -10,11 +10,11 @@\n     owner: \"{{ solr_user }}\"\n     group: \"{{ solr_user }}\"\n     mode: 0755\n-  when: not solr_example.stat.exists\n+  when: not solr_example.stat.exists and solr_version.split('.')[0] < 5\n \n - name: Copy Solr example into solr_home.\n   shell: \"cp -r {{ solr_install_path }}/example/solr/* {{ solr_home }}\"\n-  when: not solr_example.stat.exists\n+  when: not solr_example.stat.exists and solr_version.split('.')[0] < 5\n \n - name: Fix the example solrconfig.xml file.\n   replace:"}, {"sha": "390ec35c63528cdd45f8885d4f69c192571c1e9b", "filename": "tasks/init-script.yml", "previous_filename": null, "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/f32eb359341e98c23f09e76bc130c6366163c893/tasks/init-script.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/f32eb359341e98c23f09e76bc130c6366163c893/tasks/init-script.yml", "status": "modified", "patch": "@@ -8,15 +8,23 @@\n     mode: 0664\n   changed_when: false\n \n-- name: Copy solr init script into place.\n+- name: Copy solr init script into place (Solr < 5).\n+  template:\n+    src: \"solr-init-{{ ansible_os_family }}-pre5.j2\"\n+    dest: \"/etc/init.d/{{ solr_service_name }}\"\n+    mode: 0755\n+  when: \"solr_version.split('.')[0] < 5\"\n+\n+- name: Copy solr init script into place (Solr 5+).\n   template:\n     src: \"solr-init-{{ ansible_os_family }}.j2\"\n     dest: \"/etc/init.d/{{ solr_service_name }}\"\n     mode: 0755\n+  when: \"solr_version.split('.')[0] >= 5\"\n \n - name: Ensure daemon is installed (Debian).\n   apt: name=daemon state=installed\n-  when: ansible_os_family == \"Debian\"\n+  when: ansible_os_family == \"Debian\" and solr_version.split('.')[0] < 5\n \n - name: Ensure solr is started and enabled on boot.\n   service:"}, {"sha": "39a5d81df5d4c81aad875734bffae1e9849514b6", "filename": "tasks/main.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/f32eb359341e98c23f09e76bc130c6366163c893/tasks/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/f32eb359341e98c23f09e76bc130c6366163c893/tasks/main.yml", "status": "modified", "patch": "@@ -2,10 +2,10 @@\n - include: user.yml\n   when: solr_create_user\n \n-- name: Set solr_filename for Solr 4.x.\n+- name: Set solr_filename for Solr 4+.\n   set_fact:\n-    \"solr_filename=solr-{{ solr_version }}\"\n-  when: \"solr_version.split('.')[0] == '4'\"\n+    solr_filename: \"solr-{{ solr_version }}\"\n+  when: \"solr_version.split('.')[0] > 3\"\n \n - name: Set solr_filename for Solr 3.x.\n   set_fact:\n@@ -22,7 +22,7 @@\n   unarchive:\n     src: \"{{ solr_workspace }}/{{ solr_filename }}.tgz\"\n     dest: \"{{ solr_workspace }}\"\n-    creates: \"{{ solr_workspace }}/{{ solr_filename }}/dist/{{ solr_filename }}.war\"\n+    creates: \"{{ solr_workspace }}/{{ solr_filename }}/CHANGES.txt\"\n     copy: no\n \n - name: Check if Solr is already installed."}]}, {"repo": "iiab/iiab", "author_id": "MDQ6VXNlcjI0NTg5MDc=", "author_name": "A Holt", "committer_id": "MDQ6VXNlcjE5ODY0NDQ3", "committer_name": "GitHub", "committer_email": "noreply@github.com", "message": "Merge pull request #485 from holta/kiwix-cron-nightly-not-hourly\n\nrestart kiwix-serve 4AM nightly (not 15min after every hour) & restrict chown to /opt/iiab/kiwix\r\n\r\nSmoke-tested.  Please continue to test locally, so we can refine (or eliminate if nec?) this cron job's frequency as nec!\r\n\r\nCloses #484", "sha": "7b929140195f5fc1217dfa6779e6f6e81d809fd2", "url": "https://api.github.com/repos/iiab/iiab/commits/7b929140195f5fc1217dfa6779e6f6e81d809fd2", "parents": ["50a0256ebcdef429fa1de9afb21bc2c1d62620b6", "d748a14cbda76758663b4e330b6831b856366679"], "files": [{"sha": "54d7d4d86a2d0f899c95708f28055becfb11e892", "filename": "roles/kiwix/tasks/kiwix_install.yml", "previous_filename": null, "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/iiab/iiab/blob/7b929140195f5fc1217dfa6779e6f6e81d809fd2/roles/kiwix/tasks/kiwix_install.yml", "raw_url": "https://github.com/iiab/iiab/raw/7b929140195f5fc1217dfa6779e6f6e81d809fd2/roles/kiwix/tasks/kiwix_install.yml", "status": "modified", "patch": "@@ -1,4 +1,4 @@\n-- name: Create various directories for ZIM files\n+- name: Create various directories for Kiwix's ZIM files\n   file: path={{ item }}\n         owner=root\n         group=root\n@@ -9,11 +9,11 @@\n     - \"{{ kiwix_content_path }}\"\n     - \"{{ iiab_zim_path }}/index\"\n \n-- name: Check for kiwix-serve binary\n+- name: Check for 'kiwix-serve' binary\n   stat: path={{ iiab_base }}/kiwix/bin/kiwix-serve\n   register: kiwix_bin\n \n-- name: Set kiwix first pass\n+- name: Set kiwix_first_pass\n   set_fact:\n     kiwix_first_pass: True\n   when: kiwix_bin.stat.exists is defined and not kiwix_bin.stat.exists\n@@ -47,7 +47,7 @@\n              group=root\n   when: not kiwix_src_bin_only and kiwix_first_pass\n \n-- name: Create directory for kiwix bin\n+- name: Create kiwix/bin directory\n   file: path=\"{{ iiab_base }}/kiwix/bin\"\n         owner=root\n         group=root\n@@ -63,33 +63,33 @@\n     - rewrite\n   when: is_debuntu\n \n-- name: Unarchive it to permanent location - bin only\n+- name: Unarchive Kiwix to permanent location - bin only\n   unarchive: src=\"{{ downloads_dir }}/{{ kiwix_src_file }}\"\n              dest=\"{{ iiab_base }}/kiwix/bin\"\n              owner=root\n              group=root\n   when: kiwix_src_bin_only and kiwix_first_pass\n \n # workaround because unarchive does not set ownership properly\n-- name: Set kiwix ownership to root [WARNING chown -R across all of /opt/iiab]\n-  command: \"chown -R root:root {{ iiab_base }}\"\n+- name: \"Set ownership: 'chown -R root:root /opt/iiab/kiwix'\"\n+  command: \"chown -R root:root {{ iiab_base }}/kiwix\"\n \n # workaround because kiwix-serve does not stay running\n-- name: Make an entry in crontab to restart every hour\n+- name: Make a crontab entry to restart kiwix-serve at 4AM (debuntu)\n # *  *  *  *  * user-name  command to be executed\n-  lineinfile: line=\"15 *  *  *  * root /bin/systemctl restart kiwix-serve.service\"\n+  lineinfile: line=\"0  4  *  *  * root /bin/systemctl restart kiwix-serve.service\"\n               dest=/etc/crontab\n   when: is_debuntu\n \n-- name: Make an entry in crontab to restart every hour\n+- name: Make a crontab entry to restart kiwix-serve at 4AM (redhat)\n # *  *  *  *  * user-name  command to be executed\n-  lineinfile: line=\"15 *  *  *  * root /usr/bin/systemctl restart kiwix-serve.service\"\n+  lineinfile: line=\"0  4  *  *  * root /usr/bin/systemctl restart kiwix-serve.service\"\n               dest=/etc/crontab\n   when: is_redhat\n \n # Create kiwix service\n \n-- name: Create kiwix-serve service\n+- name: Create 'kiwix-serve' service\n   template: backup=no\n             src={{ item.src }}\n             dest={{ item.dest }}\n@@ -105,7 +105,7 @@\n     - { src: 'iiab-make-apache-config.py', dest: '/usr/bin/iiab-make-apache-config.py', mode: '0755'}\n \n \n-- name: Add kiwix-serve to list of services\n+- name: Add 'kiwix-serve' to list of services\n   ini_file: dest='{{ service_filelist }}'\n             section=kiwix-serve\n             option='{{ item.option }}'\n@@ -130,13 +130,13 @@\n     - option: enabled\n       value: \"{{ kiwix_enabled }}\"\n \n-- name: Enable kiwix-serve service\n+- name: Enable 'kiwix-serve' service\n   service: name=kiwix-serve\n            enabled=yes\n            state=restarted\n   when: kiwix_enabled\n \n-- name: Disable kiwix-serve service\n+- name: Disable 'kiwix-serve' service\n   service: name=kiwix-serve\n            enabled=no\n            state=stopped"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #50", "sha": "2546a8fca283af94be5e80dc6f5141836aca689a", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/2546a8fca283af94be5e80dc6f5141836aca689a", "parents": ["1d1002f58d64e00c5cb916cf8e890aff338b1c9a"], "files": [{"sha": "407838bdfb01178a2d0c4a744395d3446214526d", "filename": "tasks/configure-systemd.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/configure-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/configure-systemd.yml", "status": "modified", "patch": "@@ -3,17 +3,17 @@\n     _systemd_service_config: \"{{ docker_systemd_service_config_tweaks + docker_systemd_service_config }}\"\n \n - name: Ensure /etc/systemd/system/docker.service.d directory exists\n+  become: true\n   file:\n     path: /etc/systemd/system/docker.service.d\n     state: directory\n     mode: 0755\n-  become: yes\n \n - name: Setup default Docker drop-in to enable use of environment file\n+  become: true\n   template:\n     src: drop-ins/default.conf.j2\n     dest: /etc/systemd/system/docker.service.d/default.conf\n-  become: yes\n   notify: restart docker\n   register: _systemd_docker_dropin\n   vars:\n@@ -28,17 +28,17 @@\n       DOCKER_OPTS: \"{{ docker_daemon_opts }}\"\n \n - name: Setup Docker environment file {{ docker_envs_dir[_docker_os_dist] }}/docker-envs\n+  become: true\n   template:\n     src: docker-envs.j2\n     dest: \"{{ docker_envs_dir[_docker_os_dist] }}/docker-envs\"\n-  become: yes\n   notify: restart docker\n   vars:\n     docker_envs: \"{{ docker_service_envs }}\"\n \n - name: Force daemon reload of systemd\n+  become: true\n   systemd:\n     daemon_reload: yes\n-  become: yes\n   notify: restart docker\n   when: _systemd_docker_dropin|changed\n\\ No newline at end of file"}, {"sha": "ff55df29f92a3a92ed2e6868ec189f108bb5cd01", "filename": "tasks/bug-tweaks.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/bug-tweaks.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/bug-tweaks.yml", "status": "modified", "patch": "@@ -6,20 +6,20 @@\n     register: may_detach_mounts\n \n   - name: Ensure fs.may_detach_mounts is set to avoid 'Device or resource busy' (CentOS/RedHat)\n+    become: true\n     sysctl:\n       name: fs.may_detach_mounts\n       value: 1\n       sysctl_file: /etc/sysctl.d/99-docker.conf\n       reload: yes\n-    become: yes\n     when: may_detach_mounts.stat.exists\n \n   # Keep for compatibility reasons of this role. Now everything is in the same file.\n   - name: Remove systemd drop-in for Docker Mount Flags slave configuration (CentOS/RedHat)\n+    become: true\n     file:\n       path: /etc/systemd/system/docker.service.d/mountflags-slave.conf\n       state: absent\n-    become: yes\n     notify: restart docker\n \n   - name: Set systemd service MountFlags option to \"slave\" to prevent \"device busy\" errors on CentOS/RedHat 7.3 kernels (CentOS/RedHat)"}, {"sha": "fdd5fdbabd232c84896f0363d9a310bdbc4a2c83", "filename": "tasks/remove-pre-docker-ce.yml", "previous_filename": null, "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/remove-pre-docker-ce.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/remove-pre-docker-ce.yml", "status": "modified", "patch": "@@ -11,12 +11,12 @@\n   when: cmd_docker_version.stdout_lines is defined and cmd_docker_version.stdout_lines[0] is defined\n \n - name: Check if Docker is running\n+  become: true\n   command: systemctl status docker\n   ignore_errors: yes\n   changed_when: false\n   register: service_docker_status\n   when: remove_old_docker | default(false) | bool == true\n-  become: true\n \n - name: Stop Docker service\n   service:\n@@ -25,10 +25,10 @@\n   when: \"service_docker_status.rc | default(1) == 0\"\n \n - name: Remove old Docker installation before Docker CE\n+  become: true\n   package:\n     name: \"{{ item }}\"\n     state: absent\n-  become: true\n   when: remove_old_docker|default(false) | bool == true\n   with_items:\n     - \"{{ docker_old_packages[_docker_os_dist] }}\""}, {"sha": "d2893bcfb3c4cfc0ec7a2b9d4b33496d780c1bf4", "filename": "tasks/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/main.yml", "status": "modified", "patch": "@@ -20,8 +20,8 @@\n # https://wiki.ubuntu.com/SystemdForUpstartUsers\n # Important! systemd is only fully supported in Ubuntu 15.04 and later releases\n - name: Determine usage of systemd\n-  shell: \"ps -p1 | grep systemd 1>/dev/null && echo systemd || echo upstart\"\n   become: true\n+  shell: \"ps -p1 | grep systemd 1>/dev/null && echo systemd || echo upstart\"\n   changed_when: no\n   register: _determine_systemd_usage\n "}, {"sha": "0a3d1ef72f190984235d6bd491ac362fe6df630c", "filename": "tasks/install-docker.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/install-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/install-docker.yml", "status": "modified", "patch": "@@ -5,8 +5,8 @@\n   when: docker_latest_version|bool\n \n - name: Ensure docker-ce is installed\n+  become: true\n   package:\n     name: \"{{ docker_pkg_name }}\"\n     state: \"{{ docker_pkg_state|default('present') }}\"\n-  become: true\n   notify: restart docker"}, {"sha": "083a06ada7e59272066385e4463b79a6d4db144c", "filename": "tasks/setup-repository.yml", "previous_filename": null, "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/setup-repository.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/setup-repository.yml", "status": "modified", "patch": "@@ -1,62 +1,62 @@\n ---\n - name: Ensure python and deps for Ansible modules\n-  raw: dnf install -y python2 python2-dnf libselinux-python\n   become: true\n+  raw: dnf install -y python2 python2-dnf libselinux-python\n   changed_when: false\n   when: _docker_os_dist == \"Fedora\"\n \n - name: Update APT cache\n+  become: true\n   apt:\n     update_cache: yes\n   changed_when: false\n-  become: true\n   when: _docker_os_dist == \"Ubuntu\" or\n         _docker_os_dist == \"Debian\"\n \n - name: Ensure packages are installed for repository setup\n+  become: true\n   package:\n     name: \"{{ item }}\"\n     state: present\n   with_items:\n     - \"{{ docker_repository_related_packages[_docker_os_dist] }}\"\n-  become: true\n   when: _docker_os_dist == \"Ubuntu\" or\n         _docker_os_dist == \"Debian\" or\n         _docker_os_dist == \"CentOS\" or\n         _docker_os_dist == \"RedHat\"\n \n - name: Add Docker official GPG key\n+  become: true\n   apt_key:\n     url: https://download.docker.com/linux/{{ _docker_os_dist|lower }}/gpg\n     state: present\n-  become: true\n   when: (_docker_os_dist == \"Ubuntu\" and _docker_os_dist_major_version > '14')\n         or _docker_os_dist == \"Debian\"\n \n - name: Add Docker APT key (alternative for older Ubuntu systems without SNI).\n+  become: true\n   shell: \"curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\"\n   args:\n     warn: false\n-  become: true\n   changed_when: false\n   when: _docker_os_dist == \"Ubuntu\" and\n         _docker_os_dist_major_version == '14'\n \n - name: Add Docker CE repository (Ubuntu/Debian)\n+  become: true\n   apt_repository:\n     repo: deb [arch=amd64] https://download.docker.com/linux/{{ _docker_os_dist|lower }} {{ _docker_os_dist_release }} stable {{ (docker_enable_ce_edge == true) | ternary('edge','') }}\n     state: present\n     filename: 'docker-ce'\n-  become: true\n   when: _docker_os_dist == \"Ubuntu\" or\n         _docker_os_dist == \"Debian\"\n \n - name: Add Docker CE repository (Fedora/CentOS/RedHat)\n+  become: true\n   get_url:\n     url: \"{{ docker_repository_url[_docker_os_dist] }}\"\n     dest: /etc/yum.repos.d/docker-ce.repo\n     mode: 0644\n-  become: true\n   register: docker_repo\n   when: _docker_os_dist == \"CentOS\" or\n         _docker_os_dist == \"Fedora\" or\n@@ -81,42 +81,42 @@\n         _docker_os_dist == \"RedHat\"\n \n - name: Enable/Disable Docker CE Edge Repository (Fedora/CentOS/RedHat)\n-  shell: \"{{ docker_cmd_enable_disable_edge_repo[_docker_os_dist] }}\"\n   become: true\n+  shell: \"{{ docker_cmd_enable_disable_edge_repo[_docker_os_dist] }}\"\n   when: (_docker_os_dist == \"CentOS\" or _docker_os_dist == \"Fedora\" or _docker_os_dist == \"RedHat\") and\n         _fact_docker_ce_edge_enabled != docker_enable_ce_edge\n \n # disable rt-beta so we don't get a 403 error retrieving repomd.xml\n - name: Check if rhel-7-server-rt-beta-rpms Repository is enabled (RedHat)\n-  shell: \"subscription-manager repos --list-enabled | grep rhel-7-server-rt-beta-rpms\"\n   become: true\n+  shell: \"subscription-manager repos --list-enabled | grep rhel-7-server-rt-beta-rpms\"\n   register: cmd_rhel_rt_beta_repo_enabled\n   when: _docker_os_dist == \"RedHat\"\n   changed_when: false\n   failed_when: cmd_rhel_rt_beta_repo_enabled.rc not in [ 0, 1 ]\n \n - name: Disable rhel-7-server-rt-beta-rpms Repository (RedHat)\n-  shell: \"subscription-manager repos --disable=rhel-7-server-rt-beta-rpms\"\n   become: true\n+  shell: \"subscription-manager repos --disable=rhel-7-server-rt-beta-rpms\"\n   when: _docker_os_dist == \"RedHat\" and cmd_rhel_rt_beta_repo_enabled.rc == 0\n \n # container-selinux package wants this\n - name: Check if rhel-7-server-extras-rpms Repository is enabled (RedHat)\n-  shell: \"subscription-manager repos --list-enabled | grep rhel-7-server-extras-rpms\"\n   become: true\n+  shell: \"subscription-manager repos --list-enabled | grep rhel-7-server-extras-rpms\"\n   register: cmd_rhel_extras_repo_enabled\n   when: _docker_os_dist == \"RedHat\"\n   changed_when: false\n   failed_when: cmd_rhel_extras_repo_enabled.rc not in [ 0, 1 ]\n \n - name: Enable rhel-7-server-extras-rpms Repository (RedHat)\n-  shell: \"subscription-manager repos --enable=rhel-7-server-extras-rpms\"\n   become: true\n+  shell: \"subscription-manager repos --enable=rhel-7-server-extras-rpms\"\n   when: _docker_os_dist == \"RedHat\" and cmd_rhel_extras_repo_enabled.rc == 1\n \n - name: Update repository cache\n+  become: true\n   shell: \"{{ docker_cmd_update_repo_cache[_docker_os_dist] }}\"\n   args:\n     warn: false\n-  become: true\n   when: docker_repo.changed\n\\ No newline at end of file"}, {"sha": "defb54fb0fd7975e8d05b0e6eda0ed3ccb4ebb1f", "filename": "tasks/setup-audit.yml", "previous_filename": null, "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/setup-audit.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/setup-audit.yml", "status": "modified", "patch": "@@ -1,24 +1,23 @@\n ---\n - name: Ensure auditd is installed\n+  become: true\n   package:\n     name: auditd\n     state: present\n-  become: true\n-  when: _docker_os_dist == \"Ubuntu\" or\n-        _docker_os_dist == \"Debian\"\n+  when: docker_enable_audit and (_docker_os_dist == \"Ubuntu\" or _docker_os_dist == \"Debian\")\n \n - name: Copy Docker audit rules\n+  become: yes\n   copy:\n     src: files/etc/audit/rules.d/docker.rules\n     dest: /etc/audit/rules.d/docker.rules\n-  become: yes\n   notify: restart auditd\n-  when: docker_enable_audit | bool\n+  when: docker_enable_audit\n \n - name: Ensure Docker audit rules are removed\n+  become: yes\n   file:\n     path: /etc/audit/rules.d/docker.rules\n     state: absent\n-  become: yes\n   notify: restart auditd\n-  when: not docker_enable_audit | bool\n+  when: not docker_enable_audit"}, {"sha": "ed1532b4ca5a1698ce0e3262b0b0c78711acf156", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -1,34 +1,34 @@\n ---\n - name: Ensure /etc/docker directory exists\n+  become: true\n   file:\n     path: /etc/docker\n     state: directory\n     mode: 0755\n-  become: true\n \n - name: Configure Docker daemon (file)\n+  become: true\n   copy:\n     src: \"{{ docker_daemon_config_file }}\"\n     dest: /etc/docker/daemon.json\n-  become: true\n   notify: restart docker\n   when: docker_daemon_config_file is defined\n \n - name: Configure Docker daemon (variables)\n+  become: true\n   copy:\n     content: \"{{ docker_daemon_config | to_nice_json }}\"\n     dest: /etc/docker/daemon.json\n-  become: true\n   notify: restart docker\n   when: docker_daemon_config_file is not defined and\n         docker_daemon_config is defined\n \n - name: Ensure Docker default user namespace is defined in subuid and subgid\n+  become: true\n   lineinfile:\n     path: \"{{ item }}\"\n     regexp: '^dockremap'\n     line: 'dockremap:500000:65536'\n-  become: yes\n   with_items:\n     - /etc/subuid\n     - /etc/subgid\n@@ -39,21 +39,21 @@\n         docker_bug_usermod|bool == true)\n \n - name: Ensure thin-provisioning-tools is installed when devicemapper is used (Ubuntu)\n+  become: true\n   package:\n     name: thin-provisioning-tools\n     state: present\n-  become: yes\n   when: (_docker_os_dist == \"Ubuntu\" or _docker_os_dist == \"Debian\") and\n         docker_daemon_config['storage-driver'] is defined and\n         docker_daemon_config['storage-driver'] == 'devicemapper'\n \n - name: Enable Docker service\n+  become: true\n   service:\n     name: docker\n     enabled: yes\n   notify: restart docker\n   register: docker_service\n-  become: yes\n \n - name: Trigger start/restart of Docker\n   service:"}, {"sha": "ea43181c3cbef322147ad703a1389d78fa6f2b48", "filename": "tasks/configure-non-systemd.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/configure-non-systemd.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2546a8fca283af94be5e80dc6f5141836aca689a/tasks/configure-non-systemd.yml", "status": "modified", "patch": "@@ -6,10 +6,10 @@\n       DOCKER_OPTS: \"{{ docker_daemon_opts }}\"\n \n - name: Setup Docker environment file {{ docker_envs_dir[_docker_os_dist] }}/docker\n+  become: true\n   template:\n     src: docker-envs.j2\n     dest: \"{{ docker_envs_dir[_docker_os_dist] }}/docker\"\n-  become: yes\n   notify: restart docker\n   vars:\n     docker_envs: \"{{ docker_service_envs }}\"\n\\ No newline at end of file"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bj\u00f6rn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bj\u00f6rn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes #21", "sha": "2885718cbdaa7d152c51e76e5be437909d4f47f2", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/2885718cbdaa7d152c51e76e5be437909d4f47f2", "parents": ["b1fc2be47d577197bf49c806cec5deb83b13d6a6"], "files": [{"sha": "3f09e68f137afe4fab5d79ea6166e3c17bce20c9", "filename": "tasks/install-docker.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2885718cbdaa7d152c51e76e5be437909d4f47f2/tasks/install-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2885718cbdaa7d152c51e76e5be437909d4f47f2/tasks/install-docker.yml", "status": "modified", "patch": "@@ -6,7 +6,7 @@\n \n - name: Ensure docker-ce is installed\n   package:\n-    name: docker-ce\n+    name: \"{{ docker_pkg_name }}\"\n     state: \"{{ docker_pkg_state|default('present') }}\"\n   become: true\n   notify: restart docker"}, {"sha": "a75580fd9eba7ff4197faccb5d7f97e2cc0bc688", "filename": "tasks/configure-docker.yml", "previous_filename": null, "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/2885718cbdaa7d152c51e76e5be437909d4f47f2/tasks/configure-docker.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/2885718cbdaa7d152c51e76e5be437909d4f47f2/tasks/configure-docker.yml", "status": "modified", "patch": "@@ -32,10 +32,12 @@\n   with_items:\n     - /etc/subuid\n     - /etc/subgid\n-  when: (docker_daemon_config is defined and\n+  when: ansible_distribution == \"CentOS\" and\n+        ((docker_daemon_config is defined and\n         docker_daemon_config['userns-remap'] is defined and\n         docker_daemon_config['userns-remap'] == 'default') or\n-        docker_bug_usermod|bool == true\n+        docker_bug_usermod|bool == true)\n+\n \n \n - name: Ensure thin-provisioning-tools is installed when devicemapper is used (Ubuntu)"}]}, {"repo": "haxorof/ansible-role-docker-ce", "author_id": "MDQ6VXNlcjExNDU3NjQy", "author_name": "Bjorn Oscarsson", "committer_id": "MDQ6VXNlcjExNDU3NjQy", "committer_name": "Bjorn Oscarsson", "committer_email": "haxorof@users.noreply.github.com", "message": "Fixes related #92", "sha": "57fec6b42f8e451d9354597dd1b1fbc8c833ad0d", "url": "https://api.github.com/repos/haxorof/ansible-role-docker-ce/commits/57fec6b42f8e451d9354597dd1b1fbc8c833ad0d", "parents": ["679a956a08bc9dd352f5e397a6b29339667aa7db"], "files": [{"sha": "f9f2b10203ba12b1306b604134526ba44773f9e3", "filename": "tasks/main.yml", "previous_filename": null, "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/57fec6b42f8e451d9354597dd1b1fbc8c833ad0d/tasks/main.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/57fec6b42f8e451d9354597dd1b1fbc8c833ad0d/tasks/main.yml", "status": "modified", "patch": "@@ -49,17 +49,17 @@\n         msg: \"Tasks requiring network access will be skipped!\"\n       when: not docker_network_access\n       \n-    - name: Setup Docker package repositories\n-      include_tasks: setup-repository.yml\n-      tags: [\"install\"]\n-\n     - name: Remove Docker versions before Docker CE\n       include_tasks: remove-pre-docker-ce.yml\n       when: \n         - docker_remove_pre_ce | bool\n         - docker_network_access\n       tags: [\"install\"]\n \n+    - name: Setup Docker package repositories\n+      include_tasks: setup-repository.yml\n+      tags: [\"install\"]\n+\n     - name: Install Docker\n       include_tasks: install-docker.yml\n       when: docker_network_access"}, {"sha": "0127addda6b9519ff5ec4191e39b7967e8d95953", "filename": "tasks/remove-pre-docker-ce.yml", "previous_filename": null, "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/haxorof/ansible-role-docker-ce/blob/57fec6b42f8e451d9354597dd1b1fbc8c833ad0d/tasks/remove-pre-docker-ce.yml", "raw_url": "https://github.com/haxorof/ansible-role-docker-ce/raw/57fec6b42f8e451d9354597dd1b1fbc8c833ad0d/tasks/remove-pre-docker-ce.yml", "status": "modified", "patch": "@@ -1,16 +1,22 @@\n ---\n+- name: Reset fact related to removal of old Docker\n+  set_fact:\n+    _remove_old_docker: false\n+\n - name: Determine Docker version\n-  command: bash -c \"docker version | grep Version | awk '{print $2}'\"\n-  ignore_errors: yes\n-  changed_when: false\n+  shell: \"docker version --format='{{ '{{' }} .Client.Version {{ '}}' }}' 2>/dev/null\"\n   register: _cmd_docker_version\n+  changed_when: false\n+  failed_when: false\n   check_mode: no\n \n - name: Set fact if old Docker installation shall be removed\n   set_fact:\n-    _remove_old_docker: \"{{ docker_remove_pre_ce | bool }} and not \\\n-      {{ _cmd_docker_version.stdout_lines[0] is search('-ce') }}\"\n-  when: _cmd_docker_version.stdout_lines is defined and _cmd_docker_version.stdout_lines[0] is defined\n+    _remove_old_docker: true\n+  when:\n+    - _cmd_docker_version.stdout_lines is defined\n+    - _cmd_docker_version.stdout_lines[0] is defined\n+    - _cmd_docker_version.stdout_lines[0] is version('17', '<')\n \n - name: Check if Docker is running\n   become: true\n@@ -19,7 +25,7 @@\n   ignore_errors: yes\n   register: _service_docker_status\n   check_mode: no\n-  when: _remove_old_docker | default(False) | bool\n+  when: _remove_old_docker\n \n - name: Stop Docker service\n   service:\n@@ -34,6 +40,6 @@\n     state: absent\n   register: _pkg_result\n   until: _pkg_result is succeeded\n-  when: _remove_old_docker | default(False) | bool\n+  when: _remove_old_docker\n   with_items:\n     - \"{{ docker_old_packages[_docker_os_dist] }}\""}]}, {"repo": "kubevirt/kubevirt-ansible", "author_id": "MDQ6VXNlcjMzMzMxMQ==", "author_name": "Adam Litke", "committer_id": "MDQ6VXNlcjY3OTUyMTM=", "committer_name": "Ryan Hallisey", "committer_email": "rhallise@redhat.com", "message": "Fix heketi route discovery (#199)\n\nWhen grabbing the heketi route the json data is in an array.  Update the\r\njsonpath expression to traverse this array.\r\n\r\nSigned-off-by: Adam Litke <alitke@redhat.com>", "sha": "9ce1be2d445429b80e78fb9288506e983e48976c", "url": "https://api.github.com/repos/kubevirt/kubevirt-ansible/commits/9ce1be2d445429b80e78fb9288506e983e48976c", "parents": ["4e47f4805007d471dbe9550245514c6a5a09fdf4"], "files": [{"sha": "4d40c48b7b21dd2a2dd55b48447470ec6948b81b", "filename": "roles/storage-glusterfs/tasks/provision.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/kubevirt/kubevirt-ansible/blob/9ce1be2d445429b80e78fb9288506e983e48976c/roles/storage-glusterfs/tasks/provision.yml", "raw_url": "https://github.com/kubevirt/kubevirt-ansible/raw/9ce1be2d445429b80e78fb9288506e983e48976c/roles/storage-glusterfs/tasks/provision.yml", "status": "modified", "patch": "@@ -9,7 +9,7 @@\n     glusterfs_name_label: \"{{ glusterfs_name }}{% if glusterfs_name %}-{% endif %}\"\n \n - name: Determine the heketi route\n-  command: \"oc get route -n {{ glusterfs_namespace }} -l heketi={{ glusterfs_name_label }}route -o jsonpath='{.spec.host}'\"\n+  command: \"oc get route -n {{ glusterfs_namespace }} -l heketi={{ glusterfs_name_label }}route -o jsonpath='{.items[0].spec.host}'\"\n   register: route_cmd\n   when:\n     - cluster == 'openshift'"}]}, {"repo": "geerlingguy/ansible-role-solr", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #11: Fix restart handler for misbehaving daemonization on Debian/Ubuntu", "sha": "2e4e34d46f5d74a22a9fb6b68ba0b609c03944d0", "url": "https://api.github.com/repos/geerlingguy/ansible-role-solr/commits/2e4e34d46f5d74a22a9fb6b68ba0b609c03944d0", "parents": ["e442beb8ddaefd3eb6035f60486c5dc50d0842c8"], "files": [{"sha": "9c4c422884629a71fddc88e9a232da85bf60ae6e", "filename": "handlers/main.yml", "previous_filename": null, "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/geerlingguy/ansible-role-solr/blob/2e4e34d46f5d74a22a9fb6b68ba0b609c03944d0/handlers/main.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-solr/raw/2e4e34d46f5d74a22a9fb6b68ba0b609c03944d0/handlers/main.yml", "status": "modified", "patch": "@@ -1,3 +1,3 @@\n ---\n - name: restart solr\n-  service: name=solr state=restarted\n+  service: name=solr state=restarted sleep=5"}]}, {"repo": "geerlingguy/ansible-role-security", "author_id": "MDQ6VXNlcjQ4MTY3Nw==", "author_name": "Jeff Geerling", "committer_id": "MDQ6VXNlcjQ4MTY3Nw==", "committer_name": "Jeff Geerling", "committer_email": "geerlingguy@mac.com", "message": "Fixes #54: Make automatic updates work on CentOS 8.", "sha": "f3dd45a61b08de1b3351140cc442a705cb2fad82", "url": "https://api.github.com/repos/geerlingguy/ansible-role-security/commits/f3dd45a61b08de1b3351140cc442a705cb2fad82", "parents": ["4915fb1ec791a6437d3bba28b882f4201be97102"], "files": [{"sha": "83130f043dad73d9163bea1f7326e0ca4bd3c0ce", "filename": "tasks/autoupdate-RedHat.yml", "previous_filename": null, "additions": 26, "deletions": 7, "changes": 33, "blob_url": "https://github.com/geerlingguy/ansible-role-security/blob/f3dd45a61b08de1b3351140cc442a705cb2fad82/tasks/autoupdate-RedHat.yml", "raw_url": "https://github.com/geerlingguy/ansible-role-security/raw/f3dd45a61b08de1b3351140cc442a705cb2fad82/tasks/autoupdate-RedHat.yml", "status": "modified", "patch": "@@ -1,13 +1,32 @@\n ---\n-- name: Install yum-cron.\n-  package: name=yum-cron state=present\n+- name: Set correct automatic update utility vars (RHEL 8).\n+  set_fact:\n+    update_utility: dnf-automatic\n+    update_conf_path: /etc/dnf/automatic.conf\n+  when: ansible_distribution_major_version | int == 8\n \n-- name: Ensure yum-cron is running and enabled on boot.\n-  service: name=yum-cron state=started enabled=yes\n+- name: Set correct automatic update utility vars (RHEL <= 7).\n+  set_fact:\n+    update_utility: yum-cron\n+    update_conf_path: /etc/yum/yum-cron.conf\n+  when: ansible_distribution_major_version | int <= 7\n \n-- name: Configure autoupdates (RHEL 7).\n+- name: Install automatic update utility.\n+  package:\n+    name: '{{ update_utility }}'\n+    state: present\n+\n+- name: Ensure automatic update utility is running and enabled on boot.\n+  service:\n+    name: '{{ update_utility }}'\n+    state: started\n+    enabled: true\n+\n+- name: Configure autoupdates.\n   lineinfile:\n-    dest: \"/etc/yum/yum-cron.conf\"\n+    dest: '{{ update_conf_path }}'\n     regexp: '^apply_updates = .+'\n     line: 'apply_updates = yes'\n-  when: security_autoupdate_enabled and ansible_distribution_major_version | int == 7\n+  when:\n+    - security_autoupdate_enabled\n+    - ansible_distribution_major_version | int in [7, 8]"}]}]